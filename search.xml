<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Spring Cloud ÊúçÂä°Á¨¨‰∏ÄÊ¨°ËØ∑Ê±ÇË∂ÖÊó∂ÁöÑ‰ºòÂåñ]]></title>
    <url>%2F2017%2F11%2F18%2Ffirst-timeout%2F</url>
    <content type="text"><![CDATA[1. ÈóÆÈ¢òËÉåÊôØ‰ΩøÁî®Spring CloudÁªÑ‰ª∂ÊûÑÂª∫ÁöÑÊúçÂä°ÈõÜÁæ§ÔºåÂú®Á¨¨‰∏ÄÊ¨°ËØ∑Ê±ÇÊó∂ÁªèÂ∏∏‰ºöÂá∫Áé∞timeoutÁöÑÊÉÖÂÜµÔºåÁÑ∂ËÄåÁ¨¨‰∫åÊ¨°Â∞±Ê≠£Â∏∏‰∫Ü„ÄÇSpring CloudÁâàÊú¨‰∏∫Dalston.SR4„ÄÇ ÂêØÂä®Ê∂âÂèäÂà∞ÁöÑÁõ∏ÂÖ≥ÊúçÂä°Ôºö gateway(zuulÁΩëÂÖ≥) auth-ServiceÔºàÈâ¥ÊùÉÊúçÂä°Ôºâ user-ServiceÔºàÁî®Êà∑ÊúçÂä°Ôºâ ÊµãËØïÁöÑÁ´ØÁÇπÊé•Âè£‰∏∫Ôºöhttp:/login/oauth/token„ÄÇÊúçÂä°‰πãÈó¥ÁöÑË∞ÉÁî®È°∫Â∫è‰∏∫Ôºögateway-&gt;auth-Service-&gt;user-Service„ÄÇÁΩëÂÖ≥Êî∂Âà∞ÂÆ¢Êà∑Á´ØÁöÑËØ∑Ê±ÇÔºåËΩ¨ÂèëËØ∑Ê±ÇÂà∞Èâ¥ÊùÉÊúçÂä°ÔºåÈâ¥ÊùÉÊúçÂä°ÂØπÁî®Êà∑Ë∫´‰ªΩÁöÑÊ†∏È™åÊòØÈÄöËøáË∞ÉÁî®Áî®Êà∑ÊúçÔºåÁî®Êà∑ÊúçÂä°ÁªôÈâ¥ÊùÉÊúçÂä°ËøîÂõûË∫´‰ªΩÊ†°È™åÁöÑÁªìÊûúÔºåÈâ¥ÊùÉÊúçÂä°Â∞ÜË∫´‰ªΩÊéàÊùÉ‰ø°ÊÅØËøîÂõûÁªôgatewayÔºågatewayÂ∞ÜÊúÄÁªàÁöÑÁªìÊûúresponseËøîÂõûÁªôÂÆ¢Êà∑Á´Ø„ÄÇ‰∏â‰∏™ÊúçÂä°ÂêØÂä®ÂêéÔºåÈÄöËøázipkinÁõëÊéßË∞ÉÁî®ÈìæË∑Ø‰ø°ÊÅØÔºåÂèØ‰ª•ÁúãÂà∞Á¨¨‰∏ÄÊ¨°ÂíåÁ¨¨‰∫åÊ¨°Ë∞ÉÁî®ÊÉÖÂÜµÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö ÈÄöËøá‰∏äÈù¢‰∏§Ê¨°ÁöÑÈìæË∑ØÁõëÊéß‰ø°ÊÅØÊà™ÂõæÔºåÂèØ‰ª•ÁúãÂà∞Á¨¨‰∏ÄÊ¨°ÁöÑËÄóÊó∂ÊòØÁ¨¨‰∫åÊ¨°ÁöÑ10Â§öÂÄç„ÄÇÈÅáÂà∞Êüê‰∫õÊÉÖÂÜµÔºåÂæàÂèØËÉΩ‰ºöÂá∫Áé∞Á¨¨‰∏ÄÊ¨°ËØ∑Ê±ÇÁöÑË∂ÖÊó∂„ÄÇÂéªÂÆòÁΩëÁúã‰∫Ü‰∏ãÔºå‰∏ªË¶ÅÂéüÂõ†ÊòØzuulÁΩëÂÖ≥ÂíåÂêÑ‰∏™Ë∞ÉÁî®ÊúçÂä°‰πãÈó¥ÁöÑRibbonËøõË°åÂÆ¢Êà∑Á´ØË¥üËΩΩÂùáË°°ÁöÑClientÊáíÂä†ËΩΩÔºåÂØºËá¥Á¨¨‰∏ÄÊ¨°ÁöÑËØ∑Ê±ÇË∞ÉÁî®ÂåÖÊã¨‰∫ÜÂàõÂª∫Ribbon ClientÁöÑÊó∂Èó¥„ÄÇÈÄöËøáÂêØÂä®Êó•Âøó‰ø°ÊÅØÂ∞±ÂèØ‰ª•ÂèëÁé∞Ôºö ‰∏ãÈù¢ÂàÜ‰∏§ÈÉ®ÂàÜËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºå‰∏ÄÊòØÊúçÂä°‰πãÈó¥Ë∞ÉÁî®RibbonÁöÑÈ••È•øÂä†ËΩΩÔºåÂØπÂ∫î‰∏äÈù¢ÁöÑÊµãËØï‰∏∫auth-ServiceË∞ÉÁî®user-ServiceÔºõ‰∫åÊòØzuulÁΩëÂÖ≥ÁöÑÈ••È•øÂä†ËΩΩ„ÄÇ 2. ribbonÁöÑÈ••È•øÂä†ËΩΩÁªèËøáË∞ÉÊü•ÂèëÁé∞ÔºåÈÄ†ÊàêÁ¨¨‰∏ÄÊ¨°auth-ServiceË∞ÉÁî®user-ServiceËÄóÊó∂ÈïøÁöÑÂéüÂõ†‰∏ªË¶ÅÊòØÔºåRibbonËøõË°åÂÆ¢Êà∑Á´ØË¥üËΩΩÂùáË°°ÁöÑÊúçÂä°ÂÆû‰æãÂπ∂‰∏çÊòØÂú®ÊúçÂä°ÂêØÂä®ÁöÑÊó∂ÂÄôÂ∞±ÂàùÂßãÂåñÂ•ΩÁöÑÔºåËÄåÊòØÂú®Ë∞ÉÁî®ÁöÑÊó∂ÂÄôÊâç‰ºöÂéªÂàõÂª∫Áõ∏Â∫îÁöÑÊúçÂä°ÂÆû‰æã„ÄÇÊâÄ‰ª•Á¨¨‰∏ÄÊ¨°Ë∞ÉÁî®user-ServiceËÄóÊó∂‰∏ç‰ªÖ‰ªÖÂåÖÂê´ÂèëÈÄÅHTTPËØ∑Ê±ÇÁöÑÊó∂Èó¥ÔºåËøòÂåÖÂê´‰∫ÜÂàõÂª∫Ribbon ClientÁöÑÊó∂Èó¥ÔºåËøôÊ†∑‰∏ÄÊù•Â¶ÇÊûúÂàõÂª∫Êó∂Èó¥ÈÄüÂ∫¶ËæÉÊÖ¢ÔºåÂêåÊó∂ËÆæÁΩÆÁöÑËØ∑Ê±ÇË∂ÖÊó∂ÂèàÊØîËæÉÁü≠ÁöÑËØùÔºåÂæàÂÆπÊòìÂ∞±‰ºöÂá∫Áé∞ËÄóÊó∂ÂæàÈïøÁîöËá≥Ë∂ÖÊó∂ÁöÑÊÉÖÂÜµ„ÄÇÂú®ÂÆòÁΩëÂèØ‰ª•ÁúãÂà∞Â¶Ç‰∏ãÁöÑÈÖçÁΩÆËØ¥ÊòéÔºö Each Ribbon named client has a corresponding child Application Context that Spring Cloud maintains, this application context is lazily loaded up on the first request to the named client. This lazy loading behavior can be changed to instead eagerly load up these child Application contexts at startup by specifying the names of the Ribbon clients. ÊÑè‰∏∫Spring Cloud‰∏∫ÊØè‰∏™RibbonÂÆ¢Êà∑Á´ØÁª¥Êä§‰∫Ü‰∏Ä‰∏™Áõ∏ÂØπÁöÑÂ≠êÂ∫îÁî®ÁéØÂ¢ÉÁöÑ‰∏ä‰∏ãÊñáÔºåÂ∫îÁî®ÁöÑ‰∏ä‰∏ãÊñáÂú®Á¨¨‰∏ÄÊ¨°ËØ∑Ê±ÇÂà∞ÊåáÂÆöÂÆ¢Êà∑Á´ØÁöÑÊó∂ÂÄôÊáíÂä†ËΩΩ„ÄÇ‰∏çËøáÂèØ‰ª•ÈÄöËøáÂ¶Ç‰∏ãÈÖçÁΩÆËøõË°å‰øÆÊîπÔºö 1234ribbon: eager-load: enabled: true clients: client1, client2, client3 ÊåâÁÖßÂ¶Ç‰∏äÁöÑÈÖçÁΩÆ‰πãÂêéÔºåÂèëÁé∞Èâ¥ÊùÉÊúçÂä°ÂêØÂä®Êó∂Â∞±Â∞ÜuserÊúçÂä°ÁöÑRibbonÂÆ¢Êà∑Á´ØËøõË°å‰∫ÜÂä†ËΩΩ„ÄÇ 3. zuulÁΩëÂÖ≥ÁöÑÈ••È•øÂä†ËΩΩ‰∏äÈù¢Â∞èËäÇËß£ÂÜ≥‰∫Üauth-ServiceË∞ÉÁî®user-ServiceÁöÑRibbonÂÆ¢Êà∑Á´ØÂêØÂä®Êó∂È••È•øÂä†ËΩΩ„ÄÇÁΩëÂÖ≥‰Ωú‰∏∫ÂØπÂ§ñËØ∑Ê±ÇÁöÑÂÖ•Âè£ÔºåzuulÂÜÖÈÉ®‰ΩøÁî®RibbonË∞ÉÁî®ÂÖ∂‰ªñÊúçÂä°ÔºåSpring CloudÈªòËÆ§Âú®Á¨¨‰∏ÄÊ¨°Ë∞ÉÁî®Êó∂ÊáíÂä†ËΩΩRibbonÂÆ¢Êà∑Á´Ø„ÄÇzuulÂêåÊ†∑ÈúÄË¶ÅÁª¥Êä§‰∏Ä‰∏™Áõ∏ÂØπÁöÑÂ≠êÂ∫îÁî®ÁéØÂ¢ÉÁöÑ‰∏ä‰∏ãÊñáÔºåÊâÄ‰ª•‰πüÈúÄË¶ÅÂêØÂä®Êó∂È••È•øÂä†ËΩΩ„ÄÇ Zuul internally uses Ribbon for calling the remote url‚Äôs and Ribbon clients are by default lazily loaded up by Spring Cloud on first call. This behavior can be changed for Zuul using the following configuration and will result in the child Ribbon related Application contexts being eagerly loaded up at application startup time. ÂÖ∑‰ΩìÈÖçÁΩÆÂ¶Ç‰∏ãÔºö 1234zuul: ribbon: eager-load: enabled: true Ëá≥Ê≠§Ôºå‰ºòÂåñÂÆåÊàêÔºåÂÜçÊ¨°ÈáçÂêØÊúçÂä°ËøõË°åÁ¨¨‰∏ÄÊ¨°ËØ∑Ê±ÇÔºåÂèëÁé∞ÊÉÖÂÜµÂ∑≤ÁªèÂ•ΩÂ§ö‰∫ÜÔºåÂ§ßÂÆ∂ÂèØ‰ª•Ëá™Â∑±Âä®ÊâãÂ∞ùËØïÊîπËøõ‰∏Ä‰∏ã„ÄÇ 4. ÊÄªÁªìÊú¨Êñá‰∏ªË¶Å‰ªãÁªç‰∫ÜSpring CloudÁöÑÊúçÂä°Á¨¨‰∏ÄÊ¨°ËØ∑Ê±ÇË∂ÖÊó∂ÁöÑ‰ºòÂåñÊñπÊ≥ï„ÄÇÈ¶ñÂÖà‰ªãÁªç‰∫ÜÈóÆÈ¢òÁöÑËÉåÊôØÔºåÂπ∂ÊéíÊü•‰∫ÜÈóÆÈ¢òÈÄ†ÊàêÁöÑÂéüÂõ†Ôºå‰∏ªË¶ÅÊòØRibbonÂÆ¢Êà∑Á´ØÁöÑÊáíÂä†ËΩΩÔºõÁÑ∂ÂêéÂàÜÂà´ÈíàÂØπzuulÁΩëÂÖ≥ÂíåÊúçÂä°‰πãÈó¥Ë∞ÉÁî®ÁöÑRibbonÂÆ¢Êà∑Á´ØËøõË°åÈÖçÁΩÆÔºå‰ΩøÂÖ∂ÂêØÂä®Êó∂‰æøÂä†ËΩΩRibbonÂÆ¢Êà∑Á´ØÁöÑÁõ∏ÂÖ≥‰∏ä‰∏ãÊñá‰ø°ÊÅØ„ÄÇÊúÄÂêéÊÉ≥ËØ¥ÁöÑÊòØÔºåhttpË∞ÉÁî®ÊØïÁ´üËøòÊòØÊÄßËÉΩËøú‰Ωé‰∫éRPC„ÄÇ„ÄÇüôÇ ÂèÇËÄÉ spring-cloud Dalston.SR4 Spring CloudÂÆûÊàòÂ∞èË¥¥Â£´ÔºöRibbonÁöÑÈ••È•øÂä†ËΩΩ(eager-load)Ê®°Âºè]]></content>
      <categories>
        <category>ÂæÆÊúçÂä°</category>
      </categories>
      <tags>
        <tag>Spring Cloud</tag>
        <tag>Ribbon</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÂæÆÊúçÂä°‰πãÈÖçÁΩÆÊúçÂä°Âô®ÂàáÊç¢profile]]></title>
    <url>%2F2017%2F11%2F16%2Fprofile%2F</url>
    <content type="text"><![CDATA[ÊúÄËøëÈÅáÂà∞Spring-bootÁöÑÂ§ö‰∏™profileÂàáÊç¢ÈóÆÈ¢òÔºåÈúÄÊ±ÇÊòØËøôÊ†∑ÁöÑÔºöÂæÆÊúçÂä°‰∏≠ÂºïÂÖ•‰∫ÜSpring Cloud ConfigÔºåÊúçÂä°ÂêØÂä®ÁöÑÊó∂ÂÄôÔºå‰ªéConfig Server‰∏≠ËØªÂèñËØ•ÂÆû‰æãÂØπÂ∫îÁöÑÈÖçÁΩÆ‰ø°ÊÅØ„ÄÇÊú¨Âú∞ÂºÄÂèëÁéØÂ¢ÉÂèØËÉΩ‰ΩøÁî®ÁöÑprofileÊòØdefaultÔºåÂà∞‰∫ÜÈõÜÊàêÊµãËØïÁéØÂ¢ÉÂ∞±ÈúÄË¶ÅÂàáÊç¢Âà∞jenkinsÔºåÂà∞‰∫ÜÈ¢ÑÂèëÂ∏ÉÁéØÂ¢ÉÂèàÂèòÊàê‰∫Üprod„ÄÇÂ§ö‰∏™profileÈúÄË¶Å‰πãÈó¥ÂèØ‰ª•ÂàáÊç¢„ÄÇ ËøôËæπËÆæÁΩÆÁöÑÊó∂ÂÄôËøòËµ∞‰∫ÜÁÇπÂºØË∑ØÔºåÂÖàÊòØÊé¢Á¥¢‰∫Ü‰∏ÄÈÅçpomÁöÑprofileÔºåÂêéÊù•ÊâçÂà∞Spring-bootÁöÑÈÖçÁΩÆÊñá‰ª∂„ÄÇ Ëøô‰∏§ÈÉ®ÂàÜÂÆûÁé∞ÁöÑÂäüËÉΩ‰∏çÂ§™‰∏ÄÊ†∑ÔºåÊú¨ÊñáÂ∞Ü‰ºöÂÖ∑‰ΩìËÆ≤‰∏ãËøô‰∏§ÈÉ®ÂàÜ„ÄÇ 1. profile‰πãMaven mavenÂàáÊç¢profileÁöÑÂëΩ‰ª§ÂæàÁÆÄÂçïÔºåÂä†‰∏ä-PÂèÇÊï∞ÊåáÂÆö‰Ω†ÁöÑprofileÔºåÂ¶ÇÊåáÂÆöprodÔºö 1mvn clean package -P prod maven‰ΩøÁî®ÂêçÂ≠ó‰∏∫prodÁöÑprofileÊù•ÊâìÂåÖÔºåÂç≥ÊâÄÊúâÁöÑÈÖçÁΩÆÊñá‰ª∂ÈÉΩ‰ΩøÁî®Áîü‰∫ßÁéØÂ¢É„ÄÇ ‰∏ãÈù¢Áúã‰∏ãpom‰∏≠ÁöÑprofilesÔºö 12345678910111213141516171819202122232425262728293031 &lt;profiles&gt; &lt;profile&gt; &lt;id&gt;dev&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;/activation&gt; &lt;properties&gt; &lt;profileActive&gt;dev&lt;/profileActive&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/profile&gt; &lt;profile&gt; &lt;id&gt;prod&lt;/id&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-undertow&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;properties&gt; &lt;profileActive&gt;prod&lt;/profileActive&gt; &lt;/properties&gt; &lt;/profile&gt;&lt;/profiles&gt; ÂØπ‰∫éresourcesÁöÑÈÖçÁΩÆÂ¶Ç‰∏ãÔºö 12345678910111213141516171819202122 &lt;build&gt; &lt;resources&gt; &lt;resource&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;filtering&gt;true&lt;/filtering&gt; &lt;!-- ËøáÊª§ÊéâÊâÄÊúâÈÖçÁΩÆÊñá‰ª∂--&gt; &lt;excludes&gt; &lt;exclude&gt;application-dev.yml&lt;/exclude&gt; &lt;exclude&gt;application-prod.yml&lt;/exclude&gt; &lt;/excludes&gt; &lt;/resource&gt; &lt;resource&gt; &lt;filtering&gt;true&lt;/filtering&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;!--Ê†πÊçÆprofile‰∏≠ÁöÑÂèòÈáèprofileActiveÊåáÂÆöÂØπÂ∫îÁöÑÈÖçÁΩÆÊñá‰ª∂--&gt; &lt;includes&gt; &lt;include&gt;application-$&#123;profileActive&#125;.yml&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt; &lt;/resources&gt; &lt;/build&gt; ‰∏äÈù¢ÁöÑ‰∏§ÊÆµpomÈÖçÁΩÆÁõ∏ÁªìÂêàÔºåÂΩìÊåáÂÆöprofile‰∏∫prodÊó∂ÔºåÁéØÂ¢ÉÂèòÈáèprofileActiveÁöÑÂ±ûÊÄßÂÄºÂèò‰∏∫prod„ÄÇÊåáÂÆöÊâìÂåÖÊó∂ÔºåÂåÖÂê´application-prod.yml„ÄÇ ÊâÄ‰ª•ÂΩì‰Ω†ÊúâÂ§öÂ•óÈÖçÁΩÆÊñá‰ª∂ÔºåÂèØ‰ª•Âä®ÊÄÅÊ†πÊçÆmvnÂëΩ‰ª§ÁöÑÂèÇÊï∞-PÂä®ÊÄÅÊåáÂÆö‰Ω†ÊâÄÈúÄË¶ÅÂä†ËΩΩÁöÑÈÖçÁΩÆÊñá‰ª∂„ÄÇ 2. profile‰πãSpring bootProfileÊòØSpring bootÁî®Êù•ÈíàÂØπ‰∏çÂêåÁéØÂ¢ÉÂØπ‰∏çÂêåÈÖçÁΩÆÊèê‰æõÊîØÊåÅÁöÑ,ÂÖ®Â±ÄProfileÈÖçÁΩÆ‰ΩøÁî®„ÄÇapplication-{profile}.yml Â¶Ç:application-yml„ÄÇ springÈÄöËøáÈÖçÁΩÆspring.profiles.activeÊåáÂÆöÊøÄÊ¥ªÊüê‰∏™ÂÖ∑‰ΩìÁöÑprofile„ÄÇÈô§‰∫Üspring.profiles.activeÊù•ÊøÄÊ¥ª‰∏Ä‰∏™ÊàñËÄÖÂ§ö‰∏™profile‰πãÂ§ñÔºåËøòÂèØ‰ª•Áî®spring.profiles.includeÊù•Âè†Âä†profile„ÄÇ 1spring.profiles.include: prod,dev ‰∏ãÈù¢Áúã‰∏Ä‰∏ãÊàë‰ª¨ÁöÑapplication.yml‰∏≠ÂåÖÂê´ÁöÑÈÖçÁΩÆÔºö 1234567891011121314151617181920212223spring: profiles: active: dev---#ÂºÄÂèëÁéØÂ¢ÉÈÖçÁΩÆspring: profiles: devserver: port: 8080---#ÊµãËØïÁéØÂ¢ÉÈÖçÁΩÆspring: profiles: testserver: port: 8081---#Áîü‰∫ßÁéØÂ¢ÉÈÖçÁΩÆspring: profiles: prodserver: port: 8082 application.ymlÊñá‰ª∂ÂàÜ‰∏∫ÂõõÈÉ®ÂàÜÔºå‰ΩøÁî®‰∏ÄÁªÑ(‚Äî)Êù•‰Ωú‰∏∫ÂàÜÈöîÁ¨¶„ÄÇÁ¨¨‰∏ÄÈÉ®ÂàÜÔºåÈÄöÁî®ÈÖçÁΩÆÈÉ®ÂàÜÔºåË°®Á§∫‰∏â‰∏™ÁéØÂ¢ÉÈÉΩÈÄöÁî®ÁöÑÂ±ûÊÄßÔºåÈªòËÆ§ÊøÄÊ¥ª‰∫ÜdevÁöÑprofileÔºõÂêéÈù¢‰∏âÈÉ®ÂàÜÂàÜÂà´Ë°®Á§∫‰∏çÂêåÁöÑÁéØÂ¢ÉÔºåÊåáÂÆö‰∫Ü‰∏çÂêåÁöÑport„ÄÇ ÈÉ®ÁΩ≤Âà∞ÊúçÂä°Âô®ÁöÑËØùÔºåÊ≠£Â∏∏‰ºöÊâìÊàêjarÂåÖÔºåÂä†‰∏äÂèÇÊï∞--spring.profiles.active=testÊåáÂÆöÂä†ËΩΩÂì™‰∏™ÁéØÂ¢ÉÁöÑÈÖçÁΩÆ„ÄÇ Âú®IDE‰∏≠‰πüÂèØ‰ª•Áõ¥Êé•ÈÖçÁΩÆÊøÄÊ¥ªÁöÑprofile„ÄÇ 3. config serverÁöÑÈÖçÁΩÆËøôËäÇËÆ≤‰∏ã‰∏éSpring cloud configÁöÑÁªìÂêà‰ΩøÁî®„ÄÇÊó¢ÁÑ∂‰ΩøÁî®‰∫Üconfig serverÔºåÂä®ÊÄÅÈÖçÁΩÆËøôÂùóÂü∫Êú¨Â∞±Áî±ÈÖçÁΩÆÊúçÂä°Âô®ÂÆåÊàê‰∫Ü„ÄÇÈÖçÁΩÆÊúçÂä°Âô®‰∏≠ÂØπËØ•ÊúçÂä°ÊåáÂÆöÂ§ö‰∏™profile„ÄÇconfig Server‰∏≠ÁöÑÈÖçÁΩÆ‰ºòÂÖà‰∫éÊú¨Âú∞ÈÖçÁΩÆÔºåÂΩìÊúçÂä°ÂêØÂä®Êó∂ÔºåÊ†πÊçÆÊøÄÊ¥ªÁöÑprofileÔºåÂéªÈÖçÁΩÆÊúçÂä°Âô®ÊãâÂèñÂÖ∂ÂØπÂ∫îÁöÑÈÖçÁΩÆ„ÄÇ Êó¢ÁÑ∂Áü•ÈÅì‰∫Ü‰∏äÈù¢ÁöÑ‰∏ªË¶ÅÊµÅÁ®ãÔºåÂ∞±ÂèØ‰ª•ÊòéÁôΩÊàë‰ª¨ÁöÑÈúÄÊ±ÇÂÖ∂ÂÆûÊòØË¶ÅÂú®ÊúçÂä°ÂêØÂä®Êó∂ÊåáÂÆöÊøÄÊ¥ªÁöÑprofile„ÄÇÊâÄ‰ª•‰∏äÈù¢‰∏ÄËäÇÂÖ≥‰∫éSpring bootÁöÑprofileÂä®ÊÄÅÈÖçÁΩÆÔºåÊàë‰ª¨ÁöÑÈóÆÈ¢òÂ∞±ËÉΩËß£ÂÜ≥‰∫Ü„ÄÇ‰ΩÜ‰∏äÈù¢ËÆ≤Âà∞ÁöÑÊòØjarÂåÖÂêØÂä®Êó∂ÊåáÂÆö--spring.profiles.activeÔºåÂÆûÈôÖÈÉΩÊòØÂæÆÊúçÂä°ÁöÑÂÆπÂô®ÂåñÈÉ®ÁΩ≤ÔºåÊúçÂä°ÈÄöËøáÂÆπÂô®Áõ¥Êé•ÂêØÂä®jarÂåÖÔºåËøôÊ†∑Â∞±ÈúÄË¶ÅÂÆπÂô®ÂêØÂä®ÁöÑÊó∂ÂÄôËÉΩÂ§üÂä®ÊÄÅÊåáÂÆöactive profileÔºåÊâÄ‰ª•‰∏äÈù¢ÁöÑÈÖçÁΩÆÊîπ‰∏Ä‰∏ãÔºåÂ¶Ç‰∏ãÔºö 123spring: profiles: active: $&#123;ACTIVE_PROFILE:dev&#125; ‰ªéÂÆπÂô®ÁöÑÂêØÂä®Êà™ÂõæÊù•ÁúãÔºåÊåáÂÆö‰∫Üdocker run -d -e ACTIVE_PROFILE=exp ...ÂêéÔºåactive profile ÂèòÂë≥‰∫ÜexpÔºåÂπ∂‰∏î‰ªéconfig server‰∏≠ÊãâÂèñÂØπÂ∫îÁöÑÊòØgatewayserverÁöÑexpÈÖçÁΩÆ„ÄÇ 4. ÊÄªÁªìÊú¨Êñá‰∏ªË¶ÅÂÜô‰∫ÜSpring-bootÈÖçÁΩÆÊúçÂä°Âô®ÂàáÊç¢profile„ÄÇÈ¶ñÂÖàÊèèËø∞‰∫ÜÈúÄÊ±ÇËÉåÊôØÔºåÁÑ∂ÂêéÊòØÂØπmaven pom‰∏≠profileËøõË°å‰∫ÜÊé¢Á¥¢‰∏éËÆ≤Ëß£ÔºåÂÖ∂Ê¨°ÊòØËÆ≤Ëß£‰∫ÜSpring-boot‰∏≠ÁöÑprofileÂàáÊç¢ÔºåÊúÄÂêéÁªìÂêàconfig serverÂÆûÁé∞ÂÆπÂô®ÈÉ®ÁΩ≤ÂæÆÊúçÂä°ÁöÑprofile„ÄÇÁ¨îËÄÖÊúÄÂºÄÂßã‰∏ÄÁõ¥ËÆ§‰∏∫ÈÄöËøápomÁöÑprofileÂàáÊç¢Â∞±ÂèØ‰ª•ËÆæÁΩÆÊúçÂä°ÂêØÂä®ÁöÑprofileÔºåÁªèËøá‰∏ÄÁï™Êé¢Á¥¢ÔºåÂèëÁé∞‰∏éÈÖçÁΩÆÊúçÂä°Âô®ÁªìÂêàÂ•ΩÂÉèÂπ∂‰∏çÈúÄË¶ÅpomÁöÑprofileËøô‰πàÁπÅÁêêÔºåÁªìÂêàÈÖçÁΩÆÊúçÂä°Âô®ÂèØ‰ª•Êõ¥Êñπ‰æøÁöÑ‰ΩøÁî®Spring bootÁöÑprofile„ÄÇ ÂèÇËÄÉ ËØ¶Ëß£Spring Boot Profiles ÈÖçÁΩÆÂíå‰ΩøÁî® [Spring Boot Á≥ªÂàó] ÈõÜÊàêmavenÂíåSpring bootÁöÑprofileÂäüËÉΩ]]></content>
      <categories>
        <category>Ops</category>
      </categories>
      <tags>
        <tag>Spring Boot</tag>
        <tag>Docker</tag>
        <tag>Ops</tag>
        <tag>Maven</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÂæÆÊúçÂä°ÁΩëÂÖ≥netflix-zuul]]></title>
    <url>%2F2017%2F11%2F13%2Fgateway%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÔºöÂâçÈù¢‰∏Ä‰∏™Á≥ªÂàóÊñáÁ´†‰ªãÁªç‰∫ÜËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞ ÔºåÂ•ΩÂ§öÂêåÂ≠¶ËØ¢ÈóÆÊúâÊ≤°ÊúâÂÆåÊï¥ÁöÑdemoÈ°πÁõÆÔºåÁ¨îËÄÖÂõûÁ≠îËÇØÂÆöÊúâÁöÑ„ÄÇÁî±‰∫é‰πãÂâçÁ≥ªÂàóÊñáÁ´†‰æßÈáçËÆ≤Ëß£‰∫ÜÊùÉÈôêÂâçÁΩÆÔºåÊâÄ‰ª•ËøëÊúüË°•‰∏äÂÆåÊï¥ÁöÑÂêéÁΩÆÈ°πÁõÆÔºå‰ΩÜÊòØËøôÊúÄÂ•ΩÊúâ‰∏Ä‰∏™ÂÆåÊï¥ÁöÑÂæÆÊúçÂä°Ë∞ÉÁî®„ÄÇÊú¨Êñá‰∏ªË¶ÅËÆ≤‰∏ãAPIÁΩëÂÖ≥ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞„ÄÇnetflix-zuulÊòØÁî±netflixÂºÄÊ∫êÁöÑAPIÁΩëÂÖ≥ÔºåÂú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏ãÔºåÁΩëÂÖ≥‰Ωú‰∏∫ÂØπÂ§ñÁöÑÈó®Êà∑ÔºåÂÆûÁé∞Âä®ÊÄÅË∑ØÁî±„ÄÅÁõëÊéß„ÄÅÊéàÊùÉ„ÄÅÂÆâÂÖ®„ÄÅË∞ÉÂ∫¶Á≠âÂäüËÉΩ„ÄÇ 1. ÁΩëÂÖ≥‰ªãÁªçÂΩì‰ΩøÁî®Âçï‰ΩìÂ∫îÁî®Á®ãÂ∫èÊû∂ÊûÑÊó∂ÔºåÂÆ¢Êà∑Á´ØÔºàwebÂíåÁßªÂä®Á´ØÔºâÈÄöËøáÂêëÂêéÁ´ØÂ∫îÁî®Á®ãÂ∫èÂèëËµ∑‰∏ÄÊ¨°RESTË∞ÉÁî®Êù•Ëé∑ÂèñÊï∞ÊçÆ„ÄÇË¥üËΩΩÂùáË°°Âô®Â∞ÜËØ∑Ê±ÇË∑ØÁî±ÁªôN‰∏™Áõ∏ÂêåÁöÑÂ∫îÁî®Á®ãÂ∫èÂÆû‰æã‰∏≠ÁöÑ‰∏Ä‰∏™„ÄÇÁÑ∂ÂêéÂ∫îÁî®Á®ãÂ∫è‰ºöÊü•ËØ¢ÂêÑÁßçÊï∞ÊçÆÂ∫ìË°®ÔºåÂπ∂Â∞ÜÂìçÂ∫îËøîÂõûÁªôÂÆ¢Êà∑Á´Ø„ÄÇÂæÆÊúçÂä°Êû∂ÊûÑ‰∏ãÔºåÂçï‰ΩìÂ∫îÁî®Ë¢´ÂàáÂâ≤ÊàêÂ§ö‰∏™ÂæÆÊúçÂä°ÔºåÂ¶ÇÊûúÂ∞ÜÊâÄÊúâÁöÑÂæÆÊúçÂä°Áõ¥Êé•ÂØπÂ§ñÊö¥Èú≤ÔºåÂäøÂøÖ‰ºöÂá∫Áé∞ÂÆâÂÖ®ÊñπÈù¢ÁöÑÂêÑÁßçÈóÆÈ¢ò„ÄÇÂÆ¢Êà∑Á´ØÂèØ‰ª•Áõ¥Êé•ÂêëÊØè‰∏™ÂæÆÊúçÂä°ÂèëÈÄÅËØ∑Ê±ÇÔºåÂÖ∂ÈóÆÈ¢ò‰∏ªË¶ÅÂ¶Ç‰∏ãÔºö ÂÆ¢Êà∑Á´ØÈúÄÊ±ÇÂíåÊØè‰∏™ÂæÆÊúçÂä°Êö¥Èú≤ÁöÑÁªÜÁ≤íÂ∫¶API‰∏çÂåπÈÖç„ÄÇ ÈÉ®ÂàÜÊúçÂä°‰ΩøÁî®ÁöÑÂçèËÆÆ‰∏çÊòØWebÂèãÂ•ΩÂçèËÆÆ„ÄÇÂèØËÉΩ‰ΩøÁî®Thrift‰∫åËøõÂà∂RPCÔºå‰πüÂèØËÉΩ‰ΩøÁî®AMQPÊ∂àÊÅØ‰º†ÈÄíÂçèËÆÆ„ÄÇ ÂæÆÊúçÂä°Èöæ‰ª•ÈáçÊûÑ„ÄÇÂ¶ÇÊûúÂêàÂπ∂‰∏§‰∏™ÊúçÂä°ÔºåÊàñËÄÖÂ∞Ü‰∏Ä‰∏™ÊúçÂä°ÊãÜÂàÜÊàê‰∏§‰∏™ÊàñÊõ¥Â§öÊúçÂä°ÔºåËøôÁ±ªÈáçÊûÑÂ∞±ÈùûÂ∏∏Âõ∞Èöæ‰∫Ü„ÄÇ Â¶Ç‰∏äÈóÆÈ¢òÔºåËß£ÂÜ≥ÁöÑÊñπÊ≥ïÊòØ‰ΩøÁî®APIÁΩëÂÖ≥„ÄÇAPIÁΩëÂÖ≥ÊòØ‰∏Ä‰∏™ÊúçÂä°ÔºåÊòØÁ≥ªÁªüÁöÑÂîØ‰∏ÄÂÖ•Âè£„ÄÇ‰ªéÈù¢ÂêëÂØπË±°ËÆæËÆ°ÁöÑËßíÂ∫¶ÁúãÔºåÂÆÉ‰∏éÂ§ñËßÇÊ®°ÂºèÁ±ª‰ºº„ÄÇAPIÁΩëÂÖ≥Â∞ÅË£Ö‰∫ÜÁ≥ªÁªüÂÜÖÈÉ®Êû∂ÊûÑÔºå‰∏∫ÊØè‰∏™ÂÆ¢Êà∑Á´ØÊèê‰æõ‰∏Ä‰∏™ÂÆöÂà∂ÁöÑAPI„ÄÇÂÆÉÂèØËÉΩËøòÂÖ∑ÊúâÂÖ∂ÂÆÉËÅåË¥£ÔºåÂ¶ÇË∫´‰ªΩÈ™åËØÅ„ÄÅÁõëÊéß„ÄÅË¥üËΩΩÂùáË°°„ÄÅÈôêÊµÅ„ÄÅÈôçÁ∫ß‰∏éÂ∫îÁî®Ê£ÄÊµã„ÄÇ 2. zuulÁΩëÂÖ≥API GatewayÔºåÂ∏∏ËßÅÁöÑÈÄâÂûãÊúâÂü∫‰∫é Openresty ÁöÑ KongÂíåÂü∫‰∫é JVM ÁöÑ ZuulÔºåÂÖ∂‰ªñËøòÊúâÂü∫‰∫éGoÁöÑTyk„ÄÇÊäÄÊúØÈÄâÂûã‰∏äÔºå‰πãÂâçÁ®çÂæÆË∞ÉÁ†î‰∫ÜKongÔºåÊÄßËÉΩËøòÂèØ‰ª•„ÄÇËÄÉËôëÂà∞Âø´ÈÄüÂ∫îÁî®Âíå‰∫åÊ¨°ÂºÄÂèëÔºånetflix-zuul‰πüÂú®Spring CloudÁöÑÂÖ®ÂÆ∂Ê°∂‰∏≠ÔºåÂíåÂÖ∂‰ªñÁªÑ‰ª∂ÈÖçÂêà‰ΩøÁî®ËøòÊå∫Êñπ‰æøÔºåÂêéÊúüÂèØËÉΩËøò‰ºöÂØπÁΩëÂÖ≥ÁöÑÂäüËÉΩËøõË°åÊâ©Â¢ûÔºåÊúÄÂêéÈÄâ‰∫ÜZuul„ÄÇ 2.1 pomÈÖçÁΩÆ123456789101112&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-zuul&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; Âú®Spring CloudÁöÑÈ°πÁõÆ‰∏≠ÔºåÂºïÂÖ•zuulÁöÑstarterÔºåconsul-discoveryÊòØ‰∏∫‰∫ÜÊúçÂä°ÁöÑÂä®ÊÄÅË∑ØÁî±ÔºåËøôËæπÊ≤°ÊúâÁî®eurekaÔºåÊòØÈÄöËøáÊ≥®ÂÜåÂà∞consul‰∏äÁöÑÊúçÂä°ÂÆû‰æãËøõË°åË∑ØÁî±„ÄÇ 2.2 ÂÖ•Âè£Á±ª12345678@SpringBootApplication@EnableZuulProxypublic class GatewayApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(GatewayApplication.class, args); &#125;&#125; Spring bootÁöÑÂÖ•Âè£Á±ªÈúÄË¶ÅÂä†‰∏ä@EnableZuulProxyÔºå‰∏ãÈù¢Áúã‰∏ãËøô‰∏™Ê≥®Ëß£„ÄÇ 1234567@EnableCircuitBreaker@EnableDiscoveryClient@Target(&#123;ElementType.TYPE&#125;)@Retention(RetentionPolicy.RUNTIME)@Import(&#123;ZuulProxyConfiguration.class&#125;)public @interface EnableZuulProxy &#123;&#125; ÂèØ‰ª•ÁúãÂà∞ËØ•Ê≥®Ëß£ËøòÂåÖÂê´‰∫Ü@EnableCircuitBreaker Âíå @EnableDiscoveryClient„ÄÇ@EnableDiscoveryClientÊ≥®Ëß£Âú®ÊúçÂä°ÂêØÂä®ÁöÑÊó∂ÂÄôÔºåÂèØ‰ª•Ëß¶ÂèëÊúçÂä°Ê≥®ÂÜåÁöÑËøáÁ®ãÔºåÂêëÈÖçÁΩÆÊñá‰ª∂‰∏≠ÊåáÂÆöÁöÑÊúçÂä°Ê≥®ÂÜå‰∏≠ÂøÉÔºõ@EnableCircuitBreakerÂàôÂºÄÂêØ‰∫ÜHystrixÁöÑÊñ≠Ë∑ØÂô®„ÄÇ 2.3 bootstrap.yml12345678910111213141516171819202122232425262728293031323334server: port: 10101 #spring configspring: application: name: gateway-server cloud: consul: discovery: preferIpAddress: true enabled: true register: true service-name: api-getway ip-address: localhost port: $&#123;server.port&#125; lifecycle: enabled: true scheme: http prefer-agent-address: false host: localhost port: 8500#zuul config and routeszuul: host: maxTotalConnections: 500 maxPerRouteConnections: 50 routes: user: path: /user/** ignoredPatterns: /consul serviceId: user sensitiveHeaders: Cookie,Set-Cookie ÈÖçÁΩÆ‰∏ªË¶ÅÂåÖÊã¨‰∏âÂùóÔºåÊúçÂä°Á´ØÂè£ÔºåSpring CloudÊúçÂä°Ê≥®ÂÜåÔºåÊúÄÂêéÊòØzuulÁöÑË∑ØÁî±ÈÖçÁΩÆ„ÄÇ ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåZuulÂú®ËØ∑Ê±ÇË∑ØÁî±Êó∂Ôºå‰ºöËøáÊª§HTTPËØ∑Ê±ÇÂ§¥‰ø°ÊÅØ‰∏≠ÁöÑ‰∏Ä‰∫õÊïèÊÑü‰ø°ÊÅØÔºåÈªòËÆ§ÁöÑÊïèÊÑüÂ§¥‰ø°ÊÅØÈÄöËøázuul.sensitiveHeadersÂÆö‰πâÔºåÂåÖÊã¨Cookie„ÄÅSet-Cookie„ÄÅAuthorization„ÄÇ zuul.host.maxTotalConnectionsÈÖçÁΩÆ‰∫ÜÊØè‰∏™ÊúçÂä°ÁöÑhttpÂÆ¢Êà∑Á´ØËøûÊé•Ê±†ÊúÄÂ§ßËøûÊé•ÔºåÈªòËÆ§ÂÄºÊòØ200„ÄÇmaxPerRouteConnectionsÊØè‰∏™routeÂèØÁî®ÁöÑÊúÄÂ§ßËøûÊé•Êï∞ÔºåÈªòËÆ§ÂÄºÊòØ20„ÄÇ 2.3 ÊîØÊåÅhttps‰∏äÁ∫øÁöÑÈ°πÁõÆ‰∏ÄËà¨ÂüüÂêçÈÉΩ‰ºöÊîπ‰∏∫httpsÂçèËÆÆÔºåÈ°∫ÊâãÂÜô‰∏ãhttpsÁöÑÈÖçÁΩÆ„ÄÇ È¶ñÂÖàÁî≥ËØ∑httpsÁöÑÊï∞Â≠óËØÅ‰π¶Âú®ÈòøÈáå‰∫ëÁîüÊàêÁöÑÈíàÂØπtomcatÊúçÂä°Âô®CAËØÅ‰π¶Âú®Áî≥ËØ∑ÊàêÂäüÂêéÔºå ‰∏ãËΩΩÁõ∏Â∫îÁöÑtomcatËØÅ‰π¶Êñá‰ª∂„ÄÇ ÂåÖÂê´Â¶Ç‰∏ãÔºö1): .pfx‰∏∫keystoreÊñá‰ª∂ÔºåÊúçÂä°Âô®Áî®ÁöÑÂ∞±ÊòØËøô‰∏™Êñá‰ª∂2): pfx-password.txtÈáåÂåÖÂê´ÊúâkeystoreÊâÄÁî®Âà∞ÁöÑÂØÜÁ†Å3): .keyÈáåÈù¢ÂåÖÂê´ÁöÑÊòØÁßÅÈí•ÔºåÊöÇÊó∂Ê≤°Áî®Âà∞Ê≠§Êñá‰ª∂4): *.pemÈáåÈù¢ÂåÖÂê´ÁöÑÊòØÂÖ¨Èí•Ôºå‰∏ªË¶ÅÁªôÂÆ¢Êà∑Á´Ø bootstrap.ymlÂ¢ûÂä†Â¶Ç‰∏ãÈÖçÁΩÆ 123456789# httpsserver: port: 5443 http: 10101 ssl: enabled: true key-store: classpath:214329585620980.pfx key-store-password: password keyStoreType: PKCS12 ÂêåÊó∂ÊîØÊåÅhttpÂíåhttps 1234567891011121314151617181920212223242526272829@Bean public EmbeddedServletContainerFactory servletContainer() &#123; TomcatEmbeddedServletContainerFactory tomcat = new TomcatEmbeddedServletContainerFactory() &#123; @Override protected void postProcessContext(Context context) &#123; SecurityConstraint constraint = new SecurityConstraint(); constraint.setUserConstraint("CONFIDENTIAL"); SecurityCollection collection = new SecurityCollection(); collection.addPattern(""); constraint.addCollection(collection); context.addConstraint(constraint); &#125; &#125;; tomcat.addAdditionalTomcatConnectors(httpConnector()); return tomcat; &#125; @Bean public Connector httpConnector() &#123; Connector connector = new Connector("org.apache.coyote.http11.Http11NioProtocol"); connector.setScheme("http"); //ConnectorÁõëÂê¨ÁöÑhttpÁöÑÁ´ØÂè£Âè∑ connector.setPort(httpPort); connector.setSecure(false); //ÁõëÂê¨Âà∞httpÁöÑÁ´ØÂè£Âè∑ÂêéËΩ¨ÂêëÂà∞ÁöÑhttpsÁöÑÁ´ØÂè£Âè∑ connector.setRedirectPort(securePort); return connector; &#125; servletContainer()ÊääEmbeddedServletContainerFactoryÊ≥®ÂÖ•Âà∞webÂÆπÂô®‰∏≠ÔºåÁî®postProcessContextÊã¶Êà™ÊâÄÊúâÁöÑ/*ËØ∑Ê±ÇÔºåÂπ∂ÊääÂÖ∂ÂÖ≥ËÅîÂà∞‰∏ãÈù¢ÁöÑhttpConnector‰∏≠„ÄÇÊúÄÂêéÔºåÂú®httpConnector()‰∏≠ÔºåÊäähttpËÆæ‰∏∫10101Á´ØÂè£ÔºåÂπ∂ÊäähttpÁöÑËØ∑Ê±ÇË∑≥ËΩ¨Âà∞5443ÁöÑhttpsÁ´ØÂè£ÔºåËøôËæπÊòØËØªÂèñÁöÑÈÖçÁΩÆÊñá‰ª∂„ÄÇ Ëá≥Ê≠§ÔºåËá≥Ê≠§ÂêåÊó∂ÊîØÊåÅhttpsÂíåhttpÁöÑAPIÁΩëÂÖ≥ÂÆåÊàêÔºåÂ∞ÜÂåπÈÖçÂà∞/userÁöÑËØ∑Ê±ÇÔºåË∑ØÁî±Âà∞userÊúçÂä°ÔºåÊòØ‰∏çÊòØÂæàÁÆÄÂçïÔºü‰∏ãÈù¢‰∏ÄËµ∑Ê∑±ÂÖ•‰∫ÜËß£‰∏ãZuul„ÄÇ 3. ‰∏Ä‰∫õinternalsinternalsÂèØ‰ª•ÁêÜËß£‰∏∫ÂÜÖÂπï„ÄÇ 3.1 ËøáÊª§Âô®filterÊòØZuulÁöÑÊ†∏ÂøÉÔºåÁî®Êù•ÂÆûÁé∞ÂØπÂ§ñÊúçÂä°ÁöÑÊéßÂà∂„ÄÇfilterÁöÑÁîüÂëΩÂë®ÊúüÊúâ4‰∏™ÔºåÂàÜÂà´ÊòØpre„ÄÅroute„ÄÅpost„ÄÅerrorÔºåÊï¥‰∏™ÁîüÂëΩÂë®ÊúüÂèØ‰ª•Áî®‰∏ãÂõæÊù•Ë°®Á§∫„ÄÇ ‰∏Ä‰∏™ËØ∑Ê±Ç‰ºöÂÖàÊåâÈ°∫Â∫èÈÄöËøáÊâÄÊúâÁöÑÂâçÁΩÆËøáÊª§Âô®Ôºå‰πãÂêéÂú®Ë∑ØÁî±ËøáÊª§Âô®‰∏≠ËΩ¨ÂèëÁªôÂêéÁ´ØÂ∫îÁî®ÔºåÂæóÂà∞ÂìçÂ∫îÂêéÂèà‰ºöÈÄöËøáÊâÄÊúâÁöÑÂêéÁΩÆËøáÊª§Âô®ÔºåÊúÄÂêéÂìçÂ∫îÁªôÂÆ¢Êà∑Á´Ø„ÄÇerrorÂèØ‰ª•Âú®ÊâÄÊúâÈò∂ÊÆµÊçïËé∑ÂºÇÂ∏∏ÂêéÊâßË°å„ÄÇ ‰∏ÄËà¨Êù•ËØ¥ÔºåÂ¶ÇÊûúÈúÄË¶ÅÂú®ËØ∑Ê±ÇÂà∞ËææÂêéÁ´ØÂ∫îÁî®ÂâçÂ∞±ËøõË°åÂ§ÑÁêÜÁöÑËØùÔºå‰ºöÈÄâÊã©ÂâçÁΩÆËøáÊª§Âô®Ôºå‰æãÂ¶ÇÈâ¥ÊùÉ„ÄÅËØ∑Ê±ÇËΩ¨Âèë„ÄÅÂ¢ûÂä†ËØ∑Ê±ÇÂèÇÊï∞Á≠âË°å‰∏∫„ÄÇÂêéÈù¢Ë°îÊé•authÁ≥ªÁªüÈÉ®ÂàÜÁªôÂá∫ÂÖ∑‰ΩìÂÆûÁé∞Ôºå‰πüÊòØÂü∫‰∫épreËøáÊª§„ÄÇ Âú®ËØ∑Ê±ÇÂÆåÊàêÂêéÈúÄË¶ÅÂ§ÑÁêÜÁöÑÊìç‰ΩúÊîæÂú®ÂêéÁΩÆËøáÊª§Âô®‰∏≠ÂÆåÊàêÔºå‰æãÂ¶ÇÁªüËÆ°ËøîÂõûÂÄºÂíåË∞ÉÁî®Êó∂Èó¥„ÄÅËÆ∞ÂΩïÊó•Âøó„ÄÅÂ¢ûÂä†Ë∑®ÂüüÂ§¥Á≠âË°å‰∏∫„ÄÇË∑ØÁî±ËøáÊª§Âô®‰∏ÄËà¨Âè™ÈúÄË¶ÅÈÄâÊã© Zuul ‰∏≠ÂÜÖÁΩÆÁöÑÂç≥ÂèØ„ÄÇ ÈîôËØØËøáÊª§Âô®‰∏ÄËà¨Âè™ÈúÄË¶Å‰∏Ä‰∏™ÔºåËøôÊ†∑ÂèØ‰ª•Âú® Gateway ÈÅáÂà∞ÈîôËØØÈÄªËæëÊó∂Áõ¥Êé•ÊäõÂá∫ÂºÇÂ∏∏‰∏≠Êñ≠ÊµÅÁ®ãÔºåÂπ∂Áõ¥Êé•Áªü‰∏ÄÂ§ÑÁêÜËøîÂõûÁªìÊûú„ÄÇ 3.2 ÈÖçÁΩÆÁÆ°ÁêÜÂêéÁ´ØÊúçÂä° APIÂèØËÉΩÊ†πÊçÆÊÉÖÂÜµÔºåÊúâ‰∫õ‰∏çÈúÄË¶ÅÁôªÂΩïÊ†°È™å‰∫ÜÔºåËøô‰∏™ÈÖçÁΩÆ‰ø°ÊÅØÊÄé‰πàÂä®ÊÄÅÂä†ËΩΩÂà∞ÁΩëÂÖ≥ÈÖçÁΩÆÂΩì‰∏≠ÔºüÁ¨îËÄÖËÆ§‰∏∫Êúâ‰∏§ÁßçÊñπÂºèÔºö‰∏ÄÊòØÈÖçÁΩÆ‰ø°ÊÅØÂ≠òÂà∞Â∫ì‰∏≠ÔºåÂÆöÊúüÂÆûÁé∞ÂØπÁΩëÂÖ≥ÊúçÂä°ÁöÑÈÖçÁΩÆÂà∑Êñ∞ÔºõÂè¶‰∏ÄÁßçÂ∞±ÊòØÂü∫‰∫éÈÖçÁΩÆ‰∏≠ÂøÉÊúçÂä°ÔºåÂΩìÈÖçÁΩÆÊèê‰∫§Âà∞ÈÖçÁΩÆ‰∏≠ÂøÉÊó∂ÔºåËß¶ÂèëÁΩëÂÖ≥ÊúçÂä°ÁöÑÁÉ≠Êõ¥Êñ∞„ÄÇ ÂêéÁ´ØÂ∫îÁî®Êó†ÂÖ≥ÁöÑÈÖçÁΩÆÔºåÊúâ‰∫õÊòØËá™Âä®ÂåñÁöÑÔºå‰æãÂ¶ÇÊÅ∂ÊÑèËØ∑Ê±ÇÊã¶Êà™ÔºåGateway ‰ºöÂ∞ÜÊâÄÊúâËØ∑Ê±ÇÁöÑ‰ø°ÊÅØÈÄöËøáÊ∂àÊÅØÈòüÂàóÂèëÈÄÅÁªô‰∏Ä‰∫õÂÆûÊó∂Êï∞ÊçÆÂàÜÊûêÁöÑÂ∫îÁî®ÔºåËøô‰∫õÂ∫îÁî®‰ºöÂØπËØ∑Ê±ÇÂàÜÊûêÔºåÂèëÁé∞ÊÅ∂ÊÑèËØ∑Ê±ÇÁöÑÁâπÂæÅÔºåÂπ∂ÈÄöËøá Gateway Êèê‰æõÁöÑÊé•Âè£Â∞ÜËøô‰∫õÁâπÂæÅ‰∏äÊä•Áªô GatewayÔºåGateway Â∞±ÂèØ‰ª•ÂÆûÊó∂ÁöÑÂØπËøô‰∫õÊÅ∂ÊÑèËØ∑Ê±ÇËøõË°åÊã¶Êà™„ÄÇ 3.3 ÈöîÁ¶ªÊú∫Âà∂Âú®ÂæÆÊúçÂä°ÁöÑÊ®°Âºè‰∏ãÔºåÂ∫îÁî®‰πãÈó¥ÁöÑËÅîÁ≥ªÂèòÂæóÊ≤°ÈÇ£‰πàÂº∫ÁÉàÔºåÁêÜÊÉ≥‰∏≠‰ªª‰Ωï‰∏Ä‰∏™Â∫îÁî®Ë∂ÖËøáË¥üËΩΩÊàñÊòØÊåÇÊéâ‰∫ÜÔºåÈÉΩ‰∏çÂ∫îËØ•ÂéªÂΩ±ÂìçÂà∞ÂÖ∂‰ªñÂ∫îÁî®„ÄÇ‰ΩÜÊòØÂú® Gateway Ëøô‰∏™Â±ÇÈù¢ÔºåÊúâÊ≤°ÊúâÂèØËÉΩÂá∫Áé∞‰∏Ä‰∏™Â∫îÁî®Ë¥üËΩΩËøáÈáçÔºåÂØºËá¥Â∞ÜÊï¥‰∏™ Gateway ÈÉΩÂéãÂûÆ‰∫ÜÔºåÂ∑≤Ëá¥ÊâÄÊúâÂ∫îÁî®ÁöÑÊµÅÈáèÂÖ•Âè£ÈÉΩË¢´ÂàáÊñ≠Ôºü ËøôÂΩìÁÑ∂ÊòØÊúâÂèØËÉΩÁöÑÔºåÊÉ≥Ë±°‰∏Ä‰∏™ÊØèÁßí‰ºöÊé•ÂèóÂæàÂ§öËØ∑Ê±ÇÁöÑÂ∫îÁî®ÔºåÂú®Ê≠£Â∏∏ÊÉÖÂÜµ‰∏ãËøô‰∫õËØ∑Ê±ÇÂèØËÉΩÂú® 10 ÊØ´Áßí‰πãÂÜÖÂ∞±ËÉΩÊ≠£Â∏∏ÂìçÂ∫îÔºå‰ΩÜÊòØÂ¶ÇÊûúÊúâ‰∏ÄÂ§©ÂÆÉÂá∫‰∫ÜÈóÆÈ¢òÔºåÊâÄÊúâËØ∑Ê±ÇÈÉΩ‰ºö Block Âà∞ 30 ÁßíË∂ÖÊó∂Êâç‰ºöÊñ≠ÂºÄÔºà‰æãÂ¶ÇÈ¢ëÁπÅ Full GC Êó†Ê≥ïÊúâÊïàÈáäÊîæÂÜÖÂ≠òÔºâ„ÄÇÈÇ£‰πàÂú®Ëøô‰∏™Êó∂ÂÄôÔºåGateway ‰∏≠‰πü‰ºöÊúâÂ§ßÈáèÁöÑÁ∫øÁ®ãÂú®Á≠âÂæÖËØ∑Ê±ÇÁöÑÂìçÂ∫îÔºåÊúÄÁªà‰ºöÂêÉÂÖâÊâÄÊúâÁ∫øÁ®ãÔºåÂØºËá¥ÂÖ∂‰ªñÊ≠£Â∏∏Â∫îÁî®ÁöÑËØ∑Ê±Ç‰πüÂèóÂà∞ÂΩ±Âìç„ÄÇ Âú® Zuul ‰∏≠ÔºåÊØè‰∏Ä‰∏™ÂêéÁ´ØÂ∫îÁî®ÈÉΩÁß∞‰∏∫‰∏Ä‰∏™ RouteÔºå‰∏∫‰∫ÜÈÅøÂÖç‰∏Ä‰∏™ Route Êä¢Âç†‰∫ÜÂ§™Â§öËµÑÊ∫êÂΩ±ÂìçÂà∞ÂÖ∂‰ªñ Route ÁöÑÊÉÖÂÜµÂá∫Áé∞ÔºåZuul ‰ΩøÁî® Hystrix ÂØπÊØè‰∏Ä‰∏™ Route ÈÉΩÂÅö‰∫ÜÈöîÁ¶ªÂíåÈôêÊµÅ„ÄÇ Hystrix ÁöÑÈöîÁ¶ªÁ≠ñÁï•Êúâ‰∏§ÁßçÔºåÂü∫‰∫éÁ∫øÁ®ãÊàñÊòØÂü∫‰∫é‰ø°Âè∑Èáè„ÄÇZuul ÈªòËÆ§ÁöÑÊòØÂü∫‰∫éÁ∫øÁ®ãÁöÑÈöîÁ¶ªÊú∫Âà∂Ôºå‰πãÂâçÁ´†ËäÇÁöÑÈÖçÁΩÆÂèØ‰ª•ÂõûÈ°æ‰∏ãÔºåËøôÊÑèÂë≥ÁùÄÊØè‰∏Ä‰∏™ Route ÁöÑËØ∑Ê±ÇÈÉΩ‰ºöÂú®‰∏Ä‰∏™Âõ∫ÂÆöÂ§ßÂ∞è‰∏îÁã¨Á´ãÁöÑÁ∫øÁ®ãÊ±†‰∏≠ÊâßË°åÔºåËøôÊ†∑Âç≥‰ΩøÂÖ∂‰∏≠‰∏Ä‰∏™ Route Âá∫Áé∞‰∫ÜÈóÆÈ¢òÔºå‰πüÂè™‰ºöÊòØÊüê‰∏Ä‰∏™Á∫øÁ®ãÊ±†ÂèëÁîü‰∫ÜÈòªÂ°ûÔºåÂÖ∂‰ªñ Route ‰∏ç‰ºöÂèóÂà∞ÂΩ±Âìç„ÄÇ ‰∏ÄËà¨‰ΩøÁî® Hystrix Êó∂ÔºåÂè™ÊúâË∞ÉÁî®ÈáèÂ∑®Â§ß‰ºöÂèóÂà∞Á∫øÁ®ãÂºÄÈîÄÂΩ±ÂìçÊó∂Êâç‰ºö‰ΩøÁî®‰ø°Âè∑ÈáèËøõË°åÈöîÁ¶ªÁ≠ñÁï•ÔºåÂØπ‰∫é Zuul ËøôÁßçÁΩëÁªúËØ∑Ê±ÇÁöÑÁî®ÈÄî‰ΩøÁî®Á∫øÁ®ãÈöîÁ¶ªÊõ¥Âä†Á®≥Â¶•„ÄÇ 3.4 ÈáçËØïÊú∫Âà∂‰∏ÄËà¨Êù•ËØ¥ÔºåÂêéÁ´ØÂ∫îÁî®ÁöÑÂÅ•Â∫∑Áä∂ÊÄÅÊòØ‰∏çÁ®≥ÂÆöÁöÑÔºåÂ∫îÁî®ÂàóË°®ÈöèÊó∂‰ºöÊúâ‰øÆÊîπÔºåÊâÄ‰ª• Gateway ÂøÖÈ°ªÊúâË∂≥Â§üÂ•ΩÁöÑÂÆπÈîôÊú∫Âà∂ÔºåËÉΩÂ§üÂáèÂ∞ëÂêéÁ´ØÂ∫îÁî®ÂèòÊõ¥Êó∂ÈÄ†ÊàêÁöÑÂΩ±Âìç„ÄÇ ÁÆÄÂçï‰ªãÁªç‰∏ã Ribbon ÊîØÊåÅÂì™‰∫õÂÆπÈîôÈÖçÁΩÆ„ÄÇÈáçËØïÁöÑÂú∫ÊôØÂàÜ‰∏∫‰∏âÁßçÔºö okToRetryOnConnectErrorsÔºöÂè™ÈáçËØïÁΩëÁªúÈîôËØØ okToRetryOnAllErrorsÔºöÈáçËØïÊâÄÊúâÈîôËØØ OkToRetryOnAllOperationsÔºöÈáçËØïÊâÄÊúâÊìç‰Ωú ÈáçËØïÁöÑÊ¨°Êï∞Êúâ‰∏§ÁßçÔºö MaxAutoRetriesÔºöÊØè‰∏™ËäÇÁÇπÁöÑÊúÄÂ§ßÈáçËØïÊ¨°Êï∞ MaxAutoRetriesNextServerÔºöÊõ¥Êç¢ËäÇÁÇπÈáçËØïÁöÑÊúÄÂ§ßÊ¨°Êï∞ ‰∏ÄËà¨Êù•ËØ¥Êàë‰ª¨Â∏åÊúõÂè™Âú®ÁΩëÁªúËøûÊé•Â§±Ë¥•Êó∂ËøõË°åÈáçËØï„ÄÅÊàñÊòØÂØπ 5XX ÁöÑ GET ËØ∑Ê±ÇËøõË°åÈáçËØïÔºà‰∏çÊé®ËçêÂØπ POST ËØ∑Ê±ÇËøõË°åÈáçËØïÔºåÊó†Ê≥ï‰øùËØÅÂπÇÁ≠âÊÄß‰ºöÈÄ†ÊàêÊï∞ÊçÆ‰∏ç‰∏ÄËá¥Ôºâ„ÄÇÂçïÂè∞ÁöÑÈáçËØïÊ¨°Êï∞ÂèØ‰ª•Â∞ΩÈáèÂ∞è‰∏Ä‰∫õÔºåÈáçËØïÁöÑËäÇÁÇπÊï∞Â∞ΩÈáèÂ§ö‰∏Ä‰∫õÔºåÊï¥‰ΩìÊïàÊûú‰ºöÊõ¥Â•Ω„ÄÇ Â¶ÇÊûúÊúâÊõ¥Âä†Â§çÊùÇÁöÑÈáçËØïÂú∫ÊôØÔºå‰æãÂ¶ÇÈúÄË¶ÅÂØπÁâπÂÆöÁöÑÊüê‰∫õ API„ÄÅÁâπÂÆöÁöÑËøîÂõûÂÄºËøõË°åÈáçËØïÔºåÈÇ£‰πà‰πüÂèØ‰ª•ÈÄöËøáÂÆûÁé∞ RequestSpecificRetryHandler ÂÆöÂà∂ÈÄªËæëÔºà‰∏çÂª∫ËÆÆÁõ¥Êé•‰ΩøÁî® RetryHandlerÔºåÂõ†‰∏∫Ëøô‰∏™Â≠êÁ±ªÂèØ‰ª•‰ΩøÁî®ÂæàÂ§öÂ∑≤ÊúâÁöÑÂäüËÉΩÔºâ„ÄÇ 4. ÊÄªÁªìÊú¨ÊñáÈ¶ñÂÖà‰ªãÁªç‰∫ÜAPIÁΩëÂÖ≥ÁöÑÁõ∏ÂÖ≥Áü•ËØÜÔºõÂÖ∂Ê¨°‰ªãÁªç‰∫ÜzuulÁΩëÂÖ≥ÁöÑÈÖçÁΩÆÂÆûÁé∞ÔºåÂêåÊó∂ÊîØÊåÅhttpsÔºõÊúÄÂêé‰ªãÁªç‰∫ÜzuulÁΩëÂÖ≥ÁöÑ‰∏Ä‰∫õÂÜÖÂπïÂéüÁêÜÔºåËøôËæπÂ§ßÈÉ®ÂàÜÂèÇËÄÉ‰∫ÜÁΩë‰∏äÁöÑÊñáÁ´†„ÄÇÁΩëÂÖ≥‰Ωú‰∏∫ÂÜÖÁΩë‰∏éÂ§ñÁΩë‰πãÈó¥ÁöÑÈó®Êà∑ÔºåÊâÄÊúâËÆøÈóÆÂÜÖÁΩëÁöÑËØ∑Ê±ÇÈÉΩ‰ºöÁªèËøáÁΩëÂÖ≥ÔºåÁΩëÂÖ≥Â§ÑËøõË°åÂèçÂêë‰ª£ÁêÜ„ÄÇÂú®Êï¥‰∏™Spring CloudÂæÆÊúçÂä°Ê°ÜÊû∂ÈáåÔºåZuulÊâÆÊºîÁùÄ‚ÄùÊô∫ËÉΩÁΩëÂÖ≥‚ÄúÁöÑËßíËâ≤„ÄÇ github: https://github.com/keets2012/Spring-Boot-Samples/tree/master/api-gatewaygitee: https://gitee.com/keets/spring-boot-samples/tree/master/api-gateway ÂèÇËÄÉ ËÅäËÅä API Gateway Âíå Netflix Zuul Spring CloudÊäÄÊúØÂàÜÊûêÔºà4Ôºâ- spring cloud zuul netflix-zuul]]></content>
      <categories>
        <category>ÂæÆÊúçÂä°</category>
      </categories>
      <tags>
        <tag>zuul</tag>
        <tag>gateway</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Âá†ÁßçÂàÜÂ∏ÉÂºèË∞ÉÁî®ÈìæÁõëÊéßÁªÑ‰ª∂ÁöÑÂÆûË∑µ‰∏éÊØîËæÉÔºà‰∏ÄÔºâÂÆûË∑µ]]></title>
    <url>%2F2017%2F11%2F10%2Fapm1%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÔºöÊúÄËøëÂú®Ë∞ÉÁ†î‰∏éÈÄâÂûãÂàÜÂ∏ÉÂºèË∞ÉÁî®ÈìæÁõëÊéßÁªÑ‰ª∂„ÄÇÈÄâ‰∫Ü‰∏ªË¶ÅÁöÑ‰∏âÁßçAPMÁªÑ‰ª∂ËøõË°å‰∫ÜÂÆûË∑µ‰∏éÊØîËæÉ„ÄÇÊú¨Êù•ÊâìÁÆó‰∏ÄÁØáÊñáÁ´†ÂÜôÂÆåÁöÑÔºåÁØáÂπÖÂ§™ÈïøÔºåÊâìÁÆóÂàÜ‰∏§ÁØá„ÄÇÊú¨Êñá‰∏ªË¶ÅËÆ≤‰∏ãÈìæË∑ØtraceingÁöÑÂü∫Êú¨Ê¶ÇÂøµÂíåÂá†ÁßçAPMÁªÑ‰ª∂ÁöÑÂÆûË∑µÔºåÂÆûË∑µÈÉ®ÂàÜ‰πüÊ≤°ÁªôÂá∫ÁâπÂà´ËØ¶ÁªÜÁöÑÊ≠•È™§ÔºåÂõ†‰∏∫Êú¨ÊñáÈáçÁÇπ‰∏çÂú®ÂÖ∑‰ΩìÁöÑÊ≠•È™§„ÄÇÁ¨¨‰∫åÁØáÂ∞Ü‰ºöËÆ≤‰∏ãÂá†ÁßçAPMÈÄâÂûãÁöÑÊØîËæÉ‰∏éÊÄßËÉΩÊµãËØï„ÄÇ 1. ÈóÆÈ¢òËÉåÊôØÂæÆÊúçÂä°Êû∂ÊûÑ‰∏ãÔºåÊúçÂä°ÊåâÁÖß‰∏çÂêåÁöÑÁª¥Â∫¶ËøõË°åÊãÜÂàÜÔºå‰∏ÄÊ¨°ËØ∑Ê±ÇËØ∑Ê±ÇÂæÄÂæÄÈúÄË¶ÅÊ∂âÂèäÂà∞Â§ö‰∏™ÊúçÂä°„ÄÇ‰∫íËÅîÁΩëÂ∫îÁî®ÊûÑÂª∫Âú®‰∏çÂêåÁöÑËΩØ‰ª∂Ê®°ÂùóÈõÜ‰∏äÔºåËøô‰∫õËΩØ‰ª∂Ê®°ÂùóÔºåÊúâÂèØËÉΩÊòØÁî±‰∏çÂêåÁöÑÂõ¢ÈòüÂºÄÂèë„ÄÅÂèØËÉΩ‰ΩøÁî®‰∏çÂêåÁöÑÁºñÁ®ãËØ≠Ë®ÄÊù•ÂÆûÁé∞„ÄÅÊúâÂèØËÉΩÂ∏ÉÂú®‰∫ÜÂá†ÂçÉÂè∞ÊúçÂä°Âô®ÔºåÊ®™Ë∑®Â§ö‰∏™‰∏çÂêåÁöÑÊï∞ÊçÆ‰∏≠ÂøÉ„ÄÇÂõ†Ê≠§ÔºåÂ∞±ÈúÄË¶Å‰∏Ä‰∫õÂèØ‰ª•Â∏ÆÂä©ÁêÜËß£Á≥ªÁªüË°å‰∏∫„ÄÅÁî®‰∫éÂàÜÊûêÊÄßËÉΩÈóÆÈ¢òÁöÑÂ∑•ÂÖ∑Ôºå‰ª•‰æøÂèëÁîüÊïÖÈöúÁöÑÊó∂ÂÄôÔºåËÉΩÂ§üÂø´ÈÄüÂÆö‰ΩçÂíåËß£ÂÜ≥ÈóÆÈ¢ò„ÄÇ ÂàÜÂ∏ÉÂºèË∞ÉÁî®ÈìæÁõëÊéßÁªÑ‰ª∂Âú®ËøôÊ†∑ÁöÑÁéØÂ¢É‰∏ã‰∫ßÁîü‰∫Ü„ÄÇÊúÄÂá∫ÂêçÁöÑÊòØË∞∑Ê≠åÂÖ¨ÂºÄÁöÑËÆ∫ÊñáÊèêÂà∞ÁöÑDapper„ÄÇÂºÄÂèëDapperÊòØ‰∏∫‰∫ÜÊî∂ÈõÜÊõ¥Â§öÁöÑÂ§çÊùÇÂàÜÂ∏ÉÂºèÁ≥ªÁªüÁöÑË°å‰∏∫‰ø°ÊÅØÔºåÁÑ∂ÂêéÂëàÁé∞ÁªôGoogleÁöÑÂºÄÂèëËÄÖ‰ª¨„ÄÇËøôÊ†∑ÁöÑÂàÜÂ∏ÉÂºèÁ≥ªÁªüÊúâ‰∏Ä‰∏™ÁâπÊÆäÁöÑÂ•ΩÂ§ÑÔºåÂõ†‰∏∫ÈÇ£‰∫õÂ§ßËßÑÊ®°ÁöÑ‰ΩéÁ´ØÊúçÂä°Âô®Ôºå‰Ωú‰∏∫‰∫íËÅîÁΩëÊúçÂä°ÁöÑËΩΩ‰ΩìÔºåÊòØ‰∏Ä‰∏™ÁâπÊÆäÁöÑÁªèÊµéÂàíÁÆóÁöÑÂπ≥Âè∞„ÄÇÊÉ≥Ë¶ÅÂú®Ëøô‰∏™‰∏ä‰∏ãÊñá‰∏≠ÁêÜËß£ÂàÜÂ∏ÉÂºèÁ≥ªÁªüÁöÑË°å‰∏∫ÔºåÂ∞±ÈúÄË¶ÅÁõëÊéßÈÇ£‰∫õÊ®™Ë∑®‰∫Ü‰∏çÂêåÁöÑÂ∫îÁî®„ÄÅ‰∏çÂêåÁöÑÊúçÂä°Âô®‰πãÈó¥ÁöÑÂÖ≥ËÅîÂä®‰Ωú„ÄÇ Â∏ÇÈù¢‰∏äÁöÑAPMÔºàApplication Performance ManagementÔºâÁêÜËÆ∫Ê®°ÂûãÂ§ßÂ§öÈÉΩÊòØÂÄüÈâ¥ÔºàborrowÔºâGoogle DapperËÆ∫ÊñáÔºåÊú¨ÊñáÈáçÁÇπÂÖ≥Ê≥®‰ª•‰∏ãÂá†ÁßçAPMÁªÑ‰ª∂Ôºö Zipkin Áî±TwitterÂÖ¨Âè∏ÂºÄÊ∫êÔºåÂºÄÊîæÊ∫ê‰ª£Á†ÅÂàÜÂ∏ÉÂºèÁöÑË∑üË∏™Á≥ªÁªüÔºåÁî®‰∫éÊî∂ÈõÜÊúçÂä°ÁöÑÂÆöÊó∂Êï∞ÊçÆÔºå‰ª•Ëß£ÂÜ≥ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑÂª∂ËøüÈóÆÈ¢òÔºåÂåÖÊã¨Êï∞ÊçÆÁöÑÊî∂ÈõÜ„ÄÅÂ≠òÂÇ®„ÄÅÊü•ÊâæÂíåÂ±ïÁé∞„ÄÇ PinpointPinpointÊòØ‰∏ÄÊ¨æÂØπJavaÁºñÂÜôÁöÑÂ§ßËßÑÊ®°ÂàÜÂ∏ÉÂºèÁ≥ªÁªüÁöÑAPMÂ∑•ÂÖ∑ÔºåÁî±Èü©ÂõΩ‰∫∫ÂºÄÊ∫êÁöÑÂàÜÂ∏ÉÂºèË∑üË∏™ÁªÑ‰ª∂„ÄÇ SkywalkingÂõΩ‰∫ßÁöÑ‰ºòÁßÄAPMÁªÑ‰ª∂ÔºåÊòØ‰∏Ä‰∏™ÂØπJAVAÂàÜÂ∏ÉÂºèÂ∫îÁî®Á®ãÂ∫èÈõÜÁæ§ÁöÑ‰∏öÂä°ËøêË°åÊÉÖÂÜµËøõË°åËøΩË∏™„ÄÅÂëäË≠¶ÂíåÂàÜÊûêÁöÑÁ≥ªÁªü„ÄÇ ÂÖ∂‰ªñÁ±ª‰ººÁöÑÁªÑ‰ª∂ËøòÊúâÁæéÂõ¢ÁÇπËØÑÁöÑCATÔºåÊ∑òÂÆùÁöÑÈπ∞ÁúºEgleEye„ÄÇ Â¶Ç‰∏äÊâÄËø∞ÔºåÈÇ£‰πàÊàë‰ª¨ÈÄâÊã©ÈìæË∑ØÁõëÊéßÁªÑ‰ª∂ÊúâÂì™‰∫õË¶ÅÊ±ÇÂë¢ÔºüDapper‰∏≠‰πüÊèêÂà∞‰∫ÜÔºåÁ¨îËÄÖÊÄªÁªìÂ¶Ç‰∏ãÔºö Êé¢ÈíàÁöÑÊÄßËÉΩÊ∂àËÄó„ÄÇAPMÁªÑ‰ª∂ÊúçÂä°ÁöÑÂΩ±ÂìçÂ∫îËØ•ÂÅöÂà∞Ë∂≥Â§üÂ∞è„ÄÇÂú®‰∏Ä‰∫õÈ´òÂ∫¶‰ºòÂåñËøáÁöÑÊúçÂä°ÔºåÂç≥‰Ωø‰∏ÄÁÇπÁÇπÊçüËÄó‰πü‰ºöÂæàÂÆπÊòìÂØüËßâÂà∞ÔºåËÄå‰∏îÊúâÂèØËÉΩËø´‰ΩøÂú®Á∫øÊúçÂä°ÁöÑÈÉ®ÁΩ≤Âõ¢Èòü‰∏çÂæó‰∏çÂ∞ÜË∑üË∏™Á≥ªÁªüÂÖ≥ÂÅú„ÄÇ ‰ª£Á†ÅÁöÑ‰æµÂÖ•ÊÄßÂØπ‰∫éÂ∫îÁî®ÁöÑÁ®ãÂ∫èÂëòÊù•ËØ¥ÔºåÊòØ‰∏çÈúÄË¶ÅÁü•ÈÅìÊúâË∑üË∏™Á≥ªÁªüËøôÂõû‰∫ãÁöÑ„ÄÇÂ¶ÇÊûú‰∏Ä‰∏™Ë∑üË∏™Á≥ªÁªüÊÉ≥ÁîüÊïàÔºåÂ∞±ÂøÖÈ°ªÈúÄË¶Å‰æùËµñÂ∫îÁî®ÁöÑÂºÄÂèëËÄÖ‰∏ªÂä®ÈÖçÂêàÔºåÈÇ£‰πàËøô‰∏™Ë∑üË∏™Á≥ªÁªü‰πüÂ§™ËÑÜÂº±‰∫ÜÔºåÂæÄÂæÄÁî±‰∫éË∑üË∏™Á≥ªÁªüÂú®Â∫îÁî®‰∏≠Ê§çÂÖ•‰ª£Á†ÅÁöÑbugÊàñÁñèÂøΩÂØºËá¥Â∫îÁî®Âá∫ÈóÆÈ¢òÔºåËøôÊ†∑ÊâçÊòØÊó†Ê≥ïÊª°Ë∂≥ÂØπË∑üË∏™Á≥ªÁªü‚ÄúÊó†ÊâÄ‰∏çÂú®ÁöÑÈÉ®ÁΩ≤‚ÄùËøô‰∏™ÈúÄÊ±Ç„ÄÇ ÂèØÊâ©Â±ïÊÄßËÉΩÂ§üÊîØÊåÅÁöÑÁªÑ‰ª∂Ë∂äÂ§öÂΩìÁÑ∂Ë∂äÂ•Ω„ÄÇÊàñËÄÖÊèê‰æõ‰æøÊç∑ÁöÑÊèí‰ª∂ÂºÄÂèëAPIÔºåÂØπ‰∫é‰∏Ä‰∫õÊ≤°ÊúâÁõëÊéßÂà∞ÁöÑÁªÑ‰ª∂ÔºåÂ∫îÁî®ÂºÄÂèëËÄÖ‰πüÂèØ‰ª•Ëá™Ë°åÊâ©Â±ï„ÄÇ Êï∞ÊçÆÁöÑÂàÜÊûêÊï∞ÊçÆÁöÑÂàÜÊûêË¶ÅÂø´ ÔºåÂàÜÊûêÁöÑÁª¥Â∫¶Â∞ΩÂèØËÉΩÂ§ö„ÄÇË∑üË∏™Á≥ªÁªüËÉΩÊèê‰æõË∂≥Â§üÂø´ÁöÑ‰ø°ÊÅØÂèçÈ¶àÔºåÂ∞±ÂèØ‰ª•ÂØπÁîü‰∫ßÁéØÂ¢É‰∏ãÁöÑÂºÇÂ∏∏Áä∂ÂÜµÂÅöÂá∫Âø´ÈÄüÂèçÂ∫î„ÄÇÂàÜÊûêÁöÑÂÖ®Èù¢ÔºåËÉΩÂ§üÈÅøÂÖç‰∫åÊ¨°ÂºÄÂèë„ÄÇ 2. Âü∫Á°ÄÊ¶ÇÂøµ‰∏äÈù¢ÂàóÂá∫ÁöÑÂá†ÁßçÁªÑ‰ª∂ÔºåÂÖ∂‰∏≠ZipkinÊòØ‰∏•Ê†ºÊåâÁÖßGoogle DapperËÆ∫ÊñáÂÆûÁé∞ÁöÑÔºå‰∏ãÈù¢‰ªãÁªç‰∏ãÂÖ∂‰∏≠Ê∂âÂèäÁöÑÂü∫Êú¨Ê¶ÇÂøµ„ÄÇ SpanÂü∫Êú¨Â∑•‰ΩúÂçïÂÖÉÔºå‰∏ÄÊ¨°ÈìæË∑ØË∞ÉÁî®(ÂèØ‰ª•ÊòØRPCÔºåDBÁ≠âÊ≤°ÊúâÁâπÂÆöÁöÑÈôêÂà∂)ÂàõÂª∫‰∏Ä‰∏™spanÔºåÈÄöËøá‰∏Ä‰∏™64‰ΩçIDÊ†áËØÜÂÆÉÔºåuuidËæÉ‰∏∫Êñπ‰æøÔºåspan‰∏≠ËøòÊúâÂÖ∂‰ªñÁöÑÊï∞ÊçÆÔºå‰æãÂ¶ÇÊèèËø∞‰ø°ÊÅØÔºåÊó∂Èó¥Êà≥Ôºåkey-valueÂØπÁöÑ(Annotation)tag‰ø°ÊÅØÔºåparent-idÁ≠â,ÂÖ∂‰∏≠parent-idÂèØ‰ª•Ë°®Á§∫spanË∞ÉÁî®ÈìæË∑ØÊù•Ê∫ê„ÄÇ Trace:Á±ª‰ºº‰∫éÊ†ëÁªìÊûÑÁöÑSpanÈõÜÂêàÔºåË°®Á§∫‰∏ÄÊù°Ë∞ÉÁî®ÈìæË∑ØÔºåÂ≠òÂú®ÂîØ‰∏ÄÊ†áËØÜ„ÄÇÊØîÂ¶Ç‰Ω†ËøêË°åÁöÑÂàÜÂ∏ÉÂºèÂ§ßÊï∞ÊçÆÂ≠òÂÇ®‰∏ÄÊ¨°TraceÂ∞±Áî±‰Ω†ÁöÑ‰∏ÄÊ¨°ËØ∑Ê±ÇÁªÑÊàê„ÄÇ Annotation: Ê≥®Ëß£,Áî®Êù•ËÆ∞ÂΩïËØ∑Ê±ÇÁâπÂÆö‰∫ã‰ª∂Áõ∏ÂÖ≥‰ø°ÊÅØ(‰æãÂ¶ÇÊó∂Èó¥)ÔºåÈÄöÂ∏∏ÂåÖÂê´Âõõ‰∏™Ê≥®Ëß£‰ø°ÊÅØÔºö (1) csÔºöClient Start,Ë°®Á§∫ÂÆ¢Êà∑Á´ØÂèëËµ∑ËØ∑Ê±Ç (2) srÔºöServer Receive,Ë°®Á§∫ÊúçÂä°Á´ØÊî∂Âà∞ËØ∑Ê±Ç (3) ssÔºöServer Send,Ë°®Á§∫ÊúçÂä°Á´ØÂÆåÊàêÂ§ÑÁêÜÔºåÂπ∂Â∞ÜÁªìÊûúÂèëÈÄÅÁªôÂÆ¢Êà∑Á´Ø (4) crÔºöClient Received,Ë°®Á§∫ÂÆ¢Êà∑Á´ØËé∑ÂèñÂà∞ÊúçÂä°Á´ØËøîÂõû‰ø°ÊÅØ 2.1 Trace‰∏ãÈù¢Áúã‰∏Ä‰∏ãÔºåÂú®Á≥ªÁªü‰∏≠TraceÊòØ‰ªÄ‰πàÊ†∑Â≠ê„ÄÇ ÊØèÁßçÈ¢úËâ≤ÁöÑnoteÊ†áÊ≥®‰∫Ü‰∏Ä‰∏™spanÔºå‰∏ÄÊù°ÈìæË∑ØÈÄöËøáTraceIdÂîØ‰∏ÄÊ†áËØÜÔºåSpanÊ†áËØÜÂèëËµ∑ÁöÑËØ∑Ê±Ç‰ø°ÊÅØ„ÄÇÊ†ëËäÇÁÇπÊòØÊï¥‰∏™Êû∂ÊûÑÁöÑÂü∫Êú¨ÂçïÂÖÉÔºåËÄåÊØè‰∏Ä‰∏™ËäÇÁÇπÂèàÊòØÂØπspanÁöÑÂºïÁî®„ÄÇËäÇÁÇπ‰πãÈó¥ÁöÑËøûÁ∫øË°®Á§∫ÁöÑspanÂíåÂÆÉÁöÑÁà∂spanÁõ¥Êé•ÁöÑÂÖ≥Á≥ª„ÄÇËôΩÁÑ∂spanÂú®Êó•ÂøóÊñá‰ª∂‰∏≠Âè™ÊòØÁÆÄÂçïÁöÑ‰ª£Ë°®spanÁöÑÂºÄÂßãÂíåÁªìÊùüÊó∂Èó¥Ôºå‰ªñ‰ª¨Âú®Êï¥‰∏™Ê†ëÂΩ¢ÁªìÊûÑ‰∏≠Âç¥ÊòØÁõ∏ÂØπÁã¨Á´ãÁöÑ„ÄÇ 2.2 Span ‰∏äÂõæËØ¥Êòé‰∫ÜspanÂú®‰∏ÄÊ¨°Â§ßÁöÑË∑üË∏™ËøáÁ®ã‰∏≠ÊòØ‰ªÄ‰πàÊ†∑ÁöÑ„ÄÇDapperËÆ∞ÂΩï‰∫ÜspanÂêçÁß∞Ôºå‰ª•ÂèäÊØè‰∏™spanÁöÑIDÂíåÁà∂IDÔºå‰ª•ÈáçÂª∫Âú®‰∏ÄÊ¨°ËøΩË∏™ËøáÁ®ã‰∏≠‰∏çÂêåspan‰πãÈó¥ÁöÑÂÖ≥Á≥ª„ÄÇÂ¶ÇÊûú‰∏Ä‰∏™spanÊ≤°ÊúâÁà∂IDË¢´Áß∞‰∏∫root span„ÄÇÊâÄÊúâspanÈÉΩÊåÇÂú®‰∏Ä‰∏™ÁâπÂÆöÁöÑË∑üË∏™‰∏äÔºå‰πüÂÖ±Áî®‰∏Ä‰∏™Ë∑üË∏™id„ÄÇ 2.3 AnnotationËá™Âä®ÁöÑÊé¢ÈíàÔºå‰∏çÈúÄË¶Å‰øÆÊîπÂ∫îÁî®Á®ãÂ∫èÊ∫ê‰ª£Á†ÅÔºåÂØπÂ∫îÁî®ÂºÄÂèëËÄÖËøë‰πéÈõ∂Êµ∏ÂÖ•ÁöÑÊàêÊú¨ÂØπÂàÜÂ∏ÉÂºèÊéßÂà∂Ë∑ØÂæÑËøõË°åË∑üË∏™ÔºåÂá†‰πéÂÆåÂÖ®‰æùËµñ‰∫éÂü∫‰∫éÂ∞ëÈáèÈÄöÁî®ÁªÑ‰ª∂Â∫ìÁöÑÊîπÈÄ†„ÄÇDapperËøòÂÖÅËÆ∏Â∫îÁî®Á®ãÂ∫èÂºÄÂèë‰∫∫ÂëòÂú®DapperË∑üË∏™ÁöÑËøáÁ®ã‰∏≠Ê∑ªÂä†È¢ùÂ§ñÁöÑ‰ø°ÊÅØÔºå‰ª•ÁõëÊéßÊõ¥È´òÁ∫ßÂà´ÁöÑÁ≥ªÁªüË°å‰∏∫ÔºåÊàñÂ∏ÆÂä©Ë∞ÉËØïÈóÆÈ¢ò„ÄÇ ‰∏ãÈù¢Á´†ËäÇÂ∞Ü‰ºö‰ªãÁªç‰∏ã‰∏äËø∞‰∏âÁßçAPMÁªÑ‰ª∂ÁöÑ‰ΩøÁî®‰∏éÂÆûË∑µ„ÄÇ 3. zipkinzipkin‰∏ªË¶ÅÊ∂âÂèäÂá†‰∏™ÁªÑ‰ª∂ÔºöcollectorÊî∂ÈõÜagentÁöÑÊï∞ÊçÆÔºåstorageÂ≠òÂÇ®Ôºåweb UIÂõæÂΩ¢ÂåñÁïåÈù¢ÔºåsearchÊü•ËØ¢Storage‰∏≠Â≠òÂÇ®ÁöÑÊï∞ÊçÆ,Êèê‰æõÁÆÄÂçïÁöÑJSON APIËé∑ÂèñÊï∞ÊçÆ„ÄÇ Êàë‰ª¨ÁöÑÈ°πÁõÆÂü∫‰∫éÂæÆÊúçÂä°Ê°ÜÊû∂spring cloudÊûÑÂª∫ÂæÆÊúçÂä°„ÄÇspring cloud‰πüÊèê‰æõ‰∫Üspring-cloud-sleuthÊù•Êñπ‰æøÈõÜÊàêzipkinÂÆûÁé∞„ÄÇÊâÄ‰ª•Á¨îËÄÖÂ∞±Âú®È°πÁõÆ‰∏≠ËØï‰∫Ü‰∏ãspring-cloud-sleuth-zipkin„ÄÇ Ëµ∑‰∫Ü‰∏â‰∏™ÊúçÂä°Ôºözipkin-server„ÄÅzipkin-client-backend„ÄÅzipkin-client„ÄÇÂÖ∂‰∏≠serverÊúçÂä°Ë¥üË¥£Êî∂ÈõÜ‰ª•Âèä‰ø°ÊÅØÂ±ïÁ§∫„ÄÇclient-backendË∞ÉÁî®clientÔºå‰∫ßÁîüË∞ÉÁî®ÈìæË∑Ø‰ø°ÊÅØ„ÄÇ 3.1 zipkin-serverÂÆûÁé∞zipkin-serverÂÆûÁé∞‰∏ªË¶ÅÊúâ‰∏§ÁÇπÈúÄË¶ÅÊ≥®ÊÑèÔºåÂÖ∂‰∏ÄÊòØÊî∂ÈõÜÂà∞Êï∞ÊçÆÁöÑÂ≠òÂÇ®ÔºåÊñπÂºèÂåÖÊã¨ÂÜÖÂ≠ò„ÄÅÊï∞ÊçÆÂ∫ì„ÄÅESÁ≠âÔºõÂÖ∂‰∫åÊòØÈÄö‰ø°ÊñπÂºèÔºåÂåÖÊã¨httpÈÄö‰ø°ÂíåmqÂºÇÊ≠•ÊñπÂºèÈÄö‰ø°ÔºåhttpÈÄö‰ø°‰ºöÂØπÊ≠£Â∏∏ÁöÑËÆøÈóÆÈÄ†ÊàêÂΩ±ÂìçÔºåÊâÄ‰ª•ËøòÊòØÊé®ËçêÂü∫‰∫émqÂºÇÊ≠•ÊñπÂºèÈÄö‰ø°„ÄÇ Êú¨Êñá‰ΩøÁî®mysql‰Ωú‰∏∫Â≠òÂÇ®Ôºå‰ΩøÁî®MQÈÄö‰ø°ÔºåMQÈÄö‰ø°Âü∫‰∫éSpring-cloud-Stream„ÄÇÊú¨ÊñáÈáçÁÇπ‰∏çÂú®zipkin-serverÁöÑÂÖ∑‰ΩìÂá†ÁßçÂÆûÁé∞ÊñπÂºèÔºåÂÖ∂‰ªñÊñπÂºèÔºåËØªËÄÖÂèØ‰ª•Ëá™Â∑±ÂéªÂÆòÁΩëÊü•Áúã„ÄÇ Ôºà1ÔºâpomÈúÄË¶ÅÊ∑ªÂä†ÁöÑÂºïÁî®Â¶Ç‰∏ãÔºö 1234567891011121314151617181920212223242526272829&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--zipkin‰æùËµñ--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-sleuth-zipkin-stream&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-stream-rabbit&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.zipkin.java&lt;/groupId&gt; &lt;artifactId&gt;zipkin-autoconfigure-ui&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;!--‰øùÂ≠òÂà∞Êï∞ÊçÆÂ∫ìÈúÄË¶ÅÂ¶Ç‰∏ã‰æùËµñ--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt; &lt;/dependency&gt; Ôºà2ÔºâÂêØÂä®Á±ªÔºö 12345678// ‰ΩøÁî®StreamÊñπÂºèÂêØÂä®ZipkinServer@EnableZipkinStreamServer@SpringBootApplicationpublic class ZipkinStreamServerApplication &#123; public static void main(String[] args) &#123; SpringApplication.run(ZipkinStreamServerApplication.class,args); &#125;&#125; @EnableZipkinStreamServerÊ≥®Ëß£ÂºïÂÖ•‰∫Ü@EnableZipkinServerÊ≥®Ëß£ÔºåÂêåÊó∂ËøòÂàõÂª∫‰∫Ü‰∏Ä‰∏™rabbit-mqÁöÑSleuthSinkÊ∂àÊÅØÈòüÂàóÁõëÂê¨Âô®„ÄÇ Ôºà3ÔºâÈÖçÁΩÆÊñá‰ª∂ 123456789101112131415161718192021222324252627server: port: 9411spring: datasource: username: root password: root123 schema[0]: classpath:/zipkin.sqlzipkin: storage: type: mysql---spring: application: name: microservice-zipkin-stream-server rabbitmq: host: $&#123;RABBIT_ADDR:localhost&#125; port: $&#123;RABBIT_PORT:5672&#125; username: guest password: guest sleuth: enabled: false profiles: default datasource: url: jdbc:mysql://localhost:3307/zipkin?autoReconnect=true&amp;useSSL=false zipkin.sqlÂèØ‰ª•ÂéªÂÆòÁΩëËé∑ÂèñÔºåËÆæÁΩÆ‰∫Üzipkin-serverÁöÑÁ´ØÂè£Âè∑‰∏∫9411„ÄÇ 3.2 zipkin-client‰∏§‰∏™zipkin-clientÁöÑÈÖçÁΩÆ‰∏ÄÊ†∑ÔºåÊâÄ‰ª•ÊîæÂú®‰∏ÄËµ∑„ÄÇ Ôºà1Ôºâpom‰æùËµñ 12345678910111213&lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-sleuth-zipkin-stream&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-stream-rabbit&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-sleuth&lt;/artifactId&gt; &lt;/dependency&gt; (2) ÈÖçÁΩÆÊñá‰ª∂ 123456spring: rabbitmq: host: 127.0.0.1 port : 5672 username: guest password: guest 3.3 ÁªìÊûúÊúçÂä°‰πãÈó¥ÁöÑË∞ÉÁî®ÂÖ≥Á≥ªÂ¶Ç‰∏ãÔºö ÂèØ‰ª•ÁúãÂà∞ÂÆ¢Êà∑Á´ØÁöÑËØ∑Ê±ÇÁªèËøágatewayÔºåË∞ÉÁî®ÂÜÖÁΩë‰∏≠ÁöÑÂêÑ‰∏™ÊúçÂä°ÔºåÈÉ®ÂàÜËøòÊ∂âÂèäÂà∞Ë∞ÉÁî®noticeÊúçÂä°„ÄÇ‰ªéÂõæ‰∏≠ÂèØ‰ª•Ê∏ÖÊ•öÁöÑÁúãÂá∫ÂÆ¢Êà∑Á´ØËØ∑Ê±ÇÊâÄÁªèËøáÁöÑÊúçÂä°„ÄÇ‰∏ãÈù¢Áúã‰∏ãdemo2-defaultÊúçÂä°ÂÆû‰æã‰∏≠ÁöÑhttp pathÔºö ‰∏äÂõæ‰∏≠demo2-defaultÊúçÂä°ÁöÑÂá†‰∏™http pathÊåâÁÖßÊó∂ÈïøÊéíÂ∫èÔºåÊòæÁ§∫‰∫ÜtraceË∞ÉÁî®Êó∂ÈïøÂíåspanÊï∞Èáè„ÄÇÁÇπËøõÂéªÂèØ‰ª•ÁúãÂà∞Ôºö Âõæ‰∏≠ÂàóÂá∫‰∫Ü‰ªéÁà∂spanÂºÄÂßãÔºåÊØè‰∏Ä‰∏™spanÁöÑËÄóÊó∂„ÄÇÊú¨Ê¨°trace‰∏≠ÔºåÊ∂âÂèäÂà∞‰∏§‰∏™ÊúçÂä°demo1Âíådemo2„ÄÇdemo2Ë∞ÉÁî®demo1Ôºå‰ªé597msÂºÄÂßãË∞ÉÁî®demo1ÔºåÂÆåÊàêÊúÄÁªàÁöÑËØ∑Ê±ÇÊÄªÂÖ±ËÄóÊó∂1265ms„ÄÇ 4. pinpointÂØπ‰ª£Á†ÅÈõ∂‰æµÂÖ•ÔºåËøêÁî®JavaAgentÂ≠óËäÇÁ†ÅÂ¢ûÂº∫ÊäÄÊúØÔºåÂè™ÈúÄË¶ÅÂä†ÂêØÂä®ÂèÇÊï∞Âç≥ÂèØ„ÄÇpinpointÁöÑÂá†‰∏™ÁªÑ‰ª∂ÈÉ®ÂàÜÂíåzipkinÂ∑Æ‰∏çÂ§öÔºåÊû∂ÊûÑÂõæÂ¶Ç‰∏ãÔºö Pinpoint-CollectorÊî∂ÈõÜÂêÑÁßçÊÄßËÉΩÊï∞ÊçÆ„ÄÅPinpoint-AgentÂíåËá™Â∑±ËøêË°åÁöÑÂ∫îÁî®ÂÖ≥ËÅîËµ∑Êù•ÁöÑÊé¢Èíà„ÄÅPinpoint-WebÂ∞ÜÊî∂ÈõÜÂà∞ÁöÑÊï∞ÊçÆÊòæÁ§∫ÊàêWEBÁΩëÈ°µÂΩ¢Âºè„ÄÅHBase StorageÊî∂ÈõÜÂà∞ÁöÑÊï∞ÊçÆÂ≠òÂà∞HBase‰∏≠„ÄÇ 4.1 pinpointÂÆâË£Ö‰∏ªË¶ÅÊ∂âÂèä‰ª•‰∏ãËΩØ‰ª∂ÁöÑÂÆâË£ÖÔºö jdk 1.8JavaÁéØÂ¢ÉÂøÖÈ°ªÁöÑÔºåÊ≤°Âï•Â•ΩËß£Èáä„ÄÇ HbasepinpointÊî∂ÈõÜÊù•ÁöÑÊµãËØïÊï∞ÊçÆÔºå‰∏ªË¶ÅÊòØÂ≠òÂú®HbaseÊï∞ÊçÆÂ∫ìÁöÑ„ÄÇÊâÄ‰ª•ÂÆÉÂèØ‰ª•Êî∂ÈõÜÂ§ßÈáèÁöÑÊï∞ÊçÆÔºåÂèØ‰ª•ËøõË°åÊõ¥Âä†ËØ¶ÁªÜÁöÑÂàÜÊûê„ÄÇHbaseÂÆâË£ÖÂÆåÊàêÂêéÔºåÈúÄË¶ÅÂàùÂßãÂåñHbaseÁöÑpinpointÂ∫ìÔºåÁî±pinpointÊèê‰æõ„ÄÇHbaseÂÜÖÁΩÆ‰∫Üzookeeper„ÄÇ pinpoint-collectorcollectorÊî∂ÈõÜagentÁöÑÊï∞ÊçÆÔºåÂ∞ÜÊï∞ÊçÆÂ≠òÂà∞hbaseÈõÜÁæ§ÔºåÂØπÂ§ñÊö¥Èú≤collectorÁöÑtcpÂíåudpÁöÑÁõëÂê¨Á´ØÂè£9994Ôºå9995Ôºå9996„ÄÇ pinpoint-webÈ°µÈù¢Â±ïÁ§∫ÔºåÈÖçÁΩÆÊñá‰ª∂‰∏≠ËÆæÁΩÆÁéØÂ¢ÉÂèòÈáèHBASE_HOST„ÄÅHBASE_PORTÁ≠â„ÄÇ pinpoint-agent Âà∞ÂÆòÁΩëreleaseÈ°µÈù¢‰∏ãËΩΩpinpoint-agent-x-SNAPSHOT.tar.gzÔºåÈÖçÁΩÆpinpoint.config‰∏≠Áõ∏ÂÖ≥collectorÁöÑ‰ø°ÊÅØ„ÄÇ ÂÆâË£ÖÁ°ÆÂÆûËøòÊØîËæÉÈ∫ªÁÉ¶ÔºåÊú¨ÊñáÁØáÂπÖÂ§™Èïø‰∫ÜÔºåÂÖ∑‰ΩìÊ≠•È™§ÂêéÈù¢ÂÜçÂçïÁã¨ÂÜôÊñáÁ´†ËÆ≤Ëß£„ÄÇ 4.2 ËøêË°åpinpoint-agentÁ¨îËÄÖ‰ΩøÁî®ÁöÑÊòØspring-bootÈ°πÁõÆÔºåÊâÄ‰ª•Âè™ÈúÄË¶ÅÂú®ÂêØÂä®jarÂåÖÁöÑÂëΩ‰ª§‰∏≠Âä†ÂÖ•-javaagentÂèÇÊï∞ÔºåÂπ∂ÊåáÂÆöpinpoint-bootstrapÂåÖÁöÑÁªùÂØπË∑ØÂæÑ„ÄÇÂÆû‰æã‰ª£Á†ÅÂ¶Ç‰∏ãÔºö 1java -javaagent:/aoho/auth_compose/pinpoint-bootstrap-1.6.0.jar -Dpinpoint.agentId=aoho-consumer -Dpinpoint.applicationName=aoho-consumer -jar id_generator/snowflake-id-generate-1.0-SNAPSHOT.jar Ëµ∑ÁöÑidÁîüÊàêÂô®ÊúçÂä°ÊØîËæÉÁÆÄÂçïÔºåÊ≤°ÊúâÁî®Âà∞Êï∞ÊçÆÂ∫ìÁ≠âÂ≠òÂÇ®‰ªãË¥®„ÄÇÊúçÂä°Ê≥®ÂÜåÂà∞consul‰∏äÔºåÊú¨Âú∞ÂÆ¢Êà∑Á´ØËØ∑Ê±Ç‰∫Üid-serverËé∑Âèñid„ÄÇÂÖ∂Ë∞ÉÁî®ÈìæÂ¶Ç‰∏ãÔºö pinpointÊèê‰æõÁöÑÂäüËÉΩÊØîËæÉ‰∏∞ÂØåÔºå‰∏ãÂõæÊòØË∞ÉÁî®/api/idÊé•Âè£ÁöÑËØ¶ÁªÜ‰ø°ÊÅØ„ÄÇ ÂèØ‰ª•ÁúãÂà∞ÔºåpinpointËÆ∞ÂΩï‰∫ÜÂÆ¢Êà∑Á´ØÁöÑÁõ∏Â∫îÊó∂Èó¥„ÄÅIPÂú∞ÂùÄÁ≠âÔºåË∞ÉÁî®Ê†ëÂú®‰∏ãÈù¢‰πüÊúâËØ¶ÁªÜÂàóÂá∫ÔºåÊØè‰∏™ÊñπÊ≥ïÁöÑËÄóÊó∂Á≠â„ÄÇ serverMap‰∏≠ËøòÂ±ïÁ§∫‰∫ÜÊúçÂä°Âô®ÁöÑÂ†Ü„ÄÅÊ∞∏‰πÖ‰ª£„ÄÅCPUÁ≠â‰ø°ÊÅØÔºåÈùûÂ∏∏Âº∫Â§ß„ÄÇ 5. SkywalkingSkywalkingÊòØÂõΩÂÜÖÂºÄÊ∫êÁöÑAPMÁõëÊéßÁªÑ‰ª∂ÔºåÂÆòÁΩëOpenSkywalkingÔºåÊ†πÊçÆÂÆòÁΩë‰ªãÁªçÔºåÂÖ∂ÁùÄÂäõ‰∫éÊÄßËÉΩÂíåÂÆûÊó∂ÊÄß‰∏§ÊñπÈù¢„ÄÇÁΩë‰∏äÊâæÂà∞ÁöÑSkywalkingÁöÑÊû∂ÊûÑÂõæ„ÄÇ ÂèØ‰ª•ÁúãÂà∞Skywalking‰πüÊòØÂõõÈÉ®ÂàÜÁªÑÊàêÔºåcollector„ÄÅagent„ÄÅweb„ÄÅstorage„ÄÇÊîØÊåÅÈõÜÁæ§ÈÉ®ÁΩ≤ÔºåÈõÜÁæ§‰πãÈó¥ËøòÂºïÂÖ•‰∫ÜgrpcÈÄö‰ø°„ÄÇÂ≠òÂÇ®ÊîØÊåÅÂÜÖÁΩÆÁöÑh2ÂíåelasticsearchÂ≠òÂÇ®„ÄÇ 5.1 ÂÆâË£ÖÂÖ∑‰ΩìÂÆâË£ÖÂèØËßÅÂÆòÁΩë„ÄÇ collectorÂÆâË£ÖÊ≠§Â§ÑÁ¨îËÄÖ‰ΩøÁî®ÂçïÊú∫ÁâàÁöÑcollectorÔºåÂú®releaseÈ°µÈù¢‰∏ãËΩΩÂ•ΩÂéãÁº©ÂåÖÔºåËß£ÂéãÂêéÔºåÂçïÊú∫ÁâàÁöÑcollectorÈªòËÆ§‰ΩøÁî®h2Êï∞ÊçÆÂ∫ìÔºåÊâÄ‰ª•ÈÖçÁΩÆÊñá‰ª∂ÂèØ‰ª•‰∏çÈúÄË¶Å‰øÆÊîπÔºåÂç≥ÂèØ‰ª•ËøêË°åbin/startup.sh„ÄÇ ÁõÆÂΩïÁªìÊûÑÂ¶Ç‰∏äÔºålogsÊñá‰ª∂Â§π‰∏≠ÔºåÊúâÂêØÂä®ÁöÑÊó•ÂøóÔºåÂèØ‰ª•Êü•ÁúãÂêØÂä®ÊÉÖÂÜµ„ÄÇ webËß£ÂéãÂ•Ωskywalking-uiÔºåËÆæÁΩÆserverÁöÑconfig/collector_config.properties„ÄÅlog4j2‰ª•ÂèäÁõëÂê¨Á´ØÂè£Á≠âÁõ∏ÂÖ≥‰ø°ÊÅØÔºå agentÊã∑Ë¥ùskywalking-agentÁõÆÂΩïÂà∞ÊâÄÈúÄ‰ΩçÁΩÆÔºåÊé¢ÈíàÂåÖÂê´Êï¥‰∏™ÁõÆÂΩïÔºåËÆæÁΩÆ/config/agent.config‰∏≠ÁöÑcollector‰ø°ÊÅØ„ÄÇ 5.2 ËøêË°åagentSpring bootÁöÑÈ°πÁõÆÔºåÂêØÂä®Âíå‰∏äÈù¢pinpoint agentÂêØÂä®ÊñπÂºèÁõ∏Âêå„ÄÇÂ¢ûÂä†JVMÂêØÂä®ÂèÇÊï∞Ôºå-javaagent:/path/to/skywalking-agent/skywalking-agent.jar„ÄÇ ËøôÊ¨°Ëµ∑‰∫ÜuserÊúçÂä°ÔºåÊ∂âÂèäÂà∞mysql„ÄÅredis„ÄÅconsulÁ≠âÁªÑ‰ª∂„ÄÇÂèØ‰ª•ÁúãÂà∞ÂÖ∂Ë∞ÉÁî®ÈìæË∑ØÂõæÂ¶Ç‰∏ãÔºö ÂΩìËÆøÈóÆ/api/external/register-codeÂíå/api/external/validate-codeÊé•Âè£Êó∂ÔºåÂΩ¢Êàê‰∫Ü‰∏äÂõæ‰∏≠ÁöÑË∞ÉÁî®Èìæ„ÄÇ ‰∏äÂõæTraceId‰∏∫ 2.59.15103021777910001ÁöÑËØ∑Ê±Ç/api/external/register-code„ÄÇËøôÊ¨°trace‰∏≠ÔºåÊØè‰∏™Ê∂âÂèäÁöÑspanÁöÑËÄóÊó∂ÈÉΩÊúâÂú®Âõæ‰∏≠ÁªüËÆ°„ÄÇ ‰∏äÈù¢ËøôÂº†ÂõæÔºåÊòØÂØπuserService‰∏≠ÁöÑEntry Service ListÊé•Âè£ËøõË°å‰∫ÜÁªüËÆ°ÔºåÂåÖÊã¨Ë∞ÉÁî®Êï∞„ÄÅÊàêÂäüÁéáÁ≠â‰ø°ÊÅØ„ÄÇÔºàÂõ†‰∏∫ÂÜÖÁΩÆÁöÑh2ÔºåËøôËæπÂú®UIÂìçÂ∫îÂæà‰πÖÔºâ ËøòÊúâ‰∏™ÂØπinstanceÁöÑÁªüËÆ°ÔºåÁªüËÆ°jvmÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØÔºåAPIÂìçÂ∫î‰πüÂæàÊÖ¢ÔºåÂèØËÉΩ‰∏éÊàëÁî®ÁöÑÂ≠òÂÇ®ÊúâÂÖ≥ÂêßÔºåÂ∞±‰∏çÊà™Âõæ‰∫Ü„ÄÇ 6. ÊÄªÁªìÊú¨Êñá‰∏ªË¶ÅÂÜô‰∫ÜÈìæË∑ØÁõëÊéßÁªÑ‰ª∂ÁöÑÂÆûË∑µ„ÄÇÈ¶ñÂÖà‰ªãÁªç‰∫ÜÈìæË∑ØÁõëÊéßÁªÑ‰ª∂‰∫ßÁîü‰∏éÂ∫îÁî®ÁöÑËÉåÊôØÔºå‰ª•ÂèäÈÄâÊã©ÁöÑË¶ÅÊ±ÇÔºõÂÖ∂Ê¨°‰ªãÁªç‰∫Üopentracing‰∏≠Ê∂âÂèäÁöÑÂü∫Êú¨Ê¶ÇÂøµÔºõÊúÄÂêéÂ§ßÁØáÂπÖ‰ªãÁªç‰∫Ü‰∏âÁßçAPMÁªÑ‰ª∂ÁöÑÂÆâË£Ö‰∏é‰ΩøÁî®ÔºåÂπ∂Â±ïÁ§∫‰∫ÜÊØèÁßçAPMÁöÑUIÊà™Âõæ„ÄÇÊú¨ÊñáÊØîËæÉÁÆÄÂçïÔºå‰∏ã‰∏ÄÁØáÊñáÁ´†‰∏ªË¶Å‰ªãÁªçÂá†ÁßçAPMÈÄâÂûãÁöÑÊØîËæÉ‰∏éÊÄßËÉΩÊµãËØï„ÄÇ zipkin-server-streamÁöÑÊ∫êÁ†Ågithub: https://github.com/keets2012/Spring-Boot-Samples/oschina: https://gitee.com/keets/spring-boot-samples ÂèÇËÄÉ(ÁñØÁãÇÊâæËµÑÊñô) OpenTracingÂÆòÊñπÊ†áÂáÜ-‰∏≠ÊñáÁâà Skywalking Zipkin PinPoint Spring Cloud Sleuth Dapper pinpoint ÂÆâË£ÖÈÉ®ÁΩ≤ javaÂºÄÊ∫êAPMÊ¶ÇË¶Å ÂàÜÂ∏ÉÂºèÁ≥ªÁªüÁõëÊéßÁ≥ªÁªüzipkinÂÖ•Èó® Ë∑üÁùÄÂ∞èÁ®ãÂ≠¶ÂæÆÊúçÂä°-Ëá™Â∑±Âä®ÊâãÊâ©Â±ïÂàÜÂ∏ÉÂºèË∞ÉÁî®Èìæ]]></content>
      <categories>
        <category>Ops</category>
      </categories>
      <tags>
        <tag>APM</tag>
        <tag>zipkin</tag>
        <tag>micro-service</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÂæÆÊúçÂä°ÈÉ®ÁΩ≤‰πãMavenÊèí‰ª∂ÊûÑÂª∫DockerÈïúÂÉè]]></title>
    <url>%2F2017%2F11%2F02%2Fdockermaven%2F</url>
    <content type="text"><![CDATA[1.ËÉåÊôØÂæÆÊúçÂä°Êû∂ÊûÑ‰∏ãÔºåÂæÆÊúçÂä°Âú®Â∏¶Êù•ËâØÂ•ΩÁöÑËÆæËÆ°ÂíåÊû∂ÊûÑÁêÜÂøµÁöÑÂêåÊó∂Ôºå‰πüÂ∏¶Êù•‰∫ÜËøêÁª¥‰∏äÁöÑÈ¢ùÂ§ñÂ§çÊùÇÊÄßÔºåÂ∞§ÂÖ∂ÊòØÂú®ÊúçÂä°ÈÉ®ÁΩ≤ÂíåÊúçÂä°ÁõëÊéß‰∏ä„ÄÇÂçï‰ΩìÂ∫îÁî®ÊòØÈõÜ‰∏≠ÂºèÁöÑÔºåÂ∞±‰∏Ä‰∏™Âçï‰ΩìË∑ëÂú®‰∏ÄËµ∑ÔºåÈÉ®ÁΩ≤ÂíåÁÆ°ÁêÜÁöÑÊó∂ÂÄôÈùûÂ∏∏ÁÆÄÂçïÔºåËÄåÂæÆÊúçÂä°ÊòØ‰∏Ä‰∏™ÁΩëÁä∂ÂàÜÂ∏ÉÁöÑÔºåÊúâÂæàÂ§öÊúçÂä°ÈúÄË¶ÅÁª¥Êä§ÂíåÁÆ°ÁêÜÔºåÂØπÂÆÉËøõË°åÈÉ®ÁΩ≤ÂíåÁª¥Êä§ÁöÑÊó∂ÂÄôÂàôÊØîËæÉÂ§çÊùÇ„ÄÇ ‰∏ãÈù¢‰ªéDevÁöÑËßíÂ∫¶Êù•Áúã‰∏Ä‰∏ãOpsÁöÑÂ∑•‰Ωú„ÄÇ‰ªéDevÊèê‰∫§‰ª£Á†ÅÔºåÂà∞ÂÆåÊàêÈõÜÊàêÊµãËØïÁöÑ‰∏ÄÁ≥ªÂàóÊ≠•È™§Â¶Ç‰∏ãÔºö È¶ñÂÖàÊòØÂºÄÂèë‰∫∫ÂëòÊääÁ®ãÂ∫è‰ª£Á†ÅÊõ¥Êñ∞Âêé‰∏ä‰º†Âà∞GitÔºåÁÑ∂ÂêéÂÖ∂‰ªñÁöÑ‰∫ãÊÉÖÈÉΩÂ∞ÜÁî±JenkinsËá™Âä®ÂÆåÊàê„ÄÇ ÁÑ∂ÂêéGitÂú®Êé•Êî∂Âà∞Áî®Êà∑Êõ¥Êñ∞ÁöÑ‰ª£Á†ÅÂêéÔºå‰ºöÊääÊ∂àÊÅØÂíå‰ªªÂä°‰º†ÈÄíÁªôJenkinsÔºåÁÑ∂ÂêéJenkins‰ºöËá™Âä®ÊûÑÂª∫‰∏Ä‰∏™‰ªªÂä°Ôºå‰∏ãËΩΩMavenÁõ∏ÂÖ≥ÁöÑËΩØ‰ª∂ÂåÖ„ÄÇ‰∏ãËΩΩÂÆåÊàêÂêéÔºåÂ∞±ÂºÄÂßãÂà©Áî®Maven BuildÊñ∞ÁöÑÈ°πÁõÆÂåÖÔºåÁÑ∂ÂêéÈáçÂª∫MavenÂÆπÂô®ÔºåÊûÑÂª∫Êñ∞ÁöÑImageÂπ∂PushÂà∞DockerÁßÅÊúâÂ∫ì‰∏≠„ÄÇ ÊúÄÂêéÂà†Èô§Ê≠£Âú®ËøêË°åÁöÑDockerÂÆπÂô®ÔºåÂÜçÂü∫‰∫éÊñ∞ÁöÑÈïúÂÉèÈáçÊñ∞ÊääDockerÂÆπÂô®ÂêØÂä®ÔºåËá™Âä®ÂÆåÊàêÈõÜÊàêÊµãËØï„ÄÇ Êï¥‰∏™ËøáÁ®ãÈÉΩÊòØËá™Âä®ÁöÑÔºåËøôÊ†∑Â∞±ÁÆÄÂåñ‰∫ÜÂéüÊú¨Â§çÊùÇÁöÑÈõÜÊàêÂ∑•‰ΩúÔºå‰∏ÄÂ§©ÂèØ‰ª•ÈõÜÊàê‰∏ÄÊ¨°ÔºåÁîöËá≥ÊòØÂ§öÊ¨°„ÄÇ Êú¨Êñá‰∏ªË¶ÅÂÖ≥Ê≥®ÁöÑÁ¨¨‰∫åÊ≠•Ôºå‰Ωú‰∏∫Dev‰ΩøÁî®MavenÊèí‰ª∂ÊûÑÂª∫DockerÈïúÂÉè„ÄÇ 2. ËøáÁ®ãÊ≠•È™§2.1 ÁéØÂ¢ÉÁ¨îËÄÖÁöÑÁîµËÑëÁ≥ªÁªüÊòØMacOSÔºåÂú®ËøõË°å‰∏ãÈù¢ÁöÑÊ≠•È™§‰πãÂâçÔºåÂÖàÂÖ∑Â§á‰∏Ä‰∏ãÊù°‰ª∂Ôºö Docker Registry MavenÔºà3.5.0Ôºâ JDK(1.8.0_131) Docker for Mac (17.09.0-ce-mac35) Maven ÂíåJDK Â∞±‰∏çÁî®ËøáÂ§öÂ§ö‰∫ÜÔºåÂøÖÈ°ªÂÖ∑ÊúâÁöÑ„ÄÇDocker RegistryÊòØÁßÅÊúâÁöÑhubÔºåmac‰∏äË£ÖÂ•Ωdocker‰πãÂêéÔºåÈÖçÁΩÆ‰∏Ä‰∏ãDocker RegistryÁöÑÂú∞ÂùÄÔºåÈÖçÁΩÆÂ¶Ç‰∏ãÔºö 1234567&#123; "debug" : true, "experimental" : false, "insecure-registries" : [ "192.168.1.202" ]&#125; ÈÖçÁΩÆÂ•ΩregistryÂú∞ÂùÄ‰πãÂêéÔºåÊú¨Âú∞pullÈïúÂÉèÔºåËøòÈúÄË¶ÅÂëΩ‰ª§Ë°åloginÂà∞registryÔºö 1docker login 192.168.1.202 --username admin --password 123456 2.2 pomÊñá‰ª∂pomÊñá‰ª∂‰∏≠ÈúÄË¶ÅÂºïÂÖ•Áõ∏Â∫îÁöÑÊèí‰ª∂„ÄÇdocker-maven-pluginÊúâ‰∏âÊ¨æÔºöspotify„ÄÅfabric8ioÂíåbibryam„ÄÇÂÖ∂‰∏≠Á¨¨‰∏ÄÊ¨æÊúÄ‰∏∫ÊµÅË°åÔºåËµÑÊñô‰πüÂ§öÔºåÊâÄ‰ª•ÊØ´‰∏çÁäπË±´ÈÄâÊã©Á¨¨‰∏ÄÊ¨æ„ÄÇÊèí‰ª∂Êúâ‰∏§Áßç‰ΩøÁî®ÊñπÂºèÔºå‰∏ÄÁßçÊòØÂú®Áõ¥Êé•Âú®pomÈÖçÁΩÆ‰∏≠ÊåáÂÆöbaseImageÂíåentryPoint„ÄÇÂè¶‰∏ÄÁßçÈÄÇÂêà‰∫éÂ§çÊùÇÁöÑÊûÑÂª∫Ôºå‰ΩøÁî®dockerfileÔºåÂè™ÈúÄË¶ÅÂú®ÈÖçÁΩÆ‰∏≠ÊåáÂÆödockerfileÁöÑ‰ΩçÁΩÆ„ÄÇÂâç‰∏ÄÁßçÊØîËæÉÁÆÄÂçïÔºåÊ≠§Â§ÑÁï•ËøáÔºå‰∏ªË¶ÅËÆ≤‰∏ãÁ¨¨‰∫åÁßçÁöÑÈÖçÁΩÆ„ÄÇ 12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;plugin&gt; &lt;groupId&gt;com.spotify&lt;/groupId&gt; &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt; &lt;version&gt;$&#123;maven.docker.version&#125;&lt;/version&gt; &lt;!--Êèí‰ª∂ÁªëÂÆöÂà∞phase--&gt; &lt;executions&gt; &lt;execution&gt; &lt;phase&gt;install&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;build&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;configuration&gt; &lt;!--ÈÖçÁΩÆÂèòÈáèÔºåÂåÖÊã¨ÊòØÂê¶build„ÄÅimageName„ÄÅimageTagÔºåÈùûÂ∏∏ÁÅµÊ¥ª--&gt; &lt;skipDocker&gt;$&#123;docker.skip.build&#125;&lt;/skipDocker&gt; &lt;imageName&gt;$&#123;docker.image.prefix&#125;/$&#123;project.artifactId&#125;&lt;/imageName&gt; &lt;!--ÊúÄÂêéÈïúÂÉè‰∫ßÁîü‰∫Ü‰∏§‰∏™tagÔºåÁâàÊú¨ÂíåÂíåÊúÄÊñ∞ÁöÑ--&gt; &lt;imageTags&gt; &lt;imageTag&gt;$&#123;project.version&#125;&lt;/imageTag&gt; &lt;imageTag&gt;latest&lt;/imageTag&gt; &lt;/imageTags&gt; &lt;forceTags&gt;true&lt;/forceTags&gt; &lt;env&gt; &lt;TZ&gt;Asia/Shanghai&lt;/TZ&gt; &lt;/env&gt; &lt;!--Êó∂Âå∫ÈÖçÁΩÆ--&gt; &lt;runs&gt; &lt;run&gt;ln -snf /usr/share/zoneinfo/$TZ /etc/localtime&lt;/run&gt; &lt;run&gt;echo $TZ &gt; /etc/timezone&lt;/run&gt; &lt;/runs&gt; &lt;dockerDirectory&gt;$&#123;project.basedir&#125;&lt;/dockerDirectory&gt; &lt;resources&gt; &lt;resource&gt; &lt;targetPath&gt;/&lt;/targetPath&gt; &lt;directory&gt;$&#123;project.build.directory&#125;&lt;/directory&gt; &lt;include&gt;$&#123;project.build.finalName&#125;.jar&lt;/include&gt; &lt;/resource&gt; &lt;/resources&gt; &lt;!--pushÂà∞ÁßÅÊúâÁöÑhub--&gt; &lt;serverId&gt;docker-registry&lt;/serverId&gt; &lt;/configuration&gt; &lt;/plugin&gt; ${maven.docker.version}„ÄÅ${docker.skip.build}„ÄÅ${docker.image.prefix}ÈÉΩÊòØÂèØÈÖçÁΩÆÁöÑÂèòÈáè„ÄÇ${project.basedir}„ÄÅ${project.build.directory}„ÄÅ${project.build.finalName}„ÄÅ${project.version}ÂàÜÂà´ÂØπÂ∫îÈ°πÁõÆÊ†πÁõÆÂΩï„ÄÅÊûÑÂª∫ÁõÆÂΩï„ÄÅÊâìÂåÖÂêéÁîüÊàêÁöÑÁªìÊûúÂêçÁß∞„ÄÅÈ°πÁõÆÁâàÊú¨Âè∑„ÄÇ‰∏äÈù¢ÁöÑpomÊèí‰ª∂ÈÖçÁΩÆÔºåÊåáÂÆö‰∫ÜdockerfileÁöÑ‰ΩçÁΩÆÂíåÈïúÂÉèÁöÑÂëΩÂêçËßÑÂàô„ÄÇÂπ∂Â∞ÜdockerÁöÑbuildÁõÆÊ†áÔºåÁªëÂÆöÂú®installËøô‰∏™phase‰∏ä„ÄÇ 2.3 dockerfile12345FROM 192.168.1.202/library/basejavaVOLUME /tmpADD ./target/cloud-api-gateway-1.2.0.RELEASE.jar app.jarRUN bash -c 'touch /app.jar'ENTRYPOINT ["java","-Djava.security.egd=file:/dev/./urandom","-jar","/app.jar"] dockerfile ÂÜôÁöÑÂæàÁÆÄÂçïÔºåÂ∞ÜjarÂåÖADDËøõÂéªÔºåÊèê‰æõENTRYPOINT„ÄÇ 2.4 setting.xmlÂú®pomÊèí‰ª∂‰∏≠ÔºåËøòÊúâ‰∏Ä‰∏™serverIdÁöÑÈÖçÁΩÆ„ÄÇËøô‰∏™ÈÖçÁΩÆÊòØÂøÖË¶ÅÁöÑÔºåÂØπ‰∫éÈúÄË¶ÅÂ∞Üimage‰∏ä‰º†Âà∞ÁßÅÊúâhub‰∏äÔºåÂú®Â¶Ç‰∏äÈÖçÁΩÆ‰πãÂêéÔºåÂè™ÈúÄË¶ÅÂä†‰∏ä-DpushImageÂç≥ÂèØÂÆûÁé∞„ÄÇserverIdÊòØ‰∏émavenÁöÑÈÖçÁΩÆÊñá‰ª∂setting.xmlÁõ∏ÂØπÂ∫îÔºåsetting.xml‰∏≠Â¢ûÂä†ÁöÑÈÖçÁΩÆÔºö 12345678&lt;server&gt; &lt;id&gt;docker-registry&lt;/id&gt; &lt;username&gt;Áî®Êà∑Âêç&lt;/username&gt; &lt;password&gt;ÂØÜÁ†Å&lt;/password&gt; &lt;configuration&gt; &lt;email&gt;ÈÇÆÁÆ±&lt;/email&gt; &lt;/configuration&gt;&lt;/server&gt; 2.5 ÁªìÊûú ‰∏äÂõæÊòØÊâßË°åmvn clean install -DpushImageÊàêÂäüÁöÑÁªìÊûú„ÄÇmvnÈ¶ñÂÖàÊòØÊâìÂåÖÔºåÂ∞ÜÁîü‰∫ßÁöÑÊñá‰ª∂Êã∑Ë¥ùÂà∞target‰∏ãÁöÑdockerÁõÆÂΩïÔºåÁÑ∂ÂêéÊâßË°ådockerfile‰∏≠ÁöÑÊ≠•È™§ÔºåÂ∞ÜÊâìÊàêÁöÑÈïúÂÉèËøõË°åtagÔºåÊúÄÂêé‰∏ä‰º†Âà∞ÁßÅÊúâhub‰∏ä„ÄÇ ‰∏äÂõæÊòØVMware Harbor‰∏≠ÁöÑÊà™ÂõæÔºåÂèØ‰ª•ÁúãÂà∞ÔºåÊàë‰ª¨Â∑≤ÁªèÊàêÂäüÂ∞ÜÈïúÂÉè‰∏ä‰º†ÔºåÂÖ∂tagÊúâ‰∏§‰∏™Ôºö1.2.0.RELEASEÂíålatest„ÄÇ 3. ÊÄªÁªìÊú¨ÊñáÂ±û‰∫éÂ∑•Á®ãÂÆûË∑µÁ±ªÊñáÁ´†ÔºåÊØîËæÉÁÆÄÂçï„ÄÇÂºÄÂ§¥Áî±ËÉåÊôØ‰ªãÁªç‰∫ÜDevÂà∞ÁªßÊâøÊµãËØïÁöÑ‰∏ÄÁ≥ªÂàóÊ≠•È™§ÔºåÊú¨Êñá‰∏ªË¶ÅÂÖ≥Ê≥®ÁöÑÊòØÁ¨¨‰∫åÊ≠•Ôºå‰Ωú‰∏∫Dev‰ΩøÁî®MavenÊèí‰ª∂ÊûÑÂª∫DockerÈïúÂÉè„ÄÇÊ≠£ÊñáÈÉ®ÂàÜ‰∏ªË¶ÅËÆ≤‰∫ÜÂÆûË∑µÁöÑÁéØÂ¢ÉÔºåÁÑ∂ÂêéËÆ≤‰∫Üdocker-maven-pluginÊèí‰ª∂ÁöÑ‰ΩøÁî®ÊñπÂºèÔºåÈáçÁÇπ‰ªãÁªç‰∫Ü‰ΩøÁî®dockerfileÁöÑÊñπÂºèÔºåÂØπ‰∫éÊ∂âÂèäÂà∞ÁöÑÈÖçÁΩÆËøõË°å‰∫ÜËß£Èáä„ÄÇ Êú¨ÊñáÁöÑÊ∫êÁ†ÅÂú∞ÂùÄÔºöGitHubÔºöhttps://github.com/keets2012/snowflake-id-generatorÁ†Å‰∫ëÔºö https://gitee.com/keets/snowflake-id-generator ÂèÇËÄÉ ‰ªéËøêÁª¥ÁöÑËßíÂ∫¶ÁúãÂæÆÊúçÂä°ÂíåÂÆπÂô® Docker‰∏éÂæÆÊúçÂä°-‰ΩøÁî®MavenÊèí‰ª∂ÊûÑÂª∫DockerÈïúÂÉè]]></content>
      <categories>
        <category>Ops</category>
      </categories>
      <tags>
        <tag>Docker</tag>
        <tag>Ops</tag>
        <tag>Spring Cloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞ÔºàÂõõÔºâ]]></title>
    <url>%2F2017%2F10%2F26%2Fsecurity4%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÔºö Êú¨ÊñáÁ≥ª„ÄäËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞„ÄãÁ≥ªÂàóÁöÑÂÆåÁªìÁØáÔºåÂâçÈù¢‰∏âÁØáÂ∑≤ÁªèÂ∞ÜËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂ÁöÑÊµÅÁ®ãÂíå‰∏ªË¶ÅÁªÜËäÇËÆ≤Ëß£ÂÆå„ÄÇÊú¨ÊñáÊØîËæÉÈïøÔºåÂØπËøô‰∏™Á≥ªÂàóËøõË°åÊî∂Â∞æÔºå‰∏ªË¶ÅÂÜÖÂÆπÂåÖÊã¨ÂØπÊéàÊùÉÂíåÈâ¥ÊùÉÊµÅÁ®ã‰πãÂ§ñÁöÑendpoint‰ª•ÂèäSpring SecurityËøáÊª§Âô®ÈÉ®ÂàÜË∏©ÂùëÁöÑÁªèÂéÜ„ÄÇÊ¨¢ËøéÈòÖËØªÊú¨Á≥ªÂàóÊñáÁ´†„ÄÇ 1. ÂâçÊñáÂõûÈ°æÈ¶ñÂÖàËøòÊòØÁÖß‰æãÂØπÂâçÊñáËøõË°åÂõûÈ°æ„ÄÇÂú®Á¨¨‰∏ÄÁØá ËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞Ôºà‰∏ÄÔºâ‰ªãÁªç‰∫ÜËØ•È°πÁõÆÁöÑËÉåÊôØ‰ª•ÂèäÊäÄÊúØË∞ÉÁ†î‰∏éÊúÄÂêéÈÄâÂûã„ÄÇÁ¨¨‰∫åÁØáËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞Ôºà‰∫åÔºâÁîªÂá∫‰∫ÜÁÆÄË¶ÅÁöÑÁôªÂΩïÂíåÊ†°È™åÁöÑÊµÅÁ®ãÂõæÔºåÂπ∂ÈáçÁÇπËÆ≤Ëß£‰∫ÜÁî®Êà∑Ë∫´‰ªΩÁöÑËÆ§ËØÅ‰∏étokenÂèëÊîæÁöÑÂÖ∑‰ΩìÂÆûÁé∞„ÄÇÁ¨¨‰∏âÁØáËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞Ôºà‰∏âÔºâÂÖà‰ªãÁªç‰∫ÜËµÑÊ∫êÊúçÂä°Âô®ÈÖçÁΩÆÔºå‰ª•ÂèäÂÖ∂‰∏≠Ê∂âÂèäÁöÑÈÖçÁΩÆÁ±ªÔºåÂêéÈù¢ÈáçÁÇπËÆ≤Ëß£‰∫Ütoken‰ª•ÂèäAPIÁ∫ßÂà´ÁöÑÈâ¥ÊùÉ„ÄÇ Êú¨ÊñáÂ∞Ü‰ºöËÆ≤Ëß£Ââ©‰ΩôÁöÑ‰∏§‰∏™ÂÜÖÁΩÆÁ´ØÁÇπÔºöÊ≥®ÈîÄÂíåÂà∑Êñ∞token„ÄÇÊ≥®ÈîÄtokenÁ´ØÁÇπÁöÑÂ§ÑÁêÜ‰∏éSpring SecurityÈªòËÆ§Êèê‰æõÁöÑÊúâ‰∫õ‚Äô/logout‚ÄôÊúâ‰∫õÂå∫Âà´Ôºå‰∏ç‰ªÖÊ∏ÖÁ©∫SpringSecurityContextHolder‰∏≠ÁöÑ‰ø°ÊÅØÔºåËøòË¶ÅÂ¢ûÂä†ÂØπÂ≠òÂÇ®tokenÁöÑÊ∏ÖÁ©∫„ÄÇÂè¶‰∏Ä‰∏™Âà∑Êñ∞tokenÁ´ØÁÇπÂÖ∂ÂÆûÂíå‰πãÂâçÁöÑËØ∑Ê±ÇÊéàÊùÉÊòØ‰∏ÄÊ†∑ÁöÑAPIÔºåÂè™ÊòØÂèÇÊï∞‰∏≠ÁöÑgrant_type‰∏ç‰∏ÄÊ†∑„ÄÇ Èô§‰∫Ü‰ª•‰∏ä‰∏§‰∏™ÂÜÖÁΩÆÁ´ØÁÇπÔºåÂêéÈù¢Â∞Ü‰ºöÈáçÁÇπËÆ≤‰∏ãÂá†ÁßçSpring SecurityËøáÊª§Âô®„ÄÇAPIÁ∫ßÂà´ÁöÑÊìç‰ΩúÊùÉÈôêÊ†°È™åÊú¨Êù•ËÆæÊÉ≥ÊòØÈÄöËøáSpring SecurityÁöÑËøáÊª§Âô®ÂÆûÁé∞ÔºåÁâπÂú∞ÊääËøôËæπÂ≠¶‰π†‰∫Ü‰∏ÄÈÅçÔºåË∏©‰∫Ü‰∏ÄÈÅçÂùë„ÄÇ ÊúÄÂêéÊòØÊú¨Á≥ªÂàóÁöÑÊÄªÁªìÔºåÂπ∂ÂØπ‰∫éÂ≠òÂú®ÁöÑ‰∏çË∂≥ÂíåÂêéÁª≠Â∑•‰ΩúËøõË°åËÆ∫Ëø∞„ÄÇ 2. ÂÖ∂‰ªñÁ´ØÁÇπ2.1 Ê≥®ÈîÄÁ´ØÁÇπÂú®Á¨¨‰∏ÄÁØá‰∏≠ÊèêÂà∞‰∫ÜAuthÁ≥ªÁªüÂÜÖÁΩÆÁöÑÊ≥®ÈîÄÁ´ØÁÇπ /logoutÔºåÂ¶ÇÊûúËøòËÆ∞ÂæóÁ¨¨‰∏âÁØáËµÑÊ∫êÊúçÂä°Âô®ÁöÑÈÖçÁΩÆÔºå‰∏ãÈù¢ÁöÑÂÖ≥‰∫é/logoutÈÖçÁΩÆ‰∏ÄÂÆö‰∏çÈôåÁîü„ÄÇ 123456//... .and().logout() .logoutUrl("/logout") .clearAuthentication(true) .logoutSuccessHandler(new HttpStatusReturningLogoutSuccessHandler()) .addLogoutHandler(customLogoutHandler()); ‰∏äÈù¢ÈÖçÁΩÆÁöÑ‰∏ªË¶Å‰ΩúÁî®ÊòØÔºö ËÆæÁΩÆÊ≥®ÈîÄÁöÑURL Ê∏ÖÁ©∫Authentication‰ø°ÊÅØ ËÆæÁΩÆÊ≥®ÈîÄÊàêÂäüÁöÑÂ§ÑÁêÜÊñπÂºè ËÆæÁΩÆËá™ÂÆö‰πâÁöÑÊ≥®ÈîÄÂ§ÑÁêÜÊñπÂºè ÂΩìÁÑ∂Âú®LogoutConfigurer‰∏≠ËøòÊúâÊõ¥Â§öÁöÑËÆæÁΩÆÈÄâÈ°πÔºåÁ¨îËÄÖÊ≠§Â§ÑÂàóÂá∫È°πÁõÆÊâÄÈúÄË¶ÅÁöÑÈÖçÁΩÆÈ°π„ÄÇËøô‰∫õÈÖçÁΩÆÈ°πÂõ¥ÁªïÁùÄLogoutFilterËøáÊª§Âô®„ÄÇÈ°∫Â∏¶ËÆ≤‰∏Ä‰∏ãSpring SecurityÁöÑËøáÊª§Âô®„ÄÇÂÖ∂‰ΩøÁî®‰∫ÜspringSecurityFillterChian‰Ωú‰∏∫‰∫ÜÂÆâÂÖ®ËøáÊª§ÁöÑÂÖ•Âè£ÔºåÂêÑÁßçËøáÊª§Âô®ÊåâÈ°∫Â∫èÂÖ∑‰ΩìÂ¶Ç‰∏ãÔºö SecurityContextPersistenceFilterÔºö‰∏éSecurityContextÂÆâÂÖ®‰∏ä‰∏ãÊñá‰ø°ÊÅØÊúâÂÖ≥ HeaderWriterFilterÔºöÁªôhttpÂìçÂ∫îÊ∑ªÂä†‰∏Ä‰∫õHeader CsrfFilterÔºöÈò≤Ê≠¢csrfÊîªÂáªÔºåÈªòËÆ§ÂºÄÂêØ LogoutFilterÔºöÂ§ÑÁêÜÊ≥®ÈîÄÁöÑËøáÊª§Âô® UsernamePasswordAuthenticationFilterÔºöË°®ÂçïËÆ§ËØÅËøáÊª§Âô® RequestCacheAwareFilterÔºöÁºìÂ≠òrequestËØ∑Ê±Ç SecurityContextHolderAwareRequestFilterÔºöÊ≠§ËøáÊª§Âô®ÂØπServletRequestËøõË°å‰∫Ü‰∏ÄÊ¨°ÂåÖË£ÖÔºå‰ΩøÂæórequestÂÖ∑ÊúâÊõ¥Âä†‰∏∞ÂØåÁöÑAPI AnonymousAuthenticationFilterÔºöÂåøÂêçË∫´‰ªΩËøáÊª§Âô® SessionManagementFilterÔºösessionÁõ∏ÂÖ≥ÁöÑËøáÊª§Âô®ÔºåÂ∏∏Áî®Êù•Èò≤Ê≠¢session-fixation protection attackÔºå‰ª•ÂèäÈôêÂà∂Âêå‰∏ÄÁî®Êà∑ÂºÄÂêØÂ§ö‰∏™‰ºöËØùÁöÑÊï∞Èáè ExceptionTranslationFilterÔºöÂºÇÂ∏∏Â§ÑÁêÜËøáÊª§Âô® FilterSecurityInterceptorÔºöwebÂ∫îÁî®ÂÆâÂÖ®ÁöÑÂÖ≥ÈîÆFilter ÂêÑÁßçËøáÊª§Âô®ÁÆÄÂçïÊ†áÊ≥®‰∫Ü‰ΩúÁî®ÔºåÂú®‰∏ã‰∏ÄËäÇÈáçÁÇπËÆ≤ÂÖ∂‰∏≠ÁöÑÂá†‰∏™ËøáÊª§Âô®„ÄÇÊ≥®ÈîÄËøáÊª§Âô®ÊéíÂú®Èù†ÂâçÁöÑ‰ΩçÁΩÆÔºåÊàë‰ª¨‰∏ÄËµ∑Áúã‰∏ãLogoutFilterÁöÑUMLÁ±ªÂõæ„ÄÇ Á±ªÂõæÂíåÊàë‰ª¨‰πãÂâçÈÖçÁΩÆÊó∂ÁöÑÊÄùË∑ØÊòØ‰∏ÄËá¥ÁöÑÔºåHttpSecurityÂàõÂª∫‰∫ÜLogoutConfigurerÔºåÊàë‰ª¨Âú®ËøôËæπÈÖçÁΩÆ‰∫ÜLogoutConfigurerÁöÑ‰∏Ä‰∫õÂ±ûÊÄß„ÄÇÂêåÊó∂LogoutConfigurerÊ†πÊçÆËøô‰∫õÂ±ûÊÄßÂàõÂª∫‰∫ÜLogoutFilter„ÄÇ LogoutConfigurerÁöÑÈÖçÁΩÆÔºåÁ¨¨‰∏ÄÂíåÁ¨¨‰∫åÁÇπÂ∞±‰∏çÁî®ÂÜçËØ¶ÁªÜËß£Èáä‰∫ÜÔºå‰∏Ä‰∏™ÊòØËÆæÁΩÆÁ´ØÁÇπÔºåÂè¶‰∏Ä‰∏™ÊòØÊ∏ÖÁ©∫ËÆ§ËØÅ‰ø°ÊÅØ„ÄÇÂØπ‰∫éÁ¨¨‰∏âÁÇπÔºåÈÖçÁΩÆÊ≥®ÈîÄÊàêÂäüÁöÑÂ§ÑÁêÜÊñπÂºè„ÄÇÁî±‰∫éÈ°πÁõÆÊòØÂâçÂêéÁ´ØÂàÜÁ¶ªÔºåÂÆ¢Êà∑Á´ØÂè™ÈúÄË¶ÅÁü•ÈÅìÊâßË°åÊàêÂäüËØ•APIÊé•Âè£ÁöÑÁä∂ÊÄÅÔºåÂπ∂‰∏çÁî®ËøîÂõûÂÖ∑‰ΩìÁöÑÈ°µÈù¢ÊàñËÄÖÁªßÁª≠Âêë‰∏ã‰º†ÈÄíËØ∑Ê±Ç„ÄÇÂõ†Ê≠§ÔºåËøôËæπÈÖçÁΩÆ‰∫ÜÈªòËÆ§ÁöÑHttpStatusReturningLogoutSuccessHandlerÔºåÊàêÂäüÁõ¥Êé•ËøîÂõûÁä∂ÊÄÅÁ†Å200„ÄÇÂØπ‰∫éÁ¨¨ÂõõÁÇπÈÖçÁΩÆÔºåËá™ÂÆö‰πâÊ≥®ÈîÄÂ§ÑÁêÜÁöÑÊñπÊ≥ï„ÄÇËøôËæπÈúÄË¶ÅÂÄüÂä©TokenStoreÔºåÂØπtokenËøõË°åÊìç‰Ωú„ÄÇTokenStoreÂú®‰πãÂâçÊñáÁ´†ÁöÑÈÖçÁΩÆ‰∏≠Â∑≤ÁªèËÆ≤ËøáÔºå‰ΩøÁî®ÁöÑÊòØJdbcTokenStore„ÄÇÈ¶ñÂÖàÊ†°È™åËØ∑Ê±ÇÁöÑÂêàÊ≥ïÊÄßÔºåÂ¶ÇÊûúÂêàÊ≥ïÂàôÂØπÂÖ∂ËøõË°åÊìç‰ΩúÔºåÂÖàÂêéÁßªÈô§refreshTokenÂíåexistingAccessToken„ÄÇ 12345678910111213141516171819202122232425262728293031323334public class CustomLogoutHandler implements LogoutHandler &#123; //... @Override public void logout(HttpServletRequest request, HttpServletResponse response, Authentication authentication) &#123; //Á°ÆÂÆöÊ≥®ÂÖ•‰∫ÜtokenStore Assert.notNull(tokenStore, "tokenStore must be set"); //Ëé∑ÂèñÂ§¥ÈÉ®ÁöÑËÆ§ËØÅ‰ø°ÊÅØ String token = request.getHeader("Authorization"); Assert.hasText(token, "token must be set"); //Ê†°È™åtokenÊòØÂê¶Á¨¶ÂêàJwtBearerÊ†ºÂºè if (isJwtBearerToken(token)) &#123; token = token.substring(6); OAuth2AccessToken existingAccessToken = tokenStore.readAccessToken(token); OAuth2RefreshToken refreshToken; if (existingAccessToken != null) &#123; if (existingAccessToken.getRefreshToken() != null) &#123; LOGGER.info("remove refreshToken!", existingAccessToken.getRefreshToken()); refreshToken = existingAccessToken.getRefreshToken(); tokenStore.removeRefreshToken(refreshToken); &#125; LOGGER.info("remove existingAccessToken!", existingAccessToken); tokenStore.removeAccessToken(existingAccessToken); &#125; return; &#125; else &#123; throw new BadClientCredentialsException(); &#125; &#125; //...&#125; ÊâßË°åÂ¶Ç‰∏ãËØ∑Ê±ÇÔºö 123456method: geturl: http://localhost:9000/logoutheader:&#123; Authorization: Basic ZnJvbnRlbmQ6ZnJvbnRlbmQ=&#125; Ê≥®ÈîÄÊàêÂäüÂàô‰ºöËøîÂõû200ÔºåÂ∞ÜtokenÂíåSecurityContextHolderËøõË°åÊ∏ÖÁ©∫„ÄÇ 2.2 Âà∑Êñ∞Á´ØÁÇπÂú®Á¨¨‰∏ÄÁØáÂ∞±Â∑≤ÁªèËÆ≤ËøáÔºåÁî±‰∫étokenÁöÑÊó∂Êïà‰∏ÄËà¨‰∏ç‰ºöÂæàÈïøÔºåËÄårefresh token‰∏ÄËà¨Âë®Êúü‰ºöÂæàÈïøÔºå‰∏∫‰∫Ü‰∏çÂΩ±ÂìçÁî®Êà∑ÁöÑ‰ΩìÈ™åÔºåÂèØ‰ª•‰ΩøÁî®refresh tokenÂéªÂä®ÊÄÅÁöÑÂà∑Êñ∞token„ÄÇÂà∑Êñ∞token‰∏ªË¶Å‰∏éRefreshTokenGranterÊúâÂÖ≥ÔºåCompositeTokenGranterÁÆ°ÁêÜ‰∏Ä‰∏™ListÂàóË°®ÔºåÊØè‰∏ÄÁßçgrantTypeÂØπÂ∫î‰∏Ä‰∏™ÂÖ∑‰ΩìÁöÑÁúüÊ≠£ÊéàÊùÉËÄÖÔºårefresh_ tokenÂØπÂ∫îÁöÑgranterÂ∞±ÊòØRefreshTokenGranterÔºåËÄågranterÂÜÖÈÉ®ÂàôÊòØÈÄöËøágrantTypeÊù•Âå∫ÂàÜÊòØÂê¶ÊòØÂêÑËá™ÁöÑÊéàÊùÉÁ±ªÂûã„ÄÇÊâßË°åÂ¶Ç‰∏ãËØ∑Ê±ÇÔºö 123456method: post url: http://localhost:12000/oauth/token?grant_type=refresh_token&amp;refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJYLUtFRVRTLVVzZXJJZCI6ImQ2NDQ4YzI0LTNjNGMtNGI4MC04MzcyLWMyZDYxODY4ZjhjNiIsInVzZXJfbmFtZSI6ImtlZXRzIiwic2NvcGUiOlsiYWxsIl0sImF0aSI6ImJhZDcyYjE5LWQ5ZjMtNDkwMi1hZmZhLTA0MzBlN2RiNzllZCIsImV4cCI6MTUxMDk5NjU1NiwianRpIjoiYWE0MWY1MjctODE3YS00N2UyLWFhOTgtZjNlMDZmNmY0NTZlIiwiY2xpZW50X2lkIjoiZnJvbnRlbmQifQ.mICT1-lxOAqOU9M-Ud7wZBb4tTux6OQWouQJ2nn1DeEheader:&#123; Authorization: Basic ZnJvbnRlbmQ6ZnJvbnRlbmQ=&#125; Âú®refresh_ tokenÊ≠£Á°ÆÁöÑÊÉÖÂÜµ‰∏ãÔºåÂÖ∂ËøîÂõûÁöÑresponseÂíå/oauth/tokenÂæóÂà∞Ê≠£Â∏∏ÁöÑÂìçÂ∫îÊòØ‰∏ÄÊ†∑ÁöÑ„ÄÇÂÖ∑‰ΩìÁöÑ‰ª£Á†ÅÂèØ‰ª•ÂèÇÈòÖÁ¨¨‰∫åÁØáÁöÑËÆ≤Ëß£„ÄÇ 3. Spring SecurityËøáÊª§Âô®Âú®‰∏ä‰∏ÄËäÇÊàë‰ª¨‰ªãÁªç‰∫ÜÂÜÖÁΩÆÁöÑ‰∏§‰∏™Á´ØÁÇπÁöÑÂÆûÁé∞ÁªÜËäÇÔºåËøòÊèêÂà∞‰∫ÜHttpSecurityËøáÊª§Âô®ÔºåÂõ†‰∏∫Ê≥®ÈîÄÁ´ØÁÇπÁöÑÂÆûÁé∞Â∞±ÊòØÈÄöËøáËøáÊª§Âô®ÁöÑ‰ΩúÁî®„ÄÇÊ†∏ÂøÉÁöÑËøáÊª§Âô®‰∏ªË¶ÅÊúâÔºö FilterSecurityInterceptor UsernamePasswordAuthenticationFilter SecurityContextPersistenceFilter ExceptionTranslationFilter Ëøô‰∏ÄËäÇÂ∞ÜÈáçÁÇπ‰ªãÁªçÂÖ∂‰∏≠ÁöÑUsernamePasswordAuthenticationFilterÂíåFilterSecurityInterceptor„ÄÇ 3.1 UsernamePasswordAuthenticationFilterÁ¨îËÄÖÂú®ÂàöÂºÄÂßãÁúãÂÖ≥‰∫éËøáÊª§Âô®ÁöÑÊñáÁ´†ÔºåÂØπ‰∫éUsernamePasswordAuthenticationFilterÊúâ‰∏çÂ∞ëÁöÑÊñáÁ´†‰ªãÁªç„ÄÇÂ¶ÇÊûúÂè™ÊòØÂºïÂÖ•Spring-SecurityÔºåÂøÖÁÑ∂‰ºö‰∏é/loginÁ´ØÁÇπÁÜüÊÇâ„ÄÇSpringSecurityÂº∫Âà∂Ë¶ÅÊ±ÇÊàë‰ª¨ÁöÑË°®ÂçïÁôªÂΩïÈ°µÈù¢ÂøÖÈ°ªÊòØ‰ª•POSTÊñπÂºèÂêë/login URLÊèê‰∫§ËØ∑Ê±ÇÔºåËÄå‰∏îË¶ÅÊ±ÇÁî®Êà∑ÂêçÂíåÂØÜÁ†ÅÁöÑÂèÇÊï∞ÂêçÂøÖÈ°ªÊòØusernameÂíåpassword„ÄÇÂ¶ÇÊûú‰∏çÁ¨¶ÂêàÔºåÂàô‰∏çËÉΩÊ≠£Â∏∏Â∑•‰Ωú„ÄÇÂéüÂõ†Âú®‰∫éÔºåÂΩìÊàë‰ª¨Ë∞ÉÁî®‰∫ÜHttpSecurityÂØπË±°ÁöÑformLoginÊñπÊ≥ïÊó∂ÔºåÂÖ∂ÊúÄÁªà‰ºöÁªôÊàë‰ª¨Ê≥®ÂÜå‰∏Ä‰∏™ËøáÊª§Âô®UsernamePasswordAuthenticationFilter„ÄÇÁúã‰∏Ä‰∏ãËØ•ËøáÊª§Âô®ÁöÑÊ∫êÁ†Å„ÄÇ 1234567891011121314151617181920212223242526272829303132333435public class UsernamePasswordAuthenticationFilter extends AbstractAuthenticationProcessingFilter &#123; //Áî®Êà∑Âêç„ÄÅÂØÜÁ†Å public static final String SPRING_SECURITY_FORM_USERNAME_KEY = "username"; public static final String SPRING_SECURITY_FORM_PASSWORD_KEY = "password"; private String usernameParameter = SPRING_SECURITY_FORM_USERNAME_KEY; private String passwordParameter = SPRING_SECURITY_FORM_PASSWORD_KEY; private boolean postOnly = true; //postËØ∑Ê±Ç/login public UsernamePasswordAuthenticationFilter() &#123; super(new AntPathRequestMatcher("/login", "POST")); &#125; //ÂÆûÁé∞ÊäΩË±°Á±ªAbstractAuthenticationProcessingFilterÁöÑÊäΩË±°ÊñπÊ≥ïÔºåÂ∞ùËØïÈ™åËØÅ public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response) throws AuthenticationException &#123; if (postOnly &amp;&amp; !request.getMethod().equals("POST")) &#123; throw new AuthenticationServiceException( "Authentication method not supported: " + request.getMethod()); &#125; String username = obtainUsername(request); String password = obtainPassword(request); //¬∑¬∑¬∑ username = username.trim(); UsernamePasswordAuthenticationToken authRequest = new UsernamePasswordAuthenticationToken( username, password); //¬∑¬∑¬∑ return this.getAuthenticationManager().authenticate(authRequest); &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970public abstract class AbstractAuthenticationProcessingFilter extends GenericFilterBean implements ApplicationEventPublisherAware, MessageSourceAware &#123; //... //Ë∞ÉÁî®requiresAuthenticationÔºåÂà§Êñ≠ËØ∑Ê±ÇÊòØÂê¶ÈúÄË¶ÅauthenticationÔºåÂ¶ÇÊûúÈúÄË¶ÅÂàôË∞ÉÁî®attemptAuthentication //Êúâ‰∏âÁßçÁªìÊûúÂèØËÉΩËøîÂõûÔºö //1.AuthenticationÂØπË±° //2. AuthenticationException //3. AuthenticationÂØπË±°‰∏∫Á©∫ public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) throws IOException, ServletException &#123; HttpServletRequest request = (HttpServletRequest) req; HttpServletResponse response = (HttpServletResponse) res; //‰∏çÈúÄË¶ÅÊ†°È™åÔºåÁªßÁª≠‰º†ÈÄí if (!requiresAuthentication(request, response)) &#123; chain.doFilter(request, response); return; &#125; Authentication authResult; try &#123; authResult = attemptAuthentication(request, response); if (authResult == null) &#123; // return immediately as subclass has indicated that it hasn't completed authentication return; &#125; sessionStrategy.onAuthentication(authResult, request, response); &#125; //... catch (AuthenticationException failed) &#123; // Authentication failed unsuccessfulAuthentication(request, response, failed); return; &#125; // Authentication success if (continueChainBeforeSuccessfulAuthentication) &#123; chain.doFilter(request, response); &#125; successfulAuthentication(request, response, chain, authResult); &#125; //ÂÆûÈôÖÊâßË°åÁöÑauthenticationÔºåÁªßÊâøÁ±ªÂøÖÈ°ªÂÆûÁé∞ËØ•ÊäΩË±°ÊñπÊ≥ï public abstract Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response) throws AuthenticationException, IOException, ServletException; //ÊàêÂäüauthenticationÁöÑÈªòËÆ§Ë°å‰∏∫ protected void successfulAuthentication(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult) throws IOException, ServletException &#123; //... &#125; //Â§±Ë¥•authenticationÁöÑÈªòËÆ§Ë°å‰∏∫ protected void unsuccessfulAuthentication(HttpServletRequest request, HttpServletResponse response, AuthenticationException failed) throws IOException, ServletException &#123; //... &#125; ... //ËÆæÁΩÆAuthenticationManager public void setAuthenticationManager(AuthenticationManager authenticationManager) &#123; this.authenticationManager = authenticationManager; &#125; ...&#125; UsernamePasswordAuthenticationFilterÂõ†‰∏∫ÁªßÊâø‰∫ÜAbstractAuthenticationProcessingFilterÊâçÊã•ÊúâËøáÊª§Âô®ÁöÑÂäüËÉΩ„ÄÇAbstractAuthenticationProcessingFilterË¶ÅÊ±ÇËÆæÁΩÆ‰∏Ä‰∏™authenticationManagerÔºåauthenticationManagerÁöÑÂÆûÁé∞Á±ªÂ∞ÜÂÆûÈôÖÂ§ÑÁêÜËØ∑Ê±ÇÁöÑËÆ§ËØÅ„ÄÇAbstractAuthenticationProcessingFilterÂ∞ÜÊã¶Êà™Á¨¶ÂêàËøáÊª§ËßÑÂàôÁöÑrequestÔºåÂπ∂ËØïÂõæÊâßË°åËÆ§ËØÅ„ÄÇÂ≠êÁ±ªÂøÖÈ°ªÂÆûÁé∞ attemptAuthentication ÊñπÊ≥ïÔºåËøô‰∏™ÊñπÊ≥ïÊâßË°åÂÖ∑‰ΩìÁöÑËÆ§ËØÅ„ÄÇËÆ§ËØÅ‰πãÂêéÁöÑÂ§ÑÁêÜÂíå‰∏äÊ≥®ÈîÄÁöÑÂ∑Æ‰∏çÂ§ö„ÄÇÂ¶ÇÊûúËÆ§ËØÅÊàêÂäüÔºåÂ∞Ü‰ºöÊääËøîÂõûÁöÑAuthenticationÂØπË±°Â≠òÊîæÂú®SecurityContextÔºåÂπ∂Ë∞ÉÁî®SuccessHandlerÔºå‰πüÂèØ‰ª•ËÆæÁΩÆÊåáÂÆöÁöÑURLÂíåÊåáÂÆöËá™ÂÆö‰πâÁöÑÂ§ÑSuccessHandler„ÄÇÂ¶ÇÊûúËÆ§ËØÅÂ§±Ë¥•ÔºåÈªòËÆ§‰ºöËøîÂõû401‰ª£Á†ÅÁªôÂÆ¢Êà∑Á´ØÔºå‰πüÂèØ‰ª•ËÆæÁΩÆURLÔºåÊåáÂÆöËá™ÂÆö‰πâÁöÑÂ§ÑÁêÜFailureHandler„ÄÇ Âü∫‰∫éUsernamePasswordAuthenticationFilterËá™ÂÆö‰πâÁöÑAuthenticationFilteËøòÊòØÊå∫Â§öÊ°à‰æãÁöÑÔºåËøôËæπÊé®Ëçê‰∏ÄÁØáÂçöÊñáSpring Security(‰∫î)‚ÄìÂä®ÊâãÂÆûÁé∞‰∏Ä‰∏™IP_LoginÔºåÂÜôÂæóÊØîËæÉËØ¶ÁªÜ„ÄÇ 3.2 FilterSecurityInterceptorFilterSecurityInterceptorÊòØfilterchain‰∏≠ÊØîËæÉÂ§çÊùÇÔºå‰πüÊòØÊØîËæÉÊ†∏ÂøÉÁöÑËøáÊª§Âô®Ôºå‰∏ªË¶ÅË¥üË¥£webÂ∫îÁî®ÂÆâÂÖ®ÊéàÊùÉÁöÑÂ∑•‰Ωú„ÄÇÈ¶ñÂÖàÁúã‰∏ãÂØπ‰∫éËá™ÂÆö‰πâÁöÑFilterSecurityInterceptorÈÖçÁΩÆ„ÄÇ 12345678910111213@Override public void configure(HttpSecurity http) throws Exception &#123; ... //Ê∑ªÂä†CustomSecurityFilterÔºåËøáÊª§Âô®ÁöÑÈ°∫Â∫èÊîæÂú®FilterSecurityInterceptor http.antMatcher("/oauth/check_token").addFilterAt(customSecurityFilter(), FilterSecurityInterceptor.class); &#125; //Êèê‰æõÂÆû‰æãÂåñÁöÑËá™ÂÆö‰πâËøáÊª§Âô® @Bean public CustomSecurityFilter customSecurityFilter() &#123; return new CustomSecurityFilter(); &#125; ‰ªé‰∏äËø∞ÈÖçÁΩÆÂèØ‰ª•ÁúãÂà∞ÔºåÂú®FilterSecurityInterceptorÁöÑ‰ΩçÁΩÆÊ≥®ÂÜå‰∫ÜCustomSecurityFilterÔºåÂØπ‰∫éÂåπÈÖçÂà∞/oauth/check_tokenÔºåÂàô‰ºöË∞ÉÁî®ËØ•ËøõÂÖ•ËØ•ËøáÊª§Âô®„ÄÇ‰∏ãÂõæ‰∏∫FilterSecurityInterceptorÁöÑÁ±ªÂõæÔºåÂú®ÂÖ∂‰∏≠ËøòÊ∑ªÂä†‰∫ÜCustomSecurityFilterÂíåÁõ∏ÂÖ≥ÂÆûÁé∞ÁöÑÊé•Âè£ÁöÑÁ±ªÔºåÊñπ‰æøËØªËÄÖÂØπÊØîÁùÄÁúã„ÄÇ CustomSecurityFilterÊòØÊ®°‰ªøFilterSecurityInterceptorÂÆûÁé∞ÔºåÁªßÊâøAbstractSecurityInterceptorÂíåÂÆûÁé∞FilterÊé•Âè£„ÄÇÊï¥‰∏™ËøáÁ®ãÈúÄË¶Å‰æùËµñAuthenticationManager„ÄÅAccessDecisionManagerÂíåFilterInvocationSecurityMetadataSource„ÄÇAuthenticationManagerÊòØËÆ§ËØÅÁÆ°ÁêÜÂô®ÔºåÂÆûÁé∞Áî®Êà∑ËÆ§ËØÅÁöÑÂÖ•Âè£ÔºõAccessDecisionManagerÊòØËÆøÈóÆÂÜ≥Á≠ñÂô®ÔºåÂÜ≥ÂÆöÊüê‰∏™Áî®Êà∑ÂÖ∑ÊúâÁöÑËßíËâ≤ÔºåÊòØÂê¶ÊúâË∂≥Â§üÁöÑÊùÉÈôêÂéªËÆøÈóÆÊüê‰∏™ËµÑÊ∫êÔºõFilterInvocationSecurityMetadataSourceÊòØËµÑÊ∫êÊ∫êÊï∞ÊçÆÂÆö‰πâÔºåÂç≥ÂÆö‰πâÊüê‰∏ÄËµÑÊ∫êÂèØ‰ª•Ë¢´Âì™‰∫õËßíËâ≤ËÆøÈóÆ„ÄÇ‰ªé‰∏äÈù¢ÁöÑÁ±ªÂõæ‰∏≠ÂèØ‰ª•ÁúãÂà∞Ëá™ÂÆö‰πâÁöÑCustomSecurityFilterÂêåÊó∂ÂèàÂÆûÁé∞‰∫ÜAccessDecisionManagerÂíåFilterInvocationSecurityMetadataSource„ÄÇÂàÜÂà´‰∏∫SecureResourceFilterInvocationDefinitionSourceÂíåSecurityAccessDecisionManager„ÄÇ‰∏ãÈù¢ÂàÜÊûê‰∏ã‰∏ªË¶ÅÁöÑÈÖçÁΩÆ„ÄÇ 12345678910111213//ÈÄöËøá‰∏Ä‰∏™ÂÆûÁé∞ÁöÑfilterÔºåÂØπHTTPËµÑÊ∫êËøõË°åÂÆâÂÖ®Â§ÑÁêÜpublic class FilterSecurityInterceptor extends AbstractSecurityInterceptor implements Filter &#123; //Ë¢´filter chainÁúüÂÆûË∞ÉÁî®ÁöÑÊñπÊ≥ïÔºåÈÄöËøáinvoke‰ª£ÁêÜ public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException &#123; FilterInvocation fi = new FilterInvocation(request, response, chain); invoke(fi); &#125; //‰ª£ÁêÜÁöÑÊñπÊ≥ï public void invoke(FilterInvocation fi) throws IOException, ServletException &#123; //...ÁúÅÁï• &#125;&#125; ‰∏äËø∞‰ª£Á†ÅÊòØFilterSecurityInterceptor‰∏≠ÁöÑÂÆûÁé∞ÔºåÂÖ∑‰ΩìÂÆûÁé∞ÁªÜËäÇÂ∞±Ê≤°ÂàóÂá∫‰∫ÜÔºåÊàë‰ª¨ËøôËæπÈáçÁÇπÂú®‰∫éÂØπËá™ÂÆö‰πâÁöÑÂÆûÁé∞ËøõË°åËÆ≤Ëß£„ÄÇ 123456789101112131415161718192021222324252627282930313233343536373839404142public class CustomSecurityFilter extends AbstractSecurityInterceptor implements Filter &#123; @Autowired SecureResourceFilterInvocationDefinitionSource invocationSource; @Autowired private AuthenticationManager authenticationManager; @Autowired private SecurityAccessDecisionManager decisionManager; //ËÆæÁΩÆÁà∂Á±ª‰∏≠ÁöÑÂ±ûÊÄß @PostConstruct public void init() &#123; super.setAccessDecisionManager(decisionManager); super.setAuthenticationManager(authenticationManager); &#125; //‰∏ªË¶ÅÁöÑËøáÊª§ÊñπÊ≥ïÔºå‰∏éÂéüÊù•ÁöÑ‰∏ÄËá¥ @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123; //logger.info("doFilter in Security "); //ÊûÑÈÄ†‰∏Ä‰∏™FilterInvocationÔºåÂ∞ÅË£Örequest, response, chain FilterInvocation fi = new FilterInvocation(servletRequest, servletResponse, filterChain); //beforeInvocation‰ºöË∞ÉÁî®SecureResourceDataSource‰∏≠ÁöÑÈÄªËæëÔºåÁ±ª‰ºº‰∫éaop‰∏≠ÁöÑbefore InterceptorStatusToken token = super.beforeInvocation(fi); try &#123; //ÊâßË°å‰∏ã‰∏Ä‰∏™Êã¶Êà™Âô® fi.getChain().doFilter(fi.getRequest(), fi.getResponse()); &#125; finally &#123; //ÂÆåÊàêÂêéÁª≠Â∑•‰ΩúÔºåÁ±ª‰ºº‰∫éaop‰∏≠ÁöÑafter super.afterInvocation(token, null); &#125; &#125; //... //ËµÑÊ∫êÊ∫êÊï∞ÊçÆÂÆö‰πâÔºåËÆæÁΩÆ‰∏∫Ëá™ÂÆö‰πâÁöÑSecureResourceFilterInvocationDefinitionSource @Override public SecurityMetadataSource obtainSecurityMetadataSource() &#123; return invocationSource; &#125;&#125; ‰∏äÈù¢Ëá™ÂÆö‰πâÁöÑCustomSecurityFilterÔºå‰∏éÊàë‰ª¨‰πãÂâçÁöÑËÆ≤Ëß£ÊòØ‰∏ÄÊ†∑ÁöÑÊµÅÁ®ã„ÄÇ‰∏ªË¶Å‰æùËµñÁöÑ‰∏â‰∏™Êé•Âè£ÈÉΩÊúâÂú®ÂÆûÁé∞‰∏≠ÂÆû‰æãÂåñÊ≥®ÂÖ•„ÄÇÁúã‰∏ãÁà∂Á±ªÁöÑbeforeInvocationÊñπÊ≥ïÔºåÂÖ∂‰∏≠ÁúÅÁï•‰∫Ü‰∏Ä‰∫õ‰∏çÈáçË¶ÅÁöÑ‰ª£Á†ÅÁâáÊÆµ„ÄÇ 12345678910111213141516171819protected InterceptorStatusToken beforeInvocation(Object object) &#123; //Ê†πÊçÆSecurityMetadataSourceËé∑ÂèñÈÖçÁΩÆÁöÑÊùÉÈôêÂ±ûÊÄß Collection&lt;ConfigAttribute&gt; attributes = this.obtainSecurityMetadataSource().getAttributes(object); //... //Âà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅÂØπËÆ§ËØÅÂÆû‰ΩìÈáçÊñ∞ËÆ§ËØÅÔºåÈªòËÆ§‰∏∫Âê¶ Authentication authenticated = authenticateIfRequired(); // Attempt authorization try &#123; //ÂÜ≥Á≠ñÁÆ°ÁêÜÂô®ÂºÄÂßãÂÜ≥ÂÆöÊòØÂê¶ÊéàÊùÉÔºåÂ¶ÇÊûúÊéàÊùÉÂ§±Ë¥•ÔºåÁõ¥Êé•ÊäõÂá∫AccessDeniedException this.accessDecisionManager.decide(authenticated, object, attributes); &#125; catch (AccessDeniedException accessDeniedException) &#123; publishEvent(new AuthorizationFailureEvent(object, attributes, authenticated, accessDeniedException)); throw accessDeniedException; &#125; &#125; ‰∏äÈù¢‰ª£Á†ÅÂèØ‰ª•ÁúãÂá∫ÔºåÁ¨¨‰∏ÄÊ≠•ÊòØÊ†πÊçÆSecurityMetadataSourceËé∑ÂèñÈÖçÁΩÆÁöÑÊùÉÈôêÂ±ûÊÄßÔºåaccessDecisionManager‰ºöÁî®Âà∞ÊùÉÈôêÂàóË°®‰ø°ÊÅØ„ÄÇÁÑ∂ÂêéÂà§Êñ≠ÊòØÂê¶ÈúÄË¶ÅÂØπËÆ§ËØÅÂÆû‰ΩìÈáçÊñ∞ËÆ§ËØÅÔºåÈªòËÆ§‰∏∫Âê¶„ÄÇÁ¨¨‰∫åÊ≠•ÊòØÊé•ÁùÄÂÜ≥Á≠ñÁÆ°ÁêÜÂô®ÂºÄÂßãÂÜ≥ÂÆöÊòØÂê¶ÊéàÊùÉÔºåÂ¶ÇÊûúÊéàÊùÉÂ§±Ë¥•ÔºåÁõ¥Êé•ÊäõÂá∫AccessDeniedException„ÄÇ (1). Ëé∑ÂèñÈÖçÁΩÆÁöÑÊùÉÈôêÂ±ûÊÄß 12345678910111213141516171819202122232425262728293031323334353637383940public class SecureResourceFilterInvocationDefinitionSource implements FilterInvocationSecurityMetadataSource, InitializingBean &#123; private PathMatcher matcher; //map‰øùÂ≠òÈÖçÁΩÆÁöÑURLÂØπÂ∫îÁöÑÊùÉÈôêÈõÜ private static Map&lt;String, Collection&lt;ConfigAttribute&gt;&gt; map = new HashMap&lt;&gt;(); //Ê†πÊçÆ‰º†ÂÖ•ÁöÑÂØπË±°URLËøõË°åÂæ™ÁéØ @Override public Collection&lt;ConfigAttribute&gt; getAttributes(Object o) throws IllegalArgumentException &#123; logger.info("getAttributes"); //Â∫îËØ•ÂÅöinstanceof FilterInvocation filterInvocation = (FilterInvocation) o; //String method = filterInvocation.getHttpRequest().getMethod(); String requestURI = filterInvocation.getRequestUrl(); //Âæ™ÁéØËµÑÊ∫êË∑ØÂæÑÔºåÂΩìËÆøÈóÆÁöÑUrlÂíåËµÑÊ∫êË∑ØÂæÑurlÂåπÈÖçÊó∂ÔºåËøîÂõûËØ•UrlÊâÄÈúÄË¶ÅÁöÑÊùÉÈôê for (Iterator&lt;Map.Entry&lt;String, Collection&lt;ConfigAttribute&gt;&gt;&gt; iterator = map.entrySet().iterator(); iter.hasNext(); ) &#123; Map.Entry&lt;String, Collection&lt;ConfigAttribute&gt;&gt; entry = iterator.next(); String url = entry.getKey(); if (matcher.match(url, requestURI)) &#123; return map.get(requestURI); &#125; &#125; return null; &#125; //... //ËÆæÁΩÆÊùÉÈôêÈõÜÔºåÂç≥‰∏äËø∞ÁöÑmap @Override public void afterPropertiesSet() throws Exception &#123; logger.info("afterPropertiesSet"); //Áî®Êù•ÂåπÈÖçËÆøÈóÆËµÑÊ∫êË∑ØÂæÑ this.matcher = new AntPathMatcher(); //ÂèØ‰ª•ÊúâÂ§ö‰∏™ÊùÉÈôê Collection&lt;ConfigAttribute&gt; atts = new ArrayList&lt;&gt;(); ConfigAttribute c1 = new SecurityConfig("ROLE_ADMIN"); atts.add(c1); map.put("/oauth/check_token", atts); &#125;&#125; ‰∏äÈù¢ÊòØgetAttributes()ÂÆûÁé∞ÁöÑÂÖ∑‰ΩìÁªÜËäÇÔºåÂ∞ÜËØ∑Ê±ÇÁöÑURLÂèñÂá∫ËøõË°åÂåπÈÖç‰∫ãÂÖàËÆæÂÆöÁöÑÂèóÈôêËµÑÊ∫êÔºåÊúÄÂêéËøîÂõûÈúÄË¶ÅÁöÑÊùÉÈôê„ÄÅËßíËâ≤„ÄÇÁ≥ªÁªüÂú®ÂêØÂä®ÁöÑÊó∂ÂÄôÂ∞±‰ºöËØªÂèñÂà∞ÈÖçÁΩÆÁöÑmapÈõÜÂêàÔºåÂØπ‰∫éÊã¶Êà™Âà∞ËØ∑Ê±ÇËøõË°åÂåπÈÖç„ÄÇ‰ª£Á†Å‰∏≠Ê≥®ÈáäÊØîËæÉËØ¶ÁªÜÔºåËøôËæπ‰∏çÂ§öËØ¥„ÄÇ (2). ÂÜ≥Á≠ñÁÆ°ÁêÜÂô® 1234567891011121314151617181920212223242526272829public class SecurityAccessDecisionManager implements AccessDecisionManager &#123; //... @Override public void decide(Authentication authentication, Object o, Collection&lt;ConfigAttribute&gt; collection) throws AccessDeniedException, InsufficientAuthenticationException &#123; logger.info("decide url and permission"); //ÈõÜÂêà‰∏∫Á©∫ if (collection == null) &#123; return; &#125; Iterator&lt;ConfigAttribute&gt; ite = collection.iterator(); //Âà§Êñ≠Áî®Êà∑ÊâÄÊã•ÊúâÁöÑÊùÉÈôêÔºåÊòØÂê¶Á¨¶ÂêàÂØπÂ∫îÁöÑUrlÊùÉÈôêÔºåÂ¶ÇÊûúÂÆûÁé∞‰∫ÜUserDetailsServiceÔºåÂàôÁî®Êà∑ÊùÉÈôêÊòØloadUserByUsernameËøîÂõûÁî®Êà∑ÊâÄÂØπÂ∫îÁöÑÊùÉÈôê while (ite.hasNext()) &#123; ConfigAttribute ca = ite.next(); String needRole = ca.getAttribute(); for (GrantedAuthority ga : authentication.getAuthorities()) &#123; logger.info("GrantedAuthority: &#123;&#125;", ga); if (needRole.equals(ga.getAuthority())) &#123; return; &#125; &#125; &#125; logger.error("AccessDecisionManager: no right!"); throw new AccessDeniedException("no right!"); &#125; //...&#125; ‰∏äÈù¢ÁöÑ‰ª£Á†ÅÊòØÂÜ≥Á≠ñÁÆ°ÁêÜÂô®ÁöÑÂÆûÁé∞ÔºåÂÖ∂ÈÄªËæë‰πüÊØîËæÉÁÆÄÂçïÔºåÂ∞ÜËØ∑Ê±ÇÊâÄÂÖ∑ÊúâÁöÑÊùÉÈôê‰∏éËÆæÂÆöÁöÑÂèóÈôêËµÑÊ∫êÊâÄÈúÄÁöÑËøõË°åÂåπÈÖçÔºåÂ¶ÇÊûúÂÖ∑ÊúâÂàôËøîÂõûÔºåÂê¶ÂàôÊäõÂá∫Ê≤°ÊúâÊ≠£Á°ÆÁöÑÊùÉÈôêÂºÇÂ∏∏„ÄÇÈªòËÆ§Êèê‰æõÁöÑÂÜ≥Á≠ñÁÆ°ÁêÜÂô®Êúâ‰∏âÁßçÔºåÂàÜÂà´‰∏∫AffirmativeBased„ÄÅConsensusBased„ÄÅUnanimousBasedÔºåÁØáÂπÖÊúâÈôêÔºåÊàë‰ª¨ËøôËæπ‰∏çÂÜçÊâ©Â±ï‰∫Ü„ÄÇ Ë°•ÂÖÖ‰∏Ä‰∏ãÔºåÊâÄÂÖ∑ÊúâÁöÑÊùÉÈôêÊòØÈÄöËøá‰πãÂâçÈÖçÁΩÆÁöÑËÆ§ËØÅÊñπÂºèÔºåÊúâpasswordËÆ§ËØÅÂíåclientËÆ§ËØÅ‰∏§Áßç„ÄÇÊàë‰ª¨‰πãÂâçÂú®ÊéàÊùÉÊúçÂä°Âô®‰∏≠ÈÖçÁΩÆ‰∫ÜwithClientDetailsÔºåÊâÄ‰ª•Áî®frontendË∫´‰ªΩÈ™åËØÅËé∑ÂæóÁöÑÊùÉÈôêÊòØÊàë‰ª¨È¢ÑÂÖàÈÖçÁΩÆÂú®Êï∞ÊçÆÂ∫ì‰∏≠ÁöÑauthorities„ÄÇ 4. ÊÄªÁªìAuthÁ≥ªÁªü‰∏ªË¶ÅÂäüËÉΩÊòØÊéàÊùÉËÆ§ËØÅÂíåÈâ¥ÊùÉ„ÄÇÈ°πÁõÆÂæÆÊúçÂä°ÂåñÂêéÔºåÂéüÊúâÁöÑÂçï‰ΩìÂ∫îÁî®Âü∫‰∫éHttpSessionËÆ§ËØÅÈâ¥ÊùÉ‰∏çËÉΩÊª°Ë∂≥ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏ãÁöÑÈúÄÊ±Ç„ÄÇÊØè‰∏™ÂæÆÊúçÂä°ÈÉΩÈúÄË¶ÅÂØπËÆøÈóÆËøõË°åÈâ¥ÊùÉÔºåÊØè‰∏™ÂæÆÂ∫îÁî®ÈÉΩÈúÄË¶ÅÊòéÁ°ÆÂΩìÂâçËÆøÈóÆÁî®Êà∑‰ª•ÂèäÂÖ∂ÊùÉÈôêÔºåÂ∞§ÂÖ∂ÂΩìÊúâÂ§ö‰∏™ÂÆ¢Êà∑Á´ØÔºåÂåÖÊã¨webÁ´Ø„ÄÅÁßªÂä®Á´ØÁ≠âÁ≠âÔºåÂçï‰ΩìÂ∫îÁî®Êû∂ÊûÑ‰∏ãÁöÑÈâ¥ÊùÉÊñπÂºèÂ∞±‰∏çÊòØÁâπÂà´ÂêàÈÄÇ‰∫Ü„ÄÇÊùÉÈôêÊúçÂä°‰Ωú‰∏∫Âü∫Á°ÄÁöÑÂÖ¨ÂÖ±ÊúçÂä°Ôºå‰πüÈúÄË¶ÅÂæÆÊúçÂä°Âåñ„ÄÇ Á¨îËÄÖÁöÑËÆæËÆ°‰∏≠ÔºåAuthÊúçÂä°‰∏ÄÊñπÈù¢ËøõË°åÊéàÊùÉËÆ§ËØÅÔºåÂè¶‰∏ÄÊñπÈù¢ÊòØÂü∫‰∫étokenËøõË°åË∫´‰ªΩÂêàÊ≥ïÊÄßÂíåAPIÁ∫ßÂà´ÁöÑÊùÉÈôêÊ†°È™å„ÄÇÂØπ‰∫éÊüê‰∏™ÊúçÂä°ÁöÑËØ∑Ê±ÇÔºåÁªèËøáÁΩëÂÖ≥‰ºöË∞ÉÁî®AuthÊúçÂä°ÔºåÂØπtokenÂêàÊ≥ïÊÄßËøõË°åÈ™åËØÅ„ÄÇÂêåÊó∂Á¨îËÄÖÊ†πÊçÆÂΩìÂâçÈ°πÁõÆÁöÑÊï¥‰ΩìÊÉÖÂÜµÔºåÂ≠òÂú®ÈÉ®ÂàÜÈÅóÁïôÊúçÂä°ÔºåËøô‰∫õÈÅóÁïôÊúçÂä°ÂèàÊ≤°ÊúâË∂≥Â§üÁöÑÊó∂Èó¥Âíå‰∫∫ÂäõÁ´ãÈ©¨ËøõË°åÂæÆÊúçÂä°ÊîπÈÄ†ÔºåËÄå‰∏îËøòÈúÄË¶ÅÁªßÁª≠ËøêË°å„ÄÇ‰∏∫‰∫ÜÈÄÇÈÖçÂΩìÂâçÊñ∞ÁöÑÊû∂ÊûÑÔºåÈááÂèñÁöÑÊñπÊ°àÂ∞±ÊòØÂØπËøô‰∫õÈÅóÁïôÊúçÂä°ÁöÑÊìç‰ΩúAPIÔºåÂú®AuthÊúçÂä°ËøõË°åAPIÁ∫ßÂà´ÁöÑÊìç‰ΩúÊùÉÈôêÈâ¥ÂÆö„ÄÇAPIÁ∫ßÂà´ÁöÑÊìç‰ΩúÊùÉÈôêÊ†°È™åÈúÄË¶ÅÁöÑ‰∏ä‰∏ãÊñá‰ø°ÊÅØÈúÄË¶ÅÁªìÂêà‰∏öÂä°Ôºå‰∏éÂÆ¢Êà∑Á´ØËøõË°åÂïÜÂÆöÔºåÂ∫îËØ•Âú®tokenËÉΩÂèñÂà∞Áõ∏Â∫î‰ø°ÊÅØÔºå‰º†ÈÄíÁªôAuthÊúçÂä°Ôºå‰∏çËøáÂ∫îÂ∞ΩÈáèÂáèÂ∞ëÂú®headerÂèñ‰∏ä‰∏ãÊñáÊ†°È™åÁöÑ‰ø°ÊÅØ„ÄÇ Á¨îËÄÖÂ∞ÜÊú¨Ê¨°ÂºÄÂèëAuthÁ≥ªÁªüÊâÄÊ∂âÂèäÁöÑÂ§ßÈÉ®ÂàÜ‰ª£Á†ÅÂèäÊ∫êÁ†ÅËøõË°å‰∫ÜËß£ÊûêÔºåËá≥‰∫éÊ≤°ÊúâËÆ≤Âà∞ÁöÑ‰∏Ä‰∫õÂÜÖÂÆπÂíåÁªÜËäÇÔºåËØªËÄÖÂèØ‰ª•Ëá™Ë°åÊâ©Â±ï„ÄÇ 5. ‰∏çË∂≥‰∏éÂêéÁª≠Â∑•‰Ωú5.1 Â≠òÂú®ÁöÑ‰∏çË∂≥ APIÁ∫ßÂà´Êìç‰ΩúÊùÉÈôêÊ†°È™åÁöÑÈÄöÁî®ÊÄß (1). ÂØπ‰∫éAPIÁ∫ßÂà´Êìç‰ΩúÊùÉÈôêÊ†°È™åÔºåÈúÄË¶ÅÂú®ÁΩëÂÖ≥Â§ÑË∞ÉÁî®Êó∂ÊûÑÈÄ†Áõ∏Â∫îÁöÑ‰∏ä‰∏ãÊñá‰ø°ÊÅØ„ÄÇ‰∏ä‰∏ãÊñá‰ø°ÊÅØÂü∫Êú¨‰æùËµñ‰∫é token‰∏≠ÁöÑpayloadÔºåÂ¶ÇÊûú‰ø°ÊÅØÂ§™Â§öÂºïËµ∑tokenÂ§™ÈïøÔºåÂØºËá¥ÊØèÊ¨°ÂÆ¢Êà∑Á´ØÁöÑËØ∑Ê±ÇÂ§¥ÈÉ®ÈïøÂ∫¶ÂèòÈïø„ÄÇ (2). Âπ∂‰∏çÊòØÊâÄÊúâÁöÑÊìç‰ΩúÊé•Âè£ÈÉΩËÉΩË¶ÜÁõñÂà∞ÔºåËøô‰∏™ÈóÆÈ¢òÊòØÊØîËæÉ‰∏•ÈáçÁöÑÔºåÊ†πÊçÆ‰∏ä‰∏ãÊñáÈõÜÂêàÂæàÂèØËÉΩÂá∫Áé∞Â•ΩÂ§öÊé•Âè£ ÁöÑÊùÉÈôêÊ≤°Ê≥ïÈâ¥ÂÆöÔºåÊúÄÂêéÁöÑÁªìÊûúÂ∞±ÊòØAPIÁ∫ßÂà´Êìç‰ΩúÊùÉÈôêÊ†°È™åÂ§±Ë¥•ÁöÑÊòØÁªùÂØπÊ≤°ÊúâÊùÉÈôêËÆøÈóÆËØ•Êé•Âè£ÔºåËÄåÈÄöËøá‰∏ç‰∏ÄÂÆöËÉΩËÆøÈóÆÔºåÂõ†‰∏∫ËØ•Êé•Âè£Ê∂âÂèäÂà∞ÁöÑ‰∏ä‰∏ãÊñáÊ†πÊú¨Ê≤°Ê≥ïÂÆåÂÖ®ÂæóÂà∞„ÄÇÊàë‰ª¨ÁöÑÈ°πÁõÆÂú®Áé∞Èò∂ÊÆµÔºåÂÆö‰πâÁöÑÊúÄÂ∞è‰∏ä‰∏ãÊñáÈõÜÂêàËÉΩÂãâÂº∫Ë¶ÜÁõñÂà∞Ôºå‰ΩÜÊòØÂØπ‰∫éÂêéÈù¢Êâ©Â¢ûÁöÑÊúçÂä°Êé•Âè£ÁúüÁöÑÊòØ‰∏ç‰πêËßÇ„ÄÇ (3). ÊØè‰∏™ÊúçÂä°ÁöÑÊØè‰∏™Êé•Âè£ÈÉΩÂú®AuthÊúçÂä°Ê≥®ÂÜåÂÖ∂ÊâÄÈúÄË¶ÅÁöÑÊùÉÈôêÔºåÂ§™ËøáÈ∫ªÁÉ¶ÔºåAuthÊúçÂä°ÈúÄË¶ÅÈ¢ùÂ§ñÁª¥Êä§ËøôÊ†∑ÁöÑ‰ø°ÊÅØ„ÄÇ ÁΩëÂÖ≥Â§ÑË∞ÉÁî®AuthÊúçÂä°Â∏¶Êù•ÁöÑÁ≥ªÁªüÂêûÂêêÈáèÁì∂È¢à (1). Ëøô‰∏™ÂÖ∂ÂÆûÂæàÂÆπÊòìÁêÜËß£ÔºåAuthÊúçÂä°‰Ωú‰∏∫ÂÖ¨ÂÖ±ÁöÑÂü∫Á°ÄÊúçÂä°ÔºåÂ§ßÂ§öÊï∞ÊúçÂä°Êé•Âè£ÈÉΩ‰ºöÈúÄË¶ÅÈâ¥ÊùÉÔºåAuthÊúçÂä°ÈúÄË¶ÅÁªèËøáÂ§çÊùÇ„ÄÇ (2). ÁΩëÂÖ≥Ë∞ÉÁî®AuthÊúçÂä°ÔºåÈòªÂ°ûË∞ÉÁî®ÔºåÂè™ÊúâÁ≠âAuthÊúçÂä°ËøîÂõûÊ†°È™åÁªìÊûúÔºåÊâç‰ºöÂÅöËøõ‰∏ÄÊ≠•Â§ÑÁêÜ„ÄÇËôΩËØ¥AuthÊúçÂä°ÂèØ‰ª•Â§öÂÆû‰æãÈÉ®ÁΩ≤Ôºå‰ΩÜÊòØÂπ∂ÂèëÈáèÂ§ß‰∫Ü‰πãÂêéÔºåÂÖ∂Áì∂È¢àÊòéÊòæÂèØËßÅÔºå‰∏•ÈáçÂèØËÉΩ‰ºöÈÄ†ÊàêÊï¥‰∏™Á≥ªÁªüÁöÑ‰∏çÂèØÁî®„ÄÇ 5.2 ÂêéÁª≠Â∑•‰Ωú ‰ªéÊï¥‰∏™Á≥ªÁªüËÆæËÆ°ËßíÂ∫¶Êù•ËÆ≤ÔºåAPIÁ∫ßÂà´Êìç‰ΩúÊùÉÈôêÂêéÊúüÂ∞Ü‰ºöÂàÜÊï£Âú®ÂêÑ‰∏™ÊúçÂä°ÁöÑÊé•Âè£‰∏äÔºåÁî±ÂêÑ‰∏™Êé•Âè£Ë¥üË¥£ÂÖ∂ÊâÄÈúÄË¶ÅÁöÑÊùÉÈôê„ÄÅË∫´‰ªΩÁ≠â„ÄÇSpring SecurityÂØπ‰∫éÊé•Âè£Á∫ßÂà´ÁöÑÊùÉÈôêÊ†°È™å‰πüÊòØÊîØÊåÅÁöÑÔºå‰πãÊâÄ‰ª•ÈááÁî®ËøôÊ†∑ÁöÑÂÅöÊ≥ïÔºå‰πüÊòØ‰∏∫‰∫ÜÂÖºÂÆπÊñ∞ÊúçÂä°ÂíåÈÅóÁïôÁöÑÊúçÂä°Ôºå‰∏ªË¶ÅÊòØÈíàÂØπÈÅóÁïôÊúçÂä°ÔºåÊñ∞ÁöÑÊúçÂä°ÈááÁî®ÁöÑÊòØÂàÜÊï£Âú®ÂêÑ‰∏™Êé•Âè£‰πã‰∏ä„ÄÇ Â∞ÜAPIÁ∫ßÂà´Êìç‰ΩúÊùÉÈôêÂàÜÊï£Âà∞ÂêÑ‰∏™ÊúçÂä°Êé•Âè£‰πãÂêéÔºåÁõ∏Â∫îÁöÑËÉΩÊèêÂçáAuthÊúçÂä°ÁöÑÂìçÂ∫î„ÄÇÁΩëÂÖ≥ËÉΩÂ§üÂèäÊó∂ÁöÑÂØπËØ∑Ê±ÇËøõË°åËΩ¨ÂèëÊàñËÄÖÊãíÁªù„ÄÇ APIÁ∫ßÂà´Êìç‰ΩúÊùÉÈôêÊâÄÈúÄË¶ÅÁöÑ‰∏ä‰∏ãÊñá‰ø°ÊÅØÂØπÂêÑ‰∏™Êé•Âè£ÁúüÁöÑËÆæËÆ°ÁöÑÂæàÂ§çÊùÇÔºåËøôËæπÊàë‰ª¨Á°ÆÂÆûËä±‰∫ÜÊó∂Èó¥ÔºåÂêåÊó∂ÁÆ°ÁêÜÁßªÂä®ÊúçÂä°ÁöÑÂ•ΩÂá†ÁôæÊìç‰ΩúÊé•Âè£ÊâÄÂØπÂ∫îÁöÑÊùÉÈôêÔºåÈùûÂ∏∏ÁÉ¶„ÄÇÔºÅ Êú¨ÊñáÁöÑÊ∫êÁ†ÅÂú∞ÂùÄÔºöGitHubÔºöhttps://github.com/keets2012/Auth-serviceÁ†Å‰∫ëÔºö https://gitee.com/keets/Auth-Service ÂèÇËÄÉ ÈÖçÁΩÆË°®ÂçïÁôªÂΩï Spring Security3Ê∫êÁ†ÅÂàÜÊûê-FilterSecurityInterceptorÂàÜÊûê Core Security Filters Spring Security(Âõõ)‚ÄìÊ†∏ÂøÉËøáÊª§Âô®Ê∫êÁ†ÅÂàÜÊûê Áõ∏ÂÖ≥ÈòÖËØªËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞Ôºà‰∏ÄÔºâËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞Ôºà‰∫åÔºâËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞Ôºà‰∏âÔºâ]]></content>
      <categories>
        <category>Security</category>
      </categories>
      <tags>
        <tag>Spring Security</tag>
        <tag>OAuth2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞Ôºà‰∏âÔºâ]]></title>
    <url>%2F2017%2F10%2F24%2Fsecurity3%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÔºö Êú¨ÊñáÁ≥ª„ÄäËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞„ÄãÁ≥ªÂàóÁöÑÁ¨¨‰∏âÁØáÔºåÊú¨ÊñáÈáçÁÇπËÆ≤Ëß£token‰ª•ÂèäAPIÁ∫ßÂà´ÁöÑÈâ¥ÊùÉ„ÄÇÊú¨ÊñáÂØπÊ∂âÂèäÂà∞ÁöÑÂ§ßÈÉ®ÂàÜ‰ª£Á†ÅËøõË°å‰∫ÜÂàÜÊûêÔºåÊ¨¢ËøéËÆ¢ÈòÖÊú¨Á≥ªÂàóÊñáÁ´†„ÄÇ 1. ÂâçÊñáÂõûÈ°æÂú®ÂºÄÂßãËÆ≤Ëß£Ëøô‰∏ÄÁØáÊñáÁ´†‰πãÂâçÔºåÂÖàÂØπ‰πãÂâç‰∏§ÁØáÊñáÁ´†ËøõË°åÂõûÂøÜ‰∏ã„ÄÇÂú®Á¨¨‰∏ÄÁØá ËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞Ôºà‰∏ÄÔºâ‰ªãÁªç‰∫ÜËØ•È°πÁõÆÁöÑËÉåÊôØ‰ª•ÂèäÊäÄÊúØË∞ÉÁ†î‰∏éÊúÄÂêéÈÄâÂûã„ÄÇÁ¨¨‰∫åÁØáËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞Ôºà‰∫åÔºâÁîªÂá∫‰∫ÜÁÆÄË¶ÅÁöÑÁôªÂΩïÂíåÊ†°È™åÁöÑÊµÅÁ®ãÂõæÔºåÂπ∂ÈáçÁÇπËÆ≤Ëß£‰∫ÜÁî®Êà∑Ë∫´‰ªΩÁöÑËÆ§ËØÅ‰∏étokenÂèëÊîæÁöÑÂÖ∑‰ΩìÂÆûÁé∞„ÄÇ Êú¨ÊñáÈáçÁÇπËÆ≤Ëß£Èâ¥ÊùÉÔºåÂåÖÊã¨‰∏§‰∏™ÊñπÈù¢ÔºötokenÂêàÊ≥ïÊÄß‰ª•ÂèäAPIÁ∫ßÂà´ÁöÑÊìç‰ΩúÊùÉÈôê„ÄÇÈ¶ñÂÖàtokenÂêàÊ≥ïÊÄßÂæàÂÆπÊòìÁêÜËß£ÔºåÁ¨¨‰∫åÁØáÊñáÁ´†ËÆ≤Ëß£‰∫ÜËé∑ÂèñÊéàÊùÉtokenÁöÑ‰∏ÄÁ≥ªÂàóÊµÅÁ®ãÔºåtokenÊòØÂê¶ÊòØËÆ§ËØÅÊúçÂä°Âô®È¢ÅÂèëÁöÑÔºåÂøÖÁÑ∂ÊòØÈúÄË¶ÅÈ™åËØÅÁöÑ„ÄÇÂÖ∂Ê¨°ÂØπ‰∫éAPIÁ∫ßÂà´ÁöÑÊìç‰ΩúÊùÉÈôêÔºåÂ∞Ü‰∏ä‰∏ãÊñá‰ø°ÊÅØ‰∏çÂÖ∑Â§áÊìç‰ΩúÊùÉÈôêÁöÑËØ∑Ê±ÇÁõ¥Êé•ÊãíÁªùÔºåÂΩìÁÑ∂Ê≠§Â§ÑÊòØËÆæËÆ°tokenÂêàÊ≥ïÊÄßÊ†°È™åÂú®ÂÖàÔºåÂÖ∂Ê¨°ÂÜçÂØπÊìç‰ΩúÊùÉÈôêËøõË°åÈ™åËØÅÔºåÂ¶ÇÊûúÂâç‰∏Ä‰∏™È™åËØÅÁõ¥Êé•ÊãíÁªùÔºåÈÄöËøáÂàôËøõÂÖ•Êìç‰ΩúÊùÉÈôêÈ™åËØÅ„ÄÇ 2.ËµÑÊ∫êÊúçÂä°Âô®ÈÖçÁΩÆResourceServerÈÖçÁΩÆÂú®Á¨¨‰∏ÄÁØáÂ∞±ÂàóÂá∫‰∫ÜÔºåÂú®ËøõÂÖ•Èâ¥ÊùÉ‰πãÂâçÔºåÊääËøôËæπÁöÑÈÖçÁΩÆÊêûÊ∏ÖÔºåÂç≥‰ΩøÊúâ‰∫õÈÖçÁΩÆÂú®Êú¨È°πÁõÆ‰∏≠Ê≤°ÊúâÁî®Âà∞ÔºåÂ§ßÂÆ∂Âú®Ëá™Â∑±ÁöÑÈ°πÁõÆÊúâÂèØËÉΩÁî®Âà∞„ÄÇ 1234567891011121314151617181920212223242526272829303132333435@Configuration@EnableResourceServerpublic class ResourceServerConfig extends ResourceServerConfigurerAdapter &#123; //httpÂÆâÂÖ®ÈÖçÁΩÆ @Override public void configure(HttpSecurity http) throws Exception &#123; //Á¶ÅÊéâcsrfÔºåËÆæÁΩÆsessionÁ≠ñÁï• http.csrf().disable() .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and()//ÈªòËÆ§ÂÖÅËÆ∏ËÆøÈóÆ .requestMatchers().antMatchers("/**") .and().authorizeRequests() .antMatchers("/**").permitAll() .anyRequest().authenticated() .and().logout() //logoutÊ≥®ÈîÄÁ´ØÁÇπÈÖçÁΩÆ .logoutUrl("/logout") .clearAuthentication(true) .logoutSuccessHandler(new HttpStatusReturningLogoutSuccessHandler()) .addLogoutHandler(customLogoutHandler()); &#125; //Ê∑ªÂä†Ëá™ÂÆö‰πâÁöÑCustomLogoutHandler @Bean public CustomLogoutHandler customLogoutHandler() &#123; return new CustomLogoutHandler(); &#125; //ËµÑÊ∫êÂÆâÂÖ®ÈÖçÁΩÆÁõ∏ÂÖ≥ @Override public void configure(ResourceServerSecurityConfigurer resources) throws Exception &#123; super.configure(resources); &#125;&#125; (1). @EnableResourceServerËøô‰∏™Ê≥®Ëß£ÂæàÈáçË¶ÅÔºåOAuth2ËµÑÊ∫êÊúçÂä°Âô®ÁöÑÁÆÄ‰æøÊ≥®Ëß£„ÄÇÂÖ∂‰ΩøÂæóSpring Security filterÈÄöËøáËØ∑Ê±Ç‰∏≠ÁöÑOAuth2 tokenÊù•È™åËØÅËØ∑Ê±Ç„ÄÇÈÄöÂ∏∏‰∏éEnableWebSecurityÈÖçÂêà‰ΩøÁî®ÔºåËØ•Ê≥®Ëß£ËøòÂàõÂª∫‰∫ÜÁ°¨ÁºñÁ†ÅÁöÑ@Order(3) WebSecurityConfigurerAdapterÔºåÁî±‰∫éÂΩìÂâçspringÁöÑÊäÄÊúØÔºåorderÁöÑÈ°∫Â∫è‰∏çÊòì‰øÆÊîπÔºåÊâÄ‰ª•Âú®È°πÁõÆ‰∏≠ÈÅøÂÖçËøòÊúâÂÖ∂‰ªñorder=3ÁöÑÈÖçÁΩÆ„ÄÇ (2). ÂÖ≥ËÅîÁöÑHttpSecurityÔºå‰∏é‰πãÂâçÁöÑ Spring Security XML‰∏≠ÁöÑ ‚Äúhttp‚ÄùÂÖÉÁ¥†ÈÖçÁΩÆÁ±ª‰ººÔºåÂÆÉÂÖÅËÆ∏ÈÖçÁΩÆÂü∫‰∫éwebÂÆâÂÖ®‰ª•ÈíàÂØπÁâπÂÆöhttpËØ∑Ê±Ç„ÄÇÈªòËÆ§ÊòØÂ∫îÁî®Âà∞ÊâÄÊúâÁöÑËØ∑Ê±ÇÔºåÈÄöËøárequestMatcherÂèØ‰ª•ÈôêÂÆöÂÖ∑‰ΩìURLËåÉÂõ¥„ÄÇHttpSecurityÁ±ªÂõæÂ¶Ç‰∏ã„ÄÇ ÊÄªÁöÑÊù•ËØ¥ÔºöHttpSecurityÊòØSecurityBuilderÊé•Âè£ÁöÑ‰∏Ä‰∏™ÂÆûÁé∞Á±ªÔºå‰ªéÂêçÂ≠ó‰∏äÊàë‰ª¨Â∞±ÂèØ‰ª•ÁúãÂá∫ËøôÊòØ‰∏Ä‰∏™HTTPÂÆâÂÖ®Áõ∏ÂÖ≥ÁöÑÊûÑÂª∫Âô®„ÄÇÂΩìÁÑ∂Êàë‰ª¨Âú®ÊûÑÂª∫ÁöÑÊó∂ÂÄôÂèØËÉΩÈúÄË¶Å‰∏Ä‰∫õÈÖçÁΩÆÔºåÂΩìÊàë‰ª¨Ë∞ÉÁî®HttpSecurityÂØπË±°ÁöÑÊñπÊ≥ïÊó∂ÔºåÂÆûÈôÖ‰∏äÂ∞±ÊòØÂú®ËøõË°åÈÖçÁΩÆ„ÄÇ authorizeRequests()ÔºåformLogin()„ÄÅhttpBasic()Ëøô‰∏â‰∏™ÊñπÊ≥ïËøîÂõûÁöÑÂàÜÂà´ÊòØExpressionUrlAuthorizationConfigurer„ÄÅFormLoginConfigurer„ÄÅHttpBasicConfigurerÔºå‰ªñ‰ª¨ÈÉΩÊòØSecurityConfigurerÊé•Âè£ÁöÑÂÆûÁé∞Á±ªÔºåÂàÜÂà´‰ª£Ë°®ÁöÑÊòØ‰∏çÂêåÁ±ªÂûãÁöÑÂÆâÂÖ®ÈÖçÁΩÆÂô®„ÄÇÂõ†Ê≠§Ôºå‰ªéÊÄªÁöÑÊµÅÁ®ã‰∏äÊù•ËØ¥ÔºåÂΩìÊàë‰ª¨Âú®ËøõË°åÈÖçÁΩÆÁöÑÊó∂ÂÄôÔºåÈúÄË¶Å‰∏Ä‰∏™ÂÆâÂÖ®ÊûÑÂª∫Âô®SecurityBuilder(‰æãÂ¶ÇÊàë‰ª¨ËøôÈáåÁöÑHttpSecurity)ÔºåSecurityBuilderÂÆû‰æãÁöÑÂàõÂª∫ÈúÄË¶ÅÊúâËã•Âπ≤ÂÆâÂÖ®ÈÖçÁΩÆÂô®SecurityConfigurerÂÆû‰æãÁöÑÈÖçÂêà„ÄÇ (3).ÂÖ≥ËÅîÁöÑResourceServerSecurityConfigurerÔºå‰∏∫ËµÑÊ∫êÊúçÂä°Âô®Ê∑ªÂä†ÁâπÊÆäÁöÑÈÖçÁΩÆÔºåÈªòËÆ§ÁöÑÈÄÇÁî®‰∫éÂæàÂ§öÂ∫îÁî®Ôºå‰ΩÜÊòØËøôËæπÁöÑ‰øÆÊîπËá≥Â∞ë‰ª•resourceId‰∏∫Âçï‰Ωç„ÄÇÁ±ªÂõæÂ¶Ç‰∏ã„ÄÇ ResourceServerSecurityConfigurerÂàõÂª∫‰∫ÜOAuth2Ê†∏ÂøÉËøáÊª§Âô®OAuth2AuthenticationProcessingFilterÔºåÂπ∂‰∏∫ÂÖ∂Êèê‰æõÂõ∫ÂÆö‰∫ÜOAuth2AuthenticationManager„ÄÇÂè™ÊúâË¢´OAuth2AuthenticationProcessingFilterÊã¶Êà™Âà∞ÁöÑoauth2Áõ∏ÂÖ≥ËØ∑Ê±ÇÊâçË¢´ÁâπÊÆäÁöÑË∫´‰ªΩËÆ§ËØÅÂô®Â§ÑÁêÜ„ÄÇÂêåÊó∂ËÆæÁΩÆ‰∫ÜTokenExtractor„ÄÅÂºÇÂ∏∏Â§ÑÁêÜÂÆûÁé∞„ÄÇ OAuth2AuthenticationProcessingFilterÊòØOAuth2‰øùÊä§ËµÑÊ∫êÁöÑÈ¢ÑÂÖàËÆ§ËØÅËøáÊª§Âô®„ÄÇÈÖçÂêàOAuth2AuthenticationManager‰ΩøÁî®ÔºåÊ†πÊçÆËØ∑Ê±ÇËé∑ÂèñÂà∞OAuth2 tokenÔºå‰πãÂêéÂ∞±‰ºö‰ΩøÁî®OAuth2AuthenticationÊù•Â°´ÂÖÖSpring Security‰∏ä‰∏ãÊñá„ÄÇOAuth2AuthenticationManagerÂú®ÂâçÈù¢ÁöÑÊñáÁ´†ÁªôÂá∫ÁöÑAuthenticationManagerÁ±ªÂõæÂ∞±Âá∫Áé∞‰∫ÜÔºå‰∏étokenËÆ§ËØÅÁõ∏ÂÖ≥„ÄÇËøôËæπÁï•ËøáË¥¥Âá∫Ê∫êÁ†ÅËøõË°åËÆ≤Ëß£ÔºåËØªËÄÖÂèØ‰ª•Ëá™Ë°åÈòÖËØª„ÄÇ 3. Èâ¥ÊùÉendpointÈâ¥ÊùÉ‰∏ªË¶ÅÊòØ‰ΩøÁî®ÂÜÖÁΩÆÁöÑendpoint /oauth/check_tokenÔºåÁ¨îËÄÖÂ∞ÜÂØπÁ´ØÁÇπÁöÑÂàÜÊûêÊîæÂú®ÂâçÈù¢ÔºåÂõ†‰∏∫ËøôÊòØÈâ¥ÊùÉÁöÑÂîØ‰∏ÄÂÖ•Âè£„ÄÇ‰∏ãÈù¢Êàë‰ª¨Êù•Áúã‰∏ãËØ•APIÊé•Âè£‰∏≠ÁöÑ‰∏ªË¶Å‰ª£Á†Å„ÄÇ 123456789101112131415161718192021222324252627282930@RequestMapping(value = "/oauth/check_token") @ResponseBody public Map&lt;String, ?&gt; checkToken(CheckTokenEntity checkTokenEntity) &#123; //CheckTokenEntity‰∏∫Ëá™ÂÆö‰πâÁöÑdto Assert.notNull(checkTokenEntity, "invalid token entity!"); //ËØÜÂà´token OAuth2AccessToken token = resourceServerTokenServices.readAccessToken(checkTokenEntity.getToken()); //Âà§Êñ≠tokenÊòØÂê¶‰∏∫Á©∫ if (token == null) &#123; throw new InvalidTokenException("Token was not recognised"); &#125; //Êú™ËøáÊúü if (token.isExpired()) &#123; throw new InvalidTokenException("Token has expired"); &#125; //Âä†ËΩΩOAuth2Authentication OAuth2Authentication authentication = resourceServerTokenServices.loadAuthentication(token.getValue()); //Ëé∑ÂèñresponseÔºåtokenÂêàÊ≥ïÊÄßÈ™åËØÅÂÆåÊØï Map&lt;String, Object&gt; response = (Map&lt;String, Object&gt;) accessTokenConverter.convertAccessToken(token, authentication); //check for api permission if (response.containsKey("jti")) &#123; //‰∏ä‰∏ãÊñáÊìç‰ΩúÊùÉÈôêÊ†°È™å Assert.isTrue(checkPermissions.checkPermission(checkTokenEntity)); &#125; response.put("active", true); // Always true if token exists and not expired return response; &#125; ÁúãËøásecurity-oauthÊ∫êÁ†ÅÁöÑÂêåÂ≠¶ÂèØËÉΩÁ´ãÈ©¨Â∞±ÁúãÂá∫‰∏äËø∞‰ª£Á†Å‰∏éÊ∫êÁ†Å‰∏çÂêåÔºåÁÜüÊÇâ/oauth/check_tokenÊ†°È™åÊµÅÁ®ãÁöÑ‰πü‰ºöÁúãÂá∫Êù•ÔºåËøôËæπÁ¨îËÄÖÂØπsecurity-oauth jarËøõË°å‰∫ÜÈáçÊñ∞ÁºñËØëÔºå‰øÆÊîπ‰∫ÜÈÉ®ÂàÜÊ∫êÁ†ÅÁî®‰∫éËØ•È°πÁõÆÈúÄÊ±ÇÁöÑÂú∫ÊôØ„ÄÇ‰∏ªË¶ÅÊòØÂä†ÂÖ•‰∫ÜÂâçÁΩÆÁöÑAPIÁ∫ßÂà´ÁöÑÊùÉÈôêÊ†°È™å„ÄÇ 4. token ÂêàÊ≥ïÊÄßÈ™åËØÅ‰ªé‰∏äÈù¢ÁöÑCheckTokenEndpoint‰∏≠ÂèØ‰ª•ÁúãÂá∫ÔºåÂØπ‰∫étokenÂêàÊ≥ïÊÄßÈ™åËØÅÈ¶ñÂÖàÊòØËØÜÂà´ËØ∑Ê±Ç‰Ωì‰∏≠ÁöÑtoken„ÄÇÁî®Âà∞ÁöÑ‰∏ªË¶ÅÊñπÊ≥ïÊòØResourceServerTokenServicesÊèê‰æõÁöÑreadAccessToken()ÊñπÊ≥ï„ÄÇËØ•Êé•Âè£ÁöÑÂÆûÁé∞Á±ª‰∏∫DefaultTokenServicesÔºåÂú®‰πãÂâçÁöÑÈÖçÁΩÆ‰∏≠ÊúâËÆ≤ËøáËøôËæπÈÖçÁΩÆ‰∫ÜjdbcÁöÑTokenStore„ÄÇ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051public class JdbcTokenStore implements TokenStore &#123; ... public OAuth2AccessToken readAccessToken(String tokenValue) &#123; OAuth2AccessToken accessToken = null; try &#123; //‰ΩøÁî®selectAccessTokenSqlËØ≠Âè•ÔºåË∞ÉÁî®‰∫ÜÁßÅÊúâÁöÑextractTokenKey()ÊñπÊ≥ï accessToken = jdbcTemplate.queryForObject(selectAccessTokenSql, new RowMapper&lt;OAuth2AccessToken&gt;() &#123; public OAuth2AccessToken mapRow(ResultSet rs, int rowNum) throws SQLException &#123; return deserializeAccessToken(rs.getBytes(2)); &#125; &#125;, extractTokenKey(tokenValue)); &#125; //ÂºÇÂ∏∏ÊÉÖÂÜµ catch (EmptyResultDataAccessException e) &#123; if (LOG.isInfoEnabled()) &#123; LOG.info("Failed to find access token for token " + tokenValue); &#125; &#125; catch (IllegalArgumentException e) &#123; LOG.warn("Failed to deserialize access token for " + tokenValue, e); //‰∏çÂêàÊ≥ïÂàôÁßªÈô§ removeAccessToken(tokenValue); &#125; return accessToken; &#125; ... //ÊèêÂèñTokenKeyÊñπÊ≥ï protected String extractTokenKey(String value) &#123; if (value == null) &#123; return null; &#125; MessageDigest digest; try &#123; //MD5 digest = MessageDigest.getInstance("MD5"); &#125; catch (NoSuchAlgorithmException e) &#123; throw new IllegalStateException("MD5 algorithm not available. Fatal (should be in the JDK)."); &#125; try &#123; byte[] bytes = digest.digest(value.getBytes("UTF-8")); return String.format("%032x", new BigInteger(1, bytes)); &#125; catch (UnsupportedEncodingException e) &#123; throw new IllegalStateException("UTF-8 encoding not available. Fatal (should be in the JDK)."); &#125; &#125;&#125; readAccessToken()Ê£ÄÁ¥¢Âá∫ËØ•tokenÂÄºÁöÑÂÆåÊï¥‰ø°ÊÅØ„ÄÇ‰∏äËø∞‰ª£Á†ÅÊØîËæÉÁÆÄÂçïÔºåÊ∂âÂèäÂà∞ÁöÑÈÄªËæë‰πü‰∏çÂ§çÊùÇÔºåÊ≠§Â§ÑÁÆÄÂçïËÆ≤Ëß£„ÄÇ‰∏ãÂõæ‰∏∫debug tokenÊ†°È™åÁöÑÂèòÈáè‰ø°ÊÅØÔºåËØªËÄÖÂèØ‰ª•Ëá™Â∑±Âä®ÊâãÊìç‰Ωú‰∏ãÔºåÊà™Âõæ‰ªÖ‰æõÂèÇËÄÉ„ÄÇ Ëá≥‰∫éÂêéÈù¢ÁöÑÊ≠•È™§ÔºåloadAuthentication()‰∏∫ÁâπÂÆöÁöÑaccess token Âä†ËΩΩcredentials„ÄÇÂæóÂà∞ÁöÑcredentials ‰∏étoken‰Ωú‰∏∫convertAccessToken()ÂèÇÊï∞ÔºåÂæóÂà∞Ê†°È™åtokenÁöÑresponse„ÄÇ 5. APIÁ∫ßÂà´ÊùÉÈôêÊ†°È™åÁ¨îËÄÖÈ°πÁõÆÁõÆÂâçÈÉΩÊòØÂü∫‰∫éWebÁöÑÊùÉÈôêÈ™åËØÅÔºå‰πãÂâçÈÅóÁïôÁöÑ‰∏Ä‰∏™Â∑®Â§ßÁöÑÂçï‰ΩìÂ∫îÁî®Á≥ªÁªüÊ≠£Âú®ÈÄêÊ∏êÊãÜÂàÜÔºåÁÑ∂ËÄåÂΩìÂâçÂèà‰∏çËÉΩÂÆåÂÖ®ÊãÜÂàÜÂÆåÂñÑ„ÄÇ‰∏∫‰∫ÜÂêåÊó∂ÂÖºÂÆπÊñ∞ÊóßÊúçÂä°ÔºåÂ∞ΩÈáèÂáèÂ∞ëÂØπ‰∏öÂä°Á≥ªÁªüÁöÑÂÖ•‰æµÔºåÂÆûÁé∞ÂæÆÊúçÂä°ÁöÑÁªü‰∏ÄÊÄßÂíåÁã¨Á´ãÊÄß„ÄÇÁ¨îËÄÖÊ†πÊçÆ‰∏öÂä°‰∏öÂä°Âú∫ÊôØÔºåÂ∞ùËØïÂú®AuthÂ§ÑÂÅöÊìç‰ΩúÊùÉÈôêÊ†°È™å„ÄÇÈ¶ñÂÖàÊÉ≥Âà∞ÁöÑÊòØËµÑÊ∫êÊúçÂä°Âô®ÈÖçÁΩÆResourceServerÔºåÂ¶ÇÔºö 12http.authorizeRequests().antMatchers(&quot;/order/**&quot;).access(&quot;#oauth2.hasScope(&apos;select&apos;) and hasRole(&apos;ROLE_USER&apos;)&quot;) ËøôÊ†∑ÂÅöÈúÄË¶ÅÂ∞ÜÊØè‰∏™Êìç‰ΩúÊé•Âè£ÁöÑAPIÊùÉÈôêÊéßÂà∂ÊîæÂú®ÂêÑ‰∏™‰∏çÂêåÁöÑ‰∏öÂä°ÊúçÂä°ÔºåÊØè‰∏™ÊúçÂä°Âú®Êé•Êî∂Âà∞ËØ∑Ê±ÇÂêéÔºåÈúÄË¶ÅÂÖà‰ªéAuthÊúçÂä°ÂèñÂá∫ËØ•token ÂØπÂ∫îÁöÑroleÂíåscopeÁ≠âÊùÉÈôê‰ø°ÊÅØ„ÄÇËøô‰∏™ÊñπÊ≥ïËÇØÂÆöÊòØÂèØË°åÁöÑÔºå‰ΩÜÊòØÁî±‰∫éÈ°πÁõÆÈâ¥ÊùÉÁöÑÁ≤íÂ∫¶Êõ¥ÁªÜÔºåËÄå‰∏îÊöÇÊó∂‰∏çÊÉ≥Â§ßÂä®ÂéüÊúâÁ≥ªÁªüÔºåÂú®Âä†‰∏ä‰πãÂâçÁΩëÂÖ≥ËÆæËÆ°ÔºåÁΩëÂÖ≥Ë∞ÉÁî®AuthÊúçÂä°Ê†°È™åtokenÂêàÊ≥ïÊÄßÔºåÊâÄ‰ª•ÊúÄÂêéÂÜ≥ÂÆöÂú®AuthÁ≥ªÁªüË∞ÉÁî®‰∏≠ÔºåÊääËøô‰∫õÊ†°È™å‰∏ÄËµ∑Ëß£ÂÜ≥ÂÆå„ÄÇ ÊñáÁ´†ÂºÄÂ§¥ËµÑÊ∫êÊúçÂä°Âô®ÁöÑÈÖçÁΩÆ‰ª£Á†ÅÂèØ‰ª•ÁúãÂá∫ÔºåÂØπ‰∫éÊâÄÊúâÁöÑËµÑÊ∫êÂπ∂Ê≤°ÊúâÂÅöÊã¶Êà™ÔºåÂõ†‰∏∫ÁΩëÂÖ≥Â§ÑÊòØË∞ÉÁî®AuthÁ≥ªÁªüÁöÑÁõ∏ÂÖ≥endpointÔºåÂπ∂‰∏çÊòØÊâÄÊúâÁöÑËØ∑Ê±ÇurlÈÉΩ‰ºöÁªèËøá‰∏ÄÈÅçAuthÁ≥ªÁªüÔºåÊâÄ‰ª•ÂØπ‰∫éÊâÄÊúâÁöÑËµÑÊ∫êÔºåÂú®AuthÁ≥ªÁªü‰∏≠ÔºåÂÆö‰πâÈúÄË¶ÅÈâ¥ÊùÉÊé•Âè£ÊâÄÈúÄË¶ÅÁöÑAPIÊùÉÈôêÔºåÁÑ∂ÂêéÊ†πÊçÆ‰∏ä‰∏ãÊñáËøõË°åÂåπÈÖç„ÄÇËøôÊòØÈááÁî®ÁöÑÁ¨¨‰∫åÁßçÊñπÂºèÔºå‰πüÊòØÁ¨îËÄÖÁõÆÂâçÈááÁî®ÁöÑÊñπÊ≥ï„ÄÇÂΩìÁÑ∂ËøôÁßçÊñπÂºèÁöÑÂºäÁ´Ø‰πüÂæàÊòéÊòæÔºå‰∏ÄÊó¶Âπ∂ÂèëÈáèÂ§ßÔºåÁΩëÂÖ≥ËøòË¶ÅËÄóÊó∂Âú®Ë∞ÉÁî®AuthÁ≥ªÁªüÁöÑÈâ¥ÊùÉ‰∏äÔºåTPSÂäøÂøÖË¶Å‰∏ãÈôçÂæàÂ§öÔºåÂØπ‰∫é‰∏Ä‰∫õ‰∏çÈúÄË¶ÅÈâ¥ÊùÉÁöÑÊúçÂä°Êé•Âè£‰πü‰ºöÂºïËµ∑‰∏çÂèØÁî®„ÄÇÂè¶Â§ñ‰∏ÄÁÇπÊòØÔºåÂØπ‰∫éÊüê‰∫õÁâπÊÆäÊùÉÈôêÁöÑÊé•Âè£ÔºåÈúÄË¶ÅÁöÑ‰∏ä‰∏ãÊñá‰ø°ÊÅØÂæàÂ§öÔºåÂèØËÉΩÂπ∂‰∏çËÉΩÂÆåÂÖ®Ë¶ÜÁõñÔºåÂØπ‰∫éÊ≠§ÔºåÁ¨îËÄÖÁöÑËß£ÂÜ≥ÊòØÂàÜ‰∏§ÊñπÈù¢Ôºö‰∏ÄÊòØÂ∞ΩÈáèÂ∞ÜËøô‰∫õÁâπÊÆäÊÉÖÂÜµËøõË°åÂàÜÁ±ªÔºåÊüê‰∏ÄÁ±ªÁöÑÊÉÖÂÜµÁªü‰∏ÄËß£ÂÜ≥Ôºõ‰∫åÊòØÂ∞Ü‰∏•ËãõÁöÑÊ†°È™åÈôç‰ΩéÔºåÂØπ‰∫é‰∏ä‰∏ãÊñáÊ†°È™åÂ§±Ë¥•ÁöÑÁõ¥Êé•ÊãíÁªùÔºåËÄåÈÄöËøáÁöÑÔºåÂØπ‰∫éÊüê‰∫õÊé•Âè£ÔºåÂú®Êé•Âè£ÂÜÖËøõË°åÊìç‰Ωú‰πãÂâçÔºåÂØπÁâπÊÆäÁöÑÂú∞ÊñπËøòË¶ÅÂÜçÊ¨°ËøõË°åÊ†°È™å„ÄÇ ‰∏äÈù¢Âú®ËÆ≤endpointÊúâÊèêÂà∞ËøôËæπÂØπÊ∫êÁ†ÅËøõË°å‰∫ÜÊîπÂÜô„ÄÇCheckTokenEntityÊòØËá™ÂÆö‰πâÁöÑDTOÔºåËøôËøô‰∏™Á±ª‰∏≠ÂÆö‰πâ‰∫ÜÈâ¥ÊùÉÈúÄË¶ÅÁöÑ‰∏ä‰∏ãÊñáÔºåËøôÈáåÊòØÊåáËÉΩÊ†°È™åÊìç‰ΩúÊùÉÈôêÁöÑÊúÄÂ∞èÈõÜÂêàÔºåÂ¶ÇURI„ÄÅroleId„ÄÅaffairIdÁ≠âÁ≠â„ÄÇÂè¶Â§ñÂÆö‰πâ‰∫ÜCheckPermissionsÊé•Âè£ÔºåÂÖ∂ÊñπÊ≥ïcheckPermission(CheckTokenEntity checkTokenEntity)ËøîÂõû‰∫ÜcheckÁöÑÁªìÊûú„ÄÇËÄåÂÖ∂ÂÖ∑‰ΩìÂÆûÁé∞Á±ªÂàôÂÆö‰πâÂú®AuthÁ≥ªÁªü‰∏≠„ÄÇÁ¨îËÄÖÈ°πÁõÆ‰∏≠Ë∞ÉÁî®ÁöÑÂÆû‰æãÂ¶Ç‰∏ãÔºö 12345678910111213141516171819@Componentpublic class CustomCheckPermission implements CheckPermissions &#123; @Autowired private PermissionService permissionService; @Override public boolean checkPermission(CheckTokenEntity checkTokenEntity) &#123; String url = checkTokenEntity.getUri(); Long affairId = checkTokenEntity.getAffairId(); Long roleId = checkTokenEntity.getRoleId(); //Ê†°È™å if (StringUtils.isEmpty(url) || affairId &lt;= 0 || roleId &lt;= 0) &#123; return true; &#125; else &#123; return permissionService.checkPermission(url, affairId, roleId); &#125; &#125;&#125; ÂÖ≥‰∫éjarÂåÖspring-cloud-starter-oauth2‰∏≠ÁöÑÂÖ∑‰Ωì‰øÆÊîπÂÜÖÂÆπÔºåÂ§ßÂÆ∂ÂèØ‰ª•Áúã‰∏ãÊñáÊú´Á¨îËÄÖÁöÑGitHubÈ°πÁõÆ„ÄÇÈÄöËøáËá™ÂÆö‰πâCustomCheckPermissionÔºåË¶ÜÂÜôcheckPermission()ÊñπÊ≥ïÔºåÂ§ßÂÆ∂‰πüÂèØ‰ª•ÂØπËá™Â∑±‰∏öÂä°ÁöÑÊìç‰ΩúÊùÉÈôêËøõË°åÊ†°È™åÔºåÈùûÂ∏∏ÁÅµÊ¥ª„ÄÇËøôËæπÊ∂âÂèäÂà∞ÂÖ∑‰Ωì‰∏öÂä°ÔºåÁ¨îËÄÖÂú®È°πÁõÆ‰∏≠Âè™Êèê‰æõÊé•Âè£ÔºåÂÖ∑‰ΩìÁöÑÂÆûÁé∞ÈúÄË¶ÅËØªËÄÖËá™Ë°åÂÆåÊàê„ÄÇ 6. ÊÄªÁªìÊú¨ÊñáÁõ∏ÂØπÊù•ËØ¥ÊØîËæÉÁÆÄÂçïÔºå‰∏ªË¶ÅËÆ≤Ëß£‰∫Ütoken‰ª•ÂèäAPIÁ∫ßÂà´ÁöÑÈâ¥ÊùÉ„ÄÇtokenÁöÑÂêàÊ≥ïÊÄßËÆ§ËØÅÂæàÂ∏∏ËßÑÔºåAuthÁ≥ªÁªüÂØπ‰∫éAPIÁ∫ßÂà´ÁöÑÈâ¥ÊùÉÊòØÁªìÂêàËá™Ë∫´‰∏öÂä°ÈúÄË¶ÅÂíåÁé∞Áä∂ËøõË°åÁöÑËÆæËÆ°„ÄÇËøô‰∏§ÂùóÁöÑÊ†°È™åÈÉΩÂâçÁΩÆÂà∞AuthÁ≥ªÁªü‰∏≠Ôºå‰ºòÁº∫ÁÇπÂú®‰∏äÈù¢ÁöÑÂ∞èËäÇ‰πüÊúâËÆ≤Ëø∞„ÄÇÊúÄÂêéÔºåÊû∂ÊûÑËÆæËÆ°Ê†πÊçÆËá™Â∑±ÁöÑÈúÄÊ±ÇÂíåÁé∞Áä∂ÔºåÁ¨îËÄÖÁöÑËß£ÂÜ≥ÊÄùË∑Ø‰ªÖ‰æõÂèÇËÄÉ„ÄÇ Êú¨ÊñáÁöÑÊ∫êÁ†ÅÂú∞ÂùÄÔºöGitHubÔºöhttps://github.com/keets2012/Auth-serviceÁ†Å‰∫ëÔºö https://gitee.com/keets/Auth-Service ÂèÇËÄÉ ÂæÆÊúçÂä°APIÁ∫ßÊùÉÈôêÁöÑÊäÄÊúØÊû∂ÊûÑ spring-security-oauth Spring-Security Docs Áõ∏ÂÖ≥ÈòÖËØªËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞Ôºà‰∏ÄÔºâËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞Ôºà‰∫åÔºâ]]></content>
      <categories>
        <category>Security</category>
      </categories>
      <tags>
        <tag>Spring Security</tag>
        <tag>OAuth2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞Ôºà‰∫åÔºâ]]></title>
    <url>%2F2017%2F10%2F22%2Fsecurity2%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÔºö Êú¨ÊñáÁ≥ª„ÄäËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞„ÄãÁ≥ªÂàóÁöÑÁ¨¨‰∫åÁØáÔºåÊú¨ÊñáÈáçÁÇπËÆ≤Ëß£Áî®Êà∑Ë∫´‰ªΩÁöÑËÆ§ËØÅ‰∏étokenÂèëÊîæÁöÑÂÖ∑‰ΩìÂÆûÁé∞„ÄÇÊú¨ÊñáÁØáÂπÖËæÉÈïøÔºåÂØπÊ∂âÂèäÂà∞ÁöÑÂ§ßÈÉ®ÂàÜ‰ª£Á†ÅËøõË°å‰∫ÜÂàÜÊûêÔºåÂèØÊî∂Ëóè‰∫éÈó≤ÊöáÊó∂Èó¥ÈòÖËØªÔºåÊ¨¢ËøéËÆ¢ÈòÖÊú¨Á≥ªÂàóÊñáÁ´†„ÄÇ 1. Á≥ªÁªüÊ¶ÇËßàÂú®‰∏ä‰∏ÄÁØá ËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞Ôºà‰∏ÄÔºâ‰ªãÁªç‰∫ÜËØ•È°πÁõÆÁöÑËÉåÊôØ‰ª•ÂèäÊäÄÊúØË∞ÉÁ†î‰∏éÊúÄÂêéÈÄâÂûãÔºåÂπ∂‰∏îÂØπ‰∫éÊúÄÁªàÂÆûÁé∞ÁöÑendpointÊâßË°åÁªìÊûúËøõË°åÂ±ïÁ§∫„ÄÇÂØπÁ≥ªÁªüÊû∂ÊûÑËôΩÁÑ∂ÊúâÊèêÂà∞Ôºå‰ΩÜÊòØÂπ∂Êú™ÂàóÂá∫ËØ¶ÁªÜÊµÅÁ®ãÂõæ„ÄÇÂú®Á¨îËÄÖÁöÑÂ∫îÁî®Âú∫ÊôØ‰∏≠ÔºåAuthÁ≥ªÁªü‰∏éÁΩëÂÖ≥ËøõË°åÁªìÂêà„ÄÇÂú®ÁΩëÂÖ≥Âá∫ÈÖçÁΩÆÁõ∏Â∫îÁöÑÁ´ØÁÇπ‰ø°ÊÅØÔºåÂ¶ÇÁôªÂΩïÁ≥ªÁªüÁî≥ËØ∑tokenÊéàÊùÉÔºåÊ†°È™åcheck_tokenÁ≠âÁ´ØÁÇπ„ÄÇ ‰∏ãÂõæ‰∏∫ÁΩëÂÖ≥‰∏éAuthÁ≥ªÁªüÁªìÂêàÁöÑÊµÅÁ®ãÂõæÔºåÁΩëÂÖ≥Á≥ªÁªüÁöÑÂÖ∑‰ΩìÂÆûÁé∞ÁªÜËäÇÂú®ÂêéÈù¢Âè¶ÂÜôÊñáÁ´†‰ªãÁªç„ÄÇÔºàÊ≠§Â§ÑÊµÅÁ®ãÂõæÁöÑÁªòÂà∂‰∏≠ÔºåÁ¨îËÄÖ‰ΩøÁî®ÊûÅÁÆÄÁöÑËØ≠Ë®ÄÊèèËø∞ÔºåÂêÑ‰ΩçÂêåÂ≠¶ËΩªÂñ∑üòÜÔºÅÔºâ ‰∏äÂõæÂ±ïÁ§∫‰∫ÜÁ≥ªÁªüÁôªÂΩïÁöÑÁÆÄÂçïÊµÅÁ®ãÔºåÂÖ∂‰∏≠ÁöÑÁªÜËäÇÊúâÁúÅÁï•ÔºåÁî®Êà∑‰ø°ÊÅØÁöÑÂêàÊ≥ïÊÄßÊ†°È™åÂÆûÈôÖÊòØË∞ÉÁî®Áî®Êà∑Á≥ªÁªü„ÄÇÂ§ß‰ΩìÊµÅÁ®ãÊòØËøôÊ†∑ÔºåÂÆ¢Êà∑Á´ØËØ∑Ê±ÇÂà∞ËææÁΩëÂÖ≥‰πãÂêéÔºåÊ†πÊçÆÁΩëÂÖ≥ËØÜÂà´ÁöÑËØ∑Ê±ÇÁôªÂΩïÁ´ØÁÇπÔºåËΩ¨ÂèëÂà∞AuthÁ≥ªÁªüÔºåÂ∞ÜÁî®Êà∑ÁöÑ‰ø°ÊÅØËøõË°åÊ†°È™å„ÄÇ Âè¶‰∏ÄÊñπÈù¢ÊòØÂØπ‰∫é‰∏ÄËà¨ËØ∑Ê±ÇÁöÑÊ†°È™å„ÄÇ‰∏Ä‰∫õ‰∏çÈúÄË¶ÅÊùÉÈôêÁöÑÂÖ¨ÂºÄÊé•Âè£ÔºåÂú®ÁΩëÂÖ≥Â§ÑÈÖçÁΩÆÂ•ΩÔºåËØ∑Ê±ÇÂà∞ËææÁΩëÂÖ≥ÂêéÔºåÂåπÈÖç‰∫ÜË∑ØÂæÑÂ∞Ü‰ºöÁõ¥Êé•ÊîæË°å„ÄÇÂ¶ÇÊûúÈúÄË¶ÅÂØπËØ•ËØ∑Ê±ÇËøõË°åÊ†°È™åÔºå‰ºöÂ∞ÜËØ•ËØ∑Ê±ÇÁöÑÁõ∏ÂÖ≥È™åËØÅ‰ø°ÊÅØÊà™ÂèñÔºå‰ª•ÂèäAPIÊùÉÈôêÊ†°È™åÊâÄÈúÄÁöÑ‰∏ä‰∏ãÊñá‰ø°ÊÅØÔºàÁ¨îËÄÖÈ°πÁõÆÂØπ‰∫é‰∏Ä‰∫õÊìç‰ΩúËøõË°åÊùÉÈôêÂâçÁΩÆÈ™åËØÅÔºå‰∏ã‰∏ÄÁØáÁ´†‰ºöËÆ≤Âà∞ÔºâÔºåË∞ÉÁî®AuthÁ≥ªÁªüÔºåÊ†°È™åÊàêÂäüÂêéËøõË°åË∑ØÁî±ËΩ¨Âèë„ÄÇ ËøôÁØáÊñáÁ´†Â∞±ÈáçÁÇπËÆ≤Ëß£Êàë‰ª¨Âú®Á¨¨‰∏ÄÁØáÊñáÁ´†‰∏≠ÊèêÂà∞ÁöÑÁî®Êà∑Ë∫´‰ªΩÁöÑËÆ§ËØÅ‰∏étokenÂèëÊîæ„ÄÇËøô‰∏™‰πü‰∏ªË¶ÅÂåÖÂê´‰∏§‰∏™ÊñπÈù¢Ôºö Áî®Êà∑ÂêàÊ≥ïÊÄßÁöÑËÆ§ËØÅ Ëé∑ÂèñÂà∞ÊéàÊùÉÁöÑtoken 2. ÈÖçÁΩÆ‰∏éÁ±ªÂõæ2.1 AuthorizationServer‰∏ªË¶ÅÈÖçÁΩÆÂÖ≥‰∫éAuthorizationServerÂíåResourceServerÁöÑÈÖçÁΩÆÂú®‰∏ä‰∏ÄÁØáÊñáÁ´†Â∑≤ÁªèÂàóÂá∫„ÄÇAuthorizationServer‰∏ªË¶ÅÊòØÁªßÊâø‰∫ÜAuthorizationServerConfigurerAdapterÔºåË¶ÜÂÜô‰∫ÜÂÖ∂ÂÆûÁé∞Êé•Âè£ÁöÑ‰∏â‰∏™ÊñπÊ≥ïÔºö 1234567891011121314//ÂØπÂ∫î‰∫éÈÖçÁΩÆAuthorizationServerÂÆâÂÖ®ËÆ§ËØÅÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØÔºåÂàõÂª∫ClientCredentialsTokenEndpointFilterÊ†∏ÂøÉËøáÊª§Âô®@Overridepublic void configure(AuthorizationServerSecurityConfigurer security) throws Exception &#123; &#125;//ÈÖçÁΩÆOAuth2ÁöÑÂÆ¢Êà∑Á´ØÁõ∏ÂÖ≥‰ø°ÊÅØ@Overridepublic void configure(ClientDetailsServiceConfigurer clients) throws Exception &#123;&#125;//ÈÖçÁΩÆË∫´‰ªΩËÆ§ËØÅÂô®ÔºåÈÖçÁΩÆËÆ§ËØÅÊñπÂºèÔºåTokenStoreÔºåTokenGranterÔºåOAuth2RequestFactory@Overridepublic void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception &#123;&#125; 2.2 ‰∏ªË¶ÅAuthenticationÁ±ªÁöÑÁ±ªÂõæ ‰∏ªË¶ÅÁöÑÈ™åËØÅÊñπÊ≥ïauthenticate(Authentication authentication)Âú®Êé•Âè£AuthenticationManager‰∏≠ÔºåÂÖ∂ÂÆûÁé∞Á±ªÊúâProviderManagerÔºåÊúâ‰∏äÂõæÂèØ‰ª•ÁúãÂá∫ProviderManagerÂèà‰æùËµñ‰∫éAuthenticationProviderÊé•Âè£ÔºåÂÖ∂ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™List&lt;AuthenticationProvider&gt;ÂÖ®Â±ÄÂèòÈáè„ÄÇÁ¨îËÄÖËøôËæπÂÆûÁé∞‰∫ÜËØ•Êé•Âè£ÁöÑÂÆûÁé∞Á±ªCustomAuthenticationProvider„ÄÇËá™ÂÆö‰πâ‰∏Ä‰∏™providerÔºåÂπ∂Âú®GlobalAuthenticationConfigurerAdapter‰∏≠ÈÖçÁΩÆÂ•ΩÊîπËá™ÂÆö‰πâÁöÑÊ†°È™åproviderÔºåË¶ÜÂÜôconfigure()ÊñπÊ≥ï„ÄÇ 123456789101112@Configurationpublic class AuthenticationManagerConfig extends GlobalAuthenticationConfigurerAdapter &#123; @Autowired CustomAuthenticationProvider customAuthenticationProvider; @Override public void configure(AuthenticationManagerBuilder auth) throws Exception &#123; auth.authenticationProvider(customAuthenticationProvider);//‰ΩøÁî®Ëá™ÂÆö‰πâÁöÑAuthenticationProvider &#125;&#125; AuthenticationManagerBuilderÊòØÁî®Êù•ÂàõÂª∫AuthenticationManagerÔºåÂÖÅËÆ∏Ëá™ÂÆö‰πâÊèê‰æõÂ§öÁßçÊñπÂºèÁöÑAuthenticationProviderÔºåÊØîÂ¶ÇLDAP„ÄÅÂü∫‰∫éJDBCÁ≠âÁ≠â„ÄÇ 3. ËÆ§ËØÅ‰∏éÊéàÊùÉtoken‰∏ãÈù¢ËÆ≤Ëß£ËÆ§ËØÅ‰∏éÊéàÊùÉtoken‰∏ªË¶ÅÁöÑÁ±ª‰∏éÊé•Âè£„ÄÇ 3.1 ÂÜÖÁΩÆÁ´ØÁÇπTokenEndpointSpring-Security-Oauth2ÁöÑÊèê‰æõÁöÑjarÂåÖ‰∏≠ÂÜÖÁΩÆ‰∫Ü‰∏étokenÁõ∏ÂÖ≥ÁöÑÂü∫Á°ÄÁ´ØÁÇπ„ÄÇÊú¨ÊñáËÆ§ËØÅ‰∏éÊéàÊùÉtoken‰∏é/oauth/tokenÊúâÂÖ≥ÔºåÂÖ∂Â§ÑÁêÜÁöÑÊé•Âè£Á±ª‰∏∫TokenEndpoint„ÄÇ‰∏ãÈù¢Êàë‰ª¨Êù•Áúã‰∏Ä‰∏ãÂØπ‰∫éËÆ§ËØÅ‰∏éÊéàÊùÉtokenÊµÅÁ®ãÁöÑÂÖ∑‰ΩìÂ§ÑÁêÜËøáÁ®ã„ÄÇ 123456789101112131415161718192021222324252627282930313233343536373839404142434445@FrameworkEndpointpublic class TokenEndpoint extends AbstractEndpoint &#123; ... @RequestMapping(value = "/oauth/token", method=RequestMethod.POST) public ResponseEntity&lt;OAuth2AccessToken&gt; postAccessToken(Principal principal, @RequestParam Map&lt;String, String&gt; parameters) throws HttpRequestMethodNotSupportedException &#123; //È¶ñÂÖàÂØπclient‰ø°ÊÅØËøõË°åÊ†°È™å if (!(principal instanceof Authentication)) &#123; throw new InsufficientAuthenticationException( "There is no client authentication. Try adding an appropriate authentication filter."); &#125; String clientId = getClientId(principal); //Ê†πÊçÆËØ∑Ê±Ç‰∏≠ÁöÑclientIdÔºåÂä†ËΩΩclientÁöÑÂÖ∑‰Ωì‰ø°ÊÅØ ClientDetails authenticatedClient = getClientDetailsService().loadClientByClientId(clientId); TokenRequest tokenRequest = getOAuth2RequestFactory().createTokenRequest(parameters, authenticatedClient); ... //È™åËØÅscopeÂüüËåÉÂõ¥ if (authenticatedClient != null) &#123; oAuth2RequestValidator.validateScope(tokenRequest, authenticatedClient); &#125; //ÊéàÊùÉÊñπÂºè‰∏çËÉΩ‰∏∫Á©∫ if (!StringUtils.hasText(tokenRequest.getGrantType())) &#123; throw new InvalidRequestException("Missing grant type"); &#125; //token endpoint‰∏çÊîØÊåÅImplicitÊ®°Âºè if (tokenRequest.getGrantType().equals("implicit")) &#123; throw new InvalidGrantException("Implicit grant type not supported from token endpoint"); &#125; ... //ËøõÂÖ•CompositeTokenGranterÔºåÂåπÈÖçÊéàÊùÉÊ®°ÂºèÔºåÁÑ∂ÂêéËøõË°åpasswordÊ®°ÂºèÁöÑË∫´‰ªΩÈ™åËØÅÂíåtokenÁöÑÂèëÊîæ OAuth2AccessToken token = getTokenGranter().grant(tokenRequest.getGrantType(), tokenRequest); if (token == null) &#123; throw new UnsupportedGrantTypeException("Unsupported grant type: " + tokenRequest.getGrantType()); &#125; return getResponse(token); &#125; ...&#125; ‰∏äÈù¢Áªô‰ª£Á†ÅËøõË°å‰∫ÜÊ≥®ÈáäÔºåËØªËÄÖÊÑüÂÖ¥Ë∂£ÂèØ‰ª•ÁúãÁúã„ÄÇÊé•Âè£Â§ÑÁêÜÁöÑ‰∏ªË¶ÅÊµÅÁ®ãÂ∞±ÊòØÂØπauthentication‰ø°ÊÅØËøõË°åÊ£ÄÊü•ÊòØÂê¶ÂêàÊ≥ïÔºå‰∏çÂêàÊ≥ïÁõ¥Êé•ÊäõÂá∫ÂºÇÂ∏∏ÔºåÁÑ∂ÂêéÂØπËØ∑Ê±ÇÁöÑGrantTypeËøõË°åÂ§ÑÁêÜÔºåÊ†πÊçÆGrantTypeÔºåËøõË°åpasswordÊ®°ÂºèÁöÑË∫´‰ªΩÈ™åËØÅÂíåtokenÁöÑÂèëÊîæ„ÄÇ‰∏ãÈù¢Êàë‰ª¨Êù•Áúã‰∏ãTokenGranterÁöÑÁ±ªÂõæ„ÄÇ ÂèØ‰ª•ÁúãÂá∫TokenGranterÁöÑÂÆûÁé∞Á±ªCompositeTokenGranter‰∏≠Êúâ‰∏Ä‰∏™List&lt;TokenGranter&gt;ÔºåÂØπÂ∫î‰∫îÁßçGrantTypeÁöÑÂÆûÈôÖÊéàÊùÉÂÆûÁé∞„ÄÇËøôËæπÊ∂âÂèäÂà∞ÁöÑgetTokenGranter()Ôºå‰ª£Á†Å‰πüÂàó‰∏ãÔºö 123456789101112131415161718192021public class CompositeTokenGranter implements TokenGranter &#123; //GrantTypeÁöÑÈõÜÂêàÔºåÊúâ‰∫îÁßçÔºå‰πãÂâçÊúâËÆ≤ private final List&lt;TokenGranter&gt; tokenGranters; public CompositeTokenGranter(List&lt;TokenGranter&gt; tokenGranters) &#123; this.tokenGranters = new ArrayList&lt;TokenGranter&gt;(tokenGranters); &#125; //ÈÅçÂéÜlistÔºåÂåπÈÖçÂà∞Áõ∏Â∫îÁöÑgrantTypeÂ∞±ËøõË°åÂ§ÑÁêÜ public OAuth2AccessToken grant(String grantType, TokenRequest tokenRequest) &#123; for (TokenGranter granter : tokenGranters) &#123; OAuth2AccessToken grant = granter.grant(grantType, tokenRequest); if (grant!=null) &#123; return grant; &#125; &#125; return null; &#125; ...&#125; Êú¨Ê¨°ËØ∑Ê±ÇÊòØ‰ΩøÁî®ÁöÑpasswordÊ®°ÂºèÔºåÈöèÂêéËøõÂÖ•ÂÖ∂GrantTypeÂÖ∑‰ΩìÁöÑÂ§ÑÁêÜÊµÅÁ®ãÔºå‰∏ãÈù¢ÊòØgrant()ÊñπÊ≥ï„ÄÇ 1234567891011121314151617181920212223242526public OAuth2AccessToken grant(String grantType, TokenRequest tokenRequest) &#123; if (!this.grantType.equals(grantType)) &#123; return null; &#125; String clientId = tokenRequest.getClientId(); //Âä†ËΩΩclientIdÂØπÂ∫îÁöÑClientDetailsÔºå‰∏∫‰∫Ü‰∏ã‰∏ÄÊ≠•ÁöÑÈ™åËØÅ ClientDetails client = clientDetailsService.loadClientByClientId(clientId); //ÂÜçÊ¨°È™åËØÅclientIdÊòØÂê¶Êã•ÊúâËØ•grantTypeÊ®°ÂºèÔºåÂÆâÂÖ® validateGrantType(grantType, client); //Ëé∑Âèñtoken return getAccessToken(client, tokenRequest);&#125;protected OAuth2AccessToken getAccessToken(ClientDetails client, TokenRequest tokenRequest) &#123;//ËøõÂÖ•ÂàõÂª∫token‰πãÂâçÔºåËøõË°åË∫´‰ªΩÈ™åËØÅ return tokenServices.createAccessToken(getOAuth2Authentication(client, tokenRequest));&#125;protected OAuth2Authentication getOAuth2Authentication(ClientDetails client, TokenRequest tokenRequest) &#123;//Ë∫´‰ªΩÈ™åËØÅ OAuth2Request storedOAuth2Request = requestFactory.createOAuth2Request(client, tokenRequest); return new OAuth2Authentication(storedOAuth2Request, null);&#125; ‰∏äÈù¢‰∏ÄÊÆµ‰ª£Á†ÅÊòØgrant()ÊñπÊ≥ïÂÖ∑‰ΩìÁöÑÂÆûÁé∞ÁªÜËäÇ„ÄÇGrantTypeÂåπÈÖçÂà∞ÂÖ∂ÂØπÂ∫îÁöÑgrant()ÂêéÔºåÂÖàËøõË°åÂü∫Êú¨ÁöÑÈ™åËØÅÁ°Æ‰øùÂÆâÂÖ®ÔºåÁÑ∂ÂêéËøõÂÖ•‰∏ªÊµÅÁ®ãÔºåÂ∞±ÊòØ‰∏ãÈù¢Â∞èËäÇË¶ÅËÆ≤ÁöÑÈ™åËØÅË∫´‰ªΩÂíåÂèëÊîætoken„ÄÇ 3.2 Ëá™ÂÆö‰πâÁöÑÈ™åËØÅÁ±ªCustomAuthenticationProviderCustomAuthenticationProvider‰∏≠ÂÆö‰πâ‰∫ÜÈ™åËØÅÊñπÊ≥ïÁöÑÂÖ∑‰ΩìÂÆûÁé∞„ÄÇÂÖ∂ÂÖ∑‰ΩìÂÆûÁé∞Â¶Ç‰∏ãÊâÄÁ§∫„ÄÇ 1234567891011121314151617181920212223242526//‰∏ªË¶ÅÁöÑËá™ÂÆö‰πâÈ™åËØÅÊñπÊ≥ï@Override public Authentication authenticate(Authentication authentication) throws AuthenticationException &#123; String username = authentication.getName(); String password = (String) authentication.getCredentials(); Map data = (Map) authentication.getDetails(); String clientId = (String) data.get("client"); Assert.hasText(clientId,"clientId must have value" ); String type = (String) data.get("type"); //ÈÄöËøáË∞ÉÁî®userÊúçÂä°ÔºåÊ†°È™åÁî®Êà∑‰ø°ÊÅØ Map map = userClient.checkUsernameAndPassword(getUserServicePostObject(username, password, type)); //Ê†°È™åËøîÂõûÁöÑ‰ø°ÊÅØÔºå‰∏çÊ≠£Á°ÆÂàôÊäõÂá∫ÂºÇÂ∏∏ÔºåÊéàÊùÉÂ§±Ë¥• String userId = (String) map.get("userId"); if (StringUtils.isBlank(userId)) &#123; String errorCode = (String) map.get("code"); throw new BadCredentialsException(errorCode); &#125; CustomUserDetails customUserDetails = buildCustomUserDetails(username, password, userId, clientId); return new CustomAuthenticationToken(customUserDetails); &#125; //ÊûÑÈÄ†‰∏Ä‰∏™CustomUserDetailsÔºåÁÆÄÂçïÔºåÁï•Âéª private CustomUserDetails buildCustomUserDetails(String username, String password, String userId, String clientId) &#123; &#125;//ÊûÑÈÄ†‰∏Ä‰∏™ËØ∑Ê±ÇuserServiceÁöÑmapÔºåÂÜÖÂÆπÁï• private Map&lt;String, String&gt; getUserServicePostObject(String username, String password, String type) &#123; &#125; authenticate()ÊúÄÂêéËøîÂõûÊûÑÈÄ†ÁöÑËá™ÂÆö‰πâCustomAuthenticationTokenÔºåÂú®CustomAuthenticationToken‰∏≠ÔºåÂ∞Üboolean authenticatedËÆæ‰∏∫trueÔºåuser‰ø°ÊÅØÈ™åËØÅÊàêÂäü„ÄÇËøôËæπ‰º†ÂÖ•ÁöÑÂèÇÊï∞CustomUserDetails‰∏étokenÁîüÊàêÊúâÂÖ≥Ôºå‰Ωú‰∏∫payload‰∏≠ÁöÑ‰ø°ÊÅØÔºå‰∏ãÈù¢‰ºöËÆ≤Âà∞„ÄÇ 12345678910//ÁªßÊâøÊäΩË±°Á±ªAbstractAuthenticationTokenpublic class CustomAuthenticationToken extends AbstractAuthenticationToken &#123; private CustomUserDetails userDetails; public CustomAuthenticationToken(CustomUserDetails userDetails) &#123; super(null); this.userDetails = userDetails; super.setAuthenticated(true); &#125; ...&#125; ËÄåAbstractAuthenticationTokenÂÆûÁé∞‰∫ÜÊé•Âè£AuthenticationÂíåCredentialsContainerÔºåÈáåÈù¢ÁöÑÂÖ∑‰Ωì‰ø°ÊÅØËØªËÄÖÂèØ‰ª•Ëá™Â∑±Áúã‰∏ãÊ∫êÁ†Å„ÄÇ 3.3 ÂÖ≥‰∫éJWTÁî®Êà∑‰ø°ÊÅØÊ†°È™åÂÆåÊàê‰πãÂêéÔºå‰∏ã‰∏ÄÊ≠•ÂàôÊòØË¶ÅÂØπËØ•Áî®Êà∑ËøõË°åÊéàÊùÉ„ÄÇÂú®ËÆ≤ÂÖ∑‰ΩìÁöÑÊéàÊùÉ‰πãÂâçÔºåÂÖàË°•ÂÖÖ‰∏ãÂÖ≥‰∫éJWT TokenÁöÑÁõ∏ÂÖ≥Áü•ËØÜÁÇπ„ÄÇ Json web token (JWT), ÊòØ‰∏∫‰∫ÜÂú®ÁΩëÁªúÂ∫îÁî®ÁéØÂ¢ÉÈó¥‰º†ÈÄíÂ£∞ÊòéËÄåÊâßË°åÁöÑ‰∏ÄÁßçÂü∫‰∫éJSONÁöÑÂºÄÊîæÊ†áÂáÜ(RFC 7519)„ÄÇËØ•tokenË¢´ËÆæËÆ°‰∏∫Á¥ßÂáë‰∏îÂÆâÂÖ®ÁöÑÔºåÁâπÂà´ÈÄÇÁî®‰∫éÂàÜÂ∏ÉÂºèÁ´ôÁÇπÁöÑÂçïÁÇπÁôªÂΩïÔºàSSOÔºâÂú∫ÊôØ„ÄÇJWTÁöÑÂ£∞Êòé‰∏ÄËà¨Ë¢´Áî®Êù•Âú®Ë∫´‰ªΩÊèê‰æõËÄÖÂíåÊúçÂä°Êèê‰æõËÄÖÈó¥‰º†ÈÄíË¢´ËÆ§ËØÅÁöÑÁî®Êà∑Ë∫´‰ªΩ‰ø°ÊÅØÔºå‰ª•‰æø‰∫é‰ªéËµÑÊ∫êÊúçÂä°Âô®Ëé∑ÂèñËµÑÊ∫êÔºå‰πüÂèØ‰ª•Â¢ûÂä†‰∏Ä‰∫õÈ¢ùÂ§ñÁöÑÂÖ∂ÂÆÉ‰∏öÂä°ÈÄªËæëÊâÄÂøÖÈ°ªÁöÑÂ£∞Êòé‰ø°ÊÅØÔºåËØ•token‰πüÂèØÁõ¥Êé•Ë¢´Áî®‰∫éËÆ§ËØÅÔºå‰πüÂèØË¢´Âä†ÂØÜ„ÄÇ ‰ªé‰∏äÈù¢ÁöÑÊèèËø∞ÂèØÁü•JWTÁöÑÂÆö‰πâÔºåËøôËæπËØªËÄÖÂèØ‰ª•ÂØπÊØî‰∏ãtokenÁöÑËÆ§ËØÅÂíå‰º†ÁªüÁöÑsessionËÆ§ËØÅÁöÑÂå∫Âà´„ÄÇÊé®Ëçê‰∏ÄÁØáÊñáÁ´†‰ªÄ‰πàÊòØ JWT ‚Äì JSON WEB TOKENÔºåÁ¨îËÄÖËøôËæπÂ∞±‰∏çËØ¶ÁªÜÊâ©Â±ïËÆ≤‰∫ÜÔºåÂè™ÊòØÁÆÄÂçï‰ªãÁªç‰∏ãÂÖ∂ÊûÑÊàê„ÄÇ JWTÂåÖÂê´‰∏âÈÉ®ÂàÜÔºöheaderÂ§¥ÈÉ®„ÄÅpayload‰ø°ÊÅØ„ÄÅsignatureÁ≠æÂêç„ÄÇ‰∏ãÈù¢‰ª•‰∏ä‰∏ÄÁØáÁîüÊàêÂ•ΩÁöÑaccess_token‰∏∫‰æã‰ªãÁªç„ÄÇ headerjwtÁöÑÂ§¥ÈÉ®ÊâøËΩΩ‰∏§ÈÉ®ÂàÜ‰ø°ÊÅØÔºå‰∏ÄÊòØÂ£∞ÊòéÁ±ªÂûãÔºåËøôÈáåÊòØjwtÔºõ‰∫åÊòØÂ£∞ÊòéÂä†ÂØÜÁöÑÁÆóÊ≥ï ÈÄöÂ∏∏Áõ¥Êé•‰ΩøÁî® HMAC SHA256„ÄÇÁ¨¨‰∏ÄÈÉ®ÂàÜ‰∏ÄËà¨Âõ∫ÂÆö‰∏∫Ôºö 1eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9 playloadÂ≠òÊîæÁöÑÊúâÊïà‰ø°ÊÅØÔºåËøô‰∫õÊúâÊïà‰ø°ÊÅØÂåÖÂê´‰∏â‰∏™ÈÉ®ÂàÜ„ÄÅÊ†áÂáÜ‰∏≠Ê≥®ÂÜåÁöÑÂ£∞Êòé„ÄÅÂÖ¨ÂÖ±ÁöÑÂ£∞Êòé„ÄÅÁßÅÊúâÁöÑÂ£∞Êòé„ÄÇËøôËæπÁ¨îËÄÖÈ¢ùÂ§ñÊ∑ªÂä†ÁöÑ‰ø°ÊÅØ‰∏∫X-KEETS-UserIdÂíåX-KEETS-ClientId„ÄÇËØªËÄÖÂèØÊ†πÊçÆÂÆûÈôÖÈ°πÁõÆÈúÄË¶ÅËøõË°åÂÆöÂà∂„ÄÇÊúÄÂêéplayloadÁªèËøábase64ÁºñÁ†ÅÂêéÁöÑÁªìÊûú‰∏∫Ôºö 1eyJYLUtFRVRTLVVzZXJJZCI6ImQ2NDQ4YzI0LTNjNGMtNGI4MC04MzcyLWMyZDYxODY4ZjhjNiIsImV4cCI6MTUwODQ0Nzc1NiwidXNlcl9uYW1lIjoia2VldHMiLCJqdGkiOiJiYWQ3MmIxOS1kOWYzLTQ5MDItYWZmYS0wNDMwZTdkYjc5ZWQiLCJjbGllbnRfaWQiOiJmcm9udGVuZCIsInNjb3BlIjpbImFsbCJdfQ signaturejwtÁöÑÁ¨¨‰∏âÈÉ®ÂàÜÊòØ‰∏Ä‰∏™Á≠æËØÅ‰ø°ÊÅØÔºåËøô‰∏™Á≠æËØÅ‰ø°ÊÅØÁî±‰∏âÈÉ®ÂàÜÁªÑÊàêÔºöheader (base64ÂêéÁöÑ)„ÄÅpayload (base64ÂêéÁöÑ)„ÄÅsecret„ÄÇÂÖ≥‰∫ésecretÔºåÁªÜÂøÉÁöÑËØªËÄÖÂèØËÉΩ‰ºöÂèëÁé∞‰πãÂâçÁöÑÈÖçÁΩÆÈáåÈù¢ÊúâÂÖ∑‰ΩìËÆæÁΩÆ„ÄÇÂâç‰∏§ÈÉ®ÂàÜËøûÊé•ÁªÑÊàêÁöÑÂ≠óÁ¨¶‰∏≤ÔºåÈÄöËøáheader‰∏≠Â£∞ÊòéÁöÑÂä†ÂØÜÊñπÂºèËøõË°åÂä†ÁõêsecretÁªÑÂêàÂä†ÂØÜÔºåÁÑ∂ÂêéÂ∞±ÊûÑÊàê‰∫ÜjwtÁöÑÁ¨¨‰∏âÈÉ®ÂàÜ„ÄÇÁ¨¨‰∏âÈÉ®ÂàÜÁªìÊûú‰∏∫Ôºö 15ZNVN8TLavgpWy8KZQKArcbj7ItJLLaY1zBRaAgMjdo Ëá≥‰∫éÂÖ∑‰ΩìÂ∫îÁî®ÊñπÊ≥ïÔºåÂèØ‰ª•ÂèÇËßÅÁ¨¨‰∏ÄÁØáÊñáÁ´†‰∏≠ÊûÑÂª∫ÁöÑ/logoutÁ´ØÁÇπ„ÄÇ 3.3 Ëá™ÂÆö‰πâÁöÑAuthorizationTokenServicesÁé∞Âú®Âà∞‰∫Ü‰∏∫Áî®Êà∑ÂàõÂª∫tokenÔºåËøôËæπ‰∏ªË¶Å‰∏éËá™ÂÆö‰πâÁöÑÊé•Âè£AuthorizationServerTokenServicesÊúâÂÖ≥„ÄÇAuthorizationServerTokenServices‰∏ªË¶ÅÊúâÂ¶Ç‰∏ã‰∏â‰∏™ÊñπÊ≥ïÔºö 1234567//ÂàõÂª∫tokenOAuth2AccessToken createAccessToken(OAuth2Authentication authentication) throws AuthenticationException;//Âà∑Êñ∞tokenOAuth2AccessToken refreshAccessToken(String refreshToken, TokenRequest tokenRequest) throws AuthenticationException;//Ëé∑ÂèñtokenOAuth2AccessToken getAccessToken(OAuth2Authentication authentication); Áî±‰∫éÁØáÂπÖÈôêÂà∂ÔºåÁ¨îËÄÖËøôËæπ‰ªÖÂØπcreateAccessToken()ÁöÑÂÆûÁé∞ÊñπÊ≥ïËøõË°åÂàÜÊûêÔºåÂÖ∂‰ªñÁöÑÊñπÊ≥ïÂÆûÁé∞ÔºåËØªËÄÖÂèØ‰ª•‰∏ãÂÖ≥Ê≥®Á¨îËÄÖÁöÑGitHubÈ°πÁõÆ„ÄÇ 1234567891011121314151617181920212223242526272829303132public class CustomAuthorizationTokenServices implements AuthorizationServerTokenServices, ConsumerTokenServices &#123; ... public OAuth2AccessToken createAccessToken(OAuth2Authentication authentication) throws AuthenticationException &#123; //ÈÄöËøáTokenStoreÔºåËé∑ÂèñÁé∞Â≠òÁöÑAccessToken OAuth2AccessToken existingAccessToken = tokenStore.getAccessToken(authentication); OAuth2RefreshToken refreshToken; //ÁßªÈô§Â∑≤ÊúâÁöÑAccessTokenÂíårefreshToken if (existingAccessToken != null) &#123; if (existingAccessToken.getRefreshToken() != null) &#123; refreshToken = existingAccessToken.getRefreshToken(); // The token store could remove the refresh token when the // access token is removed, but we want to be sure tokenStore.removeRefreshToken(refreshToken); &#125; tokenStore.removeAccessToken(existingAccessToken); &#125; //recreate a refreshToken refreshToken = createRefreshToken(authentication); OAuth2AccessToken accessToken = createAccessToken(authentication, refreshToken); if (accessToken != null) &#123; tokenStore.storeAccessToken(accessToken, authentication); &#125; refreshToken = accessToken.getRefreshToken(); if (refreshToken != null) &#123; tokenStore.storeRefreshToken(refreshToken, authentication); &#125; return accessToken; &#125; ...&#125; ËøôËæπÂÖ∑‰ΩìÁöÑÂÆûÁé∞Âú®‰∏äÈù¢ÊúâÊ≥®ÈáäÔºåÂü∫Êú¨Ê≤°ÊúâÊîπÂÜôÂ§öÂ∞ëÔºåËØªËÄÖÊ≠§Â§ÑÂèØ‰ª•ÂèÇÈòÖÊ∫êÁ†Å„ÄÇcreateAccessToken()ËøòË∞ÉÁî®‰∫Ü‰∏§‰∏™ÁßÅÊúâÊñπÊ≥ïÔºåÂàÜÂà´ÂàõÂª∫accessTokenÂíårefreshToken„ÄÇÂàõÂª∫accessTokenÔºåÈúÄË¶ÅÂü∫‰∫érefreshToken„ÄÇÊ≠§Â§ÑÂèØ‰ª•Ëá™ÂÆö‰πâËÆæÁΩÆtokenÁöÑÊó∂ÊïàÈïøÂ∫¶ÔºåaccessTokenÂàõÂª∫ÂÆûÁé∞Â¶Ç‰∏ãÔºö 1234567891011121314151617private int refreshTokenValiditySeconds = 60 * 60 * 24 * 30; // default 30 days. private int accessTokenValiditySeconds = 60 * 60 * 12; // default 12 hours. private OAuth2AccessToken createAccessToken(OAuth2Authentication authentication, OAuth2RefreshToken refreshToken) &#123; //ÂØπÂ∫îtokenIdÔºåÂ≠òÂÇ®ÁöÑÊ†áËØÜ DefaultOAuth2AccessToken token = new DefaultOAuth2AccessToken(UUID.randomUUID().toString()); int validitySeconds = getAccessTokenValiditySeconds(authentication.getOAuth2Request()); if (validitySeconds &gt; 0) &#123; token.setExpiration(new Date(System.currentTimeMillis() + (validitySeconds * 1000L))); &#125; token.setRefreshToken(refreshToken); //scopeÂØπÂ∫î‰ΩúÁî®ËåÉÂõ¥ token.setScope(authentication.getOAuth2Request().getScope());//‰∏ä‰∏ÄËäÇ‰ªãÁªçÁöÑËá™ÂÆö‰πâTokenEnhancerÔºåËøôËæπ‰ΩøÁî® return accessTokenEnhancer != null ? accessTokenEnhancer.enhance(token, authentication) : token; &#125; Êó¢ÁÑ∂ÊèêÂà∞TokenEnhancerÔºåËøôËæπÁÆÄÂçïË¥¥‰∏Ä‰∏ã‰ª£Á†Å„ÄÇ 12345678910111213141516171819202122232425public class CustomTokenEnhancer extends JwtAccessTokenConverter &#123; private static final String TOKEN_SEG_USER_ID = "X-KEETS-UserId"; private static final String TOKEN_SEG_CLIENT = "X-KEETS-ClientId"; @Override public OAuth2AccessToken enhance(OAuth2AccessToken accessToken, OAuth2Authentication authentication) &#123; CustomUserDetails userDetails = (CustomUserDetails) authentication.getPrincipal(); Map&lt;String, Object&gt; info = new HashMap&lt;&gt;(); //‰ªéËá™ÂÆö‰πâÁöÑuserDetails‰∏≠ÂèñÂá∫UserId info.put(TOKEN_SEG_USER_ID, userDetails.getUserId()); DefaultOAuth2AccessToken customAccessToken = new DefaultOAuth2AccessToken(accessToken); customAccessToken.setAdditionalInformation(info); OAuth2AccessToken enhancedToken = super.enhance(customAccessToken, authentication); //ËÆæÁΩÆClientId enhancedToken.getAdditionalInformation().put(TOKEN_SEG_CLIENT, userDetails.getClientId()); return enhancedToken; &#125;&#125; Ëá™Ê≠§ÔºåÁî®Êà∑Ë∫´‰ªΩÊ†°È™å‰∏éÂèëÊîæÊéàÊùÉtokenÁªìÊùü„ÄÇÊúÄÁªàÊàêÂäüËøîÂõûÁöÑÁªìÊûú‰∏∫: 12345678910&#123; &quot;access_token&quot;: &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJYLUtFRVRTLVVzZXJJZCI6ImQ2NDQ4YzI0LTNjNGMtNGI4MC04MzcyLWMyZDYxODY4ZjhjNiIsImV4cCI6MTUwODQ0Nzc1NiwidXNlcl9uYW1lIjoia2VldHMiLCJqdGkiOiJiYWQ3MmIxOS1kOWYzLTQ5MDItYWZmYS0wNDMwZTdkYjc5ZWQiLCJjbGllbnRfaWQiOiJmcm9udGVuZCIsInNjb3BlIjpbImFsbCJdfQ.5ZNVN8TLavgpWy8KZQKArcbj7ItJLLaY1zBRaAgMjdo&quot;, &quot;token_type&quot;: &quot;bearer&quot;, &quot;refresh_token&quot;: &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJYLUtFRVRTLVVzZXJJZCI6ImQ2NDQ4YzI0LTNjNGMtNGI4MC04MzcyLWMyZDYxODY4ZjhjNiIsInVzZXJfbmFtZSI6ImtlZXRzIiwic2NvcGUiOlsiYWxsIl0sImF0aSI6ImJhZDcyYjE5LWQ5ZjMtNDkwMi1hZmZhLTA0MzBlN2RiNzllZCIsImV4cCI6MTUxMDk5NjU1NiwianRpIjoiYWE0MWY1MjctODE3YS00N2UyLWFhOTgtZjNlMDZmNmY0NTZlIiwiY2xpZW50X2lkIjoiZnJvbnRlbmQifQ.mICT1-lxOAqOU9M-Ud7wZBb4tTux6OQWouQJ2nn1DeE&quot;, &quot;expires_in&quot;: 43195, &quot;scope&quot;: &quot;all&quot;, &quot;X-KEETS-UserId&quot;: &quot;d6448c24-3c4c-4b80-8372-c2d61868f8c6&quot;, &quot;jti&quot;: &quot;bad72b19-d9f3-4902-affa-0430e7db79ed&quot;, &quot;X-KEETS-ClientId&quot;: &quot;frontend&quot;&#125; 4. ÊÄªÁªìÊú¨ÊñáÂºÄÂ§¥ÁªôÂá∫‰∫ÜAuthÁ≥ªÁªüÊ¶ÇËø∞ÔºåÁîªÂá∫‰∫ÜÁÆÄË¶ÅÁöÑÁôªÂΩïÂíåÊ†°È™åÁöÑÊµÅÁ®ãÂõæÔºåÊñπ‰æøËØªËÄÖËÉΩÂØπÁ≥ªÁªüÁöÑÂÆûÁé∞Êúâ‰∏™Â§ßÊ¶ÇÁöÑ‰∫ÜËß£„ÄÇÁÑ∂Âêé‰∏ªË¶ÅËÆ≤Ëß£‰∫ÜÁî®Êà∑Ë∫´‰ªΩÁöÑËÆ§ËØÅ‰∏étokenÂèëÊîæÁöÑÂÖ∑‰ΩìÂÆûÁé∞„ÄÇÂØπ‰∫éÂÖ∂‰∏≠‰∏ªË¶ÅÁöÑÁ±ªÂíåÊé•Âè£ËøõË°å‰∫ÜÂàÜÊûê‰∏éËÆ≤Ëß£„ÄÇ‰∏ã‰∏ÄÁØáÊñáÁ´†‰∏ªË¶ÅËÆ≤Ëß£tokenÁöÑÈâ¥ÂÆöÂíåAPIÁ∫ßÂà´ÁöÑ‰∏ä‰∏ãÊñáÊùÉÈôêÊ†°È™å„ÄÇ Êú¨ÊñáÁöÑÊ∫êÁ†ÅÂú∞ÂùÄÔºöGitHubÔºöhttps://github.com/keets2012/Auth-serviceÁ†Å‰∫ëÔºö https://gitee.com/keets/Auth-Service ÂèÇËÄÉ ‰ªÄ‰πàÊòØ JWT ‚Äì JSON WEB TOKEN ReÔºö‰ªéÈõ∂ÂºÄÂßãÁöÑSpring Security OAuth2Ôºà‰∫åÔºâ spring-security-oauth Áõ∏ÂÖ≥ÈòÖËØªËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞Ôºà‰∏ÄÔºâ]]></content>
      <categories>
        <category>Security</category>
      </categories>
      <tags>
        <tag>Spring Security</tag>
        <tag>OAuth2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞Ôºà‰∏ÄÔºâ]]></title>
    <url>%2F2017%2F10%2F19%2Fsecurity1%2F</url>
    <content type="text"><![CDATA[ÂºïË®ÄÔºö Êú¨ÊñáÁ≥ª„ÄäËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞„ÄãÁ≥ªÂàóÁöÑÁ¨¨‰∏ÄÁØáÔºåÊú¨Á≥ªÂàóÈ¢ÑËÆ°ÂõõÁØáÊñáÁ´†ËÆ≤Ëß£ÂæÆÊúçÂä°‰∏ãÁöÑËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂ÁöÑÂÆûÁé∞„ÄÇ 1. ËÉåÊôØÊúÄËøëÂú®ÂÅöÊùÉÈôêÁõ∏ÂÖ≥ÊúçÂä°ÁöÑÂºÄÂèëÔºåÂú®Á≥ªÁªüÂæÆÊúçÂä°ÂåñÂêéÔºåÂéüÊúâÁöÑÂçï‰ΩìÂ∫îÁî®ÊòØÂü∫‰∫ésessionÁöÑÂÆâÂÖ®ÊùÉÈôêÊñπÂºèÔºå‰∏çËÉΩÊª°Ë∂≥Áé∞ÊúâÁöÑÂæÆÊúçÂä°Êû∂ÊûÑÁöÑËÆ§ËØÅ‰∏éÈâ¥ÊùÉÈúÄÊ±Ç„ÄÇÂæÆÊúçÂä°Êû∂ÊûÑ‰∏ãÔºå‰∏Ä‰∏™Â∫îÁî®‰ºöË¢´ÊãÜÂàÜÊàêËã•Âπ≤‰∏™ÂæÆÂ∫îÁî®ÔºåÊØè‰∏™ÂæÆÂ∫îÁî®ÈÉΩÈúÄË¶ÅÂØπËÆøÈóÆËøõË°åÈâ¥ÊùÉÔºåÊØè‰∏™ÂæÆÂ∫îÁî®ÈÉΩÈúÄË¶ÅÊòéÁ°ÆÂΩìÂâçËÆøÈóÆÁî®Êà∑‰ª•ÂèäÂÖ∂ÊùÉÈôê„ÄÇÂ∞§ÂÖ∂ÂΩìËÆøÈóÆÊù•Ê∫ê‰∏çÂè™ÊòØÊµèËßàÂô®ÔºåËøòÂåÖÊã¨ÂÖ∂‰ªñÊúçÂä°ÁöÑË∞ÉÁî®Êó∂ÔºåÂçï‰ΩìÂ∫îÁî®Êû∂ÊûÑ‰∏ãÁöÑÈâ¥ÊùÉÊñπÂºèÂ∞±‰∏çÊòØÁâπÂà´ÂêàÈÄÇ‰∫Ü„ÄÇÂú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏ãÔºåË¶ÅËÄÉËôëÂ§ñÈÉ®Â∫îÁî®Êé•ÂÖ•ÁöÑÂú∫ÊôØ„ÄÅÁî®Êà∑‚ÄìÊúçÂä°ÁöÑÈâ¥ÊùÉ„ÄÅÊúçÂä°‚ÄìÊúçÂä°ÁöÑÈâ¥ÊùÉÁ≠âÂ§öÁßçÈâ¥ÊùÉÂú∫ÊôØ„ÄÇÊØîÂ¶ÇÁî®Êà∑AËÆøÈóÆUser ServiceÔºåAÂ¶ÇÊûúÊú™ÁôªÂΩïÔºåÂàôÈ¶ñÂÖàÈúÄË¶ÅÁôªÂΩïÔºåËØ∑Ê±ÇËé∑ÂèñÊéàÊùÉtoken„ÄÇËé∑Âèñtoken‰πãÂêéÔºåAÂ∞ÜÊê∫Â∏¶ÁùÄtokenÂéªËØ∑Ê±ÇËÆøÈóÆÊüê‰∏™Êñá‰ª∂ÔºåËøôÊ†∑Â∞±ÈúÄË¶ÅÂØπAÁöÑË∫´‰ªΩËøõË°åÊ†°È™åÔºåÂπ∂‰∏îAÂèØ‰ª•ËÆøÈóÆËØ•Êñá‰ª∂„ÄÇ‰∏∫‰∫ÜÈÄÇÂ∫îÊû∂ÊûÑÁöÑÂèòÂåñ„ÄÅÈúÄÊ±ÇÁöÑÂèòÂåñÔºåauthÊùÉÈôêÊ®°ÂùóË¢´ÂçïÁã¨Âá∫Êù•‰Ωú‰∏∫‰∏Ä‰∏™Âü∫Á°ÄÁöÑÂæÆÊúçÂä°Á≥ªÁªüÔºå‰∏∫ÂÖ∂‰ªñ‰∏öÂä°serviceÊèê‰æõÊúçÂä°„ÄÇ 2. Á≥ªÁªüÊû∂ÊûÑÁöÑÂèòÊõ¥Âçï‰ΩìÂ∫îÁî®Êû∂ÊûÑÂà∞ÂàÜÂ∏ÉÂºèÊû∂ÊûÑÔºåÁÆÄÂåñÁöÑÊùÉÈôêÈÉ®ÂàÜÂèòÂåñÂ¶Ç‰∏ãÈù¢‰∏§ÂõæÊâÄÁ§∫„ÄÇÔºà1ÔºâÂçï‰ΩìÂ∫îÁî®ÁÆÄÂåñÁâàÊû∂ÊûÑÂõæÔºöÔºà2ÔºâÂàÜÂ∏ÉÂºèÂ∫îÁî®ÁÆÄÂåñÁâàÊû∂ÊûÑÂõæÔºö ÂàÜÂ∏ÉÂºèÊû∂ÊûÑÔºåÁâπÂà´ÊòØÂæÆÊúçÂä°Êû∂ÊûÑÁöÑ‰ºòÁÇπÊòØÂèØ‰ª•Ê∏ÖÊô∞ÁöÑÂàíÂàÜÂá∫‰∏öÂä°ÈÄªËæëÊù•ÔºåËÆ©ÊØè‰∏™ÂæÆÊúçÂä°ÊâøÊãÖËÅåË¥£Âçï‰∏ÄÁöÑÂäüËÉΩÔºåÊØïÁ´üË∂äÁÆÄÂçïÁöÑ‰∏úË•øË∂äÁ®≥ÂÆö„ÄÇ ‰ΩÜÊòØÔºåÂæÆÊúçÂä°‰πüÂ∏¶Êù•‰∫ÜÂæàÂ§öÁöÑÈóÆÈ¢ò„ÄÇÊØîÂ¶ÇÂÆåÊàê‰∏Ä‰∏™‰∏öÂä°Êìç‰ΩúÔºåÈúÄË¶ÅË∑®ÂæàÂ§ö‰∏™ÂæÆÊúçÂä°ÁöÑË∞ÉÁî®ÔºåÈÇ£‰πàÂ¶Ç‰ΩïÁî®ÊùÉÈôêÁ≥ªÁªüÂéªÊéßÂà∂Áî®Êà∑ÂØπ‰∏çÂêåÂæÆÊúçÂä°ÁöÑË∞ÉÁî®ÔºåÂØπÊàë‰ª¨Êù•ËØ¥ÊòØ‰∏™ÊåëÊàò„ÄÇÂΩì‰∏öÂä°ÂæÆÊúçÂä°ÁöÑË∞ÉÁî®Êé•ÂÖ•ÊùÉÈôêÁ≥ªÁªüÂêéÔºå‰∏çËÉΩÊãñÁ¥ØÂÆÉ‰ª¨ÁöÑÂêûÂêêÈáèÔºåÂΩìÊùÉÈôêÁ≥ªÁªüÂá∫Áé∞ÈóÆÈ¢òÂêéÔºå‰∏çËÉΩÈòªÂ°ûÂÆÉ‰ª¨ÁöÑ‰∏öÂä°Ë∞ÉÁî®ËøõÂ∫¶ÔºåÂΩìÁÑ∂Êõ¥‰∏çËÉΩÊîπÂèò‰∏öÂä°ÈÄªËæë„ÄÇÊñ∞ÁöÑ‰∏öÂä°ÂæÆÊúçÂä°Âø´ÈÄüÊé•ÂÖ•ÊùÉÈôêÁ≥ªÁªüÁõ∏ÂØπÂÆπÊòìÊääÊéßÔºåÈÇ£‰πàÂØπ‰∫éÂÖ¨Âè∏Â∑≤ÊúâÁöÑÂæÆÊúçÂä°ÔºåÂ¶Ç‰ΩïËÉΩ‰∏çÊîπÂä®ÂÆÉ‰ª¨ÁöÑÊû∂ÊûÑÊñπÂºèÁöÑÂâçÊèê‰∏ãÔºåÂø´ÈÄüÊé•ÂÖ•ÔºåÂØπÊàë‰ª¨Êù•ËØ¥Ôºå‰πüÊòØ‰∏ÄÂ§ßÊåëÊàò„ÄÇ 3. ÊäÄÊúØÊñπÊ°àËøô‰∏ªË¶ÅÂåÖÊã¨‰∏§ÊñπÈù¢ÈúÄÊ±ÇÔºöÂÖ∂‰∏ÄÊòØËÆ§ËØÅ‰∏éÈâ¥ÊùÉÔºåÂØπ‰∫éËØ∑Ê±ÇÁöÑÁî®Êà∑Ë∫´‰ªΩÁöÑÊéàÊùÉ‰ª•ÂèäÂêàÊ≥ïÊÄßÈâ¥ÊùÉÔºõÂÖ∂‰∫åÊòØAPIÁ∫ßÂà´ÁöÑÊìç‰ΩúÊùÉÈôêÊéßÂà∂ÔºåËøô‰∏™Âú®Á¨¨‰∏ÄÁÇπ‰πãÂêéÔºåÂΩìÈâ¥ÂÆöÂÆåÁî®Êà∑Ë∫´‰ªΩÂêàÊ≥ï‰πãÂêéÔºåÂØπ‰∫éËØ•Áî®Êà∑ÁöÑÊüê‰∏™ÂÖ∑‰ΩìËØ∑Ê±ÇÊòØÂê¶ÂÖ∑ÊúâËØ•Êìç‰ΩúÊâßË°åÊùÉÈôêËøõË°åÊ†°È™å„ÄÇ 3.1 ËÆ§ËØÅ‰∏éÈâ¥ÊùÉÂØπ‰∫éÁ¨¨‰∏Ä‰∏™ÈúÄÊ±ÇÔºåÁ¨îËÄÖË∞ÉÊü•‰∫Ü‰∏Ä‰∫õÂÆûÁé∞ÊñπÊ°àÔºö ÂàÜÂ∏ÉÂºèSessionÊñπÊ°àÂàÜÂ∏ÉÂºè‰ºöËØùÊñπÊ°àÂéüÁêÜ‰∏ªË¶ÅÊòØÂ∞ÜÂÖ≥‰∫éÁî®Êà∑ËÆ§ËØÅÁöÑ‰ø°ÊÅØÂ≠òÂÇ®Âú®ÂÖ±‰∫´Â≠òÂÇ®‰∏≠Ôºå‰∏îÈÄöÂ∏∏Áî±Áî®Êà∑‰ºöËØù‰Ωú‰∏∫ key Êù•ÂÆûÁé∞ÁöÑÁÆÄÂçïÂàÜÂ∏ÉÂºèÂìàÂ∏åÊò†Â∞Ñ„ÄÇÂΩìÁî®Êà∑ËÆøÈóÆÂæÆÊúçÂä°Êó∂ÔºåÁî®Êà∑Êï∞ÊçÆÂèØ‰ª•‰ªéÂÖ±‰∫´Â≠òÂÇ®‰∏≠Ëé∑Âèñ„ÄÇÂú®Êüê‰∫õÂú∫ÊôØ‰∏ãÔºåËøôÁßçÊñπÊ°àÂæà‰∏çÈîôÔºåÁî®Êà∑ÁôªÂΩïÁä∂ÊÄÅÊòØ‰∏çÈÄèÊòéÁöÑ„ÄÇÂêåÊó∂‰πüÊòØ‰∏Ä‰∏™È´òÂèØÁî®‰∏îÂèØÊâ©Â±ïÁöÑËß£ÂÜ≥ÊñπÊ°à„ÄÇËøôÁßçÊñπÊ°àÁöÑÁº∫ÁÇπÂú®‰∫éÂÖ±‰∫´Â≠òÂÇ®ÈúÄË¶Å‰∏ÄÂÆö‰øùÊä§Êú∫Âà∂ÔºåÂõ†Ê≠§ÈúÄË¶ÅÈÄöËøáÂÆâÂÖ®ÈìæÊé•Êù•ËÆøÈóÆÔºåËøôÊó∂Ëß£ÂÜ≥ÊñπÊ°àÁöÑÂÆûÁé∞Â∞±ÈÄöÂ∏∏ÂÖ∑ÊúâÁõ∏ÂΩìÈ´òÁöÑÂ§çÊùÇÊÄß‰∫Ü„ÄÇ Âü∫‰∫éOAuth2 TokenÊñπÊ°àÈöèÁùÄ Restful API„ÄÅÂæÆÊúçÂä°ÁöÑÂÖ¥Ëµ∑ÔºåÂü∫‰∫éTokenÁöÑËÆ§ËØÅÁé∞Âú®Â∑≤ÁªèË∂äÊù•Ë∂äÊôÆÈÅç„ÄÇTokenÂíåSession ID ‰∏çÂêåÔºåÂπ∂ÈùûÂè™ÊòØ‰∏Ä‰∏™ key„ÄÇToken ‰∏ÄËà¨‰ºöÂåÖÂê´Áî®Êà∑ÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØÔºåÈÄöËøáÈ™åËØÅ Token Â∞±ÂèØ‰ª•ÂÆåÊàêË∫´‰ªΩÊ†°È™å„ÄÇÁî®Êà∑ËæìÂÖ•ÁôªÂΩï‰ø°ÊÅØÔºåÂèëÈÄÅÂà∞Ë∫´‰ªΩËÆ§ËØÅÊúçÂä°ËøõË°åËÆ§ËØÅ„ÄÇAuthorizationServerÈ™åËØÅÁôªÂΩï‰ø°ÊÅØÊòØÂê¶Ê≠£Á°ÆÔºåËøîÂõûÁî®Êà∑Âü∫Á°Ä‰ø°ÊÅØ„ÄÅÊùÉÈôêËåÉÂõ¥„ÄÅÊúâÊïàÊó∂Èó¥Á≠â‰ø°ÊÅØÔºåÂÆ¢Êà∑Á´ØÂ≠òÂÇ®Êé•Âè£„ÄÇÁî®Êà∑Â∞Ü Token ÊîæÂú® HTTP ËØ∑Ê±ÇÂ§¥‰∏≠ÔºåÂèëËµ∑Áõ∏ÂÖ≥ API Ë∞ÉÁî®„ÄÇË¢´Ë∞ÉÁî®ÁöÑÂæÆÊúçÂä°ÔºåÈ™åËØÅToken„ÄÇResourceServerËøîÂõûÁõ∏ÂÖ≥ËµÑÊ∫êÂíåÊï∞ÊçÆ„ÄÇ ËøôËæπÈÄâÁî®‰∫ÜÁ¨¨‰∫åÁßçÊñπÊ°àÔºåÂü∫‰∫éOAuth2 TokenËÆ§ËØÅÁöÑÂ•ΩÂ§ÑÂ¶Ç‰∏ãÔºö ÊúçÂä°Á´ØÊó†Áä∂ÊÄÅÔºöToken Êú∫Âà∂Âú®ÊúçÂä°Á´Ø‰∏çÈúÄË¶ÅÂ≠òÂÇ® session ‰ø°ÊÅØÔºåÂõ†‰∏∫ Token Ëá™Ë∫´ÂåÖÂê´‰∫ÜÊâÄÊúâÁî®Êà∑ÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØ„ÄÇ ÊÄßËÉΩËæÉÂ•ΩÔºåÂõ†‰∏∫Âú®È™åËØÅ Token Êó∂‰∏çÁî®ÂÜçÂéªËÆøÈóÆÊï∞ÊçÆÂ∫ìÊàñËÄÖËøúÁ®ãÊúçÂä°ËøõË°åÊùÉÈôêÊ†°È™åÔºåËá™ÁÑ∂ÂèØ‰ª•ÊèêÂçá‰∏çÂ∞ëÊÄßËÉΩ„ÄÇ Áé∞Âú®ÂæàÂ§öÂ∫îÁî®ÈÉΩÊòØÂêåÊó∂Èù¢ÂêëÁßªÂä®Á´ØÂíåwebÁ´ØÔºåOAuth2 TokenÊú∫Âà∂ÂèØ‰ª•ÊîØÊåÅÁßªÂä®ËÆæÂ§á„ÄÇ OAuth2‰∏éSpring SecurityÁªìÂêà‰ΩøÁî®ÔºåÊúâÊèê‰æõÂæàÂ§öÂºÄÁÆ±Âç≥Áî®ÁöÑÂäüËÉΩÔºåÂ§ßÂ§öÁâπÊÄßÈÉΩÂèØ‰ª•ÈÄöËøáÈÖçÁΩÆÁÅµÊ¥ªÁöÑÂèòÊõ¥„ÄÇ ÊúÄÂêé‰∏ÄÁÇπÔºå‰πüÂæàÈáçË¶ÅÔºåSpring Security OAuth2ÁöÑÊñáÊ°£ÂÜôÂæóËæÉ‰∏∫ËØ¶ÁªÜ„ÄÇ oauth2Ê†πÊçÆ‰ΩøÁî®Âú∫ÊôØ‰∏çÂêåÔºåÂàÜÊàê‰∫Ü4ÁßçÊ®°ÂºèÔºö ÊéàÊùÉÁ†ÅÊ®°ÂºèÔºàauthorization codeÔºâ ÁÆÄÂåñÊ®°ÂºèÔºàimplicitÔºâ ÂØÜÁ†ÅÊ®°ÂºèÔºàresource owner password credentialsÔºâ ÂÆ¢Êà∑Á´ØÊ®°ÂºèÔºàclient credentialsÔºâ ÂØπ‰∫é‰∏äËø∞oauth2ÂõõÁßçÊ®°Âºè‰∏çÁÜüÁöÑÂêåÂ≠¶ÔºåÂèØ‰ª•Ëá™Ë°åÁôæÂ∫¶oauth2ÔºåÈòÆ‰∏ÄÂ≥∞ÁöÑÊñáÁ´†ÊúâËß£Èáä„ÄÇÂ∏∏‰ΩøÁî®ÁöÑÊòØpasswordÊ®°ÂºèÂíåclientÊ®°Âºè„ÄÇ 3.2 Êìç‰ΩúÊùÉÈôêÊéßÂà∂ÂØπ‰∫éÁ¨¨‰∫å‰∏™ÈúÄÊ±ÇÔºåÁ¨îËÄÖ‰∏ªË¶ÅÁúã‰∫ÜSpring SecurityÂíåShiro„ÄÇ ShiroShiroÊòØ‰∏Ä‰∏™Âº∫Â§ßËÄåÁÅµÊ¥ªÁöÑÂºÄÊ∫êÂÆâÂÖ®Ê°ÜÊû∂ÔºåËÉΩÂ§üÈùûÂ∏∏Ê∏ÖÊô∞ÁöÑÂ§ÑÁêÜËÆ§ËØÅ„ÄÅÊéàÊùÉ„ÄÅÁÆ°ÁêÜ‰ºöËØù‰ª•ÂèäÂØÜÁ†ÅÂä†ÂØÜ„ÄÇShiroÂæàÂÆπÊòìÂÖ•ÊâãÔºå‰∏äÊâãÂø´ÊéßÂà∂Á≤íÂ∫¶ÂèØÁ≥ôÂèØÁªÜ„ÄÇËá™Áî±Â∫¶È´òÔºåShiroÊó¢ËÉΩÈÖçÂêàSpring‰ΩøÁî®‰πüÂèØ‰ª•ÂçïÁã¨‰ΩøÁî®„ÄÇ Spring SecuritySpringÁ§æÂå∫ÁîüÊÄÅÂæàÂº∫Â§ß„ÄÇÈô§‰∫Ü‰∏çËÉΩËÑ±Á¶ªSpringÔºåSpring SecurityÂÖ∑ÊúâShiroÊâÄÊúâÁöÑÂäüËÉΩ„ÄÇËÄå‰∏îSpring SecurityÂØπOauth„ÄÅOpenID‰πüÊúâÊîØÊåÅ,ShiroÂàôÈúÄË¶ÅËá™Â∑±ÊâãÂä®ÂÆûÁé∞„ÄÇSpring SecurityÁöÑÊùÉÈôêÁªÜÁ≤íÂ∫¶Êõ¥È´ò„ÄÇ‰ΩÜÊòØSpring SecurityÂ§™ËøáÂ§çÊùÇ„ÄÇ Áúã‰∫Ü‰∏ãÁΩë‰∏äÁöÑËØÑËÆ∫ÔºåË≤å‰ºº‰∏ÄËæπÂÄíÂêëShiro„ÄÇÂ§ßÈÉ®ÂàÜ‰∫∫ÊèêÂá∫ÁöÑSpring SecurityÈóÆÈ¢òÂ∞±ÊòØÊØîËæÉÂ§çÊùÇÈöæÊáÇÔºåÊñáÊ°£Â§™Èïø„ÄÇ‰∏çÁÆ°ÊòØShiroËøòÊòØSpring SecurityÔºåÂÖ∂ÂÆûÁé∞ÈÉΩÊòØÂü∫‰∫éËøáÊª§Âô®ÔºåÂØπ‰∫éËá™ÂÆö‰πâÂÆûÁé∞ËøáÊª§Âô®ÔºåÊàëÊÉ≥ÂØπ‰∫éÂæàÂ§öÂºÄÂèëËÄÖÂπ∂‰∏çÊòØÂæàÈöæÔºå‰ΩÜÊòØËøôÈúÄË¶ÅÂõ¢ÈòüËä±Ë¥πÊó∂Èó¥‰∏éÂ∞ÅË£ÖÂèØÁî®ÁöÑjarÂåÖÂá∫Êù•ÔºåÂØπ‰∫éÂêéÊúüÁª¥Êä§ÂíåÂçáÁ∫ßÔºå‰ª•ÂèäÂäüËÉΩÁöÑÊâ©Â±ï„ÄÇÂæàÂ§ö‰∏≠Â∞èÂûãÂÖ¨Âè∏Âπ∂‰∏ç‰∏ÄÂÆöÂÖ∑ÊúâËøôÊ†∑ÁöÑÊó∂Èó¥Âíå‰∫∫ÂäõÊäïÂÖ•Ëøô‰ª∂‰∫ã„ÄÇÁ¨îËÄÖÁªºÂêàËØÑ‰º∞‰∫Ü‰∏ãÂ§çÊùÇÊÄß‰∏éÊâÄË¶ÅÂÆûÁé∞ÁöÑÊùÉÈôêÈúÄÊ±ÇÔºå‰ª•Âèä‰∏ä‰∏Ä‰∏™ÈúÄÊ±ÇË∞ÉÁ†îÁöÑÁªìÊûúÔºåÊó¢ÁÑ∂Spring SecurityÂäüËÉΩË∂≥Â§üÂº∫Â§ß‰∏îÁ®≥ÂÆöÔºåÊúÄÁªàÈÄâÊã©‰∫ÜSpring Security„ÄÇ 4. Á≥ªÁªüÊû∂ÊûÑ4.1 ÁªÑ‰ª∂AuthÁ≥ªÁªüÁöÑÊúÄÁªà‰ΩøÁî®ÁªÑ‰ª∂Â¶Ç‰∏ãÔºö 123OAuth2.0 JWT TokenSpring SecuritySpring boot 4.2 Ê≠•È™§‰∏ªË¶ÅÊ≠•È™§‰∏∫Ôºö ÈÖçÁΩÆËµÑÊ∫êÊúçÂä°Âô®ÂíåËÆ§ËØÅÊúçÂä°Âô® ÈÖçÁΩÆSpring Security ‰∏äËø∞Ê≠•È™§ÊØîËæÉÁ¨ºÁªüÔºåÂØπ‰∫éÂâçÈù¢Â∞èËäÇÊèêÂà∞ÁöÑÈúÄÊ±ÇÔºåÂ±û‰∫éAuthÁ≥ªÁªüÁöÑ‰∏ªË¶ÅÂÜÖÂÆπÔºåÁ¨îËÄÖÂêéÈù¢‰ºöÂè¶ÂÜôÊñáÁ´†ÂØπÂ∫îËÆ≤Ëß£„ÄÇ 4.3 endpointÊèê‰æõÁöÑendpointÔºö 1234567/oauth/token?grant_type=password #ËØ∑Ê±ÇÊéàÊùÉtoken/oauth/token?grant_type=refresh_token #Âà∑Êñ∞token/oauth/check_token #Ê†°È™åtoken/logout #Ê≥®ÈîÄtokenÂèäÊùÉÈôêÁõ∏ÂÖ≥‰ø°ÊÅØ 4.4 maven‰æùËµñ‰∏ªË¶ÅÁöÑjarÂåÖÔºåpom.xmlÊñá‰ª∂Â¶Ç‰∏ãÔºö 12345678910111213141516171819202122232425262728293031323334&lt;dependency&gt; &lt;groupId&gt;com.auth0&lt;/groupId&gt; &lt;artifactId&gt;java-jwt&lt;/artifactId&gt; &lt;version&gt;2.2.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-security&lt;/artifactId&gt; &lt;version&gt;1.2.1-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-oauth2&lt;/artifactId&gt; &lt;version&gt;1.2.1-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jersey&lt;/artifactId&gt; &lt;version&gt;1.5.3.RELEASE&lt;/version&gt; &lt;/dependency&gt; 4.5 AuthorizationServerÈÖçÁΩÆÊñá‰ª∂AuthorizationServerÈÖçÁΩÆ‰∏ªË¶ÅÊòØË¶ÜÂÜôÂ¶Ç‰∏ãÁöÑ‰∏â‰∏™ÊñπÊ≥ïÔºåÂàÜÂà´ÈíàÂØπendpoints„ÄÅclients„ÄÅsecurityÈÖçÁΩÆ„ÄÇ 1234567891011121314151617181920@Override public void configure(AuthorizationServerSecurityConfigurer security) throws Exception &#123; security.tokenKeyAccess("permitAll()").checkTokenAccess("isAuthenticated()"); &#125; @Override public void configure(ClientDetailsServiceConfigurer clients) throws Exception &#123; //ÈÖçÁΩÆÂÆ¢Êà∑Á´ØËÆ§ËØÅ clients.withClientDetails(clientDetailsService(dataSource)); &#125; @Override public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception &#123; //ÈÖçÁΩÆtokenÁöÑÊï∞ÊçÆÊ∫ê„ÄÅËá™ÂÆö‰πâÁöÑtokenServicesÁ≠â‰ø°ÊÅØ endpoints.authenticationManager(authenticationManager) .tokenStore(tokenStore(dataSource)) .tokenServices(authorizationServerTokenServices()) .accessTokenConverter(accessTokenConverter()) .exceptionTranslator(webResponseExceptionTranslator); &#125; 4.6 ResourceServerÈÖçÁΩÆËµÑÊ∫êÊúçÂä°Âô®ÁöÑÈÖçÁΩÆÔºåË¶ÜÂÜô‰∫ÜÈªòËÆ§ÁöÑÈÖçÁΩÆ„ÄÇ‰∏∫‰∫ÜÊîØÊåÅlogoutÔºåËøôËæπËá™ÂÆö‰πâ‰∫Ü‰∏Ä‰∏™CustomLogoutHandlerÂπ∂‰∏îÂ∞ÜlogoutSuccessHandlerÊåáÂÆö‰∏∫ËøîÂõûhttpÁä∂ÊÄÅÁöÑHttpStatusReturningLogoutSuccessHandler„ÄÇ 1234567891011121314@Override public void configure(HttpSecurity http) throws Exception &#123; http.csrf().disable() .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and() .requestMatchers().antMatchers("/**") .and().authorizeRequests() .antMatchers("/**").permitAll() .anyRequest().authenticated() .and().logout() .logoutUrl("/logout") .clearAuthentication(true) .logoutSuccessHandler(new HttpStatusReturningLogoutSuccessHandler()) .addLogoutHandler(customLogoutHandler()); 4.7 ÊâßË°åendpoint È¶ñÂÖàÊâßË°åËé∑ÂèñÊéàÊùÉÁöÑendpoint„ÄÇ 123456789101112method: post url: http://localhost:12000/oauth/token?grant_type=passwordheader:&#123; Authorization: Basic ZnJvbnRlbmQ6ZnJvbnRlbmQ=, Content-Type: application/x-www-form-urlencoded&#125;body:&#123; username: keets, password: ***&#125; ‰∏äËø∞ÊûÑÈÄ†‰∫Ü‰∏Ä‰∏™postËØ∑Ê±ÇÔºåÂÖ∑‰ΩìËØ∑Ê±ÇÂÜôÂæóÂæàËØ¶ÁªÜ„ÄÇusernameÂíåpasswordÊòØÂÆ¢Êà∑Á´ØÊèê‰æõÁªôÊúçÂä°Âô®ËøõË°åÊ†°È™åÁî®Êà∑Ë∫´‰ªΩ‰ø°ÊÅØ„ÄÇheaderÈáåÈù¢ÁöÑAuthorizationÊòØÂ≠òÊîæÁöÑclientIdÂíåclientSecretÁªèËøáÁºñÁ†ÅÁöÑÂ≠óÁ¨¶‰∏≤„ÄÇËøîÂõûÁªìÊûúÂ¶Ç‰∏ãÔºö 12345678910&#123; &quot;access_token&quot;: &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJYLUtFRVRTLVVzZXJJZCI6ImQ2NDQ4YzI0LTNjNGMtNGI4MC04MzcyLWMyZDYxODY4ZjhjNiIsImV4cCI6MTUwODQ0Nzc1NiwidXNlcl9uYW1lIjoia2VldHMiLCJqdGkiOiJiYWQ3MmIxOS1kOWYzLTQ5MDItYWZmYS0wNDMwZTdkYjc5ZWQiLCJjbGllbnRfaWQiOiJmcm9udGVuZCIsInNjb3BlIjpbImFsbCJdfQ.5ZNVN8TLavgpWy8KZQKArcbj7ItJLLaY1zBRaAgMjdo&quot;, &quot;token_type&quot;: &quot;bearer&quot;, &quot;refresh_token&quot;: &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJYLUtFRVRTLVVzZXJJZCI6ImQ2NDQ4YzI0LTNjNGMtNGI4MC04MzcyLWMyZDYxODY4ZjhjNiIsInVzZXJfbmFtZSI6ImtlZXRzIiwic2NvcGUiOlsiYWxsIl0sImF0aSI6ImJhZDcyYjE5LWQ5ZjMtNDkwMi1hZmZhLTA0MzBlN2RiNzllZCIsImV4cCI6MTUxMDk5NjU1NiwianRpIjoiYWE0MWY1MjctODE3YS00N2UyLWFhOTgtZjNlMDZmNmY0NTZlIiwiY2xpZW50X2lkIjoiZnJvbnRlbmQifQ.mICT1-lxOAqOU9M-Ud7wZBb4tTux6OQWouQJ2nn1DeE&quot;, &quot;expires_in&quot;: 43195, &quot;scope&quot;: &quot;all&quot;, &quot;X-KEETS-UserId&quot;: &quot;d6448c24-3c4c-4b80-8372-c2d61868f8c6&quot;, &quot;jti&quot;: &quot;bad72b19-d9f3-4902-affa-0430e7db79ed&quot;, &quot;X-KEETS-ClientId&quot;: &quot;frontend&quot;&#125; ÂèØ‰ª•ÁúãÂà∞Âú®Áî®Êà∑ÂêçÂØÜÁ†ÅÈÄöËøáÊ†°È™åÂêéÔºåÂÆ¢Êà∑Á´ØÊî∂Âà∞‰∫ÜÊéàÊùÉÊúçÂä°Âô®ÁöÑresponseÔºå‰∏ªË¶ÅÂåÖÊã¨access token„ÄÅrefresh token„ÄÇÂπ∂‰∏îË°®ÊòétokenÁöÑÁ±ªÂûã‰∏∫bearerÔºåËøáÊúüÊó∂Èó¥expires_in„ÄÇÁ¨îËÄÖÂú®jwt token‰∏≠Âä†ÂÖ•‰∫ÜËá™ÂÆö‰πâÁöÑinfo‰∏∫UserIdÂíåClientId„ÄÇ 2.Èâ¥ÊùÉÁöÑendpoint 1234567891011method: post url: http://localhost:12000/oauth/check_tokenheader:&#123; Authorization: Basic ZnJvbnRlbmQ6ZnJvbnRlbmQ=, Content-Type: application/x-www-form-urlencoded&#125;body:&#123; token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJYLUtFRVRTLVVzZXJJZCI6ImQ2NDQ4YzI0LTNjNGMtNGI4MC04MzcyLWMyZDYxODY4ZjhjNiIsImV4cCI6MTUwODQ0Nzc1NiwidXNlcl9uYW1lIjoia2VldHMiLCJqdGkiOiJiYWQ3MmIxOS1kOWYzLTQ5MDItYWZmYS0wNDMwZTdkYjc5ZWQiLCJjbGllbnRfaWQiOiJmcm9udGVuZCIsInNjb3BlIjpbImFsbCJdfQ.5ZNVN8TLavgpWy8KZQKArcbj7ItJLLaY1zBRaAgMjdo&#125; ‰∏äÈù¢Âç≥‰∏∫check_tokenËØ∑Ê±ÇÁöÑËØ¶ÁªÜ‰ø°ÊÅØ„ÄÇÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÁ¨îËÄÖÂ∞ÜÂàöÂàöÊéàÊùÉÁöÑtokenÊîæÂú®‰∫ÜbodyÈáåÈù¢ÔºåËøôËæπÂèØ‰ª•ÊúâÂ§öÁßçÊñπÊ≥ïÔºåÊ≠§Â§Ñ‰∏çÊâ©Â±ï„ÄÇ 123456789101112&#123; &quot;X-KEETS-UserId&quot;: &quot;d6448c24-3c4c-4b80-8372-c2d61868f8c6&quot;, &quot;user_name&quot;: &quot;keets&quot;, &quot;scope&quot;: [ &quot;all&quot; ], &quot;active&quot;: true, &quot;exp&quot;: 1508447756, &quot;X-KEETS-ClientId&quot;: &quot;frontend&quot;, &quot;jti&quot;: &quot;bad72b19-d9f3-4902-affa-0430e7db79ed&quot;, &quot;client_id&quot;: &quot;frontend&quot;&#125; Ê†°È™åtokenÂêàÊ≥ïÂêéÔºåËøîÂõûÁöÑresponseÂ¶Ç‰∏äÊâÄÁ§∫„ÄÇÂú®response‰∏≠‰πüÊòØÂ±ïÁ§∫‰∫ÜÁõ∏Â∫îÁöÑtoken‰∏≠ÁöÑÂü∫Êú¨‰ø°ÊÅØ„ÄÇ 3.Âà∑Êñ∞tokenÁî±‰∫étokenÁöÑÊó∂Êïà‰∏ÄËà¨‰∏ç‰ºöÂæàÈïøÔºåËÄårefresh token‰∏ÄËà¨Âë®Êúü‰ºöÂæàÈïøÔºå‰∏∫‰∫Ü‰∏çÂΩ±ÂìçÁî®Êà∑ÁöÑ‰ΩìÈ™åÔºåÂèØ‰ª•‰ΩøÁî®refresh tokenÂéªÂä®ÊÄÅÁöÑÂà∑Êñ∞token„ÄÇ 123456method: post url: http://localhost:12000/oauth/token?grant_type=refresh_token&amp;refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJYLUtFRVRTLVVzZXJJZCI6ImQ2NDQ4YzI0LTNjNGMtNGI4MC04MzcyLWMyZDYxODY4ZjhjNiIsInVzZXJfbmFtZSI6ImtlZXRzIiwic2NvcGUiOlsiYWxsIl0sImF0aSI6ImJhZDcyYjE5LWQ5ZjMtNDkwMi1hZmZhLTA0MzBlN2RiNzllZCIsImV4cCI6MTUxMDk5NjU1NiwianRpIjoiYWE0MWY1MjctODE3YS00N2UyLWFhOTgtZjNlMDZmNmY0NTZlIiwiY2xpZW50X2lkIjoiZnJvbnRlbmQifQ.mICT1-lxOAqOU9M-Ud7wZBb4tTux6OQWouQJ2nn1DeEheader:&#123; Authorization: Basic ZnJvbnRlbmQ6ZnJvbnRlbmQ=&#125; ÂÖ∂responseÂíå/oauth/tokenÂæóÂà∞Ê≠£Â∏∏ÁöÑÁõ∏Â∫îÊòØ‰∏ÄÊ†∑ÁöÑÔºåÊ≠§Â§Ñ‰∏çÂÜçÂàóÂá∫„ÄÇ 4.Ê≥®ÈîÄtoken 123456method: geturl: http://localhost:9000/logoutheader:&#123; Authorization: Basic ZnJvbnRlbmQ6ZnJvbnRlbmQ=&#125; Ê≥®ÈîÄÊàêÂäüÂàô‰ºöËøîÂõû200ÔºåÊ≥®ÈîÄÁ´ØÁÇπ‰∏ªË¶ÅÊòØÂ∞ÜtokenÂíåSecurityContextHolderËøõË°åÊ∏ÖÁ©∫„ÄÇ 5. ÊÄªÁªìÊú¨ÊñáÊòØ„ÄäËÆ§ËØÅÈâ¥ÊùÉ‰∏éAPIÊùÉÈôêÊéßÂà∂Âú®ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÁöÑËÆæËÆ°‰∏éÂÆûÁé∞„ÄãÁ≥ªÂàóÊñáÁ´†ÁöÑÊÄªËø∞Ôºå‰ªéÈÅáÂà∞ÁöÑÈóÆÈ¢òÁùÄÊâãÔºå‰ªãÁªç‰∫ÜÈ°πÁõÆÁöÑËÉåÊôØ„ÄÇÈÄöËøáË∞ÉÁ†îÁé∞ÊúâÁöÑÊäÄÊúØÔºåÂπ∂ÁªìÂêàÂΩìÂâçÈ°πÁõÆÁöÑÂÆûÈôÖÔºåÁ°ÆÂÆö‰∫ÜÊäÄÊúØÈÄâÂûã„ÄÇÊúÄÂêéÂØπ‰∫éÁ≥ªÁªüÁöÑÊúÄÁªàÁöÑÂÆûÁé∞ËøõË°åÂ±ïÁ§∫„ÄÇÂêéÈù¢Â∞Ü‰ªéÂÆûÁé∞ÁöÑÁªÜËäÇÔºåËÆ≤Ëß£Êú¨Á≥ªÁªüÁöÑÂÆûÁé∞„ÄÇÊï¨ËØ∑ÊúüÂæÖÂêéÁª≠ÊñáÁ´†„ÄÇ ÂèÇËÄÉ ÁêÜËß£OAuth 2.0 ÂæÆÊúçÂä°APIÁ∫ßÊùÉÈôêÁöÑÊäÄÊúØÊû∂ÊûÑ ÂæÆÊúçÂä°Êû∂ÊûÑ‰∏ãÁöÑÂÆâÂÖ®ËÆ§ËØÅ‰∏éÈâ¥ÊùÉ]]></content>
      <categories>
        <category>Security</category>
      </categories>
      <tags>
        <tag>Spring Security</tag>
        <tag>OAuth2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ê∂àÊÅØ‰∏≠Èó¥‰ª∂NSQÊ∑±ÂÖ•‰∏éÂÆûË∑µ]]></title>
    <url>%2F2017%2F10%2F08%2Fnsq%2F</url>
    <content type="text"><![CDATA[1. ‰ªãÁªçÊúÄËøëÂú®Á†îÁ©∂‰∏Ä‰∫õÊ∂àÊÅØ‰∏≠Èó¥‰ª∂ÔºåÂ∏∏Áî®ÁöÑMQÂ¶ÇRabbitMQ,ActiveMQ,KafkaÁ≠â„ÄÇNSQÊòØ‰∏Ä‰∏™Âü∫‰∫éGoËØ≠Ë®ÄÁöÑÂàÜÂ∏ÉÂºèÂÆûÊó∂Ê∂àÊÅØÂπ≥Âè∞ÔºåÂÆÉÂü∫‰∫éMITÂºÄÊ∫êÂçèËÆÆÂèëÂ∏ÉÔºåÁî±bitlyÂÖ¨Âè∏ÂºÄÊ∫êÂá∫Êù•ÁöÑ‰∏ÄÊ¨æÁÆÄÂçïÊòìÁî®ÁöÑÊ∂àÊÅØ‰∏≠Èó¥‰ª∂„ÄÇÂÆòÊñπÂíåÁ¨¨‰∏âÊñπËøò‰∏∫NSQÂºÄÂèë‰∫Ü‰ºóÂ§öÂÆ¢Êà∑Á´ØÂäüËÉΩÂ∫ìÔºåÂ¶ÇÂÆòÊñπÊèê‰æõÁöÑÂü∫‰∫éHTTPÁöÑnsqd„ÄÅGoÂÆ¢Êà∑Á´Øgo-nsq„ÄÅPythonÂÆ¢Êà∑Á´Øpynsq„ÄÅÂü∫‰∫éNode.jsÁöÑJavaScriptÂÆ¢Êà∑Á´Ønsqjs„ÄÅÂºÇÊ≠•CÂÆ¢Êà∑Á´Ølibnsq„ÄÅJavaÂÆ¢Êà∑Á´Ønsq-java‰ª•ÂèäÂü∫‰∫éÂêÑÁßçËØ≠Ë®ÄÁöÑ‰ºóÂ§öÁ¨¨‰∏âÊñπÂÆ¢Êà∑Á´ØÂäüËÉΩÂ∫ì„ÄÇ 1.1 Features1). DistributedNSQÊèê‰æõ‰∫ÜÂàÜÂ∏ÉÂºèÁöÑÔºåÂéª‰∏≠ÂøÉÂåñÔºå‰∏îÊ≤°ÊúâÂçïÁÇπÊïÖÈöúÁöÑÊãìÊâëÁªìÊûÑÔºåÁ®≥ÂÆöÁöÑÊ∂àÊÅØ‰º†ËæìÂèëÂ∏É‰øùÈöúÔºåËÉΩÂ§üÂÖ∑ÊúâÈ´òÂÆπÈîôÂíåHAÔºàÈ´òÂèØÁî®ÔºâÁâπÊÄß„ÄÇ2). ScalableÊòì‰∫éÊâ©Â±ïNSQÊîØÊåÅÊ∞¥Âπ≥Êâ©Â±ïÔºåÊ≤°Êúâ‰∏≠ÂøÉÂåñÁöÑbrokers„ÄÇÂÜÖÁΩÆÁöÑÂèëÁé∞ÊúçÂä°ÁÆÄÂåñ‰∫ÜÂú®ÈõÜÁæ§‰∏≠Â¢ûÂä†ËäÇÁÇπ„ÄÇÂêåÊó∂ÊîØÊåÅpub-subÂíåload-balanced ÁöÑÊ∂àÊÅØÂàÜÂèë„ÄÇ3). Ops FriendlyNSQÈùûÂ∏∏ÂÆπÊòìÈÖçÁΩÆÂíåÈÉ®ÁΩ≤ÔºåÁîüÊù•Â∞±ÁªëÂÆö‰∫Ü‰∏Ä‰∏™ÁÆ°ÁêÜÁïåÈù¢„ÄÇ‰∫åËøõÂà∂ÂåÖÊ≤°ÊúâËøêË°åÊó∂‰æùËµñ„ÄÇÂÆòÊñπÊúâDocker image„ÄÇ4.IntegratedÈ´òÂ∫¶ÈõÜÊàêÂÆòÊñπÁöÑ Go Âíå PythonÂ∫ìÈÉΩÊúâÊèê‰æõ„ÄÇËÄå‰∏î‰∏∫Â§ßÂ§öÊï∞ËØ≠Ë®ÄÊèê‰æõ‰∫ÜÂ∫ì„ÄÇ 1.2 ÁªÑ‰ª∂ Topic Ôºö‰∏Ä‰∏™topicÂ∞±ÊòØÁ®ãÂ∫èÂèëÂ∏ÉÊ∂àÊÅØÁöÑ‰∏Ä‰∏™ÈÄªËæëÈîÆÔºåÂΩìÁ®ãÂ∫èÁ¨¨‰∏ÄÊ¨°ÂèëÂ∏ÉÊ∂àÊÅØÊó∂Â∞±‰ºöÂàõÂª∫topic„ÄÇ Channels Ôºöchannel‰∏éÊ∂àË¥πËÄÖÁõ∏ÂÖ≥ÔºåÊòØÊ∂àË¥πËÄÖ‰πãÈó¥ÁöÑË¥üËΩΩÂùáË°°ÔºåchannelÂú®ÊüêÁßçÊÑè‰πâ‰∏äÊù•ËØ¥ÊòØ‰∏Ä‰∏™‚ÄúÈòüÂàó‚Äù„ÄÇÊØèÂΩì‰∏Ä‰∏™ÂèëÂ∏ÉËÄÖÂèëÈÄÅ‰∏ÄÊù°Ê∂àÊÅØÂà∞‰∏Ä‰∏™topicÔºåÊ∂àÊÅØ‰ºöË¢´Â§çÂà∂Âà∞ÊâÄÊúâÊ∂àË¥πËÄÖËøûÊé•ÁöÑchannel‰∏äÔºåÊ∂àË¥πËÄÖÈÄöËøáËøô‰∏™ÁâπÊÆäÁöÑchannelËØªÂèñÊ∂àÊÅØÔºåÂÆûÈôÖ‰∏äÔºåÂú®Ê∂àË¥πËÄÖÁ¨¨‰∏ÄÊ¨°ËÆ¢ÈòÖÊó∂Â∞±‰ºöÂàõÂª∫channel„ÄÇChannel‰ºöÂ∞ÜÊ∂àÊÅØËøõË°åÊéíÂàóÔºåÂ¶ÇÊûúÊ≤°ÊúâÊ∂àË¥πËÄÖËØªÂèñÊ∂àÊÅØÔºåÊ∂àÊÅØÈ¶ñÂÖà‰ºöÂú®ÂÜÖÂ≠ò‰∏≠ÊéíÈòüÔºåÂΩìÈáèÂ§™Â§ßÊó∂Â∞±‰ºöË¢´‰øùÂ≠òÂà∞Á£ÅÁõò‰∏≠„ÄÇ MessagesÔºöÊ∂àÊÅØÊûÑÊàê‰∫ÜÊàë‰ª¨Êï∞ÊçÆÊµÅÁöÑ‰∏≠ÂùöÂäõÈáèÔºåÊ∂àË¥πËÄÖÂèØ‰ª•ÈÄâÊã©ÁªìÊùüÊ∂àÊÅØÔºåË°®ÊòéÂÆÉ‰ª¨Ê≠£Âú®Ë¢´Ê≠£Â∏∏Â§ÑÁêÜÔºåÊàñËÄÖÈáçÊñ∞Â∞Ü‰ªñ‰ª¨ÊéíÈòüÂæÖÂà∞ÂêéÈù¢ÂÜçËøõË°åÂ§ÑÁêÜ„ÄÇÊØè‰∏™Ê∂àÊÅØÂåÖÂê´‰º†ÈÄíÂ∞ùËØïÁöÑÊ¨°Êï∞ÔºåÂΩìÊ∂àÊÅØ‰º†ÈÄíË∂ÖËøá‰∏ÄÂÆöÁöÑÈòÄÂÄºÊ¨°Êï∞Êó∂ÔºåÊàë‰ª¨Â∫îËØ•ÊîæÂºÉËøô‰∫õÊ∂àÊÅØÔºåÊàñËÄÖ‰Ωú‰∏∫È¢ùÂ§ñÊ∂àÊÅØËøõË°åÂ§ÑÁêÜ„ÄÇ nsqdÔºönsqd ÊòØ‰∏Ä‰∏™ÂÆàÊä§ËøõÁ®ãÔºåË¥üË¥£Êé•Êî∂ÔºåÊéíÈòüÔºåÊäïÈÄíÊ∂àÊÅØÁªôÂÆ¢Êà∑Á´Ø„ÄÇÂÆÉÂèØ‰ª•Áã¨Á´ãËøêË°åÔºå‰∏çËøáÈÄöÂ∏∏ÂÆÉÊòØÁî± nsqlookupd ÂÆû‰æãÊâÄÂú®ÈõÜÁæ§ÈÖçÁΩÆÁöÑÔºàÂÆÉÂú®ËøôËÉΩÂ£∞Êòé topics Âíå channelsÔºå‰ª•‰æøÂ§ßÂÆ∂ËÉΩÊâæÂà∞Ôºâ„ÄÇ nsqlookupdÔºönsqlookupd ÊòØÂÆàÊä§ËøõÁ®ãË¥üË¥£ÁÆ°ÁêÜÊãìÊâë‰ø°ÊÅØ„ÄÇÂÆ¢Êà∑Á´ØÈÄöËøáÊü•ËØ¢ nsqlookupd Êù•ÂèëÁé∞ÊåáÂÆöËØùÈ¢òÔºàtopicÔºâÁöÑÁîü‰∫ßËÄÖÔºåÂπ∂‰∏î nsqd ËäÇÁÇπÂπøÊí≠ËØùÈ¢òÔºàtopicÔºâÂíåÈÄöÈÅìÔºàchannelÔºâ‰ø°ÊÅØ„ÄÇÊúâ‰∏§‰∏™Êé•Âè£ÔºöTCP Êé•Âè£Ôºånsqd Áî®ÂÆÉÊù•ÂπøÊí≠„ÄÇHTTP Êé•Âè£ÔºåÂÆ¢Êà∑Á´ØÁî®ÂÆÉÊù•ÂèëÁé∞ÂíåÁÆ°ÁêÜ„ÄÇ nsqadminÔºönsqadmin ÊòØ‰∏ÄÂ•ó WEB UIÔºåÁî®Êù•Ê±áÈõÜÈõÜÁæ§ÁöÑÂÆûÊó∂ÁªüËÆ°ÔºåÂπ∂ÊâßË°å‰∏çÂêåÁöÑÁÆ°ÁêÜ‰ªªÂä°„ÄÇ Â∏∏Áî®Â∑•ÂÖ∑Á±ªÔºö nsq_to _fileÔºöÊ∂àË¥πÊåáÂÆöÁöÑËØùÈ¢òÔºàtopicÔºâ/ÈÄöÈÅìÔºàchannelÔºâÔºåÂπ∂ÂÜôÂà∞Êñá‰ª∂‰∏≠ÔºåÊúâÈÄâÊã©ÁöÑÊªöÂä®Âíå/ÊàñÂéãÁº©Êñá‰ª∂„ÄÇ nsq_to _httpÔºöÊ∂àË¥πÊåáÂÆöÁöÑËØùÈ¢òÔºàtopicÔºâ/ÈÄöÈÅìÔºàchannelÔºâÂíåÊâßË°å HTTP requests (GET/POST) Âà∞ÊåáÂÆöÁöÑÁ´ØÁÇπ„ÄÇ nsq_to _nsqÔºöÊ∂àË¥πËÄÖÊåáÂÆöÁöÑËØùÈ¢ò/ÈÄöÈÅìÂíåÈáçÂèëÂ∏ÉÊ∂àÊÅØÂà∞ÁõÆÁöÑÂú∞ nsqd ÈÄöËøá TCP„ÄÇ 1.3 ÊãìÊâëÁªìÊûÑNSQÊé®ËçêÈÄöËøá‰ªñ‰ª¨Áõ∏Â∫îÁöÑnsqdÂÆû‰æã‰ΩøÁî®ÂçèÂêåÂÆö‰ΩçÂèëÂ∏ÉËÄÖÔºåËøôÊÑèÂë≥ÁùÄÂç≥‰ΩøÈù¢ÂØπÁΩëÁªúÂàÜÂå∫ÔºåÊ∂àÊÅØ‰πü‰ºöË¢´‰øùÂ≠òÂú®Êú¨Âú∞ÔºåÁõ¥Âà∞ÂÆÉ‰ª¨Ë¢´‰∏Ä‰∏™Ê∂àË¥πËÄÖËØªÂèñ„ÄÇÊõ¥ÈáçË¶ÅÁöÑÊòØÔºåÂèëÂ∏ÉËÄÖ‰∏çÂøÖÂéªÂèëÁé∞ÂÖ∂‰ªñÁöÑnsqdËäÇÁÇπÔºå‰ªñ‰ª¨ÊÄªÊòØÂèØ‰ª•ÂêëÊú¨Âú∞ÂÆû‰æãÂèëÂ∏ÉÊ∂àÊÅØ„ÄÇ È¶ñÂÖàÔºå‰∏Ä‰∏™ÂèëÂ∏ÉËÄÖÂêëÂÆÉÁöÑÊú¨Âú∞nsqdÂèëÈÄÅÊ∂àÊÅØÔºåË¶ÅÂÅöÂà∞ËøôÁÇπÔºåÈ¶ñÂÖàË¶ÅÂÖàÊâìÂºÄ‰∏Ä‰∏™ËøûÊé•ÔºåÁÑ∂ÂêéÂèëÈÄÅ‰∏Ä‰∏™ÂåÖÂê´topicÂíåÊ∂àÊÅØ‰∏ª‰ΩìÁöÑÂèëÂ∏ÉÂëΩ‰ª§ÔºåÂú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºåÊàë‰ª¨Â∞ÜÊ∂àÊÅØÂèëÂ∏ÉÂà∞‰∫ã‰ª∂topic‰∏ä‰ª•ÂàÜÊï£Âà∞Êàë‰ª¨‰∏çÂêåÁöÑworker‰∏≠„ÄÇ‰∫ã‰ª∂topic‰ºöÂ§çÂà∂Ëøô‰∫õÊ∂àÊÅØÂπ∂‰∏îÂú®ÊØè‰∏Ä‰∏™ËøûÊé•topicÁöÑchannel‰∏äËøõË°åÊéíÈòüÔºåÂú®Êàë‰ª¨ÁöÑÊ°à‰æã‰∏≠ÔºåÊúâ‰∏â‰∏™channelÔºåÂÆÉ‰ª¨ÂÖ∂‰∏≠‰πã‰∏Ä‰Ωú‰∏∫Ê°£Ê°àchannel„ÄÇÊ∂àË¥πËÄÖ‰ºöËé∑ÂèñËøô‰∫õÊ∂àÊÅØÂπ∂‰∏î‰∏ä‰º†Âà∞S3„ÄÇ ÊØè‰∏™channelÁöÑÊ∂àÊÅØÈÉΩ‰ºöËøõË°åÊéíÈòüÔºåÁõ¥Âà∞‰∏Ä‰∏™workerÊää‰ªñ‰ª¨Ê∂àË¥πÔºåÂ¶ÇÊûúÊ≠§ÈòüÂàóË∂ÖÂá∫‰∫ÜÂÜÖÂ≠òÈôêÂà∂ÔºåÊ∂àÊÅØÂ∞Ü‰ºöË¢´ÂÜôÂÖ•Âà∞Á£ÅÁõò‰∏≠„ÄÇNsqdËäÇÁÇπÈ¶ñÂÖà‰ºöÂêënsqlookupÂπøÊí≠‰ªñ‰ª¨ÁöÑ‰ΩçÁΩÆ‰ø°ÊÅØÔºå‰∏ÄÊó¶ÂÆÉ‰ª¨Ê≥®ÂÜåÊàêÂäüÔºåworkerÂ∞Ü‰ºö‰ªénsqlookupÊúçÂä°Âô®ËäÇÁÇπ‰∏äÂèëÁé∞ÊâÄÊúâÂåÖÂê´‰∫ã‰ª∂topicÁöÑnsqdËäÇÁÇπ„ÄÇ ÁÑ∂ÂêéÊØè‰∏™workerÂêëÊØè‰∏™nsqd‰∏ªÊú∫ËøõË°åËÆ¢ÈòÖÊìç‰ΩúÔºåÁî®‰∫éË°®ÊòéworkerÂ∑≤ÁªèÂáÜÂ§áÂ•ΩÊé•ÂèóÊ∂àÊÅØ‰∫Ü„ÄÇËøôÈáåÊàë‰ª¨‰∏çÈúÄË¶Å‰∏Ä‰∏™ÂÆåÊï¥ÁöÑËøûÈÄöÂõæÔºå‰ΩÜÊàë‰ª¨ÂøÖÈ°ªË¶Å‰øùËØÅÊØè‰∏™ÂçïÁã¨ÁöÑnsqdÂÆû‰æãÊã•ÊúâË∂≥Â§üÁöÑÊ∂àË¥πËÄÖÂéªÊ∂àË¥πÂÆÉ‰ª¨ÁöÑÊ∂àÊÅØÔºåÂê¶Âàôchannel‰ºöË¢´ÈòüÂàóÂ†ÜÁùÄ„ÄÇ 2. Internals2.1 Ê∂àÊÅØ‰º†ÈÄíÊãÖ‰øùNSQ ‰øùËØÅÊ∂àÊÅØÂ∞Ü‰∫§‰ªòËá≥Â∞ë‰∏ÄÊ¨°ÔºåËôΩÁÑ∂Ê∂àÊÅØÂèØËÉΩÊòØÈáçÂ§çÁöÑ„ÄÇÊ∂àË¥πËÄÖÂ∫îËØ•ÂÖ≥Ê≥®Âà∞Ëøô‰∏ÄÁÇπÔºåÂà†Èô§ÈáçÂ§çÊï∞ÊçÆÊàñÊâßË°åidempotentÁ≠âÊìç‰Ωú„ÄÇËøô‰∏™ÊãÖ‰øùÊòØ‰Ωú‰∏∫ÂçèËÆÆÂíåÂ∑•‰ΩúÊµÅÁöÑ‰∏ÄÈÉ®ÂàÜÔºåÂ∑•‰ΩúÂéüÁêÜÂ¶Ç‰∏ãÔºàÂÅáËÆæÂÆ¢Êà∑Á´ØÊàêÂäüËøûÊé•Âπ∂ËÆ¢ÈòÖ‰∏Ä‰∏™ËØùÈ¢òÔºâÔºö1ÔºâÂÆ¢Êà∑Ë°®Á§∫Â∑≤ÁªèÂáÜÂ§áÂ•ΩÊé•Êî∂Ê∂àÊÅØ2ÔºâNSQ ÂèëÈÄÅ‰∏ÄÊù°Ê∂àÊÅØÔºåÂπ∂ÊöÇÊó∂Â∞ÜÊï∞ÊçÆÂ≠òÂÇ®Âú®Êú¨Âú∞ÔºàÂú® re-queue Êàñ timeoutÔºâ3ÔºâÂÆ¢Êà∑Á´ØÂõûÂ§ç FINÔºàÁªìÊùüÔºâÊàñ REQÔºàÈáçÊñ∞ÊéíÈòüÔºâÂàÜÂà´ÊåáÁ§∫ÊàêÂäüÊàñÂ§±Ë¥•„ÄÇÂ¶ÇÊûúÂÆ¢Êà∑Á´ØÊ≤°ÊúâÂõûÂ§ç, NSQ ‰ºöÂú®ËÆæÂÆöÁöÑÊó∂Èó¥Ë∂ÖÊó∂ÔºåËá™Âä®ÈáçÊñ∞ÊéíÈòüÊ∂àÊÅØËøôÁ°Æ‰øù‰∫ÜÊ∂àÊÅØ‰∏¢Â§±ÂîØ‰∏ÄÂèØËÉΩÁöÑÊÉÖÂÜµÊòØ‰∏çÊ≠£Â∏∏ÁªìÊùü nsqd ËøõÁ®ã„ÄÇÂú®ËøôÁßçÊÉÖÂÜµ‰∏ãÔºåËøôÊòØÂú®ÂÜÖÂ≠ò‰∏≠ÁöÑ‰ªª‰Ωï‰ø°ÊÅØÔºàÊàñ‰ªª‰ΩïÁºìÂÜ≤Êú™Âà∑Êñ∞Âà∞Á£ÅÁõòÔºâÈÉΩÂ∞Ü‰∏¢Â§±„ÄÇÂ¶Ç‰ΩïÈò≤Ê≠¢Ê∂àÊÅØ‰∏¢Â§±ÊòØÊúÄÈáçË¶ÅÁöÑÔºåÂç≥‰ΩøÊòØËøô‰∏™ÊÑèÂ§ñÊÉÖÂÜµÂèØ‰ª•ÂæóÂà∞ÁºìËß£„ÄÇ‰∏ÄÁßçËß£ÂÜ≥ÊñπÊ°àÊòØÊûÑÊàêÂÜó‰Ωô nsqdÂØπÔºàÂú®‰∏çÂêåÁöÑ‰∏ªÊú∫‰∏äÔºâÊé•Êî∂Ê∂àÊÅØÁöÑÁõ∏ÂêåÈÉ®ÂàÜÁöÑÂâØÊú¨„ÄÇÂõ†‰∏∫‰Ω†ÂÆûÁé∞ÁöÑÊ∂àË¥πËÄÖÊòØÂπÇÁ≠âÁöÑÔºå‰ª•‰∏§ÂÄçÊó∂Èó¥Â§ÑÁêÜËøô‰∫õÊ∂àÊÅØ‰∏ç‰ºöÂØπ‰∏ãÊ∏∏ÈÄ†ÊàêÂΩ±ÂìçÔºåÂπ∂‰ΩøÂæóÁ≥ªÁªüËÉΩÂ§üÊâøÂèó‰ªª‰ΩïÂçï‰∏ÄËäÇÁÇπÊïÖÈöúËÄå‰∏ç‰ºö‰∏¢Â§±‰ø°ÊÅØ„ÄÇ 2.2 ÁÆÄÂåñÈÖçÁΩÆÂíåÁÆ°ÁêÜÂçï‰∏™ nsqd ÂÆû‰æãË¢´ËÆæËÆ°ÊàêÂèØ‰ª•ÂêåÊó∂Â§ÑÁêÜÂ§ö‰∏™Êï∞ÊçÆÊµÅ„ÄÇÊµÅË¢´Áß∞‰∏∫‚ÄúËØùÈ¢ò‚ÄùÂíåËØùÈ¢òÊúâ 1 ‰∏™ÊàñÂ§ö‰∏™‚ÄúÈÄöÈÅì‚Äù„ÄÇÊØè‰∏™ÈÄöÈÅìÈÉΩÊé•Êî∂Âà∞‰∏Ä‰∏™ËØùÈ¢ò‰∏≠ÊâÄÊúâÊ∂àÊÅØÁöÑÊã∑Ë¥ù„ÄÇÂú®ÂÆûË∑µ‰∏≠Ôºå‰∏Ä‰∏™ÈÄöÈÅìÊò†Â∞ÑÂà∞‰∏ãË°åÊúçÂä°Ê∂àË¥π‰∏Ä‰∏™ËØùÈ¢ò„ÄÇËØùÈ¢òÂíåÈÄöÈÅìÈÉΩÊ≤°ÊúâÈ¢ÑÂÖàÈÖçÁΩÆ„ÄÇËØùÈ¢òÁî±Á¨¨‰∏ÄÊ¨°ÂèëÂ∏ÉÊ∂àÊÅØÂà∞ÂëΩÂêçÁöÑËØùÈ¢òÊàñÁ¨¨‰∏ÄÊ¨°ÈÄöËøáËÆ¢ÈòÖ‰∏Ä‰∏™ÂëΩÂêçËØùÈ¢òÊù•ÂàõÂª∫„ÄÇÈÄöÈÅìË¢´Á¨¨‰∏ÄÊ¨°ËÆ¢ÈòÖÂà∞ÊåáÂÆöÁöÑÈÄöÈÅìÂàõÂª∫„ÄÇËØùÈ¢òÂíåÈÄöÈÅìÁöÑÊâÄÊúâÁºìÂÜ≤ÁöÑÊï∞ÊçÆÁõ∏‰∫íÁã¨Á´ãÔºåÈò≤Ê≠¢ÁºìÊÖ¢Ê∂àË¥πËÄÖÈÄ†ÊàêÂØπÂÖ∂‰ªñÈÄöÈÅìÁöÑÁßØÂéãÔºàÂêåÊ†∑ÈÄÇÁî®‰∫éËØùÈ¢òÁ∫ßÂà´Ôºâ„ÄÇ‰∏Ä‰∏™ÈÄöÈÅì‰∏ÄËà¨‰ºöÊúâÂ§ö‰∏™ÂÆ¢Êà∑Á´ØËøûÊé•„ÄÇÂÅáËÆæÊâÄÊúâÂ∑≤ËøûÊé•ÁöÑÂÆ¢Êà∑Á´ØÂ§Ñ‰∫éÂáÜÂ§áÊé•Êî∂Ê∂àÊÅØÁöÑÁä∂ÊÄÅÔºåÊØè‰∏™Ê∂àÊÅØÂ∞ÜË¢´‰º†ÈÄíÂà∞‰∏Ä‰∏™ÈöèÊú∫ÁöÑÂÆ¢Êà∑Á´Ø„ÄÇnsqlookupdÔºåÂÆÉÊèê‰æõ‰∫Ü‰∏Ä‰∏™ÁõÆÂΩïÊúçÂä°ÔºåÊ∂àË¥πËÄÖÂèØ‰ª•Êü•ÊâæÂà∞Êèê‰æõ‰ªñ‰ª¨ÊÑüÂÖ¥Ë∂£ËÆ¢ÈòÖËØùÈ¢òÁöÑ nsqd Âú∞ÂùÄ „ÄÇÂú®ÈÖçÁΩÆÊñπÈù¢ÔºåÊääÊ∂àË¥πËÄÖ‰∏éÁîü‰∫ßËÄÖËß£ËÄ¶ÂºÄÔºàÂÆÉ‰ª¨ÈÉΩÂàÜÂà´Âè™ÈúÄË¶ÅÁü•ÈÅìÂì™ÈáåÂéªËøûÊé• nsqlookupd ÁöÑÂÖ±ÂêåÂÆû‰æãÔºåËÄå‰∏çÊòØÂØπÊñπÔºâÔºåÈôç‰ΩéÂ§çÊùÇÊÄßÂíåÁª¥Êä§„ÄÇÂú®Êõ¥Â∫ïÁöÑÂ±ÇÈù¢ÔºåÊØè‰∏™ nsqd Êúâ‰∏Ä‰∏™‰∏é nsqlookupd ÁöÑÈïøÊúü TCP ËøûÊé•ÔºåÂÆöÊúüÊé®Âä®ÂÖ∂Áä∂ÊÄÅ„ÄÇËøô‰∏™Êï∞ÊçÆË¢´ nsqlookupd Áî®‰∫éÁªôÊ∂àË¥πËÄÖÈÄöÁü• nsqd Âú∞ÂùÄ„ÄÇÂØπ‰∫éÊ∂àË¥πËÄÖÊù•ËØ¥Ôºå‰∏Ä‰∏™Êö¥Èú≤ÁöÑ HTTP /lookup Êé•Âè£Áî®‰∫éËΩÆËØ¢„ÄÇ‰∏∫ËØùÈ¢òÂºïÂÖ•‰∏Ä‰∏™Êñ∞ÁöÑÊ∂àË¥πËÄÖÔºåÂè™ÈúÄÂêØÂä®‰∏Ä‰∏™ÈÖçÁΩÆ‰∫Ü nsqlookup ÂÆû‰æãÂú∞ÂùÄÁöÑ NSQ ÂÆ¢Êà∑Á´Ø„ÄÇÊó†ÈúÄ‰∏∫Ê∑ªÂä†‰ªª‰ΩïÊñ∞ÁöÑÊ∂àË¥πËÄÖÊàñÁîü‰∫ßËÄÖÊõ¥ÊîπÈÖçÁΩÆÔºåÂ§ßÂ§ßÈôç‰Ωé‰∫ÜÂºÄÈîÄÂíåÂ§çÊùÇÊÄß„ÄÇ 2.3 Ê∂àÈô§ÂçïÁÇπÊïÖÈöúNSQË¢´ËÆæËÆ°‰ª•ÂàÜÂ∏ÉÁöÑÊñπÂºèË¢´‰ΩøÁî®„ÄÇnsqd ÂÆ¢Êà∑Á´ØÔºàÈÄöËøá TCP ÔºâËøûÊé•Âà∞ÊåáÂÆöËØùÈ¢òÁöÑÊâÄÊúâÁîü‰∫ßËÄÖÂÆû‰æã„ÄÇÊ≤°Êúâ‰∏≠Èó¥‰∫∫ÔºåÊ≤°ÊúâÊ∂àÊÅØ‰ª£ÁêÜÔºå‰πüÊ≤°ÊúâÂçïÁÇπÊïÖÈöú„ÄÇËøôÁßçÊãìÊâëÁªìÊûÑÊ∂àÈô§ÂçïÈìæÔºåËÅöÂêàÔºåÂèçÈ¶à„ÄÇÁõ∏ÂèçÔºå‰Ω†ÁöÑÊ∂àË¥πËÄÖÁõ¥Êé•ËÆøÈóÆÊâÄÊúâÁîü‰∫ßËÄÖ„ÄÇ‰ªéÊäÄÊúØ‰∏äËÆ≤ÔºåÂì™‰∏™ÂÆ¢Êà∑Á´ØËøûÊé•Âà∞Âì™‰∏™ NSQ ‰∏çÈáçË¶ÅÔºåÂè™Ë¶ÅÊúâË∂≥Â§üÁöÑÊ∂àË¥πËÄÖËøûÊé•Âà∞ÊâÄÊúâÁîü‰∫ßËÄÖÔºå‰ª•Êª°Ë∂≥Â§ßÈáèÁöÑÊ∂àÊÅØÔºå‰øùËØÅÊâÄÊúâ‰∏úË•øÊúÄÁªàÂ∞ÜË¢´Â§ÑÁêÜ„ÄÇÂØπ‰∫é nsqlookupdÔºåÈ´òÂèØÁî®ÊÄßÊòØÈÄöËøáËøêË°åÂ§ö‰∏™ÂÆû‰æãÊù•ÂÆûÁé∞„ÄÇ‰ªñ‰ª¨‰∏çÁõ¥Êé•Áõ∏‰∫íÈÄö‰ø°ÂíåÊï∞ÊçÆË¢´ËÆ§‰∏∫ÊòØÊúÄÁªà‰∏ÄËá¥„ÄÇÊ∂àË¥πËÄÖËΩÆËØ¢ÊâÄÊúâÁöÑÈÖçÁΩÆÁöÑ nsqlookupd ÂÆû‰æãÂíåÂêàÂπ∂ response„ÄÇÂ§±Ë¥•ÁöÑÔºåÊó†Ê≥ïËÆøÈóÆÁöÑÔºåÊàñ‰ª•ÂÖ∂‰ªñÊñπÂºèÊïÖÈöúÁöÑËäÇÁÇπ‰∏ç‰ºöËÆ©Á≥ªÁªüÈô∑‰∫éÂÅúÈ°ø„ÄÇ 2.4 ÊïàÁéáÂØπ‰∫éÊï∞ÊçÆÁöÑÂçèËÆÆÔºåÈÄöËøáÊé®ÈÄÅÊï∞ÊçÆÂà∞ÂÆ¢Êà∑Á´ØÊúÄÂ§ßÈôêÂ∫¶Âú∞ÊèêÈ´òÊÄßËÉΩÂíåÂêûÂêêÈáèÁöÑÔºåËÄå‰∏çÊòØÁ≠âÂæÖÂÆ¢Êà∑Á´ØÊãâÊï∞ÊçÆ„ÄÇËøô‰∏™Ê¶ÇÂøµÔºåÁß∞‰πã‰∏∫ RDY Áä∂ÊÄÅÔºåÂü∫Êú¨‰∏äÊòØÂÆ¢Êà∑Á´ØÊµÅÈáèÊéßÂà∂ÁöÑ‰∏ÄÁßçÂΩ¢Âºè„ÄÇÂΩìÂÆ¢Êà∑Á´ØËøûÊé•Âà∞ nsqd ÂíåÂπ∂ËÆ¢ÈòÖÂà∞‰∏Ä‰∏™ÈÄöÈÅìÊó∂ÔºåÂÆÉË¢´ÊîæÁΩÆÂú®‰∏Ä‰∏™ RDY ‰∏∫ 0 Áä∂ÊÄÅ„ÄÇËøôÊÑèÂë≥ÁùÄÔºåËøòÊ≤°Êúâ‰ø°ÊÅØË¢´ÂèëÈÄÅÂà∞ÂÆ¢Êà∑Á´Ø„ÄÇÂΩìÂÆ¢Êà∑Á´ØÂ∑≤ÂáÜÂ§áÂ•ΩÊé•Êî∂Ê∂àÊÅØÂèëÈÄÅÔºåÊõ¥Êñ∞ÂÆÉÁöÑÂëΩ‰ª§ RDY Áä∂ÊÄÅÂà∞ÂÆÉÂáÜÂ§áÂ§ÑÁêÜÁöÑÊï∞ÈáèÔºåÊØîÂ¶Ç 100„ÄÇÊó†ÈúÄ‰ªª‰ΩïÈ¢ùÂ§ñÁöÑÊåá‰ª§ÔºåÂΩì 100 Êù°Ê∂àÊÅØÂèØÁî®Êó∂ÔºåÂ∞ÜË¢´‰º†ÈÄíÂà∞ÂÆ¢Êà∑Á´ØÔºàÊúçÂä°Âô®Á´Ø‰∏∫ÈÇ£‰∏™ÂÆ¢Êà∑Á´ØÊØèÊ¨°ÈÄíÂáè RDY ËÆ°Êï∞Ôºâ„ÄÇÂÆ¢Êà∑Á´ØÂ∫ìÁöÑË¢´ËÆæËÆ°ÊàêÂú® RDY Êï∞ËææÂà∞ÈÖçÁΩÆ max-in-flight ÁöÑ 25% ÂèëÈÄÅ‰∏Ä‰∏™ÂëΩ‰ª§Êù•Êõ¥Êñ∞ RDY ËÆ°Êï∞ÔºàÂπ∂ÈÄÇÂΩìËÄÉËôëËøûÊé•Âà∞Â§ö‰∏™ nsqd ÊÉÖÂÜµ‰∏ãÔºåÈÄÇÂΩìÂú∞ÂàÜÈÖçÔºâ„ÄÇ 2.5 ÂøÉË∑≥ÂíåË∂ÖÊó∂NSQ ÁöÑ TCP ÂçèËÆÆÊòØÈù¢Âêë push ÁöÑ„ÄÇÂú®Âª∫Á´ãËøûÊé•ÔºåÊè°ÊâãÔºåÂíåËÆ¢ÈòÖÂêéÔºåÊ∂àË¥πËÄÖË¢´ÊîæÁΩÆÂú®‰∏Ä‰∏™‰∏∫ 0 ÁöÑ RDY Áä∂ÊÄÅ„ÄÇÂΩìÊ∂àË¥πËÄÖÂáÜÂ§áÂ•ΩÊé•Êî∂Ê∂àÊÅØÔºåÂÆÉÊõ¥Êñ∞ÁöÑ RDY Áä∂ÊÄÅÂà∞ÂáÜÂ§áÊé•Êî∂Ê∂àÊÅØÁöÑÊï∞Èáè„ÄÇNSQ ÂÆ¢Êà∑Á´ØÂ∫ì‰∏çÊñ≠Âú®ÂπïÂêéÁÆ°ÁêÜÔºåÊ∂àÊÅØÊéßÂà∂ÊµÅÁöÑÁªìÊûú„ÄÇÊØèÈöî‰∏ÄÊÆµÊó∂Èó¥Ôºånsqd Â∞ÜÂèëÈÄÅ‰∏Ä‰∏™ÂøÉË∑≥Á∫øËøûÊé•„ÄÇÂÆ¢Êà∑Á´ØÂèØ‰ª•ÈÖçÁΩÆÂøÉË∑≥‰πãÈó¥ÁöÑÈó¥ÈöîÔºå‰ΩÜ nsqd ‰ºöÊúüÂæÖ‰∏Ä‰∏™ÂõûÂ∫îÂú®ÂÆÉÂèëÈÄÅ‰∏ã‰∏Ä‰∏™ÂøÉÊéâ‰πãÂâç„ÄÇÁªÑÂêàÂ∫îÁî®Á∫ßÂà´ÁöÑÂøÉË∑≥Âíå RDY Áä∂ÊÄÅÔºåÈÅøÂÖçÂ§¥ÈòªÂ°ûÁé∞Ë±°Ôºå‰πüÂèØËÉΩ‰ΩøÂøÉË∑≥Êó†Áî®ÔºàÂç≥ÔºåÂ¶ÇÊûúÊ∂àË¥πËÄÖÊòØÂú®ÂêéÈù¢ÁöÑÂ§ÑÁêÜÊ∂àÊÅØÊµÅÁöÑÊé•Êî∂ÁºìÂÜ≤Âå∫‰∏≠ÔºåÊìç‰ΩúÁ≥ªÁªüÂ∞ÜË¢´Â°´Êª°ÔºåÂ†µÂøÉË∑≥Ôºâ‰∏∫‰∫Ü‰øùËØÅËøõÂ∫¶ÔºåÊâÄÊúâÁöÑÁΩëÁªú IO Êó∂Èó¥‰∏äÈôêÂäøÂøÖ‰∏éÈÖçÁΩÆÁöÑÂøÉË∑≥Èó¥ÈöîÁõ∏ÂÖ≥ËÅî„ÄÇËøôÊÑèÂë≥ÁùÄÔºå‰Ω†ÂèØ‰ª•‰ªéÂ≠óÈù¢‰∏äÊãîÊéâ‰πãÈó¥ÁöÑÁΩëÁªúËøûÊé• nsqd ÂíåÊ∂àË¥πËÄÖÔºåÂÆÉ‰ºöÊ£ÄÊµãÂπ∂Ê≠£Á°ÆÂ§ÑÁêÜÈîôËØØ„ÄÇÂΩìÊ£ÄÊµãÂà∞‰∏Ä‰∏™Ëá¥ÂëΩÈîôËØØÔºåÂÆ¢Êà∑Á´ØËøûÊé•Ë¢´Âº∫Âà∂ÂÖ≥Èó≠„ÄÇÂú®‰º†Ëæì‰∏≠ÁöÑÊ∂àÊÅØ‰ºöË∂ÖÊó∂ËÄåÈáçÊñ∞ÊéíÈòüÁ≠âÂæÖ‰º†ÈÄíÂà∞Âè¶‰∏Ä‰∏™Ê∂àË¥πËÄÖ„ÄÇÊúÄÂêéÔºåÈîôËØØ‰ºöË¢´ËÆ∞ÂΩïÂπ∂Á¥ØËÆ°Âà∞ÂêÑÁßçÂÜÖÈÉ®ÊåáÊ†á„ÄÇ 2.6 ÂàÜÂ∏ÉÂºèÂõ†‰∏∫NSQÊ≤°ÊúâÂú®ÂÆàÊä§Á®ãÂ∫è‰πãÈó¥ÂÖ±‰∫´‰ø°ÊÅØÔºåÊâÄ‰ª•ÂÆÉ‰ªé‰∏ÄÂºÄÂßãÂ∞±ÊòØ‰∏∫‰∫ÜÂàÜÂ∏ÉÂºèÊìç‰ΩúËÄåÁîü„ÄÇ‰∏™Âà´ÁöÑÊú∫Âô®ÂèØ‰ª•Èöè‰æøÂÆïÊú∫Èöè‰æøÂêØÂä®ËÄå‰∏ç‰ºöÂΩ±ÂìçÂà∞Á≥ªÁªüÁöÑÂÖ∂‰ΩôÈÉ®ÂàÜÔºåÊ∂àÊÅØÂèëÂ∏ÉËÄÖÂèØ‰ª•Âú®Êú¨Âú∞ÂèëÂ∏ÉÔºåÂç≥‰ΩøÈù¢ÂØπÁΩëÁªúÂàÜÂå∫„ÄÇËøôÁßç‚ÄúÂàÜÂ∏ÉÂºè‰ºòÂÖà‚ÄùÁöÑËÆæËÆ°ÁêÜÂøµÊÑèÂë≥ÁùÄNSQÂü∫Êú¨‰∏äÂèØ‰ª•Ê∞∏Ëøú‰∏çÊñ≠Âú∞Êâ©Â±ïÔºåÈúÄË¶ÅÊõ¥È´òÁöÑÂêûÂêêÈáèÔºüÈÇ£Â∞±Ê∑ªÂä†Êõ¥Â§öÁöÑnsqdÂêß„ÄÇÂîØ‰∏ÄÁöÑÂÖ±‰∫´Áä∂ÊÄÅÂ∞±ÊòØ‰øùÂ≠òÂú®lookupËäÇÁÇπ‰∏äÔºåÁîöËá≥ÂÆÉ‰ª¨‰∏çÈúÄË¶ÅÂÖ®Â±ÄËßÜÂõæÔºåÈÖçÁΩÆÊüê‰∫õnsqdÊ≥®ÂÜåÂà∞Êüê‰∫õlookupËäÇÁÇπ‰∏äËøôÊòØÂæàÁÆÄÂçïÁöÑÈÖçÁΩÆÔºåÂîØ‰∏ÄÂÖ≥ÈîÆÁöÑÂú∞ÊñπÂ∞±ÊòØÊ∂àË¥πËÄÖÂèØ‰ª•ÈÄöËøálookupËäÇÁÇπËé∑ÂèñÊâÄÊúâÂÆåÊï¥ÁöÑËäÇÁÇπÈõÜ„ÄÇÊ∏ÖÊô∞ÁöÑÊïÖÈöú‰∫ã‰ª∂‚Äî‚ÄîNSQÂú®ÁªÑ‰ª∂ÂÜÖÂª∫Á´ã‰∫Ü‰∏ÄÂ•óÊòéÁ°ÆÂÖ≥‰∫éÂèØËÉΩÂØºËá¥ÊïÖÈöúÁöÑÁöÑÊïÖÈöúÊùÉË°°Êú∫Âà∂ÔºåËøôÂØπÊ∂àÊÅØ‰º†ÈÄíÂíåÊÅ¢Â§çÈÉΩÊúâÊÑè‰πâ„ÄÇËôΩÁÑ∂ÂÆÉ‰ª¨ÂèØËÉΩ‰∏çÂÉèKafkaÁ≥ªÁªüÈÇ£Ê†∑Êèê‰æõ‰∏•Ê†ºÁöÑ‰øùËØÅÁ∫ßÂà´Ôºå‰ΩÜNSQÁÆÄÂçïÁöÑÊìç‰Ωú‰ΩøÊïÖÈöúÊÉÖÂÜµÈùûÂ∏∏ÊòéÊòæ„ÄÇ 2.7 no replication‰∏çÂÉèÂÖ∂‰ªñÁöÑÈòüÂàóÁªÑ‰ª∂ÔºåNSQÂπ∂Ê≤°ÊúâÊèê‰æõ‰ªª‰ΩïÂΩ¢ÂºèÁöÑÂ§çÂà∂ÂíåÈõÜÁæ§Ôºå‰πüÊ≠£ÊòØËøôÁÇπËÆ©ÂÆÉËÉΩÂ§üÂ¶ÇÊ≠§ÁÆÄÂçïÂú∞ËøêË°åÔºå‰ΩÜÂÆÉÁ°ÆÂÆûÂØπ‰∫é‰∏Ä‰∫õÈ´ò‰øùËØÅÊÄßÈ´òÂèØÈù†ÊÄßÁöÑÊ∂àÊÅØÂèëÂ∏ÉÊ≤°ÊúâË∂≥Â§üÁöÑ‰øùËØÅ„ÄÇÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÈôç‰ΩéÊñá‰ª∂ÂêåÊ≠•ÁöÑÊó∂Èó¥Êù•ÈÉ®ÂàÜÈÅøÂÖçÔºåÂè™ÈúÄÈÄöËøá‰∏Ä‰∏™Ê†áÂøóÈÖçÁΩÆÔºåÈÄöËøáEBSÊîØÊåÅÊàë‰ª¨ÁöÑÈòüÂàó„ÄÇ‰ΩÜÊòØËøôÊ†∑‰ªçÁÑ∂Â≠òÂú®‰∏Ä‰∏™Ê∂àÊÅØË¢´ÂèëÂ∏ÉÂêéÈ©¨‰∏äÊ≠ª‰∫°Ôºå‰∏¢Â§±‰∫ÜÊúâÊïàÁöÑÂÜôÂÖ•ÁöÑÊÉÖÂÜµ„ÄÇ 2.8 Ê≤°Êúâ‰∏•Ê†ºÁöÑÈ°∫Â∫èËôΩÁÑ∂KafkaÁî±‰∏Ä‰∏™ÊúâÂ∫èÁöÑÊó•ÂøóÊûÑÊàêÔºå‰ΩÜNSQ‰∏çÊòØ„ÄÇÊ∂àÊÅØÂèØ‰ª•Âú®‰ªª‰ΩïÊó∂Èó¥‰ª•‰ªª‰ΩïÈ°∫Â∫èËøõÂÖ•ÈòüÂàó„ÄÇÂú®Êàë‰ª¨‰ΩøÁî®ÁöÑÊ°à‰æã‰∏≠ÔºåËøôÈÄöÂ∏∏Ê≤°ÊúâÂÖ≥Á≥ªÔºåÂõ†‰∏∫ÊâÄÊúâÁöÑÊï∞ÊçÆÈÉΩË¢´Âä†‰∏ä‰∫ÜÊó∂Èó¥Êà≥Ôºå‰ΩÜÂÆÉÂπ∂‰∏çÈÄÇÂêàÈúÄË¶Å‰∏•Ê†ºÈ°∫Â∫èÁöÑÊÉÖÂÜµ„ÄÇ 2.9 Êó†Êï∞ÊçÆÈáçÂ§çÂà†Èô§ÂäüËÉΩNSQÂØπ‰∫éË∂ÖÊó∂Á≥ªÁªüÔºåÂÆÉ‰ΩøÁî®‰∫ÜÂøÉË∑≥Ê£ÄÊµãÊú∫Âà∂ÂéªÊµãËØïÊ∂àË¥πËÄÖÊòØÂê¶Â≠òÊ¥ªËøòÊòØÊ≠ª‰∫°„ÄÇÂæàÂ§öÂéüÂõ†‰ºöÂØºËá¥Êàë‰ª¨ÁöÑconsumerÊó†Ê≥ïÂÆåÊàêÂøÉË∑≥Ê£ÄÊµãÔºåÊâÄ‰ª•Âú®consumer‰∏≠ÂøÖÈ°ªÊúâ‰∏Ä‰∏™ÂçïÁã¨ÁöÑÊ≠•È™§Á°Æ‰øùÂπÇÁ≠âÊÄß„ÄÇ 3. ÂÆûË∑µÂÆâË£ÖËøáÁ®ãÊú¨ÊñáÂ∞ÜnsqÈõÜÁæ§ÂÖ∑‰ΩìÁöÑÂÆâË£ÖËøáÁ®ãÁï•ÂéªÔºåÂ§ßÂÆ∂ÂèØ‰ª•Ëá™Ë°åÂèÇËÄÉÂÆòÁΩëÔºåÊØîËæÉÁÆÄÂçï„ÄÇËøôÈÉ®ÂàÜ‰ªãÁªç‰∏ãÁ¨îËÄÖÂÆûÈ™åÁöÑÊãìÊâëÔºå‰ª•ÂèänsqadminÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØ„ÄÇ 3.1 ÊãìÊâëÁªìÊûÑ ÂÆûÈ™åÈááÁî®3Âè∞NSQDÊúçÂä°Ôºå2Âè∞LOOKUPDÊúçÂä°„ÄÇÈááÁî®ÂÆòÊñπÊé®ËçêÁöÑÊãìÊâëÔºåÊ∂àÊÅØÂèëÂ∏ÉÁöÑÊúçÂä°ÂíåNSQDÂú®‰∏ÄÂè∞‰∏ªÊú∫„ÄÇ‰∏ÄÂÖ±5Âè∞Êú∫Âô®„ÄÇNSQÂü∫Êú¨Ê≤°ÊúâÈÖçÁΩÆÊñá‰ª∂ÔºåÈÖçÁΩÆÈÄöËøáÂëΩ‰ª§Ë°åÊåáÂÆöÂèÇÊï∞„ÄÇ‰∏ªË¶ÅÂëΩ‰ª§Â¶Ç‰∏ã:LOOKUPDÂëΩ‰ª§ 1bin/nsqlookupd NSQDÂëΩ‰ª§ 1bin/nsqd --lookupd-tcp-address=172.16.30.254:4160 -broadcast-address=172.16.30.254 1bin/nsqadmin --lookupd-http-address=172.16.30.254:4161 Â∑•ÂÖ∑Á±ªÔºåÊ∂àË¥πÂêéÂ≠òÂÇ®Âà∞Êú¨Âú∞Êñá‰ª∂„ÄÇ 1bin/nsq_to_file --topic=newtest --channel=test --output-dir=/tmp --lookupd-http-address=172.16.30.254:4161 ÂèëÂ∏É‰∏ÄÊù°Ê∂àÊÅØ1curl -d 'hello world 5' 'http://172.16.30.254:4151/put?topic=test' 3.2 nsqadminÂØπStreamsÁöÑËØ¶ÁªÜ‰ø°ÊÅØËøõË°åÊü•ÁúãÔºåÂåÖÊã¨NSQDËäÇÁÇπÔºåÂÖ∑‰ΩìÁöÑchannelÔºåÈòüÂàó‰∏≠ÁöÑÊ∂àÊÅØÊï∞ÔºåËøûÊé•Êï∞Á≠â‰ø°ÊÅØ„ÄÇ ÂàóÂá∫ÊâÄÊúâÁöÑNSQDËäÇÁÇπ: Ê∂àÊÅØÁöÑÁªüËÆ°: lookup‰∏ªÊú∫ÁöÑÂàóË°®: 4. ÊÄªÁªìNSQÂü∫Êú¨Ê†∏ÂøÉÂ∞±ÊòØÁÆÄÂçïÊÄßÔºåÊòØ‰∏Ä‰∏™ÁÆÄÂçïÁöÑÈòüÂàóÔºåËøôÊÑèÂë≥ÁùÄÂÆÉÂæàÂÆπÊòìËøõË°åÊïÖÈöúÊé®ÁêÜÂíåÂæàÂÆπÊòìÂèëÁé∞bug„ÄÇÊ∂àË¥πËÄÖÂèØ‰ª•Ëá™Ë°åÂ§ÑÁêÜÊïÖÈöú‰∫ã‰ª∂ËÄå‰∏ç‰ºöÂΩ±ÂìçÁ≥ªÁªüÂâ©‰∏ãÁöÑÂÖ∂‰ΩôÈÉ®ÂàÜ„ÄÇ ‰∫ãÂÆû‰∏äÔºåÁÆÄÂçïÊÄßÊòØÊàë‰ª¨ÂÜ≥ÂÆö‰ΩøÁî®NSQÁöÑÈ¶ñË¶ÅÂõ†Á¥†ÔºåËøôÊñπ‰æø‰∏éÊàë‰ª¨ÁöÑËÆ∏Â§öÂÖ∂‰ªñËΩØ‰ª∂‰∏ÄËµ∑Áª¥Êä§ÔºåÈÄöËøáÂºïÂÖ•ÈòüÂàó‰ΩøÊàë‰ª¨ÂæóÂà∞‰∫ÜÂ†™Áß∞ÂÆåÁæéÁöÑË°®Áé∞ÔºåÈÄöËøáÈòüÂàóÁîöËá≥ËÆ©Êàë‰ª¨Â¢ûÂä†‰∫ÜÂá†‰∏™Êï∞ÈáèÁ∫ßÁöÑÂêûÂêêÈáè„ÄÇË∂äÊù•Ë∂äÂ§öÁöÑconsumerÈúÄË¶Å‰∏ÄÂ•ó‰∏•Ê†ºÂèØÈù†ÊÄßÂíåÈ°∫Â∫èÊÄß‰øùÈöúÔºåËøôÂ∑≤ÁªèË∂ÖËøá‰∫ÜNSQÊèê‰æõÁöÑÁÆÄÂçïÂäüËÉΩ„ÄÇ ÁªìÂêàÊàë‰ª¨ÁöÑ‰∏öÂä°Á≥ªÁªüÊù•ÁúãÔºåÂØπ‰∫éÊàë‰ª¨ÊâÄÈúÄË¶Å‰º†ËæìÁöÑÂèëÁ•®Ê∂àÊÅØÔºåÁõ∏ÂØπÊØîËæÉÊïèÊÑüÔºåÊó†Ê≥ïÂÆπÂøçÊüê‰∏™nsqdÂÆïÊú∫ÔºåÊàñËÄÖÁ£ÅÁõòÊó†Ê≥ï‰ΩøÁî®ÁöÑÊÉÖÂÜµÔºåËØ•ËäÇÁÇπÂ†ÜÁßØÁöÑÊ∂àÊÅØÊó†Ê≥ïÊâæÂõû„ÄÇËøôÊòØÊàë‰ª¨Ê≤°ÊúâÈÄâÊã©ËØ•Ê∂àÊÅØ‰∏≠Èó¥‰ª∂ÁöÑ‰∏ªË¶ÅÂéüÂõ†„ÄÇÁÆÄÂçïÊÄßÂíåÂèØÈù†ÊÄß‰ºº‰πéÂπ∂‰∏çËÉΩÂÆåÂÖ®Êª°Ë∂≥„ÄÇÁõ∏ÊØîKafkaÔºåopsËÇ©Ë¥üËµ∑Êõ¥Â§öË¥üË¥£ÁöÑËøêËê•„ÄÇÂè¶‰∏ÄÊñπÈù¢ÔºåÂÆÉÊã•Êúâ‰∏Ä‰∏™ÂèØÂ§çÂà∂ÁöÑ„ÄÅÊúâÂ∫èÁöÑÊó•ÂøóÂèØ‰ª•Êèê‰æõÁªôÊàë‰ª¨Êõ¥Â•ΩÁöÑÊúçÂä°„ÄÇ‰ΩÜÂØπ‰∫éÂÖ∂‰ªñÈÄÇÂêàNSQÁöÑconsumerÔºåÂÆÉ‰∏∫Êàë‰ª¨ÊúçÂä°ÁöÑÁõ∏ÂΩìÂ•ΩÔºåÊàë‰ª¨ÊúüÂæÖÁùÄÁªßÁª≠Â∑©Âõ∫ÂÆÉÁöÑÂùöÂÆûÁöÑÂü∫Á°Ä„ÄÇ ps: Êú¨ÊñáÈ¶ñÂèë‰∫éÁ¨îËÄÖÁöÑcsdnÂçöÂÆ¢ÔºåÊ≠§Â§ÑÂ∞ÜÂÖ∂Âä†ÂÖ•‰∏™‰∫∫ÁöÑÂçöÂÆ¢„ÄÇ ÂèÇËÄÉ NSQÔºöÂàÜÂ∏ÉÂºèÁöÑÂÆûÊó∂Ê∂àÊÅØÂπ≥Âè∞ NSQ - NYC Golang Meetup NSQ Docs]]></content>
      <categories>
        <category>‰∏≠Èó¥‰ª∂</category>
      </categories>
      <tags>
        <tag>Cluster</tag>
        <tag>mq</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Lombok‰ΩøÁî®‰∏éÂéüÁêÜ]]></title>
    <url>%2F2017%2F10%2F06%2Flombok%2F</url>
    <content type="text"><![CDATA[1. LombokÁÆÄ‰ªãÈ¶ñÂÖàLombokÊòØ‰∏ÄÊ¨æJava IDEÁöÑÂ∫îÁî®Â∑•ÂÖ∑Êèí‰ª∂Ôºå‰∏Ä‰∏™ÂèØ‰ª•ÈÄöËøáÁÆÄÂçïÁöÑÊ≥®Ëß£ÂΩ¢ÂºèÊù•Â∏ÆÂä©Êàë‰ª¨ÁÆÄÂåñÊ∂àÈô§‰∏Ä‰∫õÂøÖÈ°ªÊúâ‰ΩÜÊòæÂæóÂæàËáÉËÇøÁöÑJava‰ª£Á†ÅÁöÑÂ∑•ÂÖ∑ÔºåÊØîÂ¶ÇÂ±ûÊÄßÁöÑÊûÑÈÄ†Âô®„ÄÅgetter„ÄÅsetter„ÄÅequals„ÄÅhashcode„ÄÅtoStringÊñπÊ≥ï„ÄÇÁªìÂêàIDEÔºåÈÄöËøá‰ΩøÁî®ÂØπÂ∫îÁöÑÊ≥®Ëß£ÔºåÂèØ‰ª•Âú®ÁºñËØëÊ∫êÁ†ÅÁöÑÊó∂ÂÄôÁîüÊàêÂØπÂ∫îÁöÑÊñπÊ≥ï„ÄÇÂÆòÊñπÂú∞ÂùÄÔºöhttps://projectlombok.org/„ÄÇ ËôΩÁÑ∂‰∏äËø∞ÁöÑÈÇ£‰∫õÂ∏∏Áî®ÊñπÊ≥ïIDEÈÉΩËÉΩÁîüÊàêÔºå‰ΩÜÊòØlombokÊõ¥Âä†ÁÆÄÊ¥Å‰∏éÊñπ‰æøÔºåËÉΩÂ§üËææÂà∞ÁöÑÊïàÊûúÂ∞±ÊòØÂú®Ê∫êÁ†Å‰∏≠‰∏çÈúÄË¶ÅÂÜô‰∏Ä‰∫õÈÄöÁî®ÁöÑÊñπÊ≥ïÔºå‰ΩÜÊòØÂú®ÁºñËØëÁîüÊàêÁöÑÂ≠óËäÇÁ†ÅÊñá‰ª∂‰∏≠‰ºöÂ∏ÆÊàë‰ª¨ÁîüÊàêËøô‰∫õÊñπÊ≥ïÔºåËøôÂ∞±ÊòØlombokÁöÑÁ•ûÂ•á‰ΩúÁî®„ÄÇ 2. ÂÆâË£Ö2.1 Êèí‰ª∂ÂÆâË£ÖÁ¨îËÄÖ‰∏ªË¶Å‰ΩøÁî®ÁöÑIDEÊòØIntellij ideaÔºåÁºñËØëÂô®ÈúÄË¶ÅÂú® 1preference-&gt;plugins-&gt;Browse repositories ÊêúÁ¥¢lombokÔºåÁÑ∂ÂêéÂÆâË£ÖpluginsÔºåÈúÄË¶ÅÁ®çÁ≠âÁâáÂàª„ÄÇÁ¨îËÄÖÊà™ÂõæÂ∑≤ÁªèÂÆâË£ÖÂ•Ω„ÄÇ 2.2 Ê∑ªÂä†jarÂåÖÂú®È°πÁõÆ‰∏≠Ê∑ªÂä†lombokÁöÑjarÂåÖÔºåÁ¨îËÄÖÁî®ÁöÑÊòØmavenÔºåÊâÄ‰ª•Âú®pomÊñá‰ª∂‰∏≠Ê∑ªÂä†‰∫ÜÂ¶Ç‰∏ãÁöÑ‰æùËµñ„ÄÇgradle‰ΩøÁî®ËßÅÂÆòÁΩë„ÄÇ 123456&lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.16.16&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt; 3. ‰ΩøÁî®lombok‰∏ªË¶ÅÈÄöËøáÊ≥®Ëß£Ëµ∑‰ΩúÁî®ÔºåËØ¶ÁªÜÁöÑÊ≥®Ëß£ËßÅLombok features„ÄÇ With Lombok: 12345678910111213import lombok.AllArgsConstructor;import lombok.Data;import lombok.NoArgsConstructor;import java.io.Serializable;@Data@AllArgsConstructorpublic class UserEntity implements Serializable &#123; private long userId; private String userName; private String sex;&#125; ÁºñËØëÂêéÔºö 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697import java.beans.ConstructorProperties;import java.io.Serializable;public class UserEntity implements Serializable &#123; private long userId; private String userName; private String sex; public long getUserId() &#123; return this.userId; &#125; public String getUserName() &#123; return this.userName; &#125; public String getSex() &#123; return this.sex; &#125; public void setUserId(long userId) &#123; this.userId = userId; &#125; public void setUserName(String userName) &#123; this.userName = userName; &#125; public void setSex(String sex) &#123; this.sex = sex; &#125; public boolean equals(Object o) &#123; if(o == this) &#123; return true; &#125; else if(!(o instanceof UserEntity)) &#123; return false; &#125; else &#123; UserEntity other = (UserEntity)o; if(!other.canEqual(this)) &#123; return false; &#125; else if(this.getUserId() != other.getUserId()) &#123; return false; &#125; else &#123; Object this$userName = this.getUserName(); Object other$userName = other.getUserName(); if(this$userName == null) &#123; if(other$userName != null) &#123; return false; &#125; &#125; else if(!this$userName.equals(other$userName)) &#123; return false; &#125; Object this$sex = this.getSex(); Object other$sex = other.getSex(); if(this$sex == null) &#123; if(other$sex != null) &#123; return false; &#125; &#125; else if(!this$sex.equals(other$sex)) &#123; return false; &#125; return true; &#125; &#125; &#125; protected boolean canEqual(Object other) &#123; return other instanceof UserEntity; &#125; public int hashCode() &#123; int PRIME = true; int result = 1; long $userId = this.getUserId(); int result = result * 59 + (int)($userId &gt;&gt;&gt; 32 ^ $userId); Object $userName = this.getUserName(); result = result * 59 + ($userName == null?43:$userName.hashCode()); Object $sex = this.getSex(); result = result * 59 + ($sex == null?43:$sex.hashCode()); return result; &#125; public String toString() &#123; return "UserEntity(userId=" + this.getUserId() + ", userName=" + this.getUserName() + ", sex=" + this.getSex() + ")"; &#125; @ConstructorProperties(&#123;"userId", "userName", "sex"&#125;) public UserEntity(long userId, String userName, String sex) &#123; this.userId = userId; this.userName = userName; this.sex = sex; &#125;&#125; ËøôËæπ‰ªãÁªçÁ¨îËÄÖÁªèÂ∏∏‰ΩøÁî®Âà∞ÁöÑÊ≥®Ëß£„ÄÇ valÔºåÁî®Âú®Â±ÄÈÉ®ÂèòÈáèÂâçÈù¢ÔºåÁõ∏ÂΩì‰∫éÂ∞ÜÂèòÈáèÂ£∞Êòé‰∏∫final @ValueÁî®Âú®Á±ª‰∏äÔºåÊòØ@DataÁöÑ‰∏çÂèØÂèòÂΩ¢ÂºèÔºåÁõ∏ÂΩì‰∫é‰∏∫Â±ûÊÄßÊ∑ªÂä†finalÂ£∞ÊòéÔºåÂè™Êèê‰æõgetterÊñπÊ≥ïÔºåËÄå‰∏çÊèê‰æõsetterÊñπÊ≥ï @Data@ToString, @EqualsAndHashCode, ÊâÄÊúâÂ±ûÊÄßÁöÑ@Getter, ÊâÄÊúânon-finalÂ±ûÊÄßÁöÑ@SetterÂíå@RequiredArgsConstructorÁöÑÁªÑÂêàÔºåÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÔºåÊàë‰ª¨‰ΩøÁî®Ëøô‰∏™Ê≥®Ëß£Â∞±Ë∂≥Â§ü‰∫Ü„ÄÇ @NoArgsConstructorÊó†ÂèÇÊûÑÈÄ†Âô® @AllArgsConstructorÂÖ®ÂèÇÊûÑÈÄ†Âô® @ToString ÁîüÊàêtoStringÊñπÊ≥ïÔºåÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºå‰ºöËæìÂá∫Á±ªÂêç„ÄÅÊâÄÊúâÂ±ûÊÄßÔºåÂ±ûÊÄß‰ºöÊåâÁÖßÈ°∫Â∫èËæìÂá∫Ôºå‰ª•ÈÄóÂè∑ÂàÜÂâ≤„ÄÇ @EqualsAndHashCodeÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºå‰ºö‰ΩøÁî®ÊâÄÊúâÈùûÁû¨ÊÄÅ(non-transient)ÂíåÈùûÈùôÊÄÅ(non-static)Â≠óÊÆµÊù•ÁîüÊàêequalsÂíåhascodeÊñπÊ≥ïÔºå‰πüÂèØ‰ª•ÊåáÂÆöÂÖ∑‰Ωì‰ΩøÁî®Âì™‰∫õÂ±ûÊÄß„ÄÇ @Getter / @Setter‰∏äÈù¢Â∑≤ÁªèËØ¥ËøáÔºå‰∏ÄËà¨Áî®@dataÂ∞±‰∏çÁî®È¢ùÂ§ñÂä†Ëøô‰∏™Ê≥®Ëß£‰∫Ü„ÄÇÂèØ‰ª•‰ΩúÁî®Âú®Á±ª‰∏äÂíåÂ±ûÊÄß‰∏äÔºåÊîæÂú®Á±ª‰∏äÔºå‰ºöÂØπÊâÄÊúâÁöÑÈùûÈùôÊÄÅ(non-static)Â±ûÊÄßÁîüÊàêGetter/SetterÊñπÊ≥ïÔºåÊîæÂú®Â±ûÊÄß‰∏äÔºå‰ºöÂØπËØ•Â±ûÊÄßÁîüÊàêGetter/SetterÊñπÊ≥ï„ÄÇÂπ∂ÂèØ‰ª•ÊåáÂÆöGetter/SetterÊñπÊ≥ïÁöÑËÆøÈóÆÁ∫ßÂà´„ÄÇ @NonNullÔºåÁªôÊñπÊ≥ïÂèÇÊï∞Â¢ûÂä†Ëøô‰∏™Ê≥®Ëß£‰ºöËá™Âä®Âú®ÊñπÊ≥ïÂÜÖÂØπËØ•ÂèÇÊï∞ËøõË°åÊòØÂê¶‰∏∫Á©∫ÁöÑÊ†°È™åÔºåÂ¶ÇÊûú‰∏∫Á©∫ÔºåÂàôÊäõÂá∫NPEÔºàNullPointerExceptionÔºâ @CleanupËá™Âä®ÁÆ°ÁêÜËµÑÊ∫êÔºåÁî®Âú®Â±ÄÈÉ®ÂèòÈáè‰πãÂâçÔºåÂú®ÂΩìÂâçÂèòÈáèËåÉÂõ¥ÂÜÖÂç≥Â∞ÜÊâßË°åÂÆåÊØïÈÄÄÂá∫‰πãÂâç‰ºöËá™Âä®Ê∏ÖÁêÜËµÑÊ∫êÔºåËá™Âä®ÁîüÊàêtry-finallyËøôÊ†∑ÁöÑ‰ª£Á†ÅÊù•ÂÖ≥Èó≠ÊµÅ @LogÊ†πÊçÆ‰∏çÂêåÁöÑÊ≥®Ëß£ÁîüÊàê‰∏çÂêåÁ±ªÂûãÁöÑlogÂØπË±°Ôºå‰ΩÜÊòØÂÆû‰æãÂêçÁß∞ÈÉΩÊòØlogÔºåÊúâ7ÁßçÂèØÈÄâÂÆûÁé∞Á±ªÔºö 1). @Log4j 1private static final org.apache.log4j.Logger log = org.apache.log4j.Logger.getLogger(LogExample.class); 2). @Log4j2 1private static final org.apache.logging.log4j.Logger log = org.apache.logging.log4j.LogManager.getLogger(LogExample.class); 3). @Slf4j 1private static final org.slf4j.Logger log = org.slf4j.LoggerFactory.getLogger(LogExample.class); 4). @XSlf4j 1private static final org.slf4j.ext.XLogger log = org.slf4j.ext.XLoggerFactory.getXLogger(LogExample.class); 5). @CommonsLog 1private static final org.apache.commons.logging.Log log = org.apache.commons.logging.LogFactory.getLog(LogExample.class); 6). @JBossLog 1private static final org.jboss.logging.Logger log = org.jboss.logging.Logger.getLogger(LogExample.class); 7). @Log private static final java.util.logging.Logger log = java.util.logging.Logger.getLogger(LogExample.class.getName()); ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåloggerÁöÑÂêçÂ≠óÂ∞Ü‰ºöÊòØË¢´@LogÊ≥®Ëß£ÁöÑÈÇ£‰∏™Á±ªÁöÑÂêçÂ≠ó„ÄÇÂΩìÁÑ∂Ëøô‰πüÂèØ‰ª•Ë¢´‰∏™ÊÄßÂåñÂëΩÂêçÔºåÈÄöËøátopicÂèÇÊï∞ÔºåÂ¶Ç@XSlf4j(topic=&quot;reporting&quot;)„ÄÇ 4. ÂéüÁêÜlombok ‰∏ªË¶ÅÈÄöËøáÊ≥®Ëß£ÁîüÊïàÔºåËá™jdk5ÂºïÂÖ•Ê≥®Ëß£ÔºåÁî±‰∏§ÁßçËß£ÊûêÊñπÂºè„ÄÇÁ¨¨‰∏ÄÁßçÊòØËøêË°åÊó∂Ëß£ÊûêÔºå@Retention(RetentionPolicy.RUNTIME), ÂÆö‰πâÊ≥®Ëß£ÁöÑ‰øùÁïôÁ≠ñÁï•ÔºåËøôÊ†∑ÂèØ‰ª•ÈÄöËøáÂèçÂ∞ÑÊãøÂà∞ËØ•Ê≥®Ëß£„ÄÇÂè¶‰∏ÄÁßçÊòØÁºñËØëÊó∂Ëß£ÊûêÔºåÊúâ‰∏§ÁßçÊú∫Âà∂„ÄÇ Annotation Processing ToolÔºåaptËá™JDK5‰∫ßÁîüÔºåJDK7Â∑≤Ê†áËÆ∞‰∏∫ËøáÊúüÔºå‰∏çÊé®Ëçê‰ΩøÁî®ÔºåJDK8‰∏≠Â∑≤ÂΩªÂ∫ïÂà†Èô§ÔºåËá™JDK6ÂºÄÂßãÔºåÂèØ‰ª•‰ΩøÁî®Pluggable Annotation Processing APIÊù•ÊõøÊç¢ÂÆÉÔºåaptË¢´ÊõøÊç¢‰∏ªË¶ÅÊúâ2ÁÇπÂéüÂõ†„ÄÇapiÈÉΩÂú®com.sun.mirrorÈùûÊ†áÂáÜÂåÖ‰∏ãÔºåËøòÊúâÂ∞±ÊòØÊ≤°ÊúâÈõÜÊàêÂà∞javac‰∏≠ÔºåÈúÄË¶ÅÈ¢ùÂ§ñËøêË°å„ÄÇ Pluggable Annotation Processing APIlombok‰ΩøÁî®ËøôÁßçÊñπÂºèÂÆûÁé∞ÔºåÂü∫‰∫éJSR 269ÔºåËá™JDK6Âä†ÂÖ•Ôºå‰Ωú‰∏∫aptÁöÑÊõø‰ª£ÊñπÊ°àÔºåÂÆÉËß£ÂÜ≥‰∫ÜaptÁöÑ‰∏§‰∏™ÈóÆÈ¢òÔºåjavacÂú®ÊâßË°åÁöÑÊó∂ÂÄô‰ºöË∞ÉÁî®ÂÆûÁé∞‰∫ÜËØ•APIÁöÑÁ®ãÂ∫èÔºåËøôÊ†∑Êàë‰ª¨Â∞±ÂèØ‰ª•ÂØπÁºñËØëÂô®ÂÅö‰∏Ä‰∫õÂ¢ûÂº∫ÔºåËøôÊó∂javacÊâßË°åÁöÑËøáÁ®ãÂ¶Ç‰∏ãÔºö 5. ÊÄªÁªìËøôÁØáÊñáÁ´†‰∏ªË¶ÅËÆ≤Ëß£‰∫ÜlombokÁöÑÂÖ•Èó®‰∏é‰ΩøÁî®„ÄÇ‰ªãÁªç‰∫Ü‰∏Ä‰∫õÂ∏∏Áî®ÁöÑlombokÊ≥®Ëß£ÔºåÂ§ßÂ§ßÁÆÄÂåñ‰∫ÜÊàë‰ª¨ÁöÑÂºÄÂèëÂ∑•‰ΩúÂíå‰ª£Á†ÅÁöÑÁÆÄÊ¥ÅÊÄß„ÄÇÂΩìÁÑ∂Ôºålombok‰∏çÊîØÊåÅÂ§öÁßçÂèÇÊï∞ÊûÑÈÄ†Âô®ÁöÑÈáçËΩΩÔºåÂ∑•ÂÖ∑ÊØïÁ´üÊòØÂ∑•ÂÖ∑ÔºåÊàëÊÑüËßâÂπ∂‰∏ç‰ºöÊúâÈùûÂ∏∏ÂÆåÁæéÈÄÇÂêàÊØè‰∏™‰∫∫ÁöÑÂ∑•ÂÖ∑„ÄÇÊúÄÂêéÔºåÊàë‰∏™‰∫∫ËøòÊòØÂæàÊé®ËçêËøôÊ¨æÊèí‰ª∂ÁöÑÔºåÊØïÁ´üÊàëÂæàÊáíÔºåüòÜ„ÄÇ ÂèÇËÄÉ Lombok Docs JavaÂ•áÊ∑´Â∑ßÊäÄ‰πãLombok]]></content>
      <categories>
        <category>Utils</category>
      </categories>
      <tags>
        <tag>Lombok</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redis ClusterÊ∑±ÂÖ•‰∏éÂÆûË∑µ]]></title>
    <url>%2F2017%2F09%2F29%2Frediscluster%2F</url>
    <content type="text"><![CDATA[1. redis‰ªãÁªçwww.redis.ioredisÊòØ‰∏Ä‰∏™Âü∫‰∫éÂÜÖÂ≠òÁöÑK-VÂ≠òÂÇ®Êï∞ÊçÆÂ∫ì„ÄÇÊîØÊåÅÂ≠òÂÇ®ÁöÑÁ±ªÂûãÊúâstring,list,set,zset(sorted set),hashÁ≠â„ÄÇËøô‰∫õÊï∞ÊçÆÁ±ªÂûãÈÉΩÊîØÊåÅpush/pop„ÄÅadd/removeÂèäÂèñ‰∫§ÈõÜÂπ∂ÈõÜÂíåÂ∑ÆÈõÜÂèäÊõ¥‰∏∞ÂØåÁöÑÊìç‰ΩúÔºåËÄå‰∏îËøô‰∫õÊìç‰ΩúÈÉΩÊòØÂéüÂ≠êÊÄßÁöÑ„ÄÇredisÊîØÊåÅÂêÑÁßç‰∏çÂêåÊñπÂºèÁöÑÊéíÂ∫è„ÄÇ‰øùËØÅÊïàÁéáÁöÑÊÉÖÂÜµ‰∏ãÔºåÊï∞ÊçÆÁºìÂ≠òÂú®ÂÜÖÂ≠ò‰∏≠„ÄÇÂêåÊó∂redisÊèê‰æõ‰∫ÜÊåÅ‰πÖÂåñÁ≠ñÁï•Ôºå‰∏çÂêåÁöÑÁ≠ñÁï•Ëß¶ÂèëÂêåÊ≠•Âà∞Á£ÅÁõòÊàñËÄÖÊää‰øÆÊîπÊìç‰ΩúÂÜôÂÖ•ËøΩÂä†ÁöÑËÆ∞ÂΩïÊñá‰ª∂ÔºåÂú®Ê≠§Âü∫Á°Ä‰∏äÂÆûÁé∞‰∫Ümaster-slave„ÄÇ ÂÆÉÊòØ‰∏Ä‰∏™È´òÊÄßËÉΩÁöÑÂ≠òÂÇ®Á≥ªÁªüÔºåËÉΩÊîØÊåÅË∂ÖËøá 100K+ ÊØèÁßíÁöÑËØªÂÜôÈ¢ëÁéá„ÄÇÂêåÊó∂ËøòÊîØÊåÅÊ∂àÊÅØÁöÑÂèëÂ∏É/ËÆ¢ÈòÖÔºå‰ªéËÄåËÆ©‰Ω†Âú®ÊûÑÂª∫È´òÊÄßËÉΩÊ∂àÊÅØÈòüÂàóÁ≥ªÁªüÊó∂Â§ö‰∫ÜÂè¶‰∏ÄÁßçÈÄâÊã©„ÄÇ RedisÊîØÊåÅ‰∏ª‰ªéÂêåÊ≠•„ÄÇÊï∞ÊçÆÂèØ‰ª•‰ªé‰∏ªÊúçÂä°Âô®Âêë‰ªªÊÑèÊï∞ÈáèÁöÑ‰ªéÊúçÂä°Âô®‰∏äÂêåÊ≠•Ôºå‰ªéÊúçÂä°Âô®ÂèØ‰ª•ÊòØÂÖ≥ËÅîÂÖ∂‰ªñ‰ªéÊúçÂä°Âô®ÁöÑ‰∏ªÊúçÂä°Âô®„ÄÇËøô‰ΩøÂæóRedisÂèØÊâßË°åÂçïÂ±ÇÊ†ëÂ§çÂà∂„ÄÇÂ≠òÁõòÂèØ‰ª•ÊúâÊÑèÊó†ÊÑèÁöÑÂØπÊï∞ÊçÆËøõË°åÂÜôÊìç‰Ωú„ÄÇÁî±‰∫éÂÆåÂÖ®ÂÆûÁé∞‰∫ÜÂèëÂ∏É/ËÆ¢ÈòÖÊú∫Âà∂Ôºå‰ΩøÂæó‰ªéÊï∞ÊçÆÂ∫ìÂú®‰ªª‰ΩïÂú∞ÊñπÂêåÊ≠•Ê†ëÊó∂ÔºåÂèØËÆ¢ÈòÖ‰∏Ä‰∏™È¢ëÈÅìÂπ∂Êé•Êî∂‰∏ªÊúçÂä°Âô®ÂÆåÊï¥ÁöÑÊ∂àÊÅØÂèëÂ∏ÉËÆ∞ÂΩï„ÄÇÂêåÊ≠•ÂØπËØªÂèñÊìç‰ΩúÁöÑÂèØÊâ©Â±ïÊÄßÂíåÊï∞ÊçÆÂÜó‰ΩôÂæàÊúâÂ∏ÆÂä©„ÄÇ 2. ‰∏ª‰ªéredisÊîØÊåÅmaster-slaveÊ®°ÂºèÔºå‰∏Ä‰∏ªÂ§ö‰ªéÔºåredis serverÂèØ‰ª•ËÆæÁΩÆÂè¶Â§ñÂ§ö‰∏™redis server‰∏∫slaveÔºå‰ªéÊú∫ÂêåÊ≠•‰∏ªÊú∫ÁöÑÊï∞ÊçÆ„ÄÇÈÖçÁΩÆÂêéÔºåËØªÂÜôÂàÜÁ¶ªÔºå‰∏ªÊú∫Ë¥üË¥£ËØªÂÜôÊúçÂä°Ôºå‰ªéÊú∫Âè™Ë¥üË¥£ËØª„ÄÇÂáèËΩª‰∏ªÊú∫ÁöÑÂéãÂäõ„ÄÇredisÂÆûÁé∞ÁöÑÊòØÊúÄÁªà‰ºö‰∏ÄËá¥ÊÄßÔºåÂÖ∑‰ΩìÈÄâÊã©Âº∫‰∏ÄËá¥ÊÄßËøòÊòØÂº±‰∏ÄËá¥ÊÄßÔºåÂèñÂÜ≥‰∫é‰∏öÂä°Âú∫ÊôØ„ÄÇredis ‰∏ª‰ªéÂêåÊ≠•Êúâ‰∏§ÁßçÊñπÂºèÔºàÊàñËÄÖÊâÄ‰∏§‰∏™Èò∂ÊÆµÔºâÔºöÂÖ®ÂêåÊ≠•ÂíåÈÉ®ÂàÜÂêåÊ≠•„ÄÇ ‰∏ª‰ªéÂàöÂàöËøûÊé•ÁöÑÊó∂ÂÄôÔºåËøõË°åÂÖ®ÂêåÊ≠•ÔºõÂÖ®ÂêåÊ≠•ÁªìÊùüÂêéÔºåËøõË°åÈÉ®ÂàÜÂêåÊ≠•„ÄÇÂΩìÁÑ∂ÔºåÂ¶ÇÊûúÊúâÈúÄË¶ÅÔºåslave Âú®‰ªª‰ΩïÊó∂ÂÄôÈÉΩÂèØ‰ª•ÂèëËµ∑ÂÖ®ÂêåÊ≠•„ÄÇredis Á≠ñÁï•ÊòØÔºåÊó†ËÆ∫Â¶Ç‰ΩïÔºåÈ¶ñÂÖà‰ºöÂ∞ùËØïËøõË°åÈÉ®ÂàÜÂêåÊ≠•ÔºåÂ¶Ç‰∏çÊàêÂäüÔºåË¶ÅÊ±Ç‰ªéÊú∫ËøõË°åÂÖ®ÂêåÊ≠•ÔºåÂπ∂ÂêØÂä® BGSAVE‚Ä¶‚Ä¶BGSAVE ÁªìÊùüÂêéÔºå‰º†Ëæì RDB Êñá‰ª∂ÔºõÂ¶ÇÊûúÊàêÂäüÔºåÂÖÅËÆ∏‰ªéÊú∫ËøõË°åÈÉ®ÂàÜÂêåÊ≠•ÔºåÂπ∂‰º†ËæìÁßØÂéãÁ©∫Èó¥‰∏≠ÁöÑÊï∞ÊçÆ„ÄÇÁÆÄÂçïÊù•ËØ¥Ôºå‰∏ª‰ªéÂêåÊ≠•Â∞±ÊòØ RDB Êñá‰ª∂ÁöÑ‰∏ä‰º†‰∏ãËΩΩÔºõ‰∏ªÊú∫ÊúâÂ∞èÈÉ®ÂàÜÁöÑÊï∞ÊçÆ‰øÆÊîπÔºåÂ∞±Êää‰øÆÊîπËÆ∞ÂΩï‰º†Êí≠ÁªôÊØè‰∏™‰ªéÊú∫„ÄÇ 3. redisÈõÜÁæ§‰∏ª‰ªéÊ®°ÂºèÂ≠òÂú®ÁöÑÈóÆÈ¢òÊòØÔºåmasterÂÆïÊú∫‰πãÂêéÔºå‰ªéÊú∫Âè™ËÉΩËØªÔºå‰∏çÂèØÂÜôÔºå‰∏çËÉΩ‰øùËØÅÈ´òÂèØÁî®„ÄÇredisÈõÜÁæ§ÊäÄÊúØÊòØÊûÑÂª∫È´òÊÄßËÉΩÁΩëÁ´ôÊû∂ÊûÑÁöÑÈáçË¶ÅÊâãÊÆµÔºåËØïÊÉ≥Âú®ÁΩëÁ´ôÊâøÂèóÈ´òÂπ∂ÂèëËÆøÈóÆÂéãÂäõÁöÑÂêåÊó∂ÔºåËøòÈúÄË¶Å‰ªéÊµ∑ÈáèÊï∞ÊçÆ‰∏≠Êü•ËØ¢Âá∫Êª°Ë∂≥Êù°‰ª∂ÁöÑÊï∞ÊçÆÔºåÂπ∂Âø´ÈÄüÂìçÂ∫îÔºåÊàë‰ª¨ÂøÖÁÑ∂ÊÉ≥Âà∞ÁöÑÊòØÂ∞ÜÊï∞ÊçÆËøõË°åÂàáÁâáÔºåÊääÊï∞ÊçÆÊ†πÊçÆÊüêÁßçËßÑÂàôÊîæÂÖ•Â§ö‰∏™‰∏çÂêåÁöÑÊúçÂä°Âô®ËäÇÁÇπÔºåÊù•Èôç‰ΩéÂçïËäÇÁÇπÊúçÂä°Âô®ÁöÑÂéãÂäõ„ÄÇ Redis ClusterÈááÁî®Êó†‰∏≠ÂøÉÁªìÊûÑÔºåÊØè‰∏™ËäÇÁÇπ‰øùÂ≠òÊï∞ÊçÆÂíåÊï¥‰∏™ÈõÜÁæ§Áä∂ÊÄÅ,ÊØè‰∏™ËäÇÁÇπÈÉΩÂíåÂÖ∂‰ªñÊâÄÊúâËäÇÁÇπËøûÊé•„ÄÇËäÇÁÇπ‰πãÈó¥‰ΩøÁî®gossipÂçèËÆÆ‰º†Êí≠‰ø°ÊÅØ‰ª•ÂèäÂèëÁé∞Êñ∞ËäÇÁÇπ„ÄÇ Redis ÈõÜÁæ§ÊòØ‰∏Ä‰∏™ÂàÜÂ∏ÉÂºèÔºàdistributedÔºâ„ÄÅÂÆπÈîôÔºàfault-tolerantÔºâÁöÑ Redis ÂÆûÁé∞ÔºåÈõÜÁæ§ÂèØ‰ª•‰ΩøÁî®ÁöÑÂäüËÉΩÊòØÊôÆÈÄöÂçïÊú∫ Redis ÊâÄËÉΩ‰ΩøÁî®ÁöÑÂäüËÉΩÁöÑ‰∏Ä‰∏™Â≠êÈõÜÔºàsubsetÔºâ„ÄÇ Redis ÈõÜÁæ§‰∏≠‰∏çÂ≠òÂú®‰∏≠ÂøÉÔºàcentralÔºâËäÇÁÇπÊàñËÄÖ‰ª£ÁêÜÔºàproxyÔºâËäÇÁÇπÔºåÈõÜÁæ§ÁöÑÂÖ∂‰∏≠‰∏Ä‰∏™‰∏ªË¶ÅËÆæËÆ°ÁõÆÊ†áÊòØËææÂà∞Á∫øÊÄßÂèØÊâ©Â±ïÊÄßÔºàlinear scalabilityÔºâ„ÄÇ Redis ÈõÜÁæ§‰∏∫‰∫Ü‰øùËØÅ‰∏ÄËá¥ÊÄßÔºàconsistencyÔºâËÄåÁâ∫Áâ≤‰∫Ü‰∏ÄÈÉ®ÂàÜÂÆπÈîôÊÄßÔºöÁ≥ªÁªü‰ºöÂú®‰øùËØÅÂØπÁΩëÁªúÊñ≠Á∫øÔºànet splitÔºâÂíåËäÇÁÇπÂ§±ÊïàÔºànode failureÔºâÂÖ∑ÊúâÊúâÈôêÔºàlimitedÔºâÊäµÊäóÂäõÁöÑÂâçÊèê‰∏ãÔºåÂ∞ΩÂèØËÉΩÂú∞‰øùÊåÅÊï∞ÊçÆÁöÑ‰∏ÄËá¥ÊÄß„ÄÇ 4. ÂÆâË£ÖÈÉ®ÁΩ≤redisÂÆâË£ÖËæÉ‰∏∫ÁÆÄÂçïÔºåÂÆòÁΩë‰∏ãËΩΩÂéãÁº©ÂåÖËß£Âéã„ÄÇÈõÜÁæ§Ê®°ÂºèÈúÄË¶ÅrubyÁöÑÁºñËØëÁéØÂ¢ÉÔºåÈõÜÁæ§ÊúÄÂ∞èÁöÑÈÖçÁΩÆ‰∏∫3Âè∞masterÔºåÂ∞è‰∫é3ÂàôÂêØÂä®ÈõÜÁæ§Êä•Èîô„ÄÇredisÁâàÊú¨Ôºö3.2.4 4.1 ‰∏ª‰ªéÊ®°ÂºèÊãìÊâëÂõæ ‰∏ª‰ªéÊ®°ÂºèÈááÁî®‰∏Ä‰∏ª‰∏â‰ªéÔºå‰∏ª‰ªéÈÉΩÈÖçÁΩÆauthËÆ§ËØÅÔºåËØªÂÜôÂàÜÁ¶ª„ÄÇ‰∏ªË¶ÅÂÆûÈ™åÁöÑÂä®‰ΩúÔºö1ÔºâÂ§ö‰∏™app ÂêåÊó∂ÂÜôÔºåÊµãÂÆöÂÜôÈÄüÁéáÔºõ2ÔºâÂ§ö‰∏™app ÂêåÊó∂ÂÜôÔºåÂêåÊó∂ÊúâËØªÁöÑËøõÁ®ãÔºåÊµãÂÆöËØªÂÜôÈÄüÁéáÔºõ3Ôºâmaster‰∏ªÊú∫ÂÆïÊú∫Ôºåapp‰æùÁÑ∂ËøõË°åËØªÂÜô„ÄÇ 4.2 clusterÊãìÊâëÂõæÂ¶Ç‰∏ã ÈõÜÁæ§Ê®°ÂºèÈááÁî®Âõõ‰∏ªÂõõ‰ªéÔºå‰πüÊòØÈááÁî®ËØªÂÜôÂàÜÁ¶ª„ÄÇ‰∏ªË¶ÅÂÆûÈ™åÁöÑÂä®‰ΩúÔºö1ÔºâÊúâ‰∏Ä‰∏™masterÂÆïÊú∫ÔºåËßÇÂØüÊó•ÂøóÔºåÊñ∞ÁöÑslaveÊàê‰∏∫masterÔºõ2ÔºâmasterÂÆïÊú∫ÂêéÔºåÈáçÊñ∞ÂêØÂä®ÔºåmasterÊàê‰∏∫slaveÔºõ3ÔºâÈõÜÁæ§ÂÖ®ÈÉ®ÂÆïÊú∫Ôºåredis‰∏ªÊú∫ÈáçÂêØÔºåÊï∞ÊçÆÊú™‰∏¢Â§±„ÄÇ 5. ÂéüÁêÜ5.1 ‰∏ÄËá¥ÊÄßfilesnapshot:ÈªòËÆ§redisÊòØ‰ºö‰ª•Âø´ÁÖßÁöÑÂΩ¢ÂºèÂ∞ÜÊï∞ÊçÆÊåÅ‰πÖÂåñÂà∞Á£ÅÁõò,Âú®ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÁöÑÊ†ºÂºèÊòØÔºösave N MË°®Á§∫Âú®NÁßí‰πãÂÜÖÔºåredisËá≥Â∞ëÂèëÁîüMÊ¨°‰øÆÊîπÂàôredisÊäìÂø´ÁÖßÂà∞Á£ÅÁõò„ÄÇ Â∑•‰ΩúÂéüÁêÜÔºöÂΩìredisÈúÄË¶ÅÂÅöÊåÅ‰πÖÂåñÊó∂Ôºåredis‰ºöfork‰∏Ä‰∏™Â≠êËøõÁ®ãÔºõÂ≠êËøõÁ®ãÂ∞ÜÊï∞ÊçÆÂÜôÂà∞Á£ÅÁõò‰∏ä‰∏Ä‰∏™‰∏¥Êó∂RDBÊñá‰ª∂‰∏≠ÔºõÂΩìÂ≠êËøõÁ®ãÂÆåÊàêÂÜô‰∏¥Êó∂Êñá‰ª∂ÂêéÔºåÂ∞ÜÂéüÊù•ÁöÑRDBÊõøÊç¢ÊéâÔºåËøôÊ†∑ÁöÑÂ•ΩÂ§ÑÂ∞±ÊòØÂèØ‰ª•copy-on-write„ÄÇ Append-onlyÔºöfilesnapshottingÊñπÊ≥ïÂú®redisÂºÇÂ∏∏Ê≠ªÊéâÊó∂Ôºå ÊúÄËøëÁöÑÊï∞ÊçÆ‰ºö‰∏¢Â§±Ôºà‰∏¢Â§±Êï∞ÊçÆÁöÑÂ§öÂ∞ëËßÜ‰Ω†saveÁ≠ñÁï•ÁöÑÈÖçÁΩÆÔºâÔºåÊâÄ‰ª•ËøôÊòØÂÆÉÊúÄÂ§ßÁöÑÁº∫ÁÇπÔºåÂΩì‰∏öÂä°ÈáèÂæàÂ§ßÊó∂Ôºå‰∏¢Â§±ÁöÑÊï∞ÊçÆÊòØÂæàÂ§öÁöÑ„ÄÇAppend-onlyÊñπÊ≥ïÂèØ ‰ª•ÂÅöÂà∞ÂÖ®ÈÉ®Êï∞ÊçÆ‰∏ç‰∏¢Â§±Ôºå‰ΩÜredisÁöÑÊÄßËÉΩÂ∞±Ë¶ÅÂ∑Æ‰∫õ„ÄÇAOFÂ∞±ÂèØ‰ª•ÂÅöÂà∞ÂÖ®Á®ãÊåÅ‰πÖÂåñÔºåÂè™ÈúÄË¶ÅÂú®ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÂºÄÂêØÔºàÈªòËÆ§ÊòØnoÔºâÔºåappendonly yesÂºÄÂêØAOF‰πãÂêéÔºåredisÊØèÊâßË°å‰∏Ä‰∏™‰øÆÊîπÊï∞ÊçÆÁöÑÂëΩ‰ª§ÔºåÈÉΩ‰ºöÊääÂÆÉÊ∑ªÂä†Âà∞aofÊñá‰ª∂‰∏≠ÔºåÂΩìredisÈáçÂêØÊó∂ÔºåÂ∞Ü‰ºöËØªÂèñAOFÊñá‰ª∂ËøõË°å‚ÄúÈáçÊîæ‚Äù‰ª•ÊÅ¢Â§çÂà∞ redisÂÖ≥Èó≠ÂâçÁöÑÊúÄÂêéÊó∂Âàª„ÄÇ AOFÊñá‰ª∂Âà∑Êñ∞ÁöÑÊñπÂºèÔºåÊúâ‰∏âÁßçÔºåÂèÇËÄÉÈÖçÁΩÆÂèÇÊï∞appendfsync Ôºö appendfsync alwaysÊØèÊèê‰∫§‰∏Ä‰∏™‰øÆÊîπÂëΩ‰ª§ÈÉΩË∞ÉÁî®fsyncÂà∑Êñ∞Âà∞AOFÊñá‰ª∂ÔºåÈùûÂ∏∏ÈùûÂ∏∏ÊÖ¢Ôºå‰ΩÜ‰πüÈùûÂ∏∏ÂÆâÂÖ®Ôºõ appendfsync everysecÊØèÁßíÈíüÈÉΩË∞ÉÁî®fsyncÂà∑Êñ∞Âà∞AOFÊñá‰ª∂ÔºåÂæàÂø´Ôºå‰ΩÜÂèØËÉΩ‰ºö‰∏¢Â§±‰∏ÄÁßí‰ª•ÂÜÖÁöÑÊï∞ÊçÆÔºõ appendfsync no‰æùÈù†OSËøõË°åÂà∑Êñ∞Ôºåredis‰∏ç‰∏ªÂä®Âà∑Êñ∞AOFÔºåËøôÊ†∑ÊúÄÂø´Ôºå‰ΩÜÂÆâÂÖ®ÊÄßÂ∞±Â∑Æ„ÄÇÈªòËÆ§Âπ∂Êé®ËçêÊØèÁßíÂà∑Êñ∞ÔºåËøôÊ†∑Âú®ÈÄüÂ∫¶ÂíåÂÆâÂÖ®‰∏äÈÉΩÂÅöÂà∞‰∫ÜÂÖºÈ°æ„ÄÇ SlaveÂêåÊ†∑ÂèØ‰ª•Êé•ÂèóÂÖ∂ÂÆÉSlavesÁöÑËøûÊé•ÂíåÂêåÊ≠•ËØ∑Ê±ÇÔºåËøôÊ†∑ÂèØ‰ª•ÊúâÊïàÁöÑÂàÜËΩΩMasterÁöÑÂêåÊ≠•ÂéãÂäõ„ÄÇÂõ†Ê≠§Êàë‰ª¨ÂèØ‰ª•Â∞ÜRedisÁöÑReplicationÊû∂ÊûÑËßÜ‰∏∫ÂõæÁªìÊûÑ„ÄÇ Master ServerÊòØ‰ª•ÈùûÈòªÂ°ûÁöÑÊñπÂºè‰∏∫SlavesÊèê‰æõÊúçÂä°„ÄÇÊâÄ‰ª•Âú®Master-SlaveÂêåÊ≠•ÊúüÈó¥ÔºåÂÆ¢Êà∑Á´Ø‰ªçÁÑ∂ÂèØ‰ª•Êèê‰∫§Êü•ËØ¢Êàñ‰øÆÊîπËØ∑Ê±Ç„ÄÇ Slave ServerÂêåÊ†∑ÊòØ‰ª•ÈùûÈòªÂ°ûÁöÑÊñπÂºèÂÆåÊàêÊï∞ÊçÆÂêåÊ≠•„ÄÇÂú®ÂêåÊ≠•ÊúüÈó¥ÔºåÂ¶ÇÊûúÊúâÂÆ¢Êà∑Á´ØÊèê‰∫§Êü•ËØ¢ËØ∑Ê±ÇÔºåRedisÂàôËøîÂõûÂêåÊ≠•‰πãÂâçÁöÑÊï∞ÊçÆ„ÄÇ ‰∏∫‰∫ÜÂàÜËΩΩMasterÁöÑËØªÊìç‰ΩúÂéãÂäõÔºåSlaveÊúçÂä°Âô®ÂèØ‰ª•‰∏∫ÂÆ¢Êà∑Á´ØÊèê‰æõÂè™ËØªÊìç‰ΩúÁöÑÊúçÂä°ÔºåÂÜôÊúçÂä°‰ªçÁÑ∂ÂøÖÈ°ªÁî±MasterÊù•ÂÆåÊàê„ÄÇÂç≥‰æøÂ¶ÇÊ≠§ÔºåÁ≥ªÁªüÁöÑ‰º∏Áº©ÊÄßËøòÊòØÂæóÂà∞‰∫ÜÂæàÂ§ßÁöÑÊèêÈ´ò„ÄÇ MasterÂèØ‰ª•Â∞ÜÊï∞ÊçÆ‰øùÂ≠òÊìç‰Ωú‰∫§ÁªôSlavesÂÆåÊàêÔºå‰ªéËÄåÈÅøÂÖç‰∫ÜÂú®Master‰∏≠Ë¶ÅÊúâÁã¨Á´ãÁöÑËøõÁ®ãÊù•ÂÆåÊàêÊ≠§Êìç‰Ωú„ÄÇRedisÂú®masterÊòØÈùûÈòªÂ°ûÊ®°ÂºèÔºå‰πüÂ∞±ÊòØËØ¥Âú®slaveÊâßË°åÊï∞ÊçÆÂêåÊ≠•ÁöÑÊó∂ÂÄôÔºåmasterÊòØÂèØ‰ª•Êé•ÂèóÂÆ¢Êà∑Á´ØÁöÑËØ∑Ê±ÇÁöÑÔºåÂπ∂‰∏çÂΩ±ÂìçÂêåÊ≠•Êï∞ÊçÆÁöÑ‰∏ÄËá¥ÊÄßÔºåÁÑ∂ËÄåÂú®slaveÁ´ØÊòØÈòªÂ°ûÊ®°ÂºèÁöÑÔºåslaveÂú®ÂêåÊ≠•masterÊï∞ÊçÆÊó∂ÔºåÂπ∂‰∏çËÉΩÂ§üÂìçÂ∫îÂÆ¢Êà∑Á´ØÁöÑÊü•ËØ¢„ÄÇ 5.2 ReplicationÁöÑÂ∑•‰ΩúÂéüÁêÜ(1)SlaveÊúçÂä°Âô®ËøûÊé•Âà∞MasterÊúçÂä°Âô®„ÄÇ(2)SlaveÊúçÂä°Âô®ÂèëÈÄÅSYCNÂëΩ‰ª§„ÄÇ(3)MasterÊúçÂä°Âô®Â§á‰ªΩÊï∞ÊçÆÂ∫ìÂà∞.rdbÊñá‰ª∂„ÄÇ(4)MasterÊúçÂä°Âô®Êää.rdbÊñá‰ª∂‰º†ËæìÁªôSlaveÊúçÂä°Âô®„ÄÇ(5)SlaveÊúçÂä°Âô®Êää.rdbÊñá‰ª∂Êï∞ÊçÆÂØºÂÖ•Âà∞Êï∞ÊçÆÂ∫ì‰∏≠„ÄÇ Âú®SlaveÂêØÂä®Âπ∂ËøûÊé•Âà∞Master‰πãÂêéÔºåÂÆÉÂ∞Ü‰∏ªÂä®ÂèëÈÄÅ‰∏Ä‰∏™SYNCÂëΩ‰ª§„ÄÇÊ≠§ÂêéMasterÂ∞ÜÂêØÂä®ÂêéÂè∞Â≠òÁõòËøõÁ®ãÔºåÂêåÊó∂Êî∂ÈõÜÊâÄÊúâÊé•Êî∂Âà∞ÁöÑÁî®‰∫é‰øÆÊîπÊï∞ÊçÆÈõÜ ÁöÑÂëΩ‰ª§ÔºåÂú®ÂêéÂè∞ËøõÁ®ãÊâßË°åÂÆåÊØïÂêéÔºåMasterÂ∞Ü‰º†ÈÄÅÊï¥‰∏™Êï∞ÊçÆÂ∫ìÊñá‰ª∂Âà∞SlaveÔºå‰ª•ÂÆåÊàê‰∏ÄÊ¨°ÂÆåÂÖ®ÂêåÊ≠•„ÄÇËÄåSlaveÊúçÂä°Âô®Âú®Êé•Êî∂Âà∞Êï∞ÊçÆÂ∫ìÊñá‰ª∂Êï∞ÊçÆ‰πãÂêéÂ∞ÜÂÖ∂ Â≠òÁõòÂπ∂Âä†ËΩΩÂà∞ÂÜÖÂ≠ò‰∏≠„ÄÇÊ≠§ÂêéÔºåMasterÁªßÁª≠Â∞ÜÊâÄÊúâÂ∑≤ÁªèÊî∂ÈõÜÂà∞ÁöÑ‰øÆÊîπÂëΩ‰ª§ÔºåÂíåÊñ∞ÁöÑ‰øÆÊîπÂëΩ‰ª§‰æùÊ¨°‰º†ÈÄÅÁªôSlavesÔºåSlaveÂ∞ÜÂú®Êú¨Ê¨°ÊâßË°åËøô‰∫õÊï∞ÊçÆ‰øÆÊîπÂëΩ‰ª§Ôºå‰ªéËÄåËææÂà∞ÊúÄÁªàÁöÑÊï∞ÊçÆÂêåÊ≠•„ÄÇÂ¶ÇÊûúMasterÂíåSlave‰πãÈó¥ÁöÑÈìæÊé•Âá∫Áé∞Êñ≠ËøûÁé∞Ë±°ÔºåSlaveÂèØ‰ª•Ëá™Âä®ÈáçËøûMasterÔºå‰ΩÜÊòØÂú®ËøûÊé•ÊàêÂäü‰πãÂêéÔºå‰∏ÄÊ¨°ÂÆåÂÖ®ÂêåÊ≠•Â∞ÜË¢´Ëá™Âä®ÊâßË°å„ÄÇ 5.3 ‰∏ÄËá¥ÊÄßÂìàÂ∏åÈõÜÁæ§Ë¶ÅÂÆûÁé∞ÁöÑÁõÆÁöÑÊòØË¶ÅÂ∞Ü‰∏çÂêåÁöÑ key ÂàÜÊï£ÊîæÁΩÆÂà∞‰∏çÂêåÁöÑ redis ËäÇÁÇπÔºåËøôÈáåÊàë‰ª¨ÈúÄË¶Å‰∏Ä‰∏™ËßÑÂàôÊàñËÄÖÁÆóÊ≥ïÔºåÈÄöÂ∏∏ÁöÑÂÅöÊ≥ïÊòØËé∑Âèñ key ÁöÑÂìàÂ∏åÂÄºÔºåÁÑ∂ÂêéÊ†πÊçÆËäÇÁÇπÊï∞Êù•Ê±ÇÊ®°Ôºå‰ΩÜËøôÁßçÂÅöÊ≥ïÊúâÂÖ∂ÊòéÊòæÁöÑÂºäÁ´ØÔºåÂΩìÊàë‰ª¨ÈúÄË¶ÅÂ¢ûÂä†ÊàñÂáèÂ∞ë‰∏Ä‰∏™ËäÇÁÇπÊó∂Ôºå‰ºöÈÄ†ÊàêÂ§ßÈáèÁöÑ key Êó†Ê≥ïÂëΩ‰∏≠ÔºåËøôÁßçÊØî‰æãÊòØÁõ∏ÂΩìÈ´òÁöÑÔºåÊâÄ‰ª•Â∞±Êúâ‰∫∫ÊèêÂá∫‰∫Ü‰∏ÄËá¥ÊÄßÂìàÂ∏åÁöÑÊ¶ÇÂøµ„ÄÇ‰∏ÄËá¥ÊÄßÂìàÂ∏åÊúâÂõõ‰∏™ÈáçË¶ÅÁâπÂæÅÔºö ÂùáË°°ÊÄßÔºö‰πüÊúâ‰∫∫ÊääÂÆÉÂÆö‰πâ‰∏∫Âπ≥Ë°°ÊÄßÔºåÊòØÊåáÂìàÂ∏åÁöÑÁªìÊûúËÉΩÂ§üÂ∞ΩÂèØËÉΩÂàÜÂ∏ÉÂà∞ÊâÄÊúâÁöÑËäÇÁÇπ‰∏≠ÂéªÔºåËøôÊ†∑ÂèØ‰ª•ÊúâÊïàÁöÑÂà©Áî®ÊØè‰∏™ËäÇÁÇπ‰∏äÁöÑËµÑÊ∫ê„ÄÇ ÂçïË∞ÉÊÄßÔºöÂØπ‰∫éÂçïË∞ÉÊÄßÊúâÂæàÂ§öÁøªËØëËÆ©ÊàëÈùûÂ∏∏ÁöÑ‰∏çËß£ÔºåËÄåÊàëÊÉ≥Ë¶ÅÁöÑÊòØÂΩìËäÇÁÇπÊï∞ÈáèÂèòÂåñÊó∂ÂìàÂ∏åÁöÑÁªìÊûúÂ∫îÂ∞ΩÂèØËÉΩÁöÑ‰øùÊä§Â∑≤ÂàÜÈÖçÁöÑÂÜÖÂÆπ‰∏ç‰ºöË¢´ÈáçÊñ∞ÂàÜÊ¥æÂà∞Êñ∞ÁöÑËäÇÁÇπ„ÄÇ ÂàÜÊï£ÊÄßÂíåË¥üËΩΩÔºöËøô‰∏§‰∏™ÂÖ∂ÂÆûÊòØÂ∑Æ‰∏çÂ§öÁöÑÊÑèÊÄùÔºåÂ∞±ÊòØË¶ÅÊ±Ç‰∏ÄËá¥ÊÄßÂìàÂ∏åÁÆóÊ≥ïÂØπ key ÂìàÂ∏åÂ∫îÂ∞ΩÂèØËÉΩÁöÑÈÅøÂÖçÈáçÂ§ç„ÄÇ Redis ÈõÜÁæ§‰∏≠ÂÜÖÁΩÆ‰∫Ü 16384 ‰∏™ÂìàÂ∏åÊßΩÔºåÂΩìÈúÄË¶ÅÂú® Redis ÈõÜÁæ§‰∏≠ÊîæÁΩÆ‰∏Ä‰∏™ key-value Êó∂Ôºåredis ÂÖàÂØπ key ‰ΩøÁî® crc16 ÁÆóÊ≥ïÁÆóÂá∫‰∏Ä‰∏™ÁªìÊûúÔºåÁÑ∂ÂêéÊääÁªìÊûúÂØπ 16384 Ê±Ç‰ΩôÊï∞ÔºåËøôÊ†∑ÊØè‰∏™ key ÈÉΩ‰ºöÂØπÂ∫î‰∏Ä‰∏™ÁºñÂè∑Âú® 0-16383 ‰πãÈó¥ÁöÑÂìàÂ∏åÊßΩÔºåredis ‰ºöÊ†πÊçÆËäÇÁÇπÊï∞ÈáèÂ§ßËá¥ÂùáÁ≠âÁöÑÂ∞ÜÂìàÂ∏åÊßΩÊò†Â∞ÑÂà∞‰∏çÂêåÁöÑËäÇÁÇπ„ÄÇ ‰ΩøÁî®ÂìàÂ∏åÊßΩÁöÑÂ•ΩÂ§ÑÂ∞±Âú®‰∫éÂèØ‰ª•Êñπ‰æøÁöÑÊ∑ªÂä†ÊàñÁßªÈô§ËäÇÁÇπ„ÄÇ ÂΩìÈúÄË¶ÅÂ¢ûÂä†ËäÇÁÇπÊó∂ÔºåÂè™ÈúÄË¶ÅÊääÂÖ∂‰ªñËäÇÁÇπÁöÑÊüê‰∫õÂìàÂ∏åÊßΩÊå™Âà∞Êñ∞ËäÇÁÇπÂ∞±ÂèØ‰ª•‰∫ÜÔºõ ÂΩìÈúÄË¶ÅÁßªÈô§ËäÇÁÇπÊó∂ÔºåÂè™ÈúÄË¶ÅÊääÁßªÈô§ËäÇÁÇπ‰∏äÁöÑÂìàÂ∏åÊßΩÊå™Âà∞ÂÖ∂‰ªñËäÇÁÇπÂ∞±Ë°å‰∫ÜÔºõ ÂΩìËÆæÁΩÆ‰∫Ü‰∏ª‰ªéÂÖ≥Á≥ªÂêéÔºåslave Âú®Á¨¨‰∏ÄÊ¨°ËøûÊé•ÊàñËÄÖÈáçÊñ∞ËøûÊé• master Êó∂Ôºåslave ÈÉΩ‰ºöÂèëÈÄÅ‰∏ÄÊù°ÂêåÊ≠•Êåá‰ª§Áªô masterÔºõ master Êé•Âà∞Êåá‰ª§ÂêéÔºåÂºÄÂßãÂêØÂä®ÂêéÂè∞‰øùÂ≠òËøõÁ®ã‰øùÂ≠òÊï∞ÊçÆÔºåÊé•ÁùÄÊî∂ÈõÜÊâÄÊúâÁöÑÊï∞ÊçÆ‰øÆÊîπÊåá‰ª§„ÄÇÂêéÂè∞‰øùÂ≠òÂÆå‰∫ÜÔºåmaster Â∞±ÊääËøô‰ªΩÊï∞ÊçÆÂèëÈÄÅÁªô slaveÔºåslave ÂÖàÊääÊï∞ÊçÆ‰øùÂ≠òÂà∞Á£ÅÁõòÔºåÁÑ∂ÂêéÊääÂÆÉÂä†ËΩΩÂà∞ÂÜÖÂ≠ò‰∏≠Ôºåmaster Êé•ÁùÄÂ∞±ÊääÊî∂ÈõÜÁöÑÊï∞ÊçÆ‰øÆÊîπÊåá‰ª§‰∏ÄË°å‰∏ÄË°åÁöÑÂèëÁªô slaveÔºåslave Êé•Êî∂Âà∞‰πãÂêéÈáçÊñ∞ÊâßË°åËØ•Êåá‰ª§ÔºåËøôÊ†∑Â∞±ÂÆûÁé∞‰∫ÜÊï∞ÊçÆÂêåÊ≠•„ÄÇ slave Âú®‰∏é master Â§±ÂéªËÅîÁ≥ªÂêéÔºåËá™Âä®ÁöÑÈáçÊñ∞ËøûÊé•„ÄÇÂ¶ÇÊûú master Êî∂Âà∞‰∫ÜÂ§ö‰∏™ slave ÁöÑÂêåÊ≠•ËØ∑Ê±ÇÔºåÂÆÉ‰ºöÊâßË°åÂçï‰∏™ÂêéÂè∞‰øùÂ≠òÊù•‰∏∫ÊâÄÊúâÁöÑ slave ÊúçÂä°„ÄÇ 5.4 ËäÇÁÇπÂ§±ÊïàÊ£ÄÊµã‰ª•‰∏ãÊòØËäÇÁÇπÂ§±ÊïàÊ£ÄÊü•ÁöÑÂÆûÁé∞ÊñπÊ≥ïÔºö ÂΩì‰∏Ä‰∏™ËäÇÁÇπÂêëÂè¶‰∏Ä‰∏™ËäÇÁÇπÂèëÈÄÅ PING ÂëΩ‰ª§Ôºå‰ΩÜÊòØÁõÆÊ†áËäÇÁÇπÊú™ËÉΩÂú®ÁªôÂÆöÁöÑÊó∂ÈôêÂÜÖËøîÂõû PING ÂëΩ‰ª§ÁöÑÂõûÂ§çÊó∂ÔºåÈÇ£‰πàÂèëÈÄÅÂëΩ‰ª§ÁöÑËäÇÁÇπ‰ºöÂ∞ÜÁõÆÊ†áËäÇÁÇπÊ†áËÆ∞‰∏∫PFAIL Ôºàpossible failureÔºåÂèØËÉΩÂ∑≤Â§±ÊïàÔºâ„ÄÇ Á≠âÂæÖ PING ÂëΩ‰ª§ÂõûÂ§çÁöÑÊó∂ÈôêÁß∞‰∏∫‚ÄúËäÇÁÇπË∂ÖÊó∂Êó∂ÈôêÔºànode timeoutÔºâ‚ÄùÔºåÊòØ‰∏Ä‰∏™ËäÇÁÇπÈÄâÈ°πÔºànode-wise settingÔºâ„ÄÇ ÊØèÊ¨°ÂΩìËäÇÁÇπÂØπÂÖ∂‰ªñËäÇÁÇπÂèëÈÄÅ PING ÂëΩ‰ª§ÁöÑÊó∂ÂÄôÔºåÂÆÉÈÉΩ‰ºöÈöèÊú∫Âú∞ÂπøÊí≠‰∏â‰∏™ÂÆÉÊâÄÁü•ÈÅìÁöÑËäÇÁÇπÁöÑ‰ø°ÊÅØÔºåËøô‰∫õ‰ø°ÊÅØÈáåÈù¢ÁöÑÂÖ∂‰∏≠‰∏ÄÈ°πÂ∞±ÊòØËØ¥ÊòéËäÇÁÇπÊòØÂê¶Â∑≤ÁªèË¢´Ê†áËÆ∞‰∏∫ PFAIL ÊàñËÄÖ FAIL „ÄÇ ÂΩìËäÇÁÇπÊé•Êî∂Âà∞ÂÖ∂‰ªñËäÇÁÇπÂèëÊù•ÁöÑ‰ø°ÊÅØÊó∂ÔºåÂÆÉ‰ºöËÆ∞‰∏ãÈÇ£‰∫õË¢´ÂÖ∂‰ªñËäÇÁÇπÊ†áËÆ∞‰∏∫Â§±ÊïàÁöÑËäÇÁÇπ„ÄÇËøôÁß∞‰∏∫Â§±ÊïàÊä•ÂëäÔºàfailure reportÔºâ„ÄÇ Â¶ÇÊûúËäÇÁÇπÂ∑≤ÁªèÂ∞ÜÊüê‰∏™ËäÇÁÇπÊ†áËÆ∞‰∏∫ PFAIL ÔºåÂπ∂‰∏îÊ†πÊçÆËäÇÁÇπÊâÄÊî∂Âà∞ÁöÑÂ§±ÊïàÊä•ÂëäÊòæÂºèÔºåÈõÜÁæ§‰∏≠ÁöÑÂ§ßÈÉ®ÂàÜÂÖ∂‰ªñ‰∏ªËäÇÁÇπ‰πüËÆ§‰∏∫ÈÇ£‰∏™ËäÇÁÇπËøõÂÖ•‰∫ÜÂ§±ÊïàÁä∂ÊÄÅÔºåÈÇ£‰πàËäÇÁÇπ‰ºöÂ∞ÜÈÇ£‰∏™Â§±ÊïàËäÇÁÇπÁöÑÁä∂ÊÄÅÊ†áËÆ∞‰∏∫ FAIL „ÄÇ ‰∏ÄÊó¶Êüê‰∏™ËäÇÁÇπË¢´Ê†áËÆ∞‰∏∫ FAIL ÔºåÂÖ≥‰∫éËøô‰∏™ËäÇÁÇπÂ∑≤Â§±ÊïàÁöÑ‰ø°ÊÅØÂ∞±‰ºöË¢´ÂπøÊí≠Âà∞Êï¥‰∏™ÈõÜÁæ§ÔºåÊâÄÊúâÊé•Êî∂Âà∞ËøôÊù°‰ø°ÊÅØÁöÑËäÇÁÇπÈÉΩ‰ºöÂ∞ÜÂ§±ÊïàËäÇÁÇπÊ†áËÆ∞‰∏∫ FAIL „ÄÇ ÁÆÄÂçïÊù•ËØ¥Ôºå‰∏Ä‰∏™ËäÇÁÇπË¶ÅÂ∞ÜÂè¶‰∏Ä‰∏™ËäÇÁÇπÊ†áËÆ∞‰∏∫Â§±ÊïàÔºåÂøÖÈ°ªÂÖàËØ¢ÈóÆÂÖ∂‰ªñËäÇÁÇπÁöÑÊÑèËßÅÔºåÂπ∂‰∏îÂæóÂà∞Â§ßÈÉ®ÂàÜ‰∏ªËäÇÁÇπÁöÑÂêåÊÑèÊâçË°å„ÄÇÂõ†‰∏∫ËøáÊúüÁöÑÂ§±ÊïàÊä•Âëä‰ºöË¢´ÁßªÈô§ÔºåÊâÄ‰ª•‰∏ªËäÇÁÇπË¶ÅÂ∞ÜÊüê‰∏™ËäÇÁÇπÊ†áËÆ∞‰∏∫ FAIL ÁöÑËØùÔºåÂøÖÈ°ª‰ª•ÊúÄËøëÊé•Êî∂Âà∞ÁöÑÂ§±ÊïàÊä•Âëä‰Ωú‰∏∫Ê†πÊçÆ„ÄÇÂú®‰ª•‰∏ã‰∏§ÁßçÊÉÖÂÜµ‰∏≠ÔºåËäÇÁÇπÁöÑ FAIL Áä∂ÊÄÅ‰ºöË¢´ÁßªÈô§Ôºö Â¶ÇÊûúË¢´Ê†áËÆ∞‰∏∫ FAIL ÁöÑÊòØ‰ªéËäÇÁÇπÔºåÈÇ£‰πàÂΩìËøô‰∏™ËäÇÁÇπÈáçÊñ∞‰∏äÁ∫øÊó∂Ôºå FAIL Ê†áËÆ∞Â∞±‰ºöË¢´ÁßªÈô§„ÄÇ‰øùÊåÅÔºàretaningÔºâ‰ªéËäÇÁÇπÁöÑ FAIL Áä∂ÊÄÅÊòØÊ≤°ÊúâÊÑè‰πâÁöÑÔºåÂõ†‰∏∫ÂÆÉ‰∏çÂ§ÑÁêÜ‰ªª‰ΩïÊßΩÔºå‰∏Ä‰∏™‰ªéËäÇÁÇπÊòØÂê¶Â§Ñ‰∫é FAIL Áä∂ÊÄÅÔºåÂÜ≥ÂÆö‰∫ÜËøô‰∏™‰ªéËäÇÁÇπÂú®ÊúâÈúÄË¶ÅÊó∂ËÉΩÂê¶Ë¢´ÊèêÂçá‰∏∫‰∏ªËäÇÁÇπ„ÄÇ Â¶ÇÊûú‰∏Ä‰∏™‰∏ªËäÇÁÇπË¢´Êâì‰∏ä FAIL Ê†áËÆ∞‰πãÂêéÔºåÁªèËøá‰∫ÜËäÇÁÇπË∂ÖÊó∂Êó∂ÈôêÁöÑÂõõÂÄçÊó∂Èó¥ÔºåÂÜçÂä†‰∏äÂçÅÁßíÈíü‰πãÂêéÔºåÈíàÂØπËøô‰∏™‰∏ªËäÇÁÇπÁöÑÊßΩÁöÑÊïÖÈöúËΩ¨ÁßªÊìç‰Ωú‰ªçÊú™ÂÆåÊàêÔºåÂπ∂‰∏îËøô‰∏™‰∏ªËäÇÁÇπÂ∑≤ÁªèÈáçÊñ∞‰∏äÁ∫øÁöÑËØùÔºåÈÇ£‰πàÁßªÈô§ÂØπËøô‰∏™ËäÇÁÇπÁöÑ FAIL Ê†áËÆ∞„ÄÇ Âú®Á¨¨‰∫åÁßçÊÉÖÂÜµ‰∏≠ÔºåÂ¶ÇÊûúÊïÖÈöúËΩ¨ÁßªÊú™ËÉΩÈ°∫Âà©ÂÆåÊàêÔºåÂπ∂‰∏î‰∏ªËäÇÁÇπÈáçÊñ∞‰∏äÁ∫øÔºåÈÇ£‰πàÈõÜÁæ§Â∞±ÁªßÁª≠‰ΩøÁî®ÂéüÊù•ÁöÑ‰∏ªËäÇÁÇπÔºå‰ªéËÄåÂÖçÂéªÁÆ°ÁêÜÂëò‰ªãÂÖ•ÁöÑÂøÖË¶Å„ÄÇ 5.5 ‰ªéËäÇÁÇπÈÄâ‰∏æ‰∏ÄÊó¶Êüê‰∏™‰∏ªËäÇÁÇπËøõÂÖ• FAIL Áä∂ÊÄÅÔºåÂ¶ÇÊûúËøô‰∏™‰∏ªËäÇÁÇπÊúâ‰∏Ä‰∏™ÊàñÂ§ö‰∏™‰ªéËäÇÁÇπÂ≠òÂú®ÔºåÈÇ£‰πàÂÖ∂‰∏≠‰∏Ä‰∏™‰ªéËäÇÁÇπ‰ºöË¢´ÂçáÁ∫ß‰∏∫Êñ∞ÁöÑ‰∏ªËäÇÁÇπÔºåËÄåÂÖ∂‰ªñ‰ªéËäÇÁÇπÂàô‰ºöÂºÄÂßãÂØπËøô‰∏™Êñ∞ÁöÑ‰∏ªËäÇÁÇπËøõË°åÂ§çÂà∂„ÄÇÊñ∞ÁöÑ‰∏ªËäÇÁÇπÁî±Â∑≤‰∏ãÁ∫ø‰∏ªËäÇÁÇπÂ±û‰∏ãÁöÑÊâÄÊúâ‰ªéËäÇÁÇπ‰∏≠Ëá™Ë°åÈÄâ‰∏æ‰∫ßÁîüÔºå‰ª•‰∏ãÊòØÈÄâ‰∏æÁöÑÊù°‰ª∂Ôºö Ëøô‰∏™ËäÇÁÇπÊòØÂ∑≤‰∏ãÁ∫ø‰∏ªËäÇÁÇπÁöÑ‰ªéËäÇÁÇπ„ÄÇ Â∑≤‰∏ãÁ∫ø‰∏ªËäÇÁÇπË¥üË¥£Â§ÑÁêÜÁöÑÊßΩÊï∞ÈáèÈùûÁ©∫„ÄÇ ‰ªéËäÇÁÇπÁöÑÊï∞ÊçÆË¢´ËÆ§‰∏∫ÊòØÂèØÈù†ÁöÑÔºå‰πüÂç≥ÊòØÔºå‰∏ª‰ªéËäÇÁÇπ‰πãÈó¥ÁöÑÂ§çÂà∂ËøûÊé•Ôºàreplication linkÔºâÁöÑÊñ≠Á∫øÊó∂Èïø‰∏çËÉΩË∂ÖËøáËäÇÁÇπË∂ÖÊó∂Êó∂ÈôêÔºànode timeoutÔºâ‰πò‰ª•REDIS_CLUSTER_SLAVE_VALIDITY_MULT Â∏∏ÈáèÂæóÂá∫ÁöÑÁßØ„ÄÇ Â¶ÇÊûú‰∏Ä‰∏™‰ªéËäÇÁÇπÊª°Ë∂≥‰∫Ü‰ª•‰∏äÁöÑÊâÄÊúâÊù°‰ª∂ÔºåÈÇ£‰πàËøô‰∏™‰ªéËäÇÁÇπÂ∞ÜÂêëÈõÜÁæ§‰∏≠ÁöÑÂÖ∂‰ªñ‰∏ªËäÇÁÇπÂèëÈÄÅÊéàÊùÉËØ∑Ê±ÇÔºåËØ¢ÈóÆÂÆÉ‰ª¨ÔºåÊòØÂê¶ÂÖÅËÆ∏Ëá™Â∑±Ôºà‰ªéËäÇÁÇπÔºâÂçáÁ∫ß‰∏∫Êñ∞ÁöÑ‰∏ªËäÇÁÇπ„ÄÇÂ¶ÇÊûúÂèëÈÄÅÊéàÊùÉËØ∑Ê±ÇÁöÑ‰ªéËäÇÁÇπÊª°Ë∂≥‰ª•‰∏ãÂ±ûÊÄßÔºåÈÇ£‰πà‰∏ªËäÇÁÇπÂ∞ÜÂêë‰ªéËäÇÁÇπËøîÂõû FAILOVER_AUTH_GRANTED ÊéàÊùÉÔºåÂêåÊÑè‰ªéËäÇÁÇπÁöÑÂçáÁ∫ßË¶ÅÊ±ÇÔºö ÂèëÈÄÅÊéàÊùÉËØ∑Ê±ÇÁöÑÊòØ‰∏Ä‰∏™‰ªéËäÇÁÇπÔºåÂπ∂‰∏îÂÆÉÊâÄÂ±ûÁöÑ‰∏ªËäÇÁÇπÂ§Ñ‰∫é FAIL Áä∂ÊÄÅ„ÄÇ Âú®Â∑≤‰∏ãÁ∫ø‰∏ªËäÇÁÇπÁöÑÊâÄÊúâ‰ªéËäÇÁÇπ‰∏≠ÔºåËøô‰∏™‰ªéËäÇÁÇπÁöÑËäÇÁÇπ ID Âú®ÊéíÂ∫è‰∏≠ÊòØÊúÄÂ∞èÁöÑ„ÄÇ ‰ªéËäÇÁÇπÂ§Ñ‰∫éÊ≠£Â∏∏ÁöÑËøêË°åÁä∂ÊÄÅÔºöÂÆÉÊ≤°ÊúâË¢´Ê†áËÆ∞‰∏∫ FAIL Áä∂ÊÄÅÔºå‰πüÊ≤°ÊúâË¢´Ê†áËÆ∞‰∏∫ PFAIL Áä∂ÊÄÅ„ÄÇ ‰∏ÄÊó¶Êüê‰∏™‰ªéËäÇÁÇπÂú®ÁªôÂÆöÁöÑÊó∂ÈôêÂÜÖÂæóÂà∞Â§ßÈÉ®ÂàÜ‰∏ªËäÇÁÇπÁöÑÊéàÊùÉÔºåÂÆÉÂ∞±‰ºöÂºÄÂßãÊâßË°å‰ª•‰∏ãÊïÖÈöúËΩ¨ÁßªÊìç‰ΩúÔºö ÈÄöËøá PONG Êï∞ÊçÆÂåÖÔºàpacketÔºâÂëäÁü•ÂÖ∂‰ªñËäÇÁÇπÔºåËøô‰∏™ËäÇÁÇπÁé∞Âú®ÊòØ‰∏ªËäÇÁÇπ‰∫Ü„ÄÇ ÈÄöËøá PONG Êï∞ÊçÆÂåÖÂëäÁü•ÂÖ∂‰ªñËäÇÁÇπÔºåËøô‰∏™ËäÇÁÇπÊòØ‰∏Ä‰∏™Â∑≤ÂçáÁ∫ßÁöÑ‰ªéËäÇÁÇπÔºàpromoted slaveÔºâ„ÄÇ Êé•ÁÆ°ÔºàclaimingÔºâÊâÄÊúâÁî±Â∑≤‰∏ãÁ∫ø‰∏ªËäÇÁÇπË¥üË¥£Â§ÑÁêÜÁöÑÂìàÂ∏åÊßΩ„ÄÇ ÊòæÂºèÂú∞ÂêëÊâÄÊúâËäÇÁÇπÂπøÊí≠‰∏Ä‰∏™ PONG Êï∞ÊçÆÂåÖÔºåÂä†ÈÄüÂÖ∂‰ªñËäÇÁÇπËØÜÂà´Ëøô‰∏™ËäÇÁÇπÁöÑËøõÂ∫¶ÔºåËÄå‰∏çÊòØÁ≠âÂæÖÂÆöÊó∂ÁöÑ PING / PONG Êï∞ÊçÆÂåÖ„ÄÇ ÊâÄÊúâÂÖ∂‰ªñËäÇÁÇπÈÉΩ‰ºöÊ†πÊçÆÊñ∞ÁöÑ‰∏ªËäÇÁÇπÂØπÈÖçÁΩÆËøõË°åÁõ∏Â∫îÁöÑÊõ¥Êñ∞ÔºåÁâπÂà´Âú∞Ôºö a. ÊâÄÊúâË¢´Êñ∞ÁöÑ‰∏ªËäÇÁÇπÊé•ÁÆ°ÁöÑÊßΩ‰ºöË¢´Êõ¥Êñ∞„ÄÇ b. Â∑≤‰∏ãÁ∫ø‰∏ªËäÇÁÇπÁöÑÊâÄÊúâ‰ªéËäÇÁÇπ‰ºöÂØüËßâÂà∞ PROMOTED Ê†áÂøóÔºåÂπ∂ÂºÄÂßãÂØπÊñ∞ÁöÑ‰∏ªËäÇÁÇπËøõË°åÂ§çÂà∂„ÄÇ c.Â¶ÇÊûúÂ∑≤‰∏ãÁ∫øÁöÑ‰∏ªËäÇÁÇπÈáçÊñ∞ÂõûÂà∞‰∏äÁ∫øÁä∂ÊÄÅÔºåÈÇ£‰πàÂÆÉ‰ºöÂØüËßâÂà∞ PROMOTED Ê†áÂøóÔºåÂπ∂Â∞ÜËá™Ë∫´Ë∞ÉÊï¥‰∏∫Áé∞‰ªª‰∏ªËäÇÁÇπÁöÑ‰ªéËäÇÁÇπ„ÄÇ Âú®ÈõÜÁæ§ÁöÑÁîüÂëΩÂë®Êúü‰∏≠ÔºåÂ¶ÇÊûú‰∏Ä‰∏™Â∏¶Êúâ PROMOTED Ê†áËØÜÁöÑ‰∏ªËäÇÁÇπÂõ†‰∏∫Êüê‰∫õÂéüÂõ†ËΩ¨ÂèòÊàê‰∫Ü‰ªéËäÇÁÇπÔºåÈÇ£‰πàËØ•ËäÇÁÇπÂ∞Ü‰∏¢Â§±ÂÆÉÊâÄÂ∏¶ÊúâÁöÑ PROMOTED Ê†áËØÜ„ÄÇ 6. ÊÄªÁªìRedisÈõÜÁæ§ÂÖ∑ÊúâÈ´òÂèØÁî®ÔºåÊòì‰∫éËøÅÁßªÔºåÂ≠òÂèñÈÄüÂ∫¶Âø´Á≠âÁâπÁÇπ„ÄÇ‰πüÂèØ‰ª•‰Ωú‰∏∫Ê∂àÊÅØÈòüÂàó‰ΩøÁî®ÔºåÊîØÊåÅpub/subÊ®°ÂºèÔºåÂÖ∑‰Ωì‰ºòÁº∫ÁÇπÊÄªÁªìÂ¶Ç‰∏ãÔºöÈ¶ñÂÖà‰ºòÁÇπ: redis Âú®‰∏ªËäÇÁÇπ‰∏ãÁ∫øÂêéÔºå‰ªéËäÇÁÇπ‰ºöËá™Âä®ÊèêÂçá‰∏∫‰∏ªËäÇÁÇπÔºåÊèê‰æõÊúçÂä° redis ÂÆïÊú∫ËäÇÁÇπÊÅ¢Â§çÂêéÔºåËá™Âä®‰ºöÊ∑ªÂä†Âà∞ÈõÜÁæ§‰∏≠ÔºåÂèòÊàê‰ªéËäÇÁÇπ Âä®ÊÄÅÊâ©Â±ïÂíåÂà†Èô§ËäÇÁÇπÔºårehash slotÁöÑÂàÜÈÖçÔºåÂü∫‰∫éÊ°∂ÁöÑÊï∞ÊçÆÂàÜÂ∏ÉÊñπÂºèÂ§ßÂ§ßÈôç‰Ωé‰∫ÜËøÅÁßªÊàêÊú¨ÔºåÂè™ÈúÄÂ∞ÜÊï∞ÊçÆÊ°∂‰ªé‰∏Ä‰∏™Redis NodeËøÅÁßªÂà∞Âè¶‰∏Ä‰∏™Redis NodeÂç≥ÂèØÂÆåÊàêËøÅÁßª„ÄÇ Redis Cluster‰ΩøÁî®ÂºÇÊ≠•Â§çÂà∂„ÄÇ ÂÖ∂Áº∫ÁÇπ‰∏∫: Áî±‰∫éredisÁöÑÂ§çÂà∂‰ΩøÁî®ÂºÇÊ≠•Êú∫Âà∂ÔºåÂú®Ëá™Âä®ÊïÖÈöúËΩ¨ÁßªÁöÑËøáÁ®ã‰∏≠ÔºåÈõÜÁæ§ÂèØËÉΩ‰ºö‰∏¢Â§±ÂÜôÂëΩ‰ª§„ÄÇÁÑ∂ËÄå redis Âá†‰πéÊòØÂêåÊó∂ÊâßË°å(Â∞ÜÂëΩ‰ª§ÊÅ¢Â§çÂèëÈÄÅÁªôÂÆ¢Êà∑Á´ØÔºå‰ª•ÂèäÂ∞ÜÂëΩ‰ª§Â§çÂà∂Âà∞‰ªéËäÇÁÇπ)Ëøô‰∏§‰∏™Êìç‰ΩúÔºåÊâÄ‰ª•ÂÆûÈôÖ‰∏≠ÔºåÂëΩ‰ª§‰∏¢Â§±ÁöÑÁ™óÂè£ÈùûÂ∏∏Â∞è„ÄÇ ÊôÆÈÄöÁöÑ‰∏ª‰ªéÊ®°ÂºèÊîØÊåÅauthÂä†ÂØÜËÆ§ËØÅÔºåËôΩÁÑ∂ÊØîËæÉÂº±Ôºå‰ΩÜÂÜôÊàñËÄÖËØªÈÉΩË¶ÅÈÄöËøáÂØÜÁ†ÅÈ™åËØÅÔºåclusterÂØπÂØÜÁ†ÅÊîØÊåÅ‰∏çÂ§™ÂèãÂ•ΩÔºåÂ¶ÇÊûúÂØπÈõÜÁæ§ËÆæÁΩÆÂØÜÁ†ÅÔºåÈÇ£‰πàrequirepassÂíåmasterauthÈÉΩÈúÄË¶ÅËÆæÁΩÆÔºåÂê¶ÂàôÂèëÁîü‰∏ª‰ªéÂàáÊç¢Êó∂ÔºåÂ∞±‰ºöÈÅáÂà∞ÊéàÊùÉÈóÆÈ¢òÔºåÂèØ‰ª•Ê®°ÊãüÂπ∂ËßÇÂØüÊó•Âøó„ÄÇ ÂèÇËÄÉËµÑÊñôÔºö www.redis.io redis-clusterÁ†îÁ©∂Âíå‰ΩøÁî® Redis Cluster 3.0Êê≠Âª∫‰∏é‰ΩøÁî®]]></content>
      <categories>
        <category>‰∏≠Èó¥‰ª∂</category>
      </categories>
      <tags>
        <tag>mq</tag>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Áî±ConsulË∞àÂà∞Raft]]></title>
    <url>%2F2017%2F09%2F25%2Fraft%2F</url>
    <content type="text"><![CDATA[Âú®Ââç‰∏ÄÁØáÊñáÁ´†consulÈÖçÁΩÆ‰∏éÂÆûÊàò‰∏≠Ôºå‰ªãÁªç‰∫ÜconsulÁöÑ‰∏Ä‰∫õÂÜÖÂπïÂèäconsulÈÖçÁΩÆÁõ∏ÂÖ≥ÔºåÂπ∂ÂØπÈ°πÁõÆ‰∏≠ÁöÑ‰∏Ä‰∫õÂÆûÈôÖÈÖçÁΩÆËøõË°åÂ±ïÁ§∫„ÄÇËøôÁØáÊñáÁ´†ÈáçÁÇπ‰ªãÁªçconsul‰∏≠ÊâÄÊ∂âÂèäÂà∞ÁöÑ‰∏ÄËá¥ÊÄßÁÆóÊ≥ïraft„ÄÇ 1. ËÉåÊôØÂàÜÂ∏ÉÂºèÁ≥ªÁªüÁöÑ‰∏ÄËá¥ÊÄßÊòØÁõ∏ÂΩìÈáçË¶ÅÁöÑÔºåÂç≥‰∏∫CAPÁêÜËÆ∫‰∏≠ÁöÑC(Consistency)„ÄÇ‰∏ÄËá¥ÊÄßÂèàÂèØ‰ª•ÂàÜ‰∏∫Âº∫‰∏ÄËá¥ÊÄßÂíåÊúÄÁªà‰∏ÄËá¥ÊÄß„ÄÇËøôÁØáÊñáÁ´†ÈáçÁÇπËÆ®ËÆ∫Âº∫‰∏ÄËá¥ÊÄßÁÆóÊ≥ïraft„ÄÇ LamportÂèëË°®Paxos‰∏ÄËá¥ÊÄßÁÆóÊ≥ï‰ªé90Âπ¥ÊèêÂá∫Âà∞Áé∞Âú®Â∑≤ÁªèÊúâ‰∫åÂçÅÂá†Âπ¥‰∫ÜÔºåÁõ¥Âà∞2006Âπ¥GoogleÁöÑ‰∏âÁØáËÆ∫ÊñáÂàùÁé∞‚Äú‰∫ë‚ÄùÁöÑÁ´ØÂÄ™ÔºåÂÖ∂‰∏≠ÁöÑChubby LockÊúçÂä°‰ΩøÁî®Paxos‰Ωú‰∏∫Chubby Cell‰∏≠ÁöÑ‰∏ÄËá¥ÊÄßÁÆóÊ≥ïÔºåPaxosÁöÑ‰∫∫Ê∞î‰ªéÊ≠§‰∏ÄË∑ØÁãÇÈ£ô„ÄÇËÄåPaxosÊµÅÁ®ãÂ§™Ëøá‰∫éÁπÅÊùÇÂÆûÁé∞Ëµ∑Êù•‰πüÊØîËæÉÂ§çÊùÇÔºåËôΩÁÑ∂Áé∞Âú®ÂæàÂπøÊ≥õ‰ΩøÁî®ÁöÑZookeeper‰πüÊòØÂü∫‰∫éPaxosÁÆóÊ≥ïÊù•ÂÆûÁé∞Ôºå‰ΩÜÊòØZookeeper‰ΩøÁî®ÁöÑZABÔºàZookeeper Atomic BroadcastÔºâÂçèËÆÆÂØπPaxosËøõË°å‰∫ÜÂæàÂ§öÁöÑÊîπËøõ‰∏é‰ºòÂåñÔºåÂ§çÊùÇÊÄßÊòØÂà∂Á∫¶‰ªñÂèëÂ±ïÁöÑ‰∏Ä‰∏™ÈáçË¶ÅÂéüÂõ†„ÄÇRaftÁöÑËÆæËÆ°ÂàùË°∑Â∞±ÊòØÊòì‰∫éÁêÜËß£ÊÄß„ÄÇ RaftÊòØÊñØÂù¶Á¶èÁöÑDiego Ongaro„ÄÅJohn Ousterhout‰∏§‰∏™‰∫∫‰ª•ÊòìÊáÇÔºàUnderstandabilityÔºâ‰∏∫ÁõÆÊ†áËÆæËÆ°ÁöÑ‰∏ÄËá¥ÊÄßÁÆóÊ≥ïÔºåÂú®2013Âπ¥ÂèëÂ∏É‰∫ÜËÆ∫ÊñáÔºö„ÄäIn Search of an Understandable Consensus Algorithm„Äã ‰ªé2013Âπ¥ÂèëÂ∏ÉÂà∞Áé∞Âú®‰∏çËøáÂè™Êúâ‰∏§Âπ¥ÔºåÂà∞Áé∞Âú®Â∑≤ÁªèÊúâ‰∫ÜÂçÅÂ§öÁßçËØ≠Ë®ÄÁöÑRaftÁÆóÊ≥ïÂÆûÁé∞Ê°ÜÊû∂ÔºåËæÉ‰∏∫Âá∫ÂêçÁöÑÊúâetcd„ÄÇ 2. RaftËØ¶Ëß£Âº∫Ë∞ÉÁöÑÊòØÊòìÊáÇÔºàUnderstandabilityÔºâÔºåRaftÂíåPaxos‰∏ÄÊ†∑Âè™Ë¶Å‰øùËØÅn/2+1ËäÇÁÇπÊ≠£Â∏∏Â∞±ËÉΩÂ§üÊèê‰æõÊúçÂä°Ôºõ‰ºóÊâÄÂë®Áü•‰ΩÜÈóÆÈ¢òËæÉ‰∏∫Â§çÊùÇÊó∂ÂèØ‰ª•ÊääÈóÆÈ¢òÂàÜËß£‰∏∫Âá†‰∏™Â∞èÈóÆÈ¢òÊù•Â§ÑÁêÜÔºåRaft‰πü‰ΩøÁî®‰∫ÜÂàÜËÄåÊ≤ª‰πãÁöÑÊÄùÊÉ≥ÊääÁÆóÊ≥ïÊµÅÁ®ãÂàÜ‰∏∫‰∏â‰∏™Â≠êÈóÆÈ¢òÔºöÈÄâ‰∏æÔºàLeader electionÔºâ„ÄÅÊó•ÂøóÂ§çÂà∂ÔºàLog replicationÔºâ„ÄÅÂÆâÂÖ®ÊÄßÔºàSafetyÔºâ‰∏â‰∏™Â≠êÈóÆÈ¢ò„ÄÇ 2.1 raftÂü∫Êú¨Ê¶ÇÂøµ states ‰∏Ä‰∏™raftÈõÜÁæ§Êã•ÊúâÂ§ö‰∏™serverÔºåÈÄöÂ∏∏‰ºöÊúâ5Âè∞ÔºåËøôÊ†∑ÂèØ‰ª•ÂÖÅËÆ∏Á≥ªÁªü‰∏≠‰∏§Âè∞serverÂÆïÊú∫„ÄÇÂú®‰ªª‰ΩïÊÉÖÂÜµ‰∏ãÔºåÊâÄÊúâÁöÑserverÂè™ÊúâÂ¶Ç‰∏ã‰∏âÁßçÁä∂ÊÄÅ‰πã‰∏ÄÔºö LeaderÔºåË¥üË¥£Client‰∫§‰∫íÂíålogÂ§çÂà∂ÔºåÂêå‰∏ÄÊó∂ÂàªÁ≥ªÁªü‰∏≠ÊúÄÂ§öÂ≠òÂú®1‰∏™ FollowerÔºåË¢´Âä®ÂìçÂ∫îËØ∑Ê±ÇRPCÔºå‰ªé‰∏ç‰∏ªÂä®ÂèëËµ∑ËØ∑Ê±ÇRPC CandidateÔºåÁî±FollowerÂêëLeaderËΩ¨Êç¢ÁöÑ‰∏≠Èó¥Áä∂ÊÄÅ Âú®Ê≠£Â∏∏ÁöÑÊìç‰ΩúÊµÅÁ®ã‰∏≠ÔºåÈõÜÁæ§‰∏≠Êúâ‰∏îÂè™Êúâ‰∏Ä‰∏™serverÔºåÂÖ∂‰ªñÊâÄÊúâÁöÑserverÈÉΩÊòØfollower„ÄÇfollowerÊòØË¢´Âä®ÁöÑÔºå‰ªñ‰ª¨Âè™ÊòØË¢´Âä®Âú∞Áõ∏Â∫îCandidateÂíåleaderÁöÑËØ∑Ê±Ç„ÄÇ„ÄÇleaderÂ§ÑÁêÜÊâÄÊúâÁöÑÂÆ¢Êà∑Á´ØËØ∑Ê±ÇÔºåfollowerËá™Â∑±‰∏çÂ§ÑÁêÜËÄåÊòØËΩ¨ÂèëÁªôleader„ÄÇÁ¨¨‰∏âÁßçÁä∂ÊÄÅÊòØCandidateÔºåÁî®Êù•ÈÄâ‰∏æ‰∏Ä‰∏™Êñ∞ÁöÑleader„ÄÇ Terms RaftÂ∞ÜÊó∂Èó¥ÂàíÂàÜÊàê‰ªªÊÑèÁöÑÈïøÂ∫¶Âë®Êúü„ÄÇTermsÂèØ‰ª•ÁêÜËß£‰∏∫ÈÄªËæëÂë®ÊúüÔºåÁî®ËøûÁª≠ÁöÑÊï¥Êï∞Ë°®Á§∫„ÄÇÂú®ÂàÜÂ∏ÉÂºèÁéØÂ¢É‰∏≠ÔºåÊó∂Èó¥ÂêåÊ≠•ÂæàÈáçË¶ÅÔºåÂêåÊó∂ÊòØ‰∏Ä‰∏™ÈöæÈ¢ò„ÄÇÂú®Raft‰∏≠‰ΩøÁî®‰∫Ü‰∏Ä‰∏™ÂèØ‰ª•ÁêÜËß£‰∏∫Âë®ÊúüÔºà‰ªªÊúüÔºâÁöÑÊ¶ÇÂøµÔºåÁî®Term‰Ωú‰∏∫‰∏Ä‰∏™Âë®ÊúüÔºåÊØè‰∏™TermÈÉΩÊòØ‰∏Ä‰∏™ËøûÁª≠ÈÄíÂ¢ûÁöÑÁºñÂè∑ÔºåÊØè‰∏ÄËΩÆÈÄâ‰∏æÈÉΩÊòØ‰∏Ä‰∏™TermÂë®ÊúüÔºåÂú®‰∏Ä‰∏™Term‰∏≠Âè™ËÉΩ‰∫ßÁîü‰∏Ä‰∏™Leader„ÄÇ ÊØè‰∏™term‰º¥ÈöèÁùÄ‰∏ÄÊ¨°electionÔºå‰∏Ä‰∏™ÊàñÂ§ö‰∏™CandidateËØïÂõæÊàê‰∏∫leaderÔºåÂ¶Ç‰∏äÂõæÁöÑÁä∂ÊÄÅËΩ¨Êç¢„ÄÇÂ¶ÇÊûúÊüê‰∏™CandidateËµ¢Âæó‰∫ÜËøôÊ¨°electionÔºåÂÆÉÂ∞ÜÂçáÁ∫ß‰∏∫Ââ©‰ΩôserverÁöÑleader„ÄÇÂú®Êüê‰∫õelectionÁöÑÊÉÖÂΩ¢‰∏≠Ôºå‰ºö‰∫ßÁîüËÄóÁ•®ÔºàSplit VotesÔºâÁöÑÁªìÊûú ÔºåÂç≥ÊäïÁ•®ÁªìÊûúÊó†ÊïàÔºåÈöèÂêé‰∏ÄÊ¨°Êñ∞ÁöÑtermÂºÄÂßã„ÄÇraftÁ°Æ‰øùÂú®Êüê‰∏™termËá≥Â§öÊúâ‰∏Ä‰∏™leader„ÄÇ Â¶Ç‰∏äÂõæÊâÄÁ§∫ÔºåÊó∂Èó¥Ë¢´ÂàíÂàÜÊàêÂ§ö‰∏™termsÔºåÊØè‰∏™termÈöèÁùÄ‰∏ÄÊ¨°election„ÄÇelectionÂÆåÊàêÂêéÔºå‰∏Ä‰∏™leaderËäÇÁÇπÁÆ°ÁêÜÊï¥‰∏™ÈõÜÁæ§ÔºåÁõ¥Ëá≥Ëøô‰∏™termÁªìÊùü„ÄÇÊúâ‰∫õelectionÂ§±Ë¥•‰∫ÜÔºåÊú™ËÉΩ‰∫ßÁîü‰∏Ä‰∏™leader„ÄÇ 2.2 Leader electionÊâÄÊúâËäÇÁÇπÈÉΩÊòØ‰ª•followerÂêØÂä®„ÄÇ‰∏Ä‰∏™ÊúÄÂ∞èÁöÑ Raft ÈõÜÁæ§ÈúÄË¶Å‰∏â‰∏™ÂèÇ‰∏éËÄÖÔºåËøôÊ†∑ÊâçÂèØËÉΩÊäïÂá∫Â§öÊï∞Á•®„ÄÇÂàùÂßãÁä∂ÊÄÅ ÈÉΩÊòØ FollowerÔºåÁÑ∂ÂêéÂèëËµ∑ÈÄâ‰∏æËøôÊó∂Êúâ‰∏âÁßçÂèØËÉΩÊÉÖÂΩ¢ÂèëÁîü„ÄÇÂ¶ÇÊûúÊØèÊñπÈÉΩÊäïÁªô‰∫ÜËá™Â∑±ÔºåÁªìÊûúÊ≤°Êúâ‰ªª‰Ωï‰∏ÄÊñπËé∑ÂæóÂ§öÊï∞Á•®„ÄÇ‰πãÂêéÊØè‰∏™ÂèÇ‰∏éÊñπÈöèÊú∫‰ºëÊÅØ‰∏ÄÈòµÔºàElection TimeoutÔºâÈáçÊñ∞ÂèëËµ∑ÊäïÁ•®Áõ¥Âà∞‰∏ÄÊñπËé∑ÂæóÂ§öÊï∞Á•®„ÄÇËøôÈáåÁöÑÂÖ≥ÈîÆÂ∞±ÊòØÈöèÊú∫ timeoutÔºåÊúÄÂÖà‰ªétimeout‰∏≠ÊÅ¢Â§çÂèëËµ∑ÊäïÁ•®ÁöÑ‰∏ÄÊñπÂêëËøòÂú® timeout ‰∏≠ÁöÑÂè¶Â§ñ‰∏§ÊñπËØ∑Ê±ÇÊäïÁ•®ÔºåËøôÊó∂ÂÆÉ‰ª¨Â∞±Âè™ËÉΩÊäïÁªôÂØπÊñπ‰∫ÜÔºåÂæàÂø´ËææÊàê‰∏ÄËá¥„ÄÇRaftÁöÑÈÄâ‰∏æÁî±ÂÆöÊó∂Âô®Êù•Ëß¶ÂèëÔºåÊØè‰∏™ËäÇÁÇπÁöÑÈÄâ‰∏æÂÆöÊó∂Âô®Êó∂Èó¥ÈÉΩÊòØ‰∏ç‰∏ÄÊ†∑ÁöÑÔºåÂºÄÂßãÊó∂Áä∂ÊÄÅÈÉΩ‰∏∫FollowerÊüê‰∏™ËäÇÁÇπÂÆöÊó∂Âô®Ëß¶ÂèëÈÄâ‰∏æÂêéTermÈÄíÂ¢ûÔºåÁä∂ÊÄÅÁî±FollowerËΩ¨‰∏∫CandidateÔºåÂêëÂÖ∂‰ªñËäÇÁÇπÂèëËµ∑RequestVote RPCËØ∑Ê±ÇÔºåËøôÊó∂ÂÄôÊúâ‰∏âÁßçÂèØËÉΩÁöÑÊÉÖÂÜµÂèëÁîüÔºö 1.ËØ•RequestVoteËØ∑Ê±ÇÊé•Êî∂Âà∞n/2+1ÔºàËøáÂçäÊï∞Ôºâ‰∏™ËäÇÁÇπÁöÑÊäïÁ•®Ôºå‰ªéCandidateËΩ¨‰∏∫LeaderÔºåÂêëÂÖ∂‰ªñËäÇÁÇπÂèëÈÄÅheartBeat‰ª•‰øùÊåÅLeaderÁöÑÊ≠£Â∏∏ËøêËΩ¨„ÄÇ 2.Âú®Ê≠§ÊúüÈó¥Â¶ÇÊûúÊî∂Âà∞ÂÖ∂‰ªñËäÇÁÇπÂèëÈÄÅËøáÊù•ÁöÑAppendEntries RPCËØ∑Ê±ÇÔºåÂ¶ÇËØ•ËäÇÁÇπÁöÑTermÂ§ßÂàôÂΩìÂâçËäÇÁÇπËΩ¨‰∏∫FollowerÔºåÂê¶Âàô‰øùÊåÅCandidateÊãíÁªùËØ•ËØ∑Ê±Ç„ÄÇ 3.Election timeoutÂèëÁîüÂàôTermÈÄíÂ¢ûÔºåÈáçÊñ∞ÂèëËµ∑ÈÄâ‰∏æ„ÄÇ Âú®‰∏Ä‰∏™TermÊúüÈó¥ÊØè‰∏™ËäÇÁÇπÂè™ËÉΩÊäïÁ•®‰∏ÄÊ¨°ÔºåÊâÄ‰ª•ÂΩìÊúâÂ§ö‰∏™CandidateÂ≠òÂú®Êó∂Â∞±‰ºöÂá∫Áé∞ÊØè‰∏™CandidateÂèëËµ∑ÁöÑÈÄâ‰∏æÈÉΩÂ≠òÂú®Êé•Êî∂Âà∞ÁöÑÊäïÁ•®Êï∞ÈÉΩ‰∏çËøáÂçäÁöÑÈóÆÈ¢òÔºåËøôÊó∂ÊØè‰∏™CandidateÈÉΩÂ∞ÜTermÈÄíÂ¢û„ÄÅÈáçÂêØÂÆöÊó∂Âô®Âπ∂ÈáçÊñ∞ÂèëËµ∑ÈÄâ‰∏æÔºåÁî±‰∫éÊØè‰∏™ËäÇÁÇπ‰∏≠ÂÆöÊó∂Âô®ÁöÑÊó∂Èó¥ÈÉΩÊòØÈöèÊú∫ÁöÑÔºåÊâÄ‰ª•Â∞±‰∏ç‰ºöÂ§öÊ¨°Â≠òÂú®ÊúâÂ§ö‰∏™CandidateÂêåÊó∂ÂèëËµ∑ÊäïÁ•®ÁöÑÈóÆÈ¢ò„ÄÇ ÂºïÁî®‰∏ÄÂº†ÁΩë‰∏äÁöÑÂõæÁâáÔºåÊØîËæÉÂΩ¢Ë±°ÔºåÂ¶Ç‰∏ãÂõæ„ÄÇ 2.3 Log replicationÊó•ÂøóÂ§çÂà∂‰∏ªË¶ÅÊòØÁî®‰∫é‰øùËØÅËäÇÁÇπÁöÑ‰∏ÄËá¥ÊÄßÔºåËøôÈò∂ÊÆµÊâÄÂÅöÁöÑÊìç‰Ωú‰πüÊòØ‰∏∫‰∫Ü‰øùËØÅ‰∏ÄËá¥ÊÄß‰∏éÈ´òÂèØÁî®ÊÄßÔºõÂΩìLeaderÈÄâ‰∏æÂá∫Êù•Âêé‰æøÂºÄÂßãË¥üË¥£ÂÆ¢Êà∑Á´ØÁöÑËØ∑Ê±ÇÔºåÊâÄÊúâ‰∫ãÂä°ÔºàÊõ¥Êñ∞Êìç‰ΩúÔºâËØ∑Ê±ÇÈÉΩÂøÖÈ°ªÂÖàÁªèËøáLeaderÂ§ÑÁêÜÔºåËøô‰∫õ‰∫ãÂä°ËØ∑Ê±ÇÊàñËØ¥ÊàêÂëΩ‰ª§‰πüÂ∞±ÊòØËøôÈáåËØ¥ÁöÑÊó•ÂøóÔºåÊàë‰ª¨ÈÉΩÁü•ÈÅìË¶Å‰øùËØÅËäÇÁÇπÁöÑ‰∏ÄËá¥ÊÄßÂ∞±Ë¶Å‰øùËØÅÊØè‰∏™ËäÇÁÇπÈÉΩÊåâÈ°∫Â∫èÊâßË°åÁõ∏ÂêåÁöÑÊìç‰ΩúÂ∫èÂàóÔºåÊó•ÂøóÂ§çÂà∂ÔºàLog ReplicationÔºâÂ∞±ÊòØ‰∏∫‰∫Ü‰øùËØÅÊâßË°åÁõ∏ÂêåÁöÑÊìç‰ΩúÂ∫èÂàóÊâÄÂÅöÁöÑÂ∑•‰ΩúÔºõÂú®Raft‰∏≠ÂΩìÊé•Êî∂Âà∞ÂÆ¢Êà∑Á´ØÁöÑÊó•ÂøóÔºà‰∫ãÂä°ËØ∑Ê±ÇÔºâÂêéÂÖàÊääËØ•Êó•ÂøóËøΩÂä†Âà∞Êú¨Âú∞ÁöÑLog‰∏≠ÔºåÁÑ∂ÂêéÈÄöËøáheartbeatÊääËØ•EntryÂêåÊ≠•ÁªôÂÖ∂‰ªñFollowerÔºåFollowerÊé•Êî∂Âà∞Êó•ÂøóÂêéËÆ∞ÂΩïÊó•ÂøóÁÑ∂ÂêéÂêëLeaderÂèëÈÄÅACKÔºåÂΩìLeaderÊî∂Âà∞Â§ßÂ§öÊï∞Ôºàn/2+1ÔºâFollowerÁöÑACK‰ø°ÊÅØÂêéÂ∞ÜËØ•Êó•ÂøóËÆæÁΩÆ‰∏∫Â∑≤Êèê‰∫§Âπ∂ËøΩÂä†Âà∞Êú¨Âú∞Á£ÅÁõò‰∏≠ÔºåÈÄöÁü•ÂÆ¢Êà∑Á´ØÂπ∂Âú®‰∏ã‰∏™heartbeat‰∏≠LeaderÂ∞ÜÈÄöÁü•ÊâÄÊúâÁöÑFollowerÂ∞ÜËØ•Êó•ÂøóÂ≠òÂÇ®Âú®Ëá™Â∑±ÁöÑÊú¨Âú∞Á£ÅÁõò‰∏≠„ÄÇ ‰∏äÂõæ‰∏≠ÔºåÂΩìleaderÈÄâÂá∫Êù•‰πãÂêéÔºåfollowerÁöÑlogsÂú∫ÊôØÂæàÂèØËÉΩÂá∫Áé∞Âú®‰∏äÂõæ‰∏≠„ÄÇfollowerÊúâÂèØËÉΩ‰∏¢Â§±entries„ÄÅÊúâÊú™Êèê‰∫§ÁöÑentries„ÄÅÊúâÈ¢ùÂ§ñÁöÑentriesÁ≠âÁ≠âÂú∫ÊôØ„ÄÇRaft‰∏≠ÔºåleaderÈÄöËøáÂº∫Âà∂followersÂ§çÂà∂Ëá™Â∑±ÁöÑlogsÊù•Â§ÑÁêÜ‰∏ç‰∏ÄËá¥„ÄÇËøôÊÑèÂë≥ÁùÄÔºåÂú®follower‰∏≠logsÂÜ≤Á™ÅÁöÑentriesÂ∞Ü‰ºöË¢´leader logs‰∏≠ÁöÑË¶ÜÂÜô„ÄÇ 2.4 SafetyÂÆâÂÖ®ÊÄßÊòØÁî®‰∫é‰øùËØÅÊØè‰∏™ËäÇÁÇπÈÉΩÊâßË°åÁõ∏ÂêåÂ∫èÂàóÁöÑÂÆâÂÖ®Êú∫Âà∂ÔºåÂ¶ÇÂΩìÊüê‰∏™FollowerÂú®ÂΩìÂâçLeader commit LogÊó∂ÂèòÂæó‰∏çÂèØÁî®‰∫ÜÔºåÁ®çÂêéÂèØËÉΩËØ•FollowerÂèà‰ºöÂÄçÈÄâ‰∏æ‰∏∫LeaderÔºåËøôÊó∂Êñ∞LeaderÂèØËÉΩ‰ºöÁî®Êñ∞ÁöÑLogË¶ÜÁõñÂÖàÂâçÂ∑≤committedÁöÑLogÔºåËøôÂ∞±ÊòØÂØºËá¥ËäÇÁÇπÊâßË°å‰∏çÂêåÂ∫èÂàóÔºõSafetyÂ∞±ÊòØÁî®‰∫é‰øùËØÅÈÄâ‰∏æÂá∫Êù•ÁöÑLeader‰∏ÄÂÆöÂåÖÂê´ÂÖàÂâç commited LogÁöÑÊú∫Âà∂Ôºõ Election SafetyÊØè‰∏™TermÂè™ËÉΩÈÄâ‰∏æÂá∫‰∏Ä‰∏™LeaderÔºåÂÅáËÆæÊüê‰∏™TermÂêåÊó∂ÈÄâ‰∏æ‰∫ßÁîü‰∏§‰∏™LeaderAÂíåLeaderBÔºåÊ†πÊçÆÈÄâ‰∏æËøáÁ®ãÂÆö‰πâÔºåAÂíåBÂøÖÈ°ªÂêåÊó∂Ëé∑ÂæóË∂ÖËøáÂçäÊï∞ËäÇÁÇπÁöÑÊäïÁ•®ÔºåËá≥Â∞ëÂ≠òÂú®ËäÇÁÇπNÂêåÊó∂Áªô‰∫àAÂíåBÊäïÁ•®ÔºåÂõ†Ê≠§ÁüõÁõæ„ÄÇ Leader CompletenessËøôÈáåÊâÄËØ¥ÁöÑÂÆåÊï¥ÊÄßÊòØÊåáLeaderÊó•ÂøóÁöÑÂÆåÊï¥ÊÄßÔºåÂΩìLogÂú®Term1Ë¢´CommitÂêéÔºåÈÇ£‰πà‰ª•ÂêéTerm2„ÄÅTerm3‚Ä¶Á≠âÁöÑLeaderÂøÖÈ°ªÂåÖÂê´ËØ•LogÔºõRaftÂú®ÈÄâ‰∏æÈò∂ÊÆµÂ∞±‰ΩøÁî®TermÁöÑÂà§Êñ≠Áî®‰∫é‰øùËØÅÂÆåÊï¥ÊÄßÔºöÂΩìËØ∑Ê±ÇÊäïÁ•®ÁöÑËØ•CandidateÁöÑTermËæÉÂ§ßÊàñTermÁõ∏ÂêåIndexÊõ¥Â§ßÂàôÊäïÁ•®ÔºåÂê¶ÂàôÊãíÁªùËØ•ËØ∑Ê±ÇÔºõ Leader Append-OnlyLeader‰ªé‰∏ç‚ÄúÈáçÂÜô‚ÄùÊàñËÄÖ‚ÄúÂà†Èô§‚ÄùÊú¨Âú∞LogÔºå‰ªÖ‰ªÖ‚ÄúËøΩÂä†‚ÄùÊú¨Âú∞Log„ÄÇRaftÁÆóÊ≥ï‰∏≠LeaderÊùÉÂ®ÅËá≥È´òÊó†‰∏äÔºåÂΩìFollowerÂíåLeader‰∫ßÁîüÂàÜÊ≠ßÁöÑÊó∂ÂÄôÔºåÊ∞∏ËøúÊòØLeaderÂéªË¶ÜÁõñ‰øÆÊ≠£Follower„ÄÇ Log MatchingÂ¶ÇÊûú‰∏§‰∏™ËäÇÁÇπ‰∏äÁöÑÊó•ÂøóÈ°πÊã•ÊúâÁõ∏ÂêåÁöÑIndexÂíåTermÔºåÈÇ£‰πàËøô‰∏§‰∏™ËäÇÁÇπ[0, Index]ËåÉÂõ¥ÂÜÖÁöÑLogÂÆåÂÖ®‰∏ÄËá¥„ÄÇ State Machine Safety‰∏ÄÊó¶Êüê‰∏™serverÂ∞ÜÊüê‰∏™Êó•ÂøóÈ°πÂ∫îÁî®‰∫éÊú¨Âú∞Áä∂ÊÄÅÊú∫Ôºå‰ª•ÂêéÊâÄÊúâserverÂØπ‰∫éËØ•ÂÅèÁßªÈÉΩÂ∞ÜÂ∫îÁî®Áõ∏ÂêåÊó•ÂøóÈ°π„ÄÇ 3. ÊÄªÁªìÊú¨Êñá‰∏ªË¶ÅËÆ≤Ëß£‰∫ÜRaftÁÆóÊ≥ïÁöÑÂü∫Êú¨Ê¶ÇÂøµÔºå‰ª•ÂèäÁÆóÊ≥ï‰∏≠Ê∂âÂèäÂà∞ÁöÑleaderÈÄâ‰∏æÔºåÊó•ÂøóÂêåÊ≠•ÔºåÂÆâÂÖ®ÊÄß„ÄÇRaftÊòØ‰ª•ÊòìÁêÜËß£ÊÄß‰Ωú‰∏∫ÂÖ∂ËÆæËÆ°ÁöÑ‰∏Ä‰∏™ÁõÆÊ†áÔºåÂØπ‰∫é‰∏Ä‰∏™Â≠¶‰π†ÁöÑÊñ∞ÊâãÊù•ËØ¥ÔºåÁ°ÆÂÆûÊØîPaxosÊòì‰∫éÁêÜËß£ÂæàÂ§ö„ÄÇËôΩÁÑ∂ Raft ÁöÑËÆ∫ÊñáÊØî Paxos ÁÆÄÂçïÁâàËÆ∫ÊñáÂÆπÊòìËØªÔºåËÆ∫Êñá‰æùÁÑ∂ÊúâÂæàÂ§öÂú∞ÊñπÈúÄË¶ÅÊ∑±Âàª‰Ωì‰ºö‰∏éÁêÜËß£ÔºåÁ¨îËÄÖ‰πüËøòÊòØÊêû‰∫ÜÂ•ΩÂá†Â§©„ÄÇ ÂèÇËÄÉ Raft Animate Demo Raft Paper Raft Website Raft ‰∏∫‰ªÄ‰πàÊòØÊõ¥ÊòìÁêÜËß£ÁöÑÂàÜÂ∏ÉÂºè‰∏ÄËá¥ÊÄßÁÆóÊ≥ï Raft‰∏ÄËá¥ÊÄßÁÆóÊ≥ï]]></content>
      <categories>
        <category>ÁÆóÊ≥ï</category>
      </categories>
      <tags>
        <tag>consul</tag>
        <tag>Cluster</tag>
        <tag>Consensus</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[consulÈÖçÁΩÆ‰∏éÂÆûÊàò]]></title>
    <url>%2F2017%2F09%2F16%2Fconsul%2F</url>
    <content type="text"><![CDATA[‰∏ä‰∏ÄÁØáÊèêÂà∞ÔºåÈ°πÁõÆÁî®ÁöÑÂàÜÂ∏ÉÂºèÊúçÂä°ÂèëÁé∞‰∏éÊ≥®ÂÜåÁªÑ‰ª∂ÊòØconsulÔºåËøôÁØáÊñáÁ´†‰∏ªË¶ÅÊù•ËÆ≤‰∏ãconsulÁªÑ‰ª∂Âú®È°πÁõÆ‰∏≠ÁöÑÂ∫îÁî®‰ª•ÂèäÁõ∏ÂÖ≥‰ªãÁªç„ÄÇÊú¨Êñá‰ª•ÂÆòÊñπÊñáÊ°£‰∏∫‰∏ªË¶ÅÂèÇËÄÉconsulÊñáÊ°£„ÄÇ 1. consul‰ªãÁªçconsulÊòØ‰∏Ä‰∏™ÊúçÂä°ÁÆ°ÁêÜËΩØ‰ª∂Ôºå‰∏ªË¶ÅÂäüËÉΩÂ¶Ç‰∏ãÔºö ÊîØÊåÅÂ§öÊï∞ÊçÆ‰∏≠ÂøÉ‰∏ãÔºåÂàÜÂ∏ÉÂºèÈ´òÂèØÁî®ÁöÑÔºåÊúçÂä°ÂèëÁé∞ÂíåÈÖçÁΩÆÂÖ±‰∫´„ÄÇ consulÊîØÊåÅÂÅ•Â∫∑Ê£ÄÊü•ÔºåÂÖÅËÆ∏Â≠òÂÇ®ÈîÆÂÄºÂØπ„ÄÇ ‰∏ÄËá¥ÊÄßÂçèËÆÆÈááÁî®RaftÁÆóÊ≥ï,Áî®Êù•‰øùËØÅÊúçÂä°ÁöÑÈ´òÂèØÁî®„ÄÇ ÊàêÂëòÁÆ°ÁêÜÂíåÊ∂àÊÅØÂπøÊí≠ÈááÁî®GOSSIPÂçèËÆÆÔºåÊîØÊåÅACLËÆøÈóÆÊéßÂà∂„ÄÇ 1.1 ÊúçÂä°Ê≥®ÂÜå‰∏éÂèëÁé∞ÊúçÂä°Ê≥®ÂÜåÊòØ‰∏Ä‰∏™ÊúçÂä°Â∞ÜÂÖ∂‰ΩçÁΩÆ‰ø°ÊÅØÂú®‚Äú‰∏≠ÂøÉÊ≥®ÂÜåËäÇÁÇπ‚ÄùÊ≥®ÂÜåÁöÑËøáÁ®ã„ÄÇËØ•ÊúçÂä°‰∏ÄËà¨‰ºöÂ∞ÜÂÆÉÁöÑ‰∏ªÊú∫IPÂú∞ÂùÄ‰ª•ÂèäÁ´ØÂè£Âè∑ËøõË°åÊ≥®ÂÜåÔºåÊúâÊó∂‰πü‰ºöÊúâÊúçÂä°ËÆøÈóÆÁöÑËÆ§ËØÅ‰ø°ÊÅØÔºå‰ΩøÁî®ÂçèËÆÆÔºåÁâàÊú¨Âè∑Ôºå‰ª•ÂèäÂÖ≥‰∫éÁéØÂ¢ÉÁöÑ‰∏Ä‰∫õÁªÜËäÇ‰ø°ÊÅØ„ÄÇËÄåÊúçÂä°ÂèëÁé∞ÂèØ‰ª•ËÆ©‰∏Ä‰∏™Â∫îÁî®ÊàñËÄÖÁªÑ‰ª∂ÂèëÁé∞ÂÖ∂ËøêË°åÁéØÂ¢É‰ª•ÂèäÂÖ∂ÂÆÉÂ∫îÁî®ÊàñÁªÑ‰ª∂ÁöÑ‰ø°ÊÅØ„ÄÇÁî®Êà∑ÈÖçÁΩÆ‰∏Ä‰∏™ÊúçÂä°ÂèëÁé∞Â∑•ÂÖ∑Â∞±ÂèØ‰ª•Â∞ÜÂÆûÈôÖÂÆπÂô®Ë∑üËøêË°åÈÖçÁΩÆÂàÜÁ¶ªÂºÄ„ÄÇÂ∏∏ËßÅÈÖçÁΩÆ‰ø°ÊÅØÂåÖÊã¨Ôºöip„ÄÅÁ´ØÂè£Âè∑„ÄÅÂêçÁß∞Á≠â„ÄÇ Âú®‰º†ÁªüÊÉÖÂÜµ‰∏ãÔºåÂΩìÂá∫Áé∞ÊúçÂä°Â≠òÂú®‰∫éÂ§ö‰∏™‰∏ªÊú∫ËäÇÁÇπ‰∏äÊó∂ÔºåÈÉΩ‰ºö‰ΩøÁî®ÈùôÊÄÅÈÖçÁΩÆÁöÑÊñπÊ≥ïÊù•ÂÆûÁé∞ÊúçÂä°‰ø°ÊÅØÁöÑÊ≥®ÂÜå„ÄÇËÄåÂΩìÂú®‰∏Ä‰∏™Â§çÊùÇÁöÑÁ≥ªÁªüÈáåÔºåÈúÄË¶ÅËæÉÂº∫ÁöÑÂèØÊâ©Â±ïÊÄßÊó∂ÔºåÊúçÂä°Ë¢´È¢ëÁπÅÊõøÊç¢Êó∂Ôºå‰∏∫ÈÅøÂÖçÊúçÂä°‰∏≠Êñ≠ÔºåÂä®ÊÄÅÁöÑÊúçÂä°Ê≥®ÂÜåÂíåÂèëÁé∞Â∞±ÂæàÈáçË¶Å„ÄÇÊúçÂä°Ê≥®ÂÜå‰∏éÂèëÁé∞ÁöÑÁªÑ‰ª∂ÊúâÂæàÂ§öÔºåÂ¶ÇZookeeper„ÄÅEtcdÁ≠â„ÄÇÊó¢ÂèØÁî®‰∫éÊúçÂä°Èó¥ÁöÑÂçèË∞ÉÔºåÂêåÊó∂ÂèàÂèØÁî®‰∫éÊúçÂä°ÁöÑÊ≥®ÂÜå„ÄÇ 1.2 Consensus Protocol - Raft Consul‰ΩøÁî®ConsensusÂçèËÆÆRaftÊèê‰æõ‰∏ÄËá¥ÊÄßÔºàConsistencyÔºâ„ÄÇÊú¨ÊñáÂè™ÊòØÁÆÄÂçï‰ªãÁªçÂú®consul‰∏≠ÁöÑ‰∏ÄËá¥ÊÄßÔºåÂêéÈù¢‰∏ìÈó®‰∏ÄÁØáÂÜôraft„ÄÇ È¶ñÂÖàÔºåRaftÊòØ‰∏ÄÁßçÂü∫‰∫éPaxosÁöÑConsensusÁÆóÊ≥ï„ÄÇÁõ∏ÊØî‰∫éPaxosÔºåRaftËÆæËÆ°ÈááÁî®‰∫ÜËæÉÂ∞ëÁöÑÁä∂ÊÄÅÔºåÂπ∂‰∏îÊòØ‰∏ÄÁßçÊõ¥ÁÆÄÂçï„ÄÅÊõ¥Êòì‰∫éÁêÜËß£ÁöÑÁÆóÊ≥ï„ÄÇÂè™ÊúâServerËäÇÁÇπÂèÇ‰∏éRaftÔºå‰∏îÊòØpeer setÁöÑ‰∏ÄÂëò„ÄÇÊâÄÊúâÁöÑClientËäÇÁÇπÂè™ÊòØËΩ¨ÂèëËØ∑Ê±ÇÂà∞Server„ÄÇËøôÁßçËÆæËÆ°ÁöÑËÄÉËôëÊòØÔºåÂΩìÊõ¥Â§öÁöÑÊàêÂëòÂä†ÂÖ•Âà∞peer set‰∏≠Êó∂ÔºåquorumÁöÑËßÑÊ®°‰πü‰ºöÂ¢ûÂä†„ÄÇÂèØËÉΩ‰ºöÂØºËá¥ÊÄßËÉΩÈóÆÈ¢òÊòØÁ≠âÂæÖquorum‰∏™ËäÇÁÇπlog entry„ÄÇ ÂêØÂä®ConsulÊó∂ÔºåÂçï‰∏™consulËäÇÁÇπÈúÄË¶Å‰ª•bootstrapÊ®°ÂºèËøêË°åÔºåËØ•Ê®°ÂºèËøêË°åËá™ÊàëÈÄâ‰∏æ‰∏∫leader„ÄÇ‰∏ÄÊó¶LeaderË¢´ÈÄâÂá∫Êù•ÔºåÂÖ∂‰ªñServerÂèØ‰ª•Ê∑ªÂä†Peer set‰∏≠Ôºå‰øùÊåÅ‰∏ÄËá¥ÊÄßÂíåÂÆâÂÖ®ÊÄß„ÄÇÊúÄÁªà‰∏Ä‰∫õServerÊ∑ªÂä†Âà∞ÈõÜÁæ§ÔºåbootstrapÊ®°ÂºèÈúÄË¶ÅÁ¶ÅÁî®„ÄÇ Âõ†‰∏∫ÊâÄÊúâServerÈÉΩÊòØPeer set‰∏≠ÁöÑÊàêÂëòÔºåÂÆÉ‰ª¨ÈÉΩÁü•ÈÅìË∞ÅÊòØLeader„ÄÇÂΩì‰∏Ä‰∏™RPCËØ∑Ê±ÇÂà∞ËææÊüê‰∏™ÈùûLeader ServerËäÇÁÇπÔºåËØ∑Ê±ÇÂ∞±‰ºöË¢´ËΩ¨ÂèëÂà∞Leader„ÄÇÂ¶ÇÊûúRPCÊòØ‰∏ÄÁßçqueryÁ±ªÂûãÔºåËøôÊÑèÂë≥ÁùÄÂÆÉÊòØÂè™ËØªÁöÑÔºåLeader‰ºöÂü∫‰∫éFSMÂΩìÂâçÁîüÊàêÁõ∏Â∫îÁöÑÁªìÊûúÔºåÂ¶ÇÊûúRPCÊòØ‰∏ÄÁßçtransactionÁ±ªÂûãÔºåÂç≥‰øÆÊîπÁä∂ÊÄÅÔºåLeader‰∫ßÁîü‰∏Ä‰∏™Êñ∞ÁöÑÊó•ÂøóÊù°ÁõÆÔºåÂπ∂Âü∫‰∫éRaftÁÆóÊ≥ïËøõË°åÁÆ°ÁêÜ„ÄÇ‰∏ÄÊó¶Êó•ÂøóÊù°ÁõÆÂ∫îÁî®‰∫éÊúâÈôêÁä∂ÊÄÅÊú∫ÔºåtransactionÂÆåÊàê„ÄÇ Áî±‰∫éRaftÁöÑreplicationÊÄßË¥®ÔºåÊÄßËÉΩÂØπÁΩëÁªúÂª∂ËøüÊòØÈùûÂ∏∏ÊïèÊÑüÁöÑ„ÄÇ‰∏∫Ê≠§ÔºåÊØè‰∏™Êï∞ÊçÆ‰∏≠ÂøÉÈÄâÊã©Áã¨Á´ãÁöÑLeaderÂíåÁª¥Êä§‰∏Ä‰∏™‰∏çÂÖ≥ËÅîÁöÑpeer set„ÄÇÊï∞ÊçÆÊåâÁÖßÊï∞ÊçÆ‰∏≠ÂøÉËøõË°åÂàíÂàÜÔºåÊâÄ‰ª•ÊØè‰∏™LeaderÂè™Ë¥üË¥£Âú®Áõ∏Â∫îÊï∞ÊçÆ‰∏≠ÂøÉÁöÑÊï∞ÊçÆ„ÄÇÂΩìÊé•Êî∂Âà∞‰∏Ä‰∏™ËøúÁ®ãÊï∞ÊçÆ‰∏≠ÂøÉÁöÑËØ∑Ê±ÇÊó∂ÔºåËØ∑Ê±Ç‰ºöË¢´ËΩ¨ÂèëÂà∞Áõ∏Â∫îÁöÑLeader„ÄÇËøôÁßçËÆæËÆ°Âú®‰∏çÁâ∫Áâ≤‰∏ÄËá¥ÊÄßÁöÑÊÉÖÂÜµÂÆûÁé∞ËæÉ‰ΩéÂª∂Ëøü‰∫§ÊòìÂíåÊõ¥È´òÁöÑÂèØÁî®ÊÄß„ÄÇËôΩÁÑ∂ÊâÄÊúâÊó•ÂøóÂâØÊú¨ÁöÑÂÜôÂÖ•ÈÉΩÊòØÂü∫‰∫éRaftÔºåËØªÂèñÊõ¥ÁÅµÊ¥ª„ÄÇ‰ΩÜ‰∏∫‰∫ÜÊîØÊåÅÂºÄÂèë‰∫∫ÂëòÂèØËÉΩÈúÄË¶ÅÁöÑÂêÑÁßçÊùÉË°°ÔºåConsulÊîØÊåÅ3Áßç‰∏çÂêåÁöÑ‰∏ÄËá¥ÊÄßÊ®°Âºè„ÄÇ DefaultÔºåRaftÈááÁî®LeaderÁßüËµÅÊ®°ÂºèÔºåÊèê‰æõ‰∫Ü‰∏Ä‰∏™Êó∂Èó¥Á™óÂè£ÔºåÂú®ËØ•Êó∂Èó¥ÊÆµÂÜÖÔºåLeaderËßíËâ≤ÊòØÁ®≥ÂÆöÁöÑ„ÄÇ consistentÔºåÊó†Êù°‰ª∂‰∏ÄËá¥ÊÄß staleÔºåËøôÁßçÊ®°ÂºèÂÖÅËÆ∏Âú®‰ªª‰ΩïServerËäÇÁÇπÊâßË°åËØªÂèñÊìç‰ΩúÔºåÊó†ËÆ∫ÂÆÉÊòØ‰∏çÊòØLeader„ÄÇ 1.3 Group Membership Protocol - GossipConsul‰ΩøÁî®gossipÂçèËÆÆÁÆ°ÁêÜÊàêÂëòÂÖ≥Á≥ª„ÄÅÂπøÊí≠Ê∂àÊÅØÂà∞Êï¥‰∏™ÈõÜÁæ§„ÄÇËØ¶ÊÉÖÂèØÂèÇËÄÉSerf library„ÄÇ ConsulÂà©Áî®‰∏§‰∏™‰∏çÂêåÁöÑgossip pool„ÄÇÂ±ÄÂüüÁΩë(LAN Pool)ÂíåÂπøÂüüÁΩë(WAN Pool)„ÄÇ ÊØè‰∏™ConsulÊï∞ÊçÆ‰∏≠ÂøÉÈÉΩÊúâ‰∏Ä‰∏™ÂåÖÂê´ÊâÄÊúâÊàêÂëòÔºàServerÂíåClientÔºâÁöÑLAN gossip pool„ÄÇLAN PoolÊúâÂ¶Ç‰∏ãÂá†‰∏™ÁõÆÁöÑÔºö È¶ñÂÖàÔºåÊàêÂëòÂÖ≥Á≥ªÂÖÅËÆ∏ClientËá™Âä®ÂèëÁé∞ServerËäÇÁÇπÔºåÂáèÂ∞ëÊâÄÈúÄÁöÑÈÖçÁΩÆÈáè„ÄÇ ÂÖ∂Ê¨°ÔºåÂàÜÂ∏ÉÂºèÊïÖÈöúÊ£ÄÊµãÂÖÅËÆ∏ÁöÑÊïÖÈöúÊ£ÄÊµãÁöÑÂ∑•‰ΩúÂú®ÊüêÂá†‰∏™ServerÂá†ÁÇπÊâßË°åÔºåËÄå‰∏çÊòØÈõÜ‰∏≠Êï¥‰∏™ÈõÜÁæ§ÊâÄÊúâËäÇÁÇπ‰∏ä„ÄÇ ÊúÄÂêéÔºågossipÂÖÅËÆ∏ÂèØÈù†ÂíåÂø´ÈÄüÁöÑ‰∫ã‰ª∂ÂπøÊí≠ÔºåÂ¶ÇLeaderÈÄâ‰∏æ„ÄÇ WAN PoolÊòØÂÖ®Â±ÄÂîØ‰∏ÄÁöÑÔºåÊó†ËÆ∫Â±û‰∫éÂì™‰∏Ä‰∏™Êï∞ÊçÆ‰∏≠ÂøÉÔºåÊâÄÊúâServerÂ∫îËØ•Âä†ÂÖ•Âà∞WAN Pool„ÄÇÁî±WAN PoolÊèê‰æõ‰ºöÂëò‰ø°ÊÅØËÆ©ServerÂèØËäÇÁîµÊâßË°åË∑®Êï∞ÊçÆ‰∏≠ÂøÉÁöÑËØ∑Ê±Ç„ÄÇÈõÜÊàê‰∏≠ÊïÖÈöúÊ£ÄÊµãÂÖÅËÆ∏ConsulÂ¶•ÂñÑÂ§ÑÁêÜÊï¥‰∏™Êï∞ÊçÆ‰∏≠ÂøÉÂ§±ÂéªËøûÊé•ÔºåÊàñÂú®ËøúÁ®ãÊï∞ÊçÆ‰∏≠ÂøÉÂè™ÊòØÂçï‰∏™ÁöÑServerËäÇÁÇπ„ÄÇÊâÄÊúâËøô‰∫õÂäüËÉΩÈÉΩÊòØÈÄöËøáÂà©Áî®SerfÊèê‰æõ„ÄÇ‰ªéÁî®Êà∑ËßíÂ∫¶Êù•ÁúãÔºåÂÆÉÊòØ‰Ωú‰∏∫‰∏Ä‰∏™ÂµåÂÖ•ÂºèÂ∫ìÊèê‰æõËøô‰∫õÂäüËÉΩ„ÄÇ‰ΩÜÂÖ∂Ë¢´ConsulÂ±èËîΩÔºåÁî®Êà∑Êó†ÈúÄÂÖ≥ÂøÉ„ÄÇ‰Ωú‰∏∫ÂºÄÂèë‰∫∫ÂëòÂèØ‰ª•Âéª‰∫ÜËß£Ëøô‰∏™Â∫ìÊòØÂ¶Ç‰ΩïÂà©Áî®„ÄÇ 1.4 Session‰ºöËØù‰∏ä‰∏ÄÁØáÊñáÁ´†snowflakeÂçáÁ∫ßÁâàÂÖ®Â±ÄidÁîüÊàê‰∏≠‰ΩøÁî®Âà∞‰∫ÜconsulÁöÑKVÂ≠òÂÇ®„ÄÇConsulÊèê‰æõsession‰ºöËØùÊú∫Âà∂ÔºåÂèØ‰ª•Áî®‰∫éÊûÑÂª∫ÂàÜÂ∏ÉÂºèÈîÅ„ÄÇsessionÂèØ‰ª•ÁªëÂÆöÂà∞ËäÇÁÇπ„ÄÅÂÅ•Â∫∑Ê£ÄÊü•„ÄÅKVÊï∞ÊçÆÔºåÁõÆÁöÑÊòØÊèê‰æõÁªÜÁ≤íÂ∫¶ÈîÅ„ÄÇKVÂ≠òÂÇ®Âíå‰ºöËØùÁöÑÈõÜÊàêÊòØ‰ΩøÁî®‰ºöËØùÁöÑ‰∏ªË¶ÅÂú∫ÊôØ„ÄÇÂøÖÈ°ªÂú®‰ΩøÁî®‰πãÂâçÂàõÂª∫‰∏Ä‰∏™‰ºöËØùÔºåÁÑ∂Âêé‰ΩøÁî®ÂÆÉÁöÑID„ÄÇKV APIÊîØÊåÅacquireÂíåreleaseÊìç‰ΩúÔºåacquireÊìç‰ΩúÁ±ª‰ººCASÊìç‰ΩúÔºåÂè™ÊúâÂΩìÈîÅÁ©∫Èó≤Êó∂Êâç‰ºöËøîÂõûÊàêÂäü„ÄÇÂΩìÊàêÂäüÊó∂ÔºåÊüê‰∏™normalÊ†áËØÜ‰ºöÊõ¥Êñ∞Ôºå‰πü‰ºöÈÄíÂ¢ûLockIndexÔºåÂΩìÁÑ∂‰πü‰ºöÊõ¥Êñ∞sessionÁöÑ‰ø°ÊÅØ„ÄÇÂ¶ÇÊûúÂú®acquireÊìç‰ΩúÊó∂Ôºå‰∏ésessionÁõ∏ÂÖ≥ÁöÑÈîÅÂ∑≤ÁªèÊåÅÊúâÔºåÈÇ£‰πàLockIndexÂ∞±‰∏ç‰ºöÈÄíÂ¢ûÔºå‰ΩÜÊòØkeyÂÄº‰ºöÊõ¥Êñ∞ÔºåËøôÂ∞±ÂÖÅËÆ∏ÈîÅÁöÑÂΩìÂâçÊåÅÊúâËÄÖÊó†ÈúÄÈáçÊñ∞Ëé∑ÂæóÈîÅÂ∞±ÂèØ‰ª•Êõ¥Êñ∞keyÁöÑÂÜÖÂÆπ„ÄÇ ‰∏ÄÊó¶Ëé∑ÂæóÈîÅÔºåÊâÄÈúÄË¶ÅÁªèreleaseÊìç‰ΩúÊù•ÈáäÊîæÔºà‰ΩøÁî®Áõ∏ÂêåÁöÑsessionÔºâ„ÄÇReleaseÊìç‰Ωú‰πüÁ±ª‰ºº‰∫éCASÊìç‰Ωú„ÄÇÂ¶ÇÊûúÁªôÂÆöÁöÑsessionÊó†ÊïàÔºåÈÇ£‰πàËØ∑Ê±Ç‰ºöÂ§±Ë¥•„ÄÇÈúÄË¶ÅÁâπÂà´Ê≥®ÊÑèÁöÑÊòØÔºåÊó†ÈúÄÁªèËøásessionÁöÑÂàõÂª∫ËÄÖÔºålock‰πüÊòØÂèØ‰ª•Ë¢´ÈáäÊîæÁöÑ„ÄÇËøôÁßçËÆæËÆ°ÊòØÂÖÅËÆ∏Êìç‰ΩúËÄÖÂπ≤È¢ÑÊù•ÁªàÊ≠¢‰ºöËØùÔºåÂú®ÈúÄË¶ÅÁöÑÊó∂ÂÄô„ÄÇÂ¶Ç‰∏äÊâÄËø∞Ôºå‰ºöËØùÊó†Êïà‰πüÂ∞ÜÂØºËá¥ÊâÄÊúâË¢´ÊåÅÊúâÁöÑÈîÅË¢´ÈáäÊîæÊàñÂà†Èô§„ÄÇÂΩìÈîÅË¢´ÈáäÊîæÊó∂ÔºåLockIndex‰∏ç‰ºöÂèòÂåñÔºå‰ΩÜÊòØsession‰ºöË¢´Ê∏ÖÁ©∫ÔºåÂπ∂‰∏îModifyIndexÈÄíÂ¢û„ÄÇËøô‰∫õËØ≠‰πâÂÖÅËÆ∏ÂÖÉÁªÑÔºàKeyÔºåLockIndexÔºåSessionÔºâ‰Ωú‰∏∫‰∏Ä‰∏™Áã¨ÁâπÁöÑ‚ÄúÂ∫èÂàó‚Äù„ÄÇËøô‰∏™Â∫èÂàóÂèØ‰ª•Ë¢´‰º†ÈÄíÂíåÁî®‰∫éÈ™åËØÅËØ∑Ê±ÇÊòØÂê¶Â±û‰∫éÂΩìÂâçÁöÑÈîÅÊåÅÊúâËÄÖ„ÄÇÂõ†‰∏∫ÊØèÊ¨°acquire ÈÉΩ‰ºöÂØºËá¥LockIndexÈÄíÂ¢ûÔºåÂç≥‰ΩøÂêå‰∏Ä‰ºöËØù‰∏≠ÈáçÊñ∞Ëé∑ÂèñÈîÅÔºåËØ•Â∫èÂàóËÉΩÂ§üÊ£ÄÊµãÂà∞ÈôàÊóßÁöÑËØ∑Ê±Ç„ÄÇÂêåÊ†∑ÔºåÂ¶ÇÊûú‰ºöËØùÂ§±ÊïàÔºåÁõ∏Â∫îÁöÑLockIndexÂ∞Ü‰∏∫Á©∫„ÄÇË¶ÅÊ∏ÖÊ•öÁöÑÊòØÔºåËøôÁßçÈîÅÁ≥ªÁªüÊòØÁ∫ØÁ≤πÁöÑÂí®ËØ¢„ÄÇÂπ∂‰∏çÊòØÂº∫Âà∂ClientÂøÖÈ°ªËé∑ÂèñÈîÅÂÜçËÉΩÊâßË°åÊìç‰Ωú‰Ωú„ÄÇ‰ªª‰ΩïÂÆ¢Êà∑Á´ØÈÉΩÂèØ‰ª•Âú®Êú™Ëé∑ÂæóÈîÅÁöÑÊÉÖÂÜµ‰∏ãËØªÂèñ„ÄÅÂÜôÂÖ•ÂíåÂà†Èô§KeyÊìç‰Ωú„ÄÇÂÆÉ‰∏çÊòØConsulÁî®‰∫é‰øùÊä§Á≥ªÁªüÁöÑÊñπÊ≥ï„ÄÇ 2. consulÊû∂ÊûÑ‰∏äÈù¢‰ªãÁªç‰∫ÜconsulÁöÑÊäÄÊúØÂÜÖÂπï„ÄÇÁé∞Âú®Êù•ËÆ≤ËÆ≤consulÁöÑÊû∂ÊûÑ„ÄÇ ÊãÜËß£ÂºÄËøô‰∏™‰ΩìÁ≥ªÔºå‰ªéÊØè‰∏Ä‰∏™ÁªÑ‰ª∂ÂºÄÂßã‰∫ÜËß£„ÄÇÈ¶ñÂÖàÔºåÂèØ‰ª•ÁúãÂà∞Êúâ‰∏§‰∏™Êï∞ÊçÆ‰∏≠ÂøÉÔºåÂàÜÂà´Ê†áËÆ∞‰∏∫‚Äúone‚ÄùÂíå‚Äútwo‚Äù„ÄÇConsulÊòØÊîØÊåÅÂ§öÊï∞ÊçÆ‰∏≠ÂøÉ‰∏ÄÊµÅÔºåÂπ∂‰∏îÊòØÂ∏∏Áî®‰∏öÂä°Âú∫ÊôØ„ÄÇ ÊØè‰∏™Êï∞ÊçÆ‰∏≠ÂøÉÈÉΩÊòØÁî±ServerÂíåclientÁªÑÊàê„ÄÇÂª∫ËÆÆÊúâ3~5Âè∞ServerÔºåÂü∫‰∫éÊïÖÈöúÂ§ÑÁêÜÂíåÊÄßËÉΩÁöÑÂπ≥Ë°°‰πãÁ≠ñ„ÄÇÂ¶ÇÊûúÂ¢ûÂä†Ë∂äÂ§öÁöÑÊú∫Âô®ÔºåÂàôConsensus‰ºöË∂äÊù•Ë∂äÊÖ¢„ÄÇÂØπclientÊ≤°ÊúâÈôêÂà∂ÔºåÂèØ‰ª•ÂæàÂÆπÊòìÂú∞Êâ©Â±ïÂà∞ÊàêÂçÉ‰∏ä‰∏áÊàñÊï∞‰∏á„ÄÇÂêå‰∏Ä‰∏™Êï∞ÊçÆ‰∏≠ÂøÉÁöÑÊâÄÊúâËäÇÁÇπÈÉΩË¶ÅÂä†ÂÖ•GossipÂçèËÆÆ„ÄÇËøôÊÑèÂë≥ÁùÄgossip poolÂåÖÂê´ÁªôÂÆöÊï∞ÊçÆ‰∏≠ÂøÉÁöÑÊâÄÊúâËäÇÁÇπ„ÄÇÊúâ‰ª•‰∏ãÁõÆÁöÑÔºöÈ¶ñÂÖàÔºåÊ≤°ÊúâÂøÖË¶Å‰∏∫clientÈÖçÁΩÆÊúçÂä°Âô®Âú∞ÂùÄÂèÇÊï∞ÔºõÂèëÁé∞ÊòØËá™Âä®ÂÆåÊàêÁöÑ„ÄÇÁ¨¨‰∫åÔºåËäÇÁÇπÊïÖÈöúÊ£ÄÊµãÁöÑÂ∑•‰Ωú‰∏çÊòØÊîæÁΩÆÂú®ÊúçÂä°Âô®‰∏äÔºåËÄåÊòØÂàÜÂ∏ÉÂºèÁöÑ„ÄÇËøô‰ΩøÊïÖÈöúÊ£ÄÊµãÊØîÂøÉË∑≥Êú∫Âà∂Êõ¥ÂèØÊâ©Â±ïÊÄß„ÄÇÁ¨¨‰∏âÔºåÂèØÁî®Êù•‰Ωú‰∏∫Ê∂àÊÅØÂ±ÇÈÄöÁü•ÈáçË¶ÅÁöÑ‰∫ã‰ª∂ÔºåÂ¶ÇleaderÈÄâ‰∏æ„ÄÇ ÊØè‰∏™Êï∞ÊçÆ‰∏≠ÂøÉÁöÑÊúçÂä°Âô®ÈÉΩÊòØÂ±û‰∫é‰∏Ä‰∏™Raft peer„ÄÇËøôÊÑèÂë≥ÁùÄÔºå‰ªñ‰ª¨‰∏ÄËµ∑Â∑•‰ΩúÔºåÈÄâÂá∫‰∏Ä‰∏™ÁöÑLeaderÔºåLeader serverÊòØÊúâÈ¢ùÂ§ñÁöÑËÅåË¥£„ÄÇË¥üË¥£Â§ÑÁêÜÊâÄÊúâÁöÑÊü•ËØ¢Âíå‰∫ãÂä°„ÄÇ‰∫ãÂä°‰πüÂøÖÈ°ªÈÄöËøáConsensusÂçèËÆÆÂ§çÂà∂Âà∞ÊâÄÊúâÁöÑ‰ºô‰º¥„ÄÇÁî±‰∫éËøô‰∏ÄË¶ÅÊ±ÇÔºåÂΩìÈùûLeader ServerÊé•Êî∂Âà∞‰∏Ä‰∏™RPCËØ∑Ê±ÇÔºå‰ºöËΩ¨ÂèëÂà∞ÈõÜÁæ§ÁöÑleader„ÄÇ ServerËäÇÁÇπ‰πüÊòØ‰Ωú‰∏∫WAN gossip poolÁöÑ‰∏ÄÈÉ®ÂàÜ„ÄÇËøô‰∏™poolÊòØ‰∏éLAN gossip poolÊòØ‰∏çÂêåÁöÑÔºåÂÆÉ‰∏∫ÂÖ∑ÊúâÊõ¥È´òÂª∂ËøüÁöÑÁΩëÁªúÂìçÂ∫îÂÅö‰∫Ü‰ºòÂåñÔºåÂπ∂‰∏îÂèØËÉΩÂåÖÊã¨ÂÖ∂‰ªñconsulÈõÜÁæ§ÁöÑserverËäÇÁÇπ„ÄÇËÆæËÆ°WANpoolÁöÑÁõÆÁöÑÊòØËÆ©Êï∞ÊçÆ‰∏≠ÂøÉËÉΩÂ§ü‰ª•low-touchÁöÑÊñπÂºèÂèëÁé∞ÂΩºÊ≠§„ÄÇÂ∞Ü‰∏Ä‰∏™Êñ∞ÁöÑÊï∞ÊçÆ‰∏≠ÂøÉÂä†ÂÖ•Áé∞ÊúâÁöÑWAN GossipÊòØÂæàÂÆπÊòìÁöÑ„ÄÇÂõ†‰∏∫Ê±†‰∏≠ÁöÑÊâÄÊúâServerÈÉΩÊòØÂèØÊéßÂà∂ÁöÑÔºåËøô‰πü‰ΩøË∑®Êï∞ÊçÆ‰∏≠ÂøÉÁöÑË¶ÅÊ±Ç„ÄÇÂΩì‰∏Ä‰∏™SerferÊé•Êî∂Âà∞‰∏çÂêåÁöÑÊï∞ÊçÆ‰∏≠ÂøÉÁöÑË¶ÅÊ±ÇÊó∂ÔºåÂÆÉÊääËøô‰∏™ËØ∑Ê±ÇËΩ¨ÂèëÁªôÁõ∏Â∫îÊï∞ÊçÆ‰∏≠ÂøÉÁöÑ‰ªª‰∏ÄServer„ÄÇÁÑ∂ÂêéÔºåÊé•Êî∂Âà∞ËØ∑Ê±ÇÁöÑServerÂèØËÉΩ‰ºöËΩ¨ÂèëÁªôLeader„ÄÇÂ§ö‰∏™Êï∞ÊçÆ‰∏≠ÂøÉ‰πãÈó¥ÊòØ‰ΩéËÄ¶ÂêàÔºå‰ΩÜÁî±‰∫éÊïÖÈöúÊ£ÄÊµã„ÄÅËøûÊé•ÁºìÂ≠òÂ§çÁî®„ÄÅË∑®Êï∞ÊçÆ‰∏≠ÂøÉË¶ÅÊ±ÇÂø´ÈÄüÂíåÂèØÈù†ÁöÑÂìçÂ∫î„ÄÇ 3. consulÈÉ®ÁΩ≤3.1 dockerÂÆâË£ÖdockerÂÆâË£ÖÂæàÁÆÄÂçïÔºåÁ¨îËÄÖËøôËæπÊòØÂü∫‰∫édocker-composeÁöÑÈÖçÁΩÆÊñá‰ª∂ÔºåÂè™ÈúÄË¶ÅÊú¨Âú∞ÂÆâË£ÖÂ•ΩdockerÂíådocker-composeÔºådocker-compose.ymlÂ¶Ç‰∏ãÔºö 12345678version: '3'services: consul: image: consul ports: - "8500:8500" - "8600:8600" - "8300:8300" ÊãâÂèñconsulÂæóÊúÄÊñ∞imageÔºåËøõË°åÁ´ØÂè£Êò†Â∞ÑÔºåÊö¥Èú≤ÂØπÂ§ñÁöÑÁ´ØÂè£8500Ôºå8300. 3.2 ËΩØ‰ª∂ÂÆâË£Ö ‰ªéÂÆòÁΩë‰∏ãËΩΩÁΩ™Ë°åÁöÑconsulÂÆâË£ÖÂåÖÔºåhttps://www.consul.io/downloads.html„ÄÇ Ëß£Âéãconsul_0.6.4_darwin_amd64.zip„ÄÇ Â∞ÜËß£ÂéãÂêéÁöÑ‰∫åËøõÂà∂Êñá‰ª∂consulÊã∑Ë¥ùÂà∞/usr/local/bin‰∏ã„ÄÇ ÂÜôÈÖçÁΩÆÊñá‰ª∂„ÄÇÊúçÂä°Ê≥®ÂÜåÁöÑÈÖçÁΩÆÊñá‰ª∂Â¶Ç‰∏ã: 12345678910111213141516&#123; &quot;service&quot;: &#123; &quot;name&quot;: &quot;redis&quot;, &quot;tags&quot;: [&quot;master&quot;], &quot;address&quot;: &quot;1192.168.1.100&quot;, &quot;port&quot;: 8000, &quot;enableTagOverride&quot;: false, &quot;check&quot;: &#123; &quot;id&quot;: &quot;redis&quot;, &quot;name&quot;: &quot;redis on port 8000&quot;, &quot;tcp&quot;: &quot;localhost:8000&quot;, &quot;interval&quot;: &quot;10s&quot;, &quot;timeout&quot;: &quot;1s&quot; &#125; &#125;&#125; Â¶Ç‰∏äÈÖçÁΩÆÊ≥®ÂÜå‰∫ÜRedisÁöÑ8000Á´ØÂè£ÔºåÂπ∂Â∏¶ÊúâtcpÁöÑhealth check„ÄÇ ËäÇÁÇπÁöÑÈÖçÁΩÆÊñá‰ª∂Ôºö 12345678910111213141516&#123; "datacenter": "east-cn", "data_dir": "/opt/consul", "log_level": "INFO", "node_name": "redis", "server": true, "addresses": &#123; "https": "192.168.1.100" &#125;, "ports": &#123; "https": 0 &#125;, "ui": true, "retry-join": []&#125; ÂΩìÂä†ËΩΩÈÖçÁΩÆÈÄâÈ°πÊó∂ÔºåconsulÊòØÊåâÁÖßËØçÂÖ∏È°∫Â∫è‰ªéÊâÄÊúâÈÖçÁΩÆÊñá‰ª∂ÊàñÁõÆÂΩï‰∏≠Âä†ËΩΩ„ÄÇÊØîÂ¶ÇÔºåa.json‰ºöÂÖà‰∫ée.jsonÂ§ÑÁêÜ„ÄÇÂêéÈù¢ËÆæÂÆöÁöÑÈÖçÁΩÆÈÄâÈ°π‰ºöÂêàÂπ∂Âà∞ÂâçÈù¢ÁöÑÈÖçÁΩÆÈõÜÂêà‰∏≠ÔºåÂ¶ÇÊûúÂ≠òÂú®ÈáçÂ§çÁöÑÈÖçÁΩÆÈÄâÈ°πÂàô‰ºöË¶ÜÁõñ„ÄÇÂΩìÁÑ∂ÔºåÂú®Êüê‰∫õÊÉÖÂÜµ‰∏ãÔºåÊØîÂ¶Ç‰∫ã‰ª∂Â§ÑÁêÜÁ®ãÂ∫èÔºåÂêéÈù¢Â§ÑÁêÜÁ®ãÂ∫è‰ºöËøΩÂä†Âà∞Áé∞ÊúâÁöÑÈÖçÁΩÆÈÄâÈ°π‰∏≠ÔºåÂΩ¢Êàê‰∫ã‰ª∂Â§ÑÁêÜÁ®ãÂ∫èÂàóË°®„ÄÇ 3.3 ÂêØÂä®ÂÖ∑‰ΩìÂêØÂä®ÊñáÊ°£ËßÅconfiguration„ÄÇÂ¶Ç: consul agent -server -config-dir /etc/consul.d -bind=192.168.1.100 -config-dir /etc/consul.d config-dirÈúÄË¶ÅÂä†ËΩΩÁöÑÈÖçÁΩÆÊñá‰ª∂ÁõÆÂΩïÔºåconsulÂ∞ÜÂä†ËΩΩÁõÆÂΩï‰∏ãÊâÄÊúâÂêéÁºÄ‰∏∫‚Äú.json‚ÄùÁöÑÊñá‰ª∂ÔºåÂä†ËΩΩÈ°∫Â∫è‰∏∫Â≠óÊØçÈ°∫Â∫èÔºåÊñá‰ª∂‰∏≠ÈÖçÁΩÆÈÄâÈ°πÂêàÂπ∂ÊñπÂºèÂ¶Çconfig-file„ÄÇËØ•ÂèÇÊï∞ÂèØ‰ª•Â§öÊ¨°ÈÖçÁΩÆ„ÄÇÁõÆÂΩï‰∏≠ÁöÑÂ≠êÁõÆÂΩïÊòØ‰∏ç‰ºöÂä†ËΩΩÁöÑ„ÄÇ data-dirÊ≠§ÁõÆÂΩïÊòØ‰∏∫AgentÂ≠òÊîæstateÊï∞ÊçÆÁöÑ„ÄÇÊòØÊâÄÊúâAgentÈúÄË¶ÅÁöÑÔºåËØ•ÁõÆÂΩïÂ∫îËØ•Â≠òÊîæÂú®ÊåÅ‰πÖÂ≠òÂÇ®‰∏≠Ôºàreboot‰∏ç‰ºö‰∏¢Â§±ÔºâÔºåÂØπ‰∫éserverËßíËâ≤ÁöÑAgentÊòØÂæàÂÖ≥ÈîÆÁöÑ,ÈúÄË¶ÅËÆ∞ÂΩïÈõÜÁæ§Áä∂ÊÄÅ„ÄÇÂπ∂‰∏îËØ•ÁõÆÂΩïÊòØÊîØÊåÅÊñá‰ª∂ÈîÅ„ÄÇ serverËÆæÁΩÆAgentÊòØserverÊ®°ÂºèËøòÊòØclientÊ®°Âºè„ÄÇConsul agentÊúâ‰∏§ÁßçËøêË°åÊ®°ÂºèÔºöServerÂíåClient„ÄÇËøôÈáåÁöÑServerÂíåClientÂè™ÊòØConsulÈõÜÁæ§Â±ÇÈù¢ÁöÑÂå∫ÂàÜÔºå‰∏éÊê≠Âª∫Âú®Cluster‰πã‰∏ä ÁöÑÂ∫îÁî®ÊúçÂä°Êó†ÂÖ≥„ÄÇConsule ServerÊ®°ÂºèagentËäÇÁÇπÁî®‰∫éÈááÁî®raftÁÆóÊ≥ïÁª¥Êä§ConsulÈõÜÁæ§ÁöÑÁä∂ÊÄÅÔºåÂÆòÊñπÂª∫ËÆÆÊØè‰∏™Consul ClusterËá≥Â∞ëÊúâ3‰∏™Êàñ‰ª•‰∏äÁöÑËøêË°åÂú®Server modeÁöÑAgentÔºåClientËäÇÁÇπ‰∏çÈôê„ÄÇ ÂÖ∂‰ªñÂ∏∏Áî®ÁöÑËøòÊúâÔºö clientÂ∞ÜÁªëÂÆöÂà∞clientÊé•Âè£ÁöÑÂú∞ÂùÄÔºåÂèØ‰ª•ÊòØHTTP„ÄÅDNS„ÄÅRPCÊúçÂä°Âô®„ÄÇÈªòËÆ§‰∏∫‚Äú127.0.0.1‚ÄùÔºåÂè™ÂÖÅËÆ∏ÂõûË∑ØËøûÊé•„ÄÇRPCÂú∞ÂùÄ‰ºöË¢´ÂÖ∂‰ªñÁöÑconsulÂëΩ‰ª§‰ΩøÁî®ÔºåÊØîÂ¶Çconsul membersÔºåÊü•ËØ¢agentÂàóË°® nodeËäÇÁÇπÂú®ÈõÜÁæ§ÁöÑÂêçÂ≠óÔºåÂú®ÈõÜÁæ§‰∏≠ÂøÖÈ°ªÊòØÂîØ‰∏ÄÁöÑ„ÄÇÈªòËÆ§‰∏∫ËäÇÁÇπÁöÑHostname„ÄÇ bootstrapËÆæÁΩÆÊúçÂä°ÊòØÂê¶‰∏∫‚Äúbootstrap‚ÄùÊ®°Âºè„ÄÇÂ¶ÇÊûúÊï∞ÊçÆ‰∏≠ÂøÉÂè™Êúâ1‰∏™server agentÔºåÈÇ£‰πàÈúÄË¶ÅËÆæÁΩÆËØ•ÂèÇÊï∞„ÄÇ‰ªéÊäÄÊúØ‰∏äÊù•ËÆ≤ÔºåÂ§Ñ‰∫ébootstrapÊ®°ÂºèÁöÑÊúçÂä°Âô®ÊòØÂèØ‰ª•ÈÄâÊã©Ëá™Â∑±‰Ωú‰∏∫Raft LeaderÁöÑ„ÄÇÂú®consulÈõÜÁæ§‰∏≠ÔºåÂè™Êúâ‰∏Ä‰∏™ËäÇÁÇπÂèØ‰ª•ÈÖçÁΩÆËØ•ÂèÇÊï∞ÔºåÂ¶ÇÊûúÊúâÂ§ö‰∏™ÂèÇÊï∞ÈÖçÁΩÆËØ•ÂèÇÊï∞ÔºåÈÇ£‰πàÈöæ‰ª•‰øùËØÅ‰∏ÄËá¥ÊÄß„ÄÇ bindÁî®‰∫éÈõÜÁæ§ÂÜÖÈÉ®ÈÄö‰ø°ÁöÑIPÂú∞ÂùÄÔºå‰∏éÈõÜÁæ§‰∏≠ÂÖ∂‰ªñËäÇÁÇπ‰∫íËøûÂèØÈÄö„ÄÇÈªòËÆ§‰∏∫‚Äú0.0.0.0‚ÄùÔºåconsulÂ∞Ü‰ΩøÁî®Á¨¨‰∏Ä‰∏™ÊúâÊïàÁöÑÁßÅÊúâIPv4Âú∞ÂùÄ„ÄÇÂ¶ÇÊûúÊåáÂÆö‚Äú[::]‚ÄùÔºåconsulÂ∞Ü‰ΩøÁî®Á¨¨‰∏Ä‰∏™ÊúâÊïàÁöÑÂÖ¨ÂÖ±IPv6Âú∞ÂùÄ„ÄÇ‰ΩøÁî®TCPÂíåUDPÈÄö‰ø°„ÄÇÊ≥®ÊÑèÈò≤ÁÅ´Â¢ôÔºåÈÅøÂÖçÊó†Ê≥ïÈÄö‰ø°„ÄÇ 3.4 ÁªìÊûúÂú®ÂºÄÂêØ‰∫Ü&quot;ui&quot;: trueserver‰∏ªÊú∫‰∏äÔºåÂ¶Çhttp://192.168.1.100:8500/uiÊü•ÁúãÊ≥®ÂÜå‰∏≠ÂøÉÁöÑÊúçÂä°„ÄÇdemo uiÂ¶Ç‰∏ãÔºö 4. ÊÄªÁªìÊú¨Êñá‰ªãÁªç‰∫ÜconsulÁöÑ‰∏Ä‰∫õÂÜÖÂπïÂèäconsulÈÖçÁΩÆÁõ∏ÂÖ≥ÔºåÂπ∂ÂØπÈ°πÁõÆ‰∏≠ÁöÑ‰∏Ä‰∫õÂÆûÈôÖÈÖçÁΩÆËøõË°åÂ±ïÁ§∫„ÄÇÂ∏åÊúõËÉΩÂ§üÂ∏ÆÂä©Â§ßÂÆ∂ÂØπconsulÁõ∏ÂÖ≥ÁöÑÁü•ËØÜÊúâÊâÄ‰∫ÜËß£ÔºåÂπ∂ÂØπ‰∫éÂÖ•Èó®ÈÖçÁΩÆconsulÂíåÂÆûÈôÖÂ∫îÁî®ÊúâÊâÄÁü•ÈÅì„ÄÇ‰∏™‰∫∫ËÆ§‰∏∫ÔºåconsulÂéüÁêÜËøòÊòØÁÆÄÂçïÊòìÊáÇÁöÑÔºåÈõÜÁæ§ÁöÑÈÖçÁΩÆ‰πü‰∏çÂ§çÊùÇÔºåÂÆâÂà©Â§ßÂÆ∂‰ΩøÁî®„ÄÇÂêéÈù¢‰ºöÂÜçÂÜô‰∏ÄÁØá‰ªãÁªçSpring cloud‰∏≠ÈõÜÊàêÂíå‰ΩøÁî®consulÁªÑ‰ª∂‰Ωú‰∏∫Ê≥®ÂÜå‰∏éÂèëÁé∞‰∏≠ÂøÉ„ÄÇ ÂèÇËÄÉÊñáÁåÆconsulÊñáÊ°£consul‰∏≠ÊñáÁøªËØë]]></content>
      <categories>
        <category>‰∏≠Èó¥‰ª∂</category>
      </categories>
      <tags>
        <tag>consul</tag>
        <tag>cluster</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[snowflakeÂçáÁ∫ßÁâàÂÖ®Â±ÄidÁîüÊàê]]></title>
    <url>%2F2017%2F09%2F09%2Fsnowflake%2F</url>
    <content type="text"><![CDATA[1. ËÉåÊôØÂàÜÂ∏ÉÂºèÁ≥ªÁªüÊàñËÄÖÂæÆÊúçÂä°Êû∂ÊûÑÂü∫Êú¨ÈÉΩÈááÁî®‰∫ÜÂàÜÂ∫ìÂàÜË°®ÁöÑËÆæËÆ°ÔºåÂÖ®Â±ÄÂîØ‰∏ÄidÁîüÊàêÁöÑÈúÄÊ±ÇÂèòÂæóÂæàËø´Âàá„ÄÇ‰º†ÁªüÁöÑÂçï‰ΩìÂ∫îÁî®Ôºå‰ΩøÁî®ÂçïÂ∫ìÔºåÊï∞ÊçÆÂ∫ì‰∏≠Ëá™Â¢ûidÂèØ‰ª•ÂæàÊñπ‰æøÂÆûÁé∞„ÄÇÂàÜÂ∫ì‰πãÂêéÔºåÈ¶ñÂÖàÈúÄË¶ÅÂàÜÂ∫ìÈîÆÔºåÂàÜÂ∫ìÈîÆÂøÖÁÑ∂‰∏çËÉΩÈáçÂ§çÔºåÊâÄ‰ª•‰º†ÁªüÁöÑÂÅöÊ≥ïÂπ∂‰∏çËÉΩÊª°Ë∂≥ÈúÄÊ±Ç„ÄÇÊ¶ÇÊã¨‰∏ãÊù•ÔºåÈÇ£‰∏öÂä°Á≥ªÁªüÂØπIDÂè∑ÁöÑË¶ÅÊ±ÇÊúâÂì™‰∫õÂë¢Ôºü 1.ÂÖ®Â±ÄÂîØ‰∏ÄÊÄßÔºö‰∏çËÉΩÂá∫Áé∞ÈáçÂ§çÁöÑIDÂè∑ÔºåÊó¢ÁÑ∂ÊòØÂîØ‰∏ÄÊ†áËØÜÔºåËøôÊòØÊúÄÂü∫Êú¨ÁöÑË¶ÅÊ±Ç„ÄÇ2.Ë∂ãÂäøÈÄíÂ¢ûÔºöÂú®MySQL InnoDBÂºïÊìé‰∏≠‰ΩøÁî®ÁöÑÊòØËÅöÈõÜÁ¥¢ÂºïÔºåÁî±‰∫éÂ§öÊï∞RDBMS‰ΩøÁî®B-treeÁöÑÊï∞ÊçÆÁªìÊûÑÊù•Â≠òÂÇ®Á¥¢ÂºïÊï∞ÊçÆÔºåÂú®‰∏ªÈîÆÁöÑÈÄâÊã©‰∏äÈù¢Êàë‰ª¨Â∫îËØ•Â∞ΩÈáè‰ΩøÁî®ÊúâÂ∫èÁöÑ‰∏ªÈîÆ‰øùËØÅÂÜôÂÖ•ÊÄßËÉΩ„ÄÇ3.ÂçïË∞ÉÈÄíÂ¢ûÔºö‰øùËØÅ‰∏ã‰∏Ä‰∏™ID‰∏ÄÂÆöÂ§ß‰∫é‰∏ä‰∏Ä‰∏™IDÔºå‰æãÂ¶Ç‰∫ãÂä°ÁâàÊú¨Âè∑„ÄÅIMÂ¢ûÈáèÊ∂àÊÅØ„ÄÅÊéíÂ∫èÁ≠âÁâπÊÆäÈúÄÊ±Ç„ÄÇ4.‰ø°ÊÅØÂÆâÂÖ®ÔºöÂ¶ÇÊûúIDÊòØËøûÁª≠ÁöÑÔºåÊÅ∂ÊÑèÁî®Êà∑ÁöÑÊâíÂèñÂ∑•‰ΩúÂ∞±ÈùûÂ∏∏ÂÆπÊòìÂÅö‰∫ÜÔºåÁõ¥Êé•ÊåâÁÖßÈ°∫Â∫è‰∏ãËΩΩÊåáÂÆöURLÂç≥ÂèØÔºõÂ¶ÇÊûúÊòØËÆ¢ÂçïÂè∑Â∞±Êõ¥Âç±Èô©‰∫ÜÔºåÁ´ûÂØπÂèØ‰ª•Áõ¥Êé•Áü•ÈÅìÊàë‰ª¨‰∏ÄÂ§©ÁöÑÂçïÈáè„ÄÇÊâÄ‰ª•Âú®‰∏Ä‰∫õÂ∫îÁî®Âú∫ÊôØ‰∏ãÔºå‰ºöÈúÄË¶ÅIDÊó†ËßÑÂàô„ÄÅ‰∏çËßÑÂàô„ÄÇ ÂÖ∂‰∏≠Á¨¨3ÂíåÁ¨¨4ÁÇπÊòØ‰∫íÊñ•ÁöÑ„ÄÇÈô§‰∫ÜÂäüËÉΩÊÄßÈúÄÊ±ÇÔºåËøòÊúâÊÄßËÉΩÂíåÂèØÈù†ÊÄßÁöÑÈúÄÊ±ÇÔºö Âπ≥ÂùáÂª∂ËøüÂíåTP999Âª∂ËøüÈÉΩË¶ÅÂ∞ΩÂèØËÉΩ‰ΩéÔºõ ÂèØÁî®ÊÄß5‰∏™9Ôºõ È´òQPS„ÄÇ 2. ËøõÈò∂ÂéÜÁ®ãËá™‰ªéÈ°πÁõÆ‰ªéÂçï‰ΩìÂ∫îÁî®ÊãÜÂàÜÊàêÂæÆÊúçÂä°Êû∂ÊûÑÂêéÔºåÂØπÂÖ®Â±ÄidÈÉ®ÂàÜÂÅö‰∫Ü‰∫õÊë∏Á¥¢„ÄÇ 2.1 uuidÂàöÂºÄÂßãÊãÜÂàÜ‰∏öÂä°Ôºåid‰∏ªÈîÆÈÉΩÊòØ‰ΩøÁî®uuidÂ≠óÁ¨¶‰∏≤„ÄÇUUID(Universally Unique Identifier)ÁöÑÊ†áÂáÜÂûãÂºèÂåÖÂê´32‰∏™16ËøõÂà∂Êï∞Â≠óÔºå‰ª•ËøûÂ≠óÂè∑ÂàÜ‰∏∫‰∫îÊÆµÔºåÂΩ¢Âºè‰∏∫8-4-4-4-12ÁöÑ36‰∏™Â≠óÁ¨¶„ÄÇÁ±ª‰ººËøôÊ†∑ÁöÑÂ≠óÁ¨¶‰∏≤Ôºödc5adf0a-d531-11e5-95aa-3c15c2d22392„ÄÇ128‰ΩçÔºåÊ†πÊú¨‰∏çÁî®ÊãÖÂøÉ‰∏çÂ§üÁî®„ÄÇÁîüÊàêÁöÑÊñπÊ≥ï‰πüÂæàÁÆÄÂçïÔºö 1UUID userId = UUID.randomUUID(); uuidÂÖ®ÁêÉÂîØ‰∏ÄÔºåÊú¨Âú∞ÁîüÊàêÔºåÊ≤°ÊúâÁΩëÁªúÊ∂àËÄóÔºå‰∫ßÁîüÁöÑÊÄßËÉΩÁªùÂØπÂèØ‰ª•Êª°Ë∂≥„ÄÇÂÖ∂Áº∫ÁÇπ‰πüÊòØÊòæËÄåÊòìËßÅÁöÑÔºåÊØîËæÉÂç†Âú∞ÊñπÔºåÂíåINTÁ±ªÂûãÁõ∏ÊØîÔºåÂ≠òÂÇ®‰∏Ä‰∏™UUIDË¶ÅËä±Ë¥πÊõ¥Â§öÁöÑÁ©∫Èó¥„ÄÇ‰ΩøÁî®UUIDÂêéÔºåURLÊòæÂæóÂÜóÈïøÔºå‰∏çÂ§üÂèãÂ•Ω„ÄÇID‰Ωú‰∏∫‰∏ªÈîÆÊó∂Âú®ÁâπÂÆöÁöÑÁéØÂ¢É‰ºöÂ≠òÂú®‰∏Ä‰∫õÈóÆÈ¢òÔºåÊØîÂ¶ÇÂÅöDB‰∏ªÈîÆÁöÑÂú∫ÊôØ‰∏ãÔºåUUIDÂ∞±ÈùûÂ∏∏‰∏çÈÄÇÁî®Ôºö MySQLÂÆòÊñπÊúâÊòéÁ°ÆÁöÑÂª∫ËÆÆ‰∏ªÈîÆË¶ÅÂ∞ΩÈáèË∂äÁü≠Ë∂äÂ•ΩÔºå36‰∏™Â≠óÁ¨¶ÈïøÂ∫¶ÁöÑUUID‰∏çÁ¨¶ÂêàË¶ÅÊ±Ç„ÄÇ ÂØπMySQLÁ¥¢Âºï‰∏çÂà©ÔºöÂ¶ÇÊûú‰Ωú‰∏∫Êï∞ÊçÆÂ∫ì‰∏ªÈîÆÔºåÂú®InnoDBÂºïÊìé‰∏ãÔºåUUIDÁöÑÊó†Â∫èÊÄßÂèØËÉΩ‰ºöÂºïËµ∑Êï∞ÊçÆ‰ΩçÁΩÆÈ¢ëÁπÅÂèòÂä®Ôºå‰∏•ÈáçÂΩ±ÂìçÊÄßËÉΩ„ÄÇ 2.2 Êï∞ÊçÆÂ∫ìÁîüÊàê‰ª•MySQL‰∏æ‰æãÔºåÂà©Áî®ÁªôÂ≠óÊÆµËÆæÁΩÆauto_increment_incrementÂíåauto_increment_offsetÊù•‰øùËØÅIDËá™Â¢ûÔºåÊØèÊ¨°‰∏öÂä°‰ΩøÁî®‰∏ãÂàóSQLËØªÂÜôMySQLÂæóÂà∞IDÂè∑„ÄÇÂèÇËÄÉ‰∫ÜLeafÁöÑÂÆûÁé∞ÊÄùÊÉ≥: id serverÊØèÊ¨°ÊâπÈáè‰ªéÊï∞ÊçÆÂ∫ìÂèñÂè∑ÊÆµÔºåÊú¨Âú∞ÁºìÂ≠òËøô‰∏™Âè∑ÊÆµÔºåÂπ∂‰∏îËÆæÁΩÆÈòàÂÄºÔºåÂΩìËææÂà∞0.8ÔºàÂ∑≤Áî®‰∏éÂè∑ÊÆµÂÆπÈáèÁöÑÊØîÂÄºÔºâÔºåËá™Âä®ÂéªËé∑Âèñ‰∏Ä‰∏™Êñ∞ÁöÑÂè∑ÊÆµÔºåÊõ¥Êñ∞Êú¨Âú∞ÁºìÂ≠òÁöÑÂè∑ÊÆµ„ÄÇ id clientÔºåÂç≥ÂÖ∑‰ΩìÁöÑË∞ÉÁî®ÊúçÂä°ÂÆû‰æãÔºåÂú®Êú¨Âú∞‰πüÂÅö‰∏Ä‰∏™ÁºìÂ≠òÔºåÂÆûÁé∞Âíåid serverÁöÑÁºìÂ≠òÂ∑Æ‰∏çÂ§öÔºåËøôÊ†∑ÂÅöÁöÑÁõÆÁöÑÊòØ‰∏∫‰∫ÜÂáèËΩªidÊúçÂä°Á´ØÁöÑÂéãÂäõÔºåÂêåÊó∂ÂáèÂ∞ë‰∫ÜrpcË∞ÉÁî®ÁöÑÁΩëÁªúÊ∂àËÄó„ÄÇ ‰ª•‰∏äÊñπÊ°àÔºåÂÖ∂Áº∫ÁÇπÊòØÔºö Âè∑ÊÆµÂ≠òÂú®Êµ™Ë¥πÔºåÊó†ËÆ∫Âì™‰∏™ÂÆ¢Êà∑Á´ØËøòÊòØÊúçÂä°Á´ØÈáçÂêØÈÉΩ‰ºöÊµ™Ë¥πÂè∑ÊÆµ„ÄÇ Âè∑ÊÆµÊòØÁõ¥Êé•Ëá™Â¢ûÔºå‰∏çÂ§üÈöèÊú∫ÔºåÂØπÂ§ñÊö¥Èú≤‰ø°ÊÅØËøáÂ§ö„ÄÇ DBÂÆïÊú∫‰ºöÈÄ†ÊàêÊï¥‰∏™Á≥ªÁªü‰∏çÂèØÁî®„ÄÇËôΩÁÑ∂Âú®DBÂÆïÊú∫‰πãÂêéÔºåÂà©Áî®ÁºìÂ≠òËøòËÉΩËøõË°åÁü≠ÊöÇ‰æõÂè∑Ôºå‰ΩÜÊòØÊï∞ÊçÆÂ∫ìÁöÑ‰æùËµñËøòÊòØÂæàÈáç„ÄÇLeafÈááÁî®ÁöÑ‰∏ÄËà¨ÂÅöÊ≥ïÊòØÈ´òÂèØÁî®ÂÆπÁÅæ: ÈááÁî®‰∏Ä‰∏ª‰∏§‰ªéÁöÑÊñπÂºèÔºåÂêåÊó∂ÂàÜÊú∫ÊàøÈÉ®ÁΩ≤ÔºåMasterÂíåSlave‰πãÈó¥ÈááÁî®ÂçäÂêåÊ≠•ÊñπÂºèÂêåÊ≠•Êï∞ÊçÆ„ÄÇÂêåÊó∂‰ΩøÁî®DBProxyÂÅö‰∏ª‰ªéÂàáÊç¢„ÄÇÂΩìÁÑ∂ËøôÁßçÊñπÊ°àÂú®‰∏Ä‰∫õÊÉÖÂÜµ‰ºöÈÄÄÂåñÊàêÂºÇÊ≠•Ê®°ÂºèÔºåÁîöËá≥Âú®ÈùûÂ∏∏ÊûÅÁ´ØÊÉÖÂÜµ‰∏ã‰ªçÁÑ∂‰ºöÈÄ†ÊàêÊï∞ÊçÆ‰∏ç‰∏ÄËá¥ÁöÑÊÉÖÂÜµÔºå‰ΩÜÊòØÂá∫Áé∞ÁöÑÊ¶ÇÁéáÈùûÂ∏∏Â∞è„ÄÇ 3. snowflakeÊñπÊ°à3.1 ‰ªãÁªçËÄÉËôëÂà∞‰∏äËø∞ÊñπÊ°àÁöÑÁº∫Èô∑ÔºåÁ¨îËÄÖË∞ÉÊü•‰∫ÜÂÖ∂‰ªñÁöÑÁîüÊàêÊñπÊ°àÔºåsnowflakeÂ∞±ÊòØÂÖ∂‰∏≠‰∏ÄÁßçÊñπÊ°à„ÄÇË∂ãÂäøÈÄíÂ¢ûÂíå‰∏çÂ§üÈöèÊú∫ÁöÑÈóÆÈ¢òÔºåÂú®snowflakeÂÆåÂÖ®ÂèØ‰ª•Ëß£ÂÜ≥ÔºåSnowflake IDÊúâ64bitsÈïøÔºåÁî±‰ª•‰∏ã‰∏âÈÉ®ÂàÜÁªÑÊàêÔºö Á¨¨‰∏Ä‰Ωç‰∏∫0Ôºå‰∏çÁî®„ÄÇ timestamp‚Äî41bits,Á≤æÁ°ÆÂà∞msÔºåÈÇ£Â∞±ÊÑèÂë≥ÁùÄÂÖ∂ÂèØ‰ª•Ë°®Á§∫ÈïøËææ(2^41-1)/(1000360024*365)=139.5Âπ¥ÔºåÂè¶Â§ñ‰ΩøÁî®ËÄÖÂèØ‰ª•Ëá™Â∑±ÂÆö‰πâ‰∏Ä‰∏™ÂºÄÂßãÁ∫™ÂÖÉÔºàepoch)ÔºåÁÑ∂ÂêéÁî®(ÂΩìÂâçÊó∂Èó¥-ÂºÄÂßãÁ∫™ÂÖÉÔºâÁÆóÂá∫timeÔºåËøôË°®Á§∫Âú®timeËøô‰∏™ÈÉ®ÂàÜÂú®140Âπ¥ÁöÑÊó∂Èó¥ÈáåÊòØ‰∏ç‰ºöÈáçÂ§çÁöÑÔºåÂÆòÊñπÊñáÊ°£Âú®ËøôÈáåÂÜôÊàê‰∫Ü41bitsÔºåÂ∫îËØ•ÊòØÂÜôÈîô‰∫Ü„ÄÇÂè¶Â§ñÔºåËøôÈáåÁî®timeËøòÊúâ‰∏Ä‰∏™ÂæàÈáçË¶ÅÁöÑÂéüÂõ†ÔºåÂ∞±ÊòØÂèØ‰ª•Áõ¥Êé•Êõ¥ÂÖ∑timeËøõË°åÊéíÂ∫èÔºåÂØπ‰∫étwitterËøôÁßçÊõ¥Êñ∞È¢ëÁπÅÁöÑÂ∫îÁî®ÔºåÊó∂Èó¥ÊéíÂ∫èÂ∞±ÊòæÂæóÂ∞§‰∏∫ÈáçË¶Å‰∫Ü„ÄÇ machine id‚Äî10bits,ËØ•ÈÉ®ÂàÜÂÖ∂ÂÆûÁî±datacenterIdÂíåworkerId‰∏§ÈÉ®ÂàÜÁªÑÊàêÔºåËøô‰∏§ÈÉ®ÂàÜÊòØÂú®ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÊåáÊòéÁöÑ„ÄÇ datacenterIdÔºåÊñπ‰æøÊê≠Âª∫Â§ö‰∏™ÁîüÊàêuidÁöÑserviceÔºåÂπ∂‰øùËØÅuid‰∏çÈáçÂ§çÔºåÊØîÂ¶ÇÂú®datacenter0Â∞ÜÊú∫Âô®0Ôºå1Ôºå2ÁªÑÊàê‰∫Ü‰∏Ä‰∏™ÁîüÊàêuidÁöÑserviceÔºåËÄådatacenter1Ê≠§Êó∂‰πüÈúÄË¶Å‰∏Ä‰∏™ÁîüÊàêuidÁöÑserviceÔºå‰ªéÊú¨‰∏≠ÂøÉËé∑ÂèñuidÊòæÁÑ∂ÊòØÊúÄÂø´ÊúÄÊñπ‰æøÁöÑÔºåÈÇ£‰πàÂÆÉÂèØ‰ª•Âú®Ëá™Â∑±‰∏≠ÂøÉÊê≠Âª∫ÔºåÂè™Ë¶Å‰øùËØÅdatacenterIdÂîØ‰∏Ä„ÄÇÂ¶ÇÊûúÊ≤°ÊúâdatacenterIdÔºåÂç≥Áî®10bitsÔºåÈÇ£‰πàÂú®Êê≠Âª∫‰∏Ä‰∏™Êñ∞ÁöÑserviceÂâçÂøÖÈ°ªÁü•ÈÅìÁõÆÂâçÂ∑≤ÁªèÂú®Áî®ÁöÑidÔºåÂê¶Âàô‰∏çËÉΩ‰øùËØÅÁîüÊàêÁöÑidÂîØ‰∏ÄÔºåÊØîÂ¶ÇÊê≠Âª∫ÁöÑ‰∏§‰∏™uid service‰∏≠ÈÉΩÊúâmachine id‰∏∫100ÁöÑÊú∫Âô®ÔºåÂ¶ÇÊûúÂÖ∂serverÊó∂Èó¥Áõ∏ÂêåÔºåÈÇ£‰πà‰∫ßÁîüÁõ∏ÂêåidÁöÑÊÉÖÂÜµ‰∏çÂèØÈÅøÂÖç„ÄÇ workerIdÊòØÂÆûÈôÖserverÊú∫Âô®ÁöÑ‰ª£Âè∑ÔºåÊúÄÂ§ßÂà∞32ÔºåÂêå‰∏Ä‰∏™datacenter‰∏ãÁöÑworkerIdÊòØ‰∏çËÉΩÈáçÂ§çÁöÑ„ÄÇÂÆÉ‰ºöË¢´Ê≥®ÂÜåÂà∞consul‰∏äÔºåÁ°Æ‰øùworkerIdÊú™Ë¢´ÂÖ∂‰ªñÊú∫Âô®Âç†Áî®ÔºåÂπ∂Â∞Ühost:portÂÄºÂ≠òÂÖ•ÔºåÊ≥®ÂÜåÊàêÂäüÂêéÂ∞±ÂèØ‰ª•ÂØπÂ§ñÊèê‰æõÊúçÂä°‰∫Ü„ÄÇ sequence id ‚Äî12bits,ËØ•idÂèØ‰ª•Ë°®Á§∫4096‰∏™Êï∞Â≠óÔºåÂÆÉÊòØÂú®timeÁõ∏ÂêåÁöÑÊÉÖÂÜµ‰∏ãÔºåÈÄíÂ¢ûËØ•ÂÄºÁõ¥Âà∞‰∏∫0ÔºåÂç≥‰∏Ä‰∏™Âæ™ÁéØÁªìÊùüÔºåÊ≠§Êó∂‰æøÂè™ËÉΩÁ≠âÂà∞‰∏ã‰∏Ä‰∏™msÂà∞Êù•Ôºå‰∏ÄËà¨ÊÉÖÂÜµ‰∏ã4096/msÁöÑËØ∑Ê±ÇÊòØ‰∏çÂ§™ÂèØËÉΩÂá∫Áé∞ÁöÑÔºåÊâÄ‰ª•Ë∂≥Â§ü‰ΩøÁî®‰∫Ü„ÄÇ 3.2 ÂÆûÁé∞ÊÄùË∑ØsnowflakeÊñπÊ°àÔºåidÊúçÂä°Á´ØÁîüÊàêÔºå‰∏ç‰æùËµñDBÔºåÊó¢ËÉΩ‰øùËØÅÊÄßËÉΩÔºå‰∏îÁîüÊàêÁöÑidË∂≥Â§üÈöèÊú∫„ÄÇÊØè‰∏ÄÊØ´ÁßíÔºå‰∏ÄÂè∞workerÂèØ‰ª•ÁîüÊàê4096‰∏™idÔºåÂ¶ÇÊûúË∂ÖËøáÔºå‰ºöÈòªÂ°ûÂà∞‰∏ã‰∏ÄÊØ´ÁßíÁîüÊàê„ÄÇÂØπ‰∫éÈÇ£‰∫õÂπ∂ÂèëÈáèÂæàÂ§ßÁöÑÁ≥ªÁªüÊù•ËØ¥,ÊòæÁÑ∂ÊòØ‰∏çÂ§üÁöÑ, ÈÇ£‰πàËøô‰∏™Êó∂ÂÄôÂ∞±ÊòØÈÄöËøádatacenterIdÂíåworkerIdÊù•ÂÅöÂå∫ÂàÜ,Ëøô‰∏§‰∏™ID,ÂàÜÂà´ÊòØ5bit,ÂÖ±10bit,ÊúÄÂ§ßÂÄºÊòØ1024(0-1023)‰∏™, Âú®ËøôÁßçÊÉÖÂÜµ‰∏ã,snowflake‰∏ÄÊØ´ÁßíÁêÜËÆ∫‰∏äÊúÄÂ§ßËÉΩÂ§üÁîüÊàêÁöÑIDÊï∞ÈáèÊòØÁ∫¶42W‰∏™,ËøôÊòØ‰∏Ä‰∏™ÈùûÂ∏∏Â§ßÁöÑÂü∫Êï∞‰∫Ü,ÁêÜËÆ∫‰∏äËÉΩÂ§üÊª°Ë∂≥ÁªùÂ§ßÂ§öÊï∞Á≥ªÁªüÁöÑÂπ∂ÂèëÈáè„ÄÇ ËØ•ÊñπÊ°à‰æùËµñ‰∫éÁ≥ªÁªüÊó∂ÈíüÔºåÈúÄË¶ÅËÄÉËôëÊó∂ÈíüÂõûÊã®ÁöÑÈóÆÈ¢ò„ÄÇÊú¨Âú∞ÁºìÂ≠ò‰∏ä‰∏ÄÊ¨°ËØ∑Ê±ÇÁöÑlastTimestampÔºå‰∏Ä‰∏™Á∫øÁ®ãËøáÊù•Ëé∑ÂèñidÊó∂ÔºåÈ¶ñÂÖàÊ†°È™åÂΩìÂâçÊó∂Èó¥ÊòØÂê¶Â∞è‰∫é‰∏ä‰∏ÄÊ¨°IDÁîüÊàêÁöÑÊó∂Èó¥Êà≥„ÄÇÂ¶ÇÊûúÂ∞è‰∫éËØ¥ÊòéÁ≥ªÁªüÊó∂ÈíüË¢´‰øÆÊîπËøáÔºåÂõûÈÄÄÂú®‰∏ä‰∏ÄÊ¨°IDÁîüÊàêÊó∂Èó¥‰πãÂâçÂ∫îÂΩìÊäõÂá∫ÂºÇÂ∏∏ÔºÅÂ¶ÇÊ≠§ÂèØ‰ª•Ëß£ÂÜ≥ËøêË°å‰∏≠ÔºåÁ≥ªÁªüÊó∂ÈíüË¢´‰øÆÊîπÁöÑÈóÆÈ¢ò„ÄÇ Âè¶‰∏ÄÁßçÊÉÖÂÜµÊòØÔºåserverÊúçÂä°ÂêØÂä®Êó∂ÔºåÁ≥ªÁªüÁöÑÊó∂Èó¥Ë¢´ÂõûÊã®ÔºàËôΩÁÑ∂ÊØîËæÉÊûÅÁ´ØÔºåËøòÊòØÂàóÂú®ËÄÉËôë‰∏≠ÔºâÔºåËøôÊ†∑ÊúâÂèØËÉΩ‰∏é‰πãÂâçÁîüÊàêÁöÑidÂÜ≤Á™ÅÔºåÂÖ®Â±Ä‰∏çÂîØ‰∏Ä„ÄÇËøôËæπËß£ÂÜ≥ÊñπÊ≥ïÊòØÂà©Áî®È°πÁõÆÁöÑÊúçÂä°ÂèëÁé∞‰∏éÊ≥®ÂÜåÁªÑ‰ª∂consulÔºåÂú®consulÈõÜÁæ§Â≠òÂÇ®ÊúÄÊñ∞ÁöÑlastTimestampÔºåkey‰∏∫ÂØπÂ∫îÁöÑmachine-id„ÄÇconsulÁöÑ‰∏ÄËá¥ÊÄßÂü∫‰∫éraftÁÆóÊ≥ïÔºåÂπ∂Âà©Áî®GossipÂçèËÆÆÔºö Consul uses a gossip protocol to manage membership and broadcast messages to the cluster. All of this is provided through the use of the Serf library. ÂÖ∑‰ΩìÁöÑÂçèËÆÆÁÆóÊ≥ïÔºåÂèØ‰ª•ÂèÇËÄÉGossip„ÄÇÊØèÊ¨°serverÂÆû‰æãÂêØÂä®Êó∂ÔºåÂÆû‰æãÂåñidÁîüÊàêbeanÁöÑÊó∂ÂÄôÔºå‰ºöÈ¶ñÂÖàÊ†°È™åÂΩìÂâçÊó∂Èó¥‰∏éconsulÈõÜÁæ§‰∏≠ËØ•workerÂØπÂ∫îÁöÑlastTimestampÂ§ßÂ∞èÔºåÂ¶ÇÊûúÂΩìÂâçÊó∂Èó¥ÂÅèÂ∞èÔºåÂàôÊäõÂá∫ÂºÇÂ∏∏ÔºåÊúçÂä°ÂêØÂä®Â§±Ë¥•Âπ∂Êä•Ë≠¶„ÄÇ Á¨îËÄÖÈ°πÁõÆÊöÇÊó∂Êú™ÂàÜdata centerÔºåÊâÄ‰ª•machine-idÈÉ®ÂàÜÈÉΩÊòØ‰ª•ÊúçÂä°ÂÆû‰æãÁöÑworkid‰ª£Êõø„ÄÇworkidÂèØ‰ª•‰ªéÈÖçÁΩÆ‰∏≠ÂøÉËé∑ÂèñÔºå‰πüÂèØ‰ª•Êú¨Âú∞ÈÖçÁΩÆ„ÄÇÁÆÄÂåñÁöÑÁ≥ªÁªüÊû∂ÊûÑÈÉ®ÁΩ≤ÂõæÂ¶Ç‰∏ãÔºö consulÈõÜÁæ§ËøôËæπ‰Ωú‰∏∫Êèê‰æõnaming serviceÂíåkvÂ≠òÂÇ®ÁöÑÁªÑ‰ª∂ÔºåÊØè‰∏™ÊúçÂä°ÈÉ®ÁΩ≤ÂêéÊ≥®ÂÜåÂà∞consulÈõÜÁæ§ÔºåËá≥‰∫éconsulÈõÜÁæ§Áõ∏ÂÖ≥ÁöÑ‰ø°ÊÅØÔºå‰ª•ÂèäconsulÊàêÂëòÁöÑ‰∏ÄËá¥ÊÄßÁõ∏ÂÖ≥ÔºåÂêéÈù¢ÂçïÁã¨‰∏ÄÁØáÊñáÁ´†ËØ¶ÁªÜ‰ªãÁªç„ÄÇ ËØ∑Ê±ÇidÁîüÊàêÊµÅÁ®ãÂõæÂ¶Ç‰∏ãÔºö ÊúçÂä°ÂÆû‰æãÂêØÂä®ÁöÑÊµÅÁ®ãÂõæËßÅ‰∏äÊñáÔºåÊ≠§Â§Ñ‰∏çÁîªÂá∫‰∫Ü„ÄÇËøôËæπÈúÄË¶ÅÂº∫Ë∞ÉÁöÑÊòØÔºåÊúçÂä°Ê≥®ÂÜå‰∏éÂèëÁé∞ÁªÑ‰ª∂consul„ÄÇÈÉ®ÁΩ≤Êó∂ÊØè‰∏™ÊúçÂä°ÂÆû‰æãÈÉΩ‰ºöÊ≥®ÂÜåÂà∞‰∏Ä‰∏™consul agentÔºà‰∏ÄËà¨ÊòØÊú¨Êú∫ÔºâÔºåconsul agentËøûÊé•Âà∞consulÈõÜÁæ§ÔºåÈÄöËøágossipÂçèËÆÆËøõË°åÂπøÊí≠‰ø°ÊÅØÔºåÊâÄ‰ª•Â¶ÇÊûúËøûÊé•ÁöÑconsul agentËøõÁ®ã‰∏çÂπ∏ÊåÇÊéâÔºàÂ§ßÂ§ö‰∏∫Á≥ªÁªüÂÆïÊú∫ÔºâÔºåÂú®ËøõÁ®ãÈáçÂêØÂêéÔºåËøòÊòØËÉΩËøÖÈÄüËé∑ÂèñÂà∞ÈõÜÁæ§‰∏≠Â≠òÂÇ®ÁöÑËØ•workidÁöÑlastTimestampÔºåÈíàÂØπËØ•workidÔºåÂ¶ÇÊûúÁ≥ªÁªüÊó∂Èó¥ÂõûÊã®Â∞è‰∫élastTimestampÔºåGeneratorÂêØÂä®Êó∂‰ºöÊä•Ë≠¶„ÄÇËÄåÂØπ‰∫éÂ§ß‰∫élastTimestampÁöÑÊÉÖÂÜµÔºåÂèØËÉΩÁ≥ªÁªüÊó∂ÈíüËøòÊòØÁõ∏ÂØπÂõûÊã®ÔºåÊàë‰ª¨Âßë‰∏îÂèØ‰ª•ËÆ§‰∏∫ÂØπÂÖ®Â±ÄidÊ≤°ÊúâÂΩ±Âìç„ÄÇ ÂÆû‰æãÂåñÊó∂ÔºåËøõË°åÊ†°È™åÔºö 123456789public IdServiceImpl(long workerId, ConsulClient consulClient) &#123; if (workerId &gt; idMeta.MAX_ID || workerId &lt; 0) &#123; throw new IllegalArgumentException(String.format("worker Id can't be greater than %d or less than 0", idMeta.MAX_ID)); &#125; this.workerId = workerId; this.consulClient = consulClient; validateStoredTimestamp(); log.info("worker starting. timestamp left shift &#123;&#125;, worker id bits &#123;&#125;, sequence bits &#123;&#125;, workerid &#123;&#125;", idMeta.TIMESTAMP_LEFT_SHIFT_BITS, idMeta.ID_BITS, idMeta.SEQUENCE_BITS, workerId);&#125; Ê†°È™åÂáΩÊï∞Ôºö 123456789101112131415/** * checks for timestamp by workerId when server starts. * if server starts for the first time, just let it go and log warns. * if current timestamp is smaller than the value stored in consul server, throw exception. */private void validateStoredTimestamp() &#123; long current = timeGen(); Response&lt;GetValue&gt; keyValueResponse = consulClient.getKVValue(String.valueOf(workerId)); if (keyValueResponse.getValue() != null) &#123; lastTimestamp = Long.parseLong(keyValueResponse.getValue().getDecodedValue()); validateTimestamp(current, lastTimestamp, Periods.START); &#125; else &#123; log.warn(String.format("clock in consul is null. Generator works as for the 1st time.")); &#125;&#125; validateTimestamp: 123456789101112/** * Â¶ÇÊûúÂΩìÂâçÊó∂Èó¥Êà≥Â∞è‰∫é‰∏ä‰∏ÄÊ¨°IDÁîüÊàêÁöÑÊó∂Èó¥Êà≥ÔºåËØ¥ÊòéÁ≥ªÁªüÊó∂ÈíüË¢´‰øÆÊîπËøáÔºåÂõûÈÄÄÂú®‰∏ä‰∏ÄÊ¨°IDÁîüÊàêÊó∂Èó¥‰πãÂâçÂ∫îÂΩìÊäõÂá∫ÂºÇÂ∏∏ÔºÅÔºÅÔºÅ * * @param lastTimestamp ‰∏ä‰∏ÄÊ¨°IDÁîüÊàêÁöÑÊó∂Èó¥Êà≥ * @param timestamp ÂΩìÂâçÊó∂Èó¥Êà≥ */ private void validateTimestamp(long timestamp, long lastTimestamp, Periods period) &#123; if (timestamp &lt; lastTimestamp) &#123; log.error(String.format("clock is moving backwards. Rejecting requests until %d.", lastTimestamp)); throw new IllegalStateException(String.format("Clock moved backwards in %s. Refusing to generate id for %d milliseconds", period, lastTimestamp - timestamp)); &#125; &#125; Ëé∑ÂèñidÊñπÊ≥ïÔºö 123456789101112131415161718192021222324252627/** * ÁîüÊàêIDÔºàÁ∫øÁ®ãÂÆâÂÖ®Ôºâ * * @return id */ public synchronized long genId() &#123; long timestamp = timeGen(); //Â¶ÇÊûúÂΩìÂâçÊó∂Èó¥Â∞è‰∫é‰∏ä‰∏ÄÊ¨°IDÁîüÊàêÁöÑÊó∂Èó¥Êà≥ÔºåËØ¥ÊòéÁ≥ªÁªüÊó∂ÈíüË¢´‰øÆÊîπËøáÔºåÂõûÈÄÄÂú®‰∏ä‰∏ÄÊ¨°IDÁîüÊàêÊó∂Èó¥‰πãÂâçÂ∫îÂΩìÊäõÂá∫ÂºÇÂ∏∏ÔºÅÔºÅÔºÅ validateTimestamp(timestamp, lastTimestamp, Periods.RUNNING); //Â¶ÇÊûúÊòØÂêå‰∏ÄÊó∂Èó¥ÁîüÊàêÁöÑÔºåÂàôËøõË°åÊØ´ÁßíÂÜÖsequenceÁîüÊàê if (lastTimestamp == timestamp) &#123; sequence = (sequence + 1) &amp; IdMeta.SEQUENCE_MASK; //Ê∫¢Âá∫Â§ÑÁêÜ if (sequence == 0) &#123;//ÈòªÂ°ûÂà∞‰∏ã‰∏ÄÊØ´Áßí,Ëé∑ÂæóÊñ∞Êó∂Èó¥Êà≥ timestamp = tilNextMillis(lastTimestamp); &#125; &#125; else &#123;//Êó∂Èó¥Êà≥ÊîπÂèòÔºåÊØ´ÁßíÂÜÖsequenceÈáçÁΩÆ sequence = 0L; &#125; //‰∏äÊ¨°ÁîüÊàêIDÊó∂Èó¥Êà™ lastTimestamp = timestamp; consulClient.setKVValue(String.valueOf(workerId), String.valueOf(lastTimestamp)); //Áßª‰ΩçÂπ∂ÈÄöËøáÊàñËøêÁÆóÁªÑÊàê64‰ΩçID return ((timestamp - idMeta.START_TIME) &lt;&lt; idMeta.TIMESTAMP_LEFT_SHIFT_BITS) | (workerId &lt;&lt; idMeta.ID_SHIFT_BITS) | sequence; &#125; 4. ÊÄªÁªìËøôÁØáÊñáÁ´†ÂíåÂ§ßÂÆ∂ÂàÜ‰∫´‰∫ÜÁ¨îËÄÖÈ°πÁõÆ‰∏≠ÂÖ®Â±ÄidÁîüÊàêÊúçÂä°ÁöÑÊºîËøõËøáÁ®ã„ÄÇÂΩìÂâçÁöÑÊñπÊ°àÂèØ‰ª•Êª°Ë∂≥Á¨îËÄÖÂΩìÂâçÈ°πÁõÆÁöÑÈúÄÊ±ÇÔºåËá≥‰∫éÂàÜdata-centerÔºàÂêå‰∏Ä‰∏™Êú∫Êàø‰ºòÂÖàË∞ÉÁî®ÔºâÔºåÈúÄË¶ÅÁªìÂêàrpcË∞ÉÁî®Ëøõ‰∏ÄÊ≠•ÂÅöÂ§ÑÁêÜÔºåÊâÄ‰ª•ËøôÂùóÂêéÁª≠ÂèØ‰ª•ÁªßÁª≠ÂÆåÂñÑ„ÄÇÊ¨¢ËøéÂ§ßÂÆ∂ÊèêÂá∫Âª∫ËÆÆ„ÄÇ Êú¨ÊñáÁöÑÊ∫êÁ†ÅÂú∞ÂùÄÔºöGitHubÔºöhttps://github.com/keets2012/snowflake-id-generatorÁ†Å‰∫ëÔºö https://gitee.com/keets/snowflake-id-generator ÂèÇËÄÉÔºö www.consul.io leaf TwitterÁöÑÂàÜÂ∏ÉÂºèËá™Â¢ûIDÁÆóÊ≥ïsnowflake (JavaÁâà)]]></content>
      <categories>
        <category>ÂæÆÊúçÂä°</category>
      </categories>
      <tags>
        <tag>spring boot</tag>
        <tag>snowflake</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ê∑±ÂÖ•ThreadLocal]]></title>
    <url>%2F2017%2F09%2F04%2FThreadLocal%2F</url>
    <content type="text"><![CDATA[ThreadLocal‰∏ªË¶ÅÊòØÊèê‰æõÁ∫øÁ®ãÂÜÖÈÉ®ÁöÑÂ±ÄÈÉ®ÂèòÈáèÔºåÂú®ÊØè‰∏™Á∫øÁ®ãÂÜÖÈöèÊó∂ÈöèÂú∞ÂèØÂèñÔºåÈöîÁ¶ªÂÖ∂‰ªñÁ∫øÁ®ã„ÄÇ 1. ThreadLocalÊé•Âè£1.1 ThreadLocalÁ±ªÊé•Âè£ÂæàÁÆÄÂçïÔºåÂè™Êúâ4‰∏™ÊñπÊ≥ïÔºåÊàë‰ª¨ÂÖàÊù•‰∫ÜËß£‰∏Ä‰∏ãÔºö void set(Object value)ËÆæÁΩÆÂΩìÂâçÁ∫øÁ®ãÁöÑÁ∫øÁ®ãÂ±ÄÈÉ®ÂèòÈáèÁöÑÂÄº„ÄÇ public Object get()ËØ•ÊñπÊ≥ïËøîÂõûÂΩìÂâçÁ∫øÁ®ãÊâÄÂØπÂ∫îÁöÑÁ∫øÁ®ãÂ±ÄÈÉ®ÂèòÈáè„ÄÇ public void remove()Â∞ÜÂΩìÂâçÁ∫øÁ®ãÂ±ÄÈÉ®ÂèòÈáèÁöÑÂÄºÂà†Èô§ÔºåÁõÆÁöÑÊòØ‰∏∫‰∫ÜÂáèÂ∞ëÂÜÖÂ≠òÁöÑÂç†Áî®ÔºåËØ•ÊñπÊ≥ïÊòØJDK 5.0Êñ∞Â¢ûÁöÑÊñπÊ≥ï„ÄÇÈúÄË¶ÅÊåáÂá∫ÁöÑÊòØÔºåÂΩìÁ∫øÁ®ãÁªìÊùüÂêéÔºåÂØπÂ∫îËØ•Á∫øÁ®ãÁöÑÂ±ÄÈÉ®ÂèòÈáèÂ∞ÜËá™Âä®Ë¢´ÂûÉÂúæÂõûÊî∂ÔºåÊâÄ‰ª•ÊòæÂºèË∞ÉÁî®ËØ•ÊñπÊ≥ïÊ∏ÖÈô§Á∫øÁ®ãÁöÑÂ±ÄÈÉ®ÂèòÈáèÂπ∂‰∏çÊòØÂøÖÈ°ªÁöÑÊìç‰ΩúÔºå‰ΩÜÂÆÉÂèØ‰ª•Âä†Âø´ÂÜÖÂ≠òÂõûÊî∂ÁöÑÈÄüÂ∫¶„ÄÇ protected Object initialValue()ËøîÂõûËØ•Á∫øÁ®ãÂ±ÄÈÉ®ÂèòÈáèÁöÑÂàùÂßãÂÄºÔºåËØ•ÊñπÊ≥ïÊòØ‰∏Ä‰∏™protectedÁöÑÊñπÊ≥ïÔºåÊòæÁÑ∂ÊòØ‰∏∫‰∫ÜËÆ©Â≠êÁ±ªË¶ÜÁõñËÄåËÆæËÆ°ÁöÑ„ÄÇËøô‰∏™ÊñπÊ≥ïÊòØ‰∏Ä‰∏™Âª∂ËøüË∞ÉÁî®ÊñπÊ≥ïÔºåÂú®Á∫øÁ®ãÁ¨¨1Ê¨°Ë∞ÉÁî®get()Êàñset(Object)Êó∂ÊâçÊâßË°åÔºåÂπ∂‰∏î‰ªÖÊâßË°å1Ê¨°„ÄÇThreadLocal‰∏≠ÁöÑÁº∫ÁúÅÂÆûÁé∞Áõ¥Êé•ËøîÂõû‰∏Ä‰∏™null„ÄÇ Âú®ÂêåÊ≠•Êú∫Âà∂‰∏≠ÔºåÈÄöËøáÂØπË±°ÁöÑÈîÅÊú∫Âà∂‰øùËØÅÂêå‰∏ÄÊó∂Èó¥Âè™Êúâ‰∏Ä‰∏™Á∫øÁ®ãËÆøÈóÆÂèòÈáè„ÄÇËøôÊó∂ËØ•ÂèòÈáèÊòØÂ§ö‰∏™Á∫øÁ®ãÂÖ±‰∫´ÁöÑÔºå‰ΩøÁî®ÂêåÊ≠•Êú∫Âà∂Ë¶ÅÊ±ÇÁ®ãÂ∫èÊÖéÂØÜÂú∞ÂàÜÊûê‰ªÄ‰πàÊó∂ÂÄôÂØπÂèòÈáèËøõË°åËØªÂÜôÔºå‰ªÄ‰πàÊó∂ÂÄôÈúÄË¶ÅÈîÅÂÆöÊüê‰∏™ÂØπË±°Ôºå‰ªÄ‰πàÊó∂ÂÄôÈáäÊîæÂØπË±°ÈîÅÁ≠âÁπÅÊùÇÁöÑÈóÆÈ¢òÔºåÁ®ãÂ∫èËÆæËÆ°ÂíåÁºñÂÜôÈöæÂ∫¶Áõ∏ÂØπËæÉÂ§ß„ÄÇ ËÄåThreadLocalÂàô‰ªéÂè¶‰∏Ä‰∏™ËßíÂ∫¶Êù•Ëß£ÂÜ≥Â§öÁ∫øÁ®ãÁöÑÂπ∂ÂèëËÆøÈóÆ„ÄÇThreadLocal‰ºö‰∏∫ÊØè‰∏Ä‰∏™Á∫øÁ®ãÊèê‰æõ‰∏Ä‰∏™Áã¨Á´ãÁöÑÂèòÈáèÂâØÊú¨Ôºå‰ªéËÄåÈöîÁ¶ª‰∫ÜÂ§ö‰∏™Á∫øÁ®ãÂØπÊï∞ÊçÆÁöÑËÆøÈóÆÂÜ≤Á™Å„ÄÇÂõ†‰∏∫ÊØè‰∏Ä‰∏™Á∫øÁ®ãÈÉΩÊã•ÊúâËá™Â∑±ÁöÑÂèòÈáèÂâØÊú¨Ôºå‰ªéËÄå‰πüÂ∞±Ê≤°ÊúâÂøÖË¶ÅÂØπËØ•ÂèòÈáèËøõË°åÂêåÊ≠•‰∫Ü„ÄÇThreadLocalÊèê‰æõ‰∫ÜÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÂÖ±‰∫´ÂØπË±°ÔºåÂú®ÁºñÂÜôÂ§öÁ∫øÁ®ã‰ª£Á†ÅÊó∂ÔºåÂèØ‰ª•Êää‰∏çÂÆâÂÖ®ÁöÑÂèòÈáèÂ∞ÅË£ÖËøõThreadLocal„ÄÇÂ¶ÇÊûúÊÉ≥Âú®get‰πãÂâç‰∏çÈúÄË¶ÅË∞ÉÁî®setÂ∞±ËÉΩÊ≠£Â∏∏ËÆøÈóÆÁöÑËØùÔºåÂøÖÈ°ªÈáçÂÜôinitialValue()ÊñπÊ≥ï„ÄÇÊúÄÂ∏∏ËßÅÁöÑThreadLocal‰ΩøÁî®Âú∫ÊôØ‰∏∫ Áî®Êù•Ëß£ÂÜ≥ Êï∞ÊçÆÂ∫ìËøûÊé•„ÄÅSessionÁÆ°ÁêÜÁ≠â„ÄÇ 1.2 ‰ΩøÁî®ThreadLocal123456789101112131415161718192021222324252627282930313233343536373839404142434445public class ThreadTest &#123; ThreadLocal&lt;Long&gt; longLocal = new ThreadLocal&lt;Long&gt;()&#123; protected Long initialValue() &#123; return Thread.currentThread().getId(); &#125; &#125;; ThreadLocal&lt;String&gt; stringLocal = new ThreadLocal&lt;String&gt;()&#123;; protected String initialValue() &#123; return Thread.currentThread().getName(); &#125; &#125;; public void set() &#123; longLocal.set(Thread.currentThread().getId()); stringLocal.set(Thread.currentThread().getName()); &#125; public long getLong() &#123; return longLocal.get(); &#125; public String getString() &#123; return stringLocal.get(); &#125; public static void main(String[] args) throws InterruptedException &#123; final ThreadTest test = new ThreadTest(); //test.set(); System.out.println("main.getLong: " + test.getLong()); System.out.println("main.getString: " + test.getString()); Thread thread1 = new Thread() &#123; public void run() &#123; //test.set(); System.out.println("Thread.getLong: " + test.getLong()); System.out.println("Thread.getString: " + test.getString()); &#125; &#125;; thread1.start(); thread1.join(); &#125;&#125; ‰ª•‰∏ädemoË¶ÜÂÜô‰∫ÜinitialValue()ÊñπÊ≥ïÔºåÊàñËÄÖË∞ÉÁî®setÊñπÊ≥ïÔºåÂê¶Âàô‰ºöÊä•Á©∫ÊåáÈíàÂºÇÂ∏∏„ÄÇÂú®mainÁ∫øÁ®ã‰∏≠Âíåthread1Á∫øÁ®ã‰∏≠ÔºålongLocal‰øùÂ≠òÁöÑÂâØÊú¨ÂÄºÂíåstringLocal‰øùÂ≠òÁöÑÂâØÊú¨ÂÄºÈÉΩ‰∏ç‰∏ÄÊ†∑„ÄÇ 2. ThreadLocalMapThreadLocalMapÁöÑEntryÁªßÊâø‰∫ÜWeakReferenceÔºåÂπ∂‰∏î‰ΩøÁî®ThreadLocal‰Ωú‰∏∫ÈîÆÂÄº„ÄÇ 1. ÂÆûÈôÖÁöÑÈÄöËøáThreadLocalÂàõÂª∫ÁöÑÂâØÊú¨ÊòØÂ≠òÂÇ®Âú®ÊØè‰∏™Á∫øÁ®ãËá™Â∑±ÁöÑthreadLocals‰∏≠ÁöÑÔºõ 2. ‰∏∫‰ΩïthreadLocalsÁöÑÁ±ªÂûãThreadLocalMapÁöÑÈîÆÂÄº‰∏∫ThreadLocalÂØπË±°ÔºåÂõ†‰∏∫ÊØè‰∏™Á∫øÁ®ã‰∏≠ÂèØÊúâÂ§ö‰∏™threadLocalÂèòÈáèÔºåÂ∞±ÂÉè‰∏äÈù¢‰ª£Á†Å‰∏≠ÁöÑlongLocalÂíåstringLocalÔºõ 3. Âú®ËøõË°åget‰πãÂâçÔºåÂøÖÈ°ªÂÖàsetÔºåÂê¶Âàô‰ºöÊä•Á©∫ÊåáÈíàÂºÇÂ∏∏Ôºõ 2.1 ÊñπÊ≥ïÂàÜÊûê1). JDK8ÁöÑThreadLocalÁöÑgetÊñπÊ≥ïÁöÑÊ∫êÁ†Å 123456789101112131415161718192021/** * Returns the value in the current thread's copy of this * thread-local variable. If the variable has no value for the * current thread, it is first initialized to the value returned * by an invocation of the &#123;@link #initialValue&#125; method. * * @return the current thread's value of this thread-local */public T get() &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) &#123; ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) &#123; @SuppressWarnings("unchecked") T result = (T)e.value; return result; &#125; &#125; return setInitialValue();&#125; 2). getMap 12345678910/** * Get the map associated with a ThreadLocal. Overridden in * InheritableThreadLocal. * * @param t the current thread * @return the map */ThreadLocalMap getMap(Thread t) &#123; return t.threadLocals;&#125; 3). setInitialValue 12345678910111213141516/** * Variant of set() to establish initialValue. Used instead * of set() in case user has overridden the set() method. * * @return the initial value */private T setInitialValue() &#123; T value = initialValue(); Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value); return value;&#125; getÊñπÊ≥ïÁöÑÊµÅÁ®ãÊòØËøôÊ†∑ÁöÑÔºö 1.È¶ñÂÖàËé∑ÂèñÂΩìÂâçÁ∫øÁ®ã 2.Ê†πÊçÆÂΩìÂâçÁ∫øÁ®ãËé∑Âèñ‰∏Ä‰∏™Map 3.Â¶ÇÊûúËé∑ÂèñÁöÑMap‰∏ç‰∏∫Á©∫ÔºåÂàôÂú®Map‰∏≠‰ª•ThreadLocalÁöÑÂºïÁî®‰Ωú‰∏∫keyÊù•Âú®Map‰∏≠Ëé∑ÂèñÂØπÂ∫îÁöÑvalue eÔºåÂê¶ÂàôËΩ¨Âà∞5 4.Â¶ÇÊûúe‰∏ç‰∏∫nullÔºåÂàôËøîÂõûe.valueÔºåÂê¶ÂàôËΩ¨Âà∞5 5.Map‰∏∫Á©∫ÊàñËÄÖe‰∏∫Á©∫ÔºåÂàôÈÄöËøáinitialValueÂáΩÊï∞Ëé∑ÂèñÂàùÂßãÂÄºvalueÔºåÁÑ∂ÂêéÁî®ThreadLocalÁöÑÂºïÁî®Âíåvalue‰Ωú‰∏∫firstKeyÂíåfirstValueÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑMap ÊØè‰∏™ThreadÁª¥Êä§‰∏Ä‰∏™ThreadLocalMapÊò†Â∞ÑË°®ÔºåËøô‰∏™Êò†Â∞ÑË°®ÁöÑkeyÊòØThreadLocalÂÆû‰æãÊú¨Ë∫´ÔºåvalueÊòØÁúüÊ≠£ÈúÄË¶ÅÂ≠òÂÇ®ÁöÑObject„ÄÇ 3. WeakReferenceÂÖ≥‰∫éÂÜÖÂ≠òÊ≥ÑÈú≤Ôºö ThreadLocalMap‰ΩøÁî®ThreadLocalÁöÑÂº±ÂºïÁî®‰Ωú‰∏∫keyÔºåÂ¶ÇÊûú‰∏Ä‰∏™ThreadLocalÊ≤°ÊúâÂ§ñÈÉ®Âº∫ÂºïÁî®ÂºïÁî®‰ªñÔºåÈÇ£‰πàÁ≥ªÁªügcÁöÑÊó∂ÂÄôÔºåËøô‰∏™ThreadLocalÂäøÂøÖ‰ºöË¢´ÂõûÊî∂ÔºåËøôÊ†∑‰∏ÄÊù•ÔºåThreadLocalMap‰∏≠Â∞±‰ºöÂá∫Áé∞key‰∏∫nullÁöÑEntryÔºåÂ∞±Ê≤°ÊúâÂäûÊ≥ïËÆøÈóÆËøô‰∫õkey‰∏∫nullÁöÑEntryÁöÑvalueÔºåÂ¶ÇÊûúÂΩìÂâçÁ∫øÁ®ãÂÜçËøüËøü‰∏çÁªìÊùüÁöÑËØùÔºåËøô‰∫õkey‰∏∫nullÁöÑEntryÁöÑvalueÂ∞±‰ºö‰∏ÄÁõ¥Â≠òÂú®‰∏ÄÊù°Âº∫ÂºïÁî®ÈìæÔºöThreadLocal Ref -&gt; Thread -&gt; ThreaLocalMap -&gt; Entry -&gt; value ‰∏ªË¶ÅÁúã‰∏ãgetEntryAfterMissÂáΩÊï∞Ôºö 12345678910111213141516private Entry getEntryAfterMiss(ThreadLocal&lt;?&gt; key, int i, Entry e) &#123; Entry[] tab = table; int len = tab.length; while (e != null) &#123; ThreadLocal&lt;?&gt; k = e.get(); if (k == key) return e; if (k == null) expungeStaleEntry(i); else i = nextIndex(i, len); e = tab[i]; &#125; return null; &#125; ThreadLocalMapÁöÑgetEntryÂáΩÊï∞ÁöÑÊµÅÁ®ãÔºö È¶ñÂÖà‰ªéThreadLocalÁöÑÁõ¥Êé•Á¥¢Âºï‰ΩçÁΩÆ(ÈÄöËøáThreadLocal.threadLocalHashCode &amp; (len-1)ËøêÁÆóÂæóÂà∞)Ëé∑ÂèñEntry eÔºåÂ¶ÇÊûúe‰∏ç‰∏∫nullÂπ∂‰∏îkeyÁõ∏ÂêåÂàôËøîÂõûeÔºõ Â¶ÇÊûúe‰∏∫nullÊàñËÄÖkey‰∏ç‰∏ÄËá¥ÂàôÂêë‰∏ã‰∏Ä‰∏™‰ΩçÁΩÆÊü•ËØ¢ÔºåÂ¶ÇÊûú‰∏ã‰∏Ä‰∏™‰ΩçÁΩÆÁöÑkeyÂíåÂΩìÂâçÈúÄË¶ÅÊü•ËØ¢ÁöÑkeyÁõ∏Á≠âÔºåÂàôËøîÂõûÂØπÂ∫îÁöÑEntryÔºåÂê¶ÂàôÔºåÂ¶ÇÊûúkeyÂÄº‰∏∫nullÔºåÂàôÊì¶Èô§ËØ•‰ΩçÁΩÆÁöÑEntryÔºåÂê¶ÂàôÁªßÁª≠Âêë‰∏ã‰∏Ä‰∏™‰ΩçÁΩÆÊü•ËØ¢ Âú®Ëøô‰∏™ËøáÁ®ã‰∏≠ÈÅáÂà∞ÁöÑkey‰∏∫nullÁöÑEntryÈÉΩ‰ºöË¢´Êì¶Èô§ÔºåÈÇ£‰πàEntryÂÜÖÁöÑvalue‰πüÂ∞±Ê≤°ÊúâÂº∫ÂºïÁî®ÈìæÔºåËá™ÁÑ∂‰ºöË¢´ÂõûÊî∂„ÄÇ‰ªîÁªÜÁ†îÁ©∂‰ª£Á†ÅÂèØ‰ª•ÂèëÁé∞ÔºåsetÊìç‰Ωú‰πüÊúâÁ±ª‰ººÁöÑÊÄùÊÉ≥ÔºåÂ∞Ükey‰∏∫nullÁöÑËøô‰∫õEntryÈÉΩÂà†Èô§ÔºåÈò≤Ê≠¢ÂÜÖÂ≠òÊ≥ÑÈú≤„ÄÇ ‰ΩÜÊòØÂÖâËøôÊ†∑ËøòÊòØ‰∏çÂ§üÁöÑÔºå‰∏äÈù¢ÁöÑËÆæËÆ°ÊÄùË∑Ø‰æùËµñ‰∏Ä‰∏™ÂâçÊèêÊù°‰ª∂ÔºöË¶ÅË∞ÉÁî®ThreadLocalMapÁöÑgenEntryÂáΩÊï∞ÊàñËÄÖsetÂáΩÊï∞„ÄÇËøôÂΩìÁÑ∂ÊòØ‰∏çÂèØËÉΩ‰ªª‰ΩïÊÉÖÂÜµÈÉΩÊàêÁ´ãÁöÑÔºåÊâÄ‰ª•ÂæàÂ§öÊÉÖÂÜµ‰∏ãÈúÄË¶Å‰ΩøÁî®ËÄÖÊâãÂä®Ë∞ÉÁî®ThreadLocalÁöÑremoveÂáΩÊï∞ÔºåÊâãÂä®Âà†Èô§‰∏çÂÜçÈúÄË¶ÅÁöÑThreadLocalÔºåÈò≤Ê≠¢ÂÜÖÂ≠òÊ≥ÑÈú≤„ÄÇÊâÄ‰ª•JDKÂª∫ËÆÆÂ∞ÜThreadLocalÂèòÈáèÂÆö‰πâÊàêprivate staticÁöÑÔºåËøôÊ†∑ÁöÑËØùThreadLocalÁöÑÁîüÂëΩÂë®ÊúüÂ∞±Êõ¥ÈïøÔºåÁî±‰∫é‰∏ÄÁõ¥Â≠òÂú®ThreadLocalÁöÑÂº∫ÂºïÁî®ÔºåÊâÄ‰ª•ThreadLocal‰πüÂ∞±‰∏ç‰ºöË¢´ÂõûÊî∂Ôºå‰πüÂ∞±ËÉΩ‰øùËØÅ‰ªª‰ΩïÊó∂ÂÄôÈÉΩËÉΩÊ†πÊçÆThreadLocalÁöÑÂº±ÂºïÁî®ËÆøÈóÆÂà∞EntryÁöÑvalueÂÄºÔºåÁÑ∂ÂêéremoveÂÆÉÔºåÈò≤Ê≠¢ÂÜÖÂ≠òÊ≥ÑÈú≤„ÄÇ ÂèÇËÄÉÔºöThreadLocalÂíåsynchronizedÁöÑÂå∫Âà´JavaÂπ∂ÂèëÁºñÁ®ãÔºöÊ∑±ÂÖ•ÂâñÊûêThreadLocal]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>Thread</tag>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Ëá™Âà∂Jersey-SwaggerÁöÑspring-boot-starter]]></title>
    <url>%2F2017%2F09%2F02%2Fspring-boot-starter-swaggerforjersey%2F</url>
    <content type="text"><![CDATA[Spring BootÁöÑËá™Âä®ÂåñÈÖçÁΩÆÁâπÊÄßÊù•ÂÆûÁé∞Âø´ÈÄüÁöÑÂ∞Üswagger2ÂºïÂÖ•spring bootÂ∫îÁî®Êù•ÁîüÊàêjerseyÁöÑAPIÊñáÊ°£ÔºåÁÆÄÂåñÂéüÁîü‰ΩøÁî®swagger2ÁöÑÊï¥Âêà‰ª£Á†Å„ÄÇ ÁâàÊú¨Âü∫Á°Ä Spring BootÔºö1.5.x swagger-jersey2-jaxrsÔºö2.7.x Jersey 2 Â¶Ç‰Ωï‰ΩøÁî®Âú®ËØ•È°πÁõÆÁöÑÂ∏ÆÂä©‰∏ãÔºåÊàë‰ª¨ÁöÑSpring BootÂèØ‰ª•ËΩªÊùæÁöÑÂºïÂÖ•swagger2Ôºå‰∏ªÈúÄË¶ÅÂÅö‰∏ãÈù¢‰∏§‰∏™Ê≠•È™§Ôºö Âú®pom.xml‰∏≠ÂºïÂÖ•‰æùËµñÔºö 12345&lt;dependency&gt; &lt;groupId&gt;club.hacloud&lt;/groupId&gt; &lt;artifactId&gt;jersey-starter-swagger&lt;/artifactId&gt; &lt;version&gt;1.0.0.RELEASE&lt;/version&gt;&lt;/dependency&gt; Âú®Â∫îÁî®‰∏ªÁ±ª‰∏≠Â¢ûÂä†@EnableSwagger2DocÊ≥®Ëß£ 123456789@EnableSwagger2Doc@SpringBootApplicationpublic class Bootstrap &#123; public static void main(String[] args) &#123; SpringApplication.run(Bootstrap.class, args); &#125;&#125; JerseyConfig ‰∏≠Â¢ûÂä†1234@PostConstructpublic void init() &#123; this.register(ApiListingResource.class, SwaggerSerializers.class);&#125; ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÂ∞±ËÉΩ‰∫ßÁîüÊâÄÊúâÂΩìÂâçjerseyÂä†ËΩΩÁöÑËØ∑Ê±ÇÊò†Â∞ÑÊñáÊ°£„ÄÇ ÂèÇÊï∞ÈÖçÁΩÆÊõ¥ÁªÜËá¥ÁöÑÈÖçÁΩÆÂÜÖÂÆπÂèÇËÄÉÂ¶Ç‰∏ãÔºö ÈÖçÁΩÆÁ§∫‰æã1234567891011swagger: enabled: true title: spring-boot-starter-swagger config-id: demo-mvc version: v2 license: Apache License, Version 2.0 licenseUrl: https://www.apache.org/licenses/LICENSE-2.0.html termsOfServiceUrl: http://git.oschina.net/keets/jersey-starter-swagger contact: keets base-path: /** resource-package: cn.keets.demo ÈÖçÁΩÆËØ¥ÊòéÈªòËÆ§ÈÖçÁΩÆ12345678910- swagger.enabled=ÊòØÂê¶ÂºÄÂêØ // todo ÂÆûÁé∞Á∫ø‰∏äÂÖ≥Èó≠ÂäüËÉΩ- swagger.title=Ê†áÈ¢ò- swagger.description=ÊèèËø∞- swagger.version=ÁâàÊú¨- swagger.license=ËÆ∏ÂèØËØÅ- swagger.licenseUrl=ËÆ∏ÂèØËØÅURL- swagger.termsOfServiceUrl=ÊúçÂä°Êù°Ê¨æURL- swagger.contact=Áª¥Êä§‰∫∫- swagger.resource-package=swaggerÊâ´ÊèèÁöÑÂü∫Á°ÄÂåÖÔºåÈªòËÆ§ÔºöÂÖ®Êâ´Êèè- swagger.base-path=ÈúÄË¶ÅÂ§ÑÁêÜÁöÑÂü∫Á°ÄURLËßÑÂàôÔºåÈªòËÆ§Ôºö/** swagger uiÊú™ÂåÖÂê´Âú®È°πÁõÆ‰∏≠ÔºåÂ§ßÂÆ∂ÂèØ‰ª•Ëá™Â∑±ÈÉ®ÁΩ≤ÈùôÊÄÅÊñá‰ª∂ÔºåÈÄöËøáÈùôÊÄÅÊñá‰ª∂Ëß£Êûêjson Â¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö È°πÁõÆgitÂú∞ÂùÄÔºöhttp://git.oschina.net/keets/jersey-starter-swaggerdemo gitÂú∞ÂùÄÔºöhttp://git.oschina.net/keets/spring-boot-samples/tree/master/demo-jersey-starter ÂèÇËÄÉÔºöspring-boot-starter-swagger 1.3.0.RELEASEÔºöÊñ∞Â¢ûÂØπJSR-303ÁöÑÊîØÊåÅÂíåhostÁöÑÈÖçÁΩÆ]]></content>
      <categories>
        <category>ÂæÆÊúçÂä°</category>
      </categories>
      <tags>
        <tag>Jersey</tag>
        <tag>Spring Boot</tag>
        <tag>starter</tag>
        <tag>swagger</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Restful Layer of SpringMVC vs Jersey]]></title>
    <url>%2F2017%2F08%2F30%2FJerseyvsspringmvc%2F</url>
    <content type="text"><![CDATA[Á¨îËÄÖÈ°πÁõÆÂÆûÁé∞ÂâçÂêéÁ´ØÂâ•Á¶ªÔºåÊúçÂä°Á´ØÂØπÂ§ñÊèê‰æõrestfulÊé•Âè£„ÄÇRESTÈÄêÊ∏êÊàê‰∏∫ÂΩ±ÂìçWebÊ°ÜÊû∂„ÄÅWebÂçèËÆÆ‰∏éWebÂ∫îÁî®ËÆæËÆ°ÁöÑÈáçË¶ÅÊ¶ÇÂøµ„ÄÇÁé∞Âú®ÊúâË∂äÊù•Ë∂äÂ§öÁöÑÂÖ¨Âè∏Â∏åÊúõËÉΩ‰ª•ÁÆÄÂçïËÄåÂèàË¥¥ÂêàWebÊû∂ÊûÑÊú¨Ë∫´ÁöÑÊñπÂºèÂÖ¨ÂºÄWeb APIÔºåÂõ†Ê≠§RESTÂèòÂæóË∂äÊù•Ë∂äÈáçË¶Å‰πüÂ∞±‰∏çË∂≥‰∏∫Â•á‰∫Ü„ÄÇ‰ΩøÁî®AjaxËøõË°åÈÄö‰ø°ÁöÑÂØåÊµèËßàÂô®Á´Ø‰πüÂú®ÊúùËøô‰∏™ÁõÆÊ†á‰∏çÊñ≠ËøàËøõ„ÄÇËøô‰∏™Êû∂ÊûÑÂéüÂàôÊèêÂçá‰∫Ü‰∏áÁª¥ÁΩëÁöÑÂèØ‰º∏Áº©ÊÄßÔºåÊó†ËÆ∫‰ΩïÁßçÂ∫îÁî®ÈÉΩËÉΩ‰ªéËØ•ÂéüÂàô‰∏≠ÂèóÁõäÊó†Á©∑„ÄÇSpringMVCÂíåJerseyÈÉΩÂèØ‰ª•‰∏∫‰Ω†Êèê‰æõrestfulÈ£éÊ†ºÁöÑÊé•Âè£„ÄÇÊú¨ÊñáÂ∞Ü‰ªãÁªçSpringMVC‰∏≠ÁöÑRESTÁâπÊÄßÂπ∂‰∏éJerseyËøõË°åÂØπÊØî„ÄÇ 1. RESTÂü∫Á°ÄÊ¶ÇÂøµ Âú®REST‰∏≠ÁöÑ‰∏ÄÂàáÈÉΩË¢´ËÆ§‰∏∫ÊòØ‰∏ÄÁßçËµÑÊ∫ê„ÄÇ ÊØè‰∏™ËµÑÊ∫êÁî±URIÊ†áËØÜ„ÄÇ ‰ΩøÁî®Áªü‰∏ÄÁöÑÊé•Âè£„ÄÇÂ§ÑÁêÜËµÑÊ∫ê‰ΩøÁî®POSTÔºåGETÔºåPUTÔºåDELETEÊìç‰ΩúÁ±ª‰ººÂàõÂª∫ÔºåËØªÂèñÔºåÊõ¥Êñ∞ÂíåÂà†Èô§ÔºàCRUDÔºâÊìç‰Ωú„ÄÇ Êó†Áä∂ÊÄÅ„ÄÇÊØè‰∏™ËØ∑Ê±ÇÊòØ‰∏Ä‰∏™Áã¨Á´ãÁöÑËØ∑Ê±Ç„ÄÇ‰ªéÂÆ¢Êà∑Á´ØÂà∞ÊúçÂä°Âô®ÁöÑÊØè‰∏™ËØ∑Ê±ÇÈÉΩÂøÖÈ°ªÂåÖÂê´ÊâÄÊúâÂøÖË¶ÅÁöÑ‰ø°ÊÅØÔºå‰ª•‰æø‰∫éÁêÜËß£„ÄÇ ÈÄö‰ø°ÈÉΩÊòØÈÄöËøáÂ±ïÁé∞„ÄÇ‰æãÂ¶ÇXMLÔºåJSON„ÄÇ 2. Jersey‰∏éSpringMVCJAX-RSÔºàJSR 311ÔºâÊåáÁöÑÊòØJava API for RESTful Web ServicesÔºåRoy Fielding‰πüÂèÇ‰∏é‰∫ÜJAX-RSÁöÑÂà∂ËÆ¢Ôºå‰ªñÂú®Ëá™Â∑±ÁöÑÂçöÂ£´ËÆ∫Êñá‰∏≠ÂÆö‰πâ‰∫ÜREST„ÄÇÂØπ‰∫éÈÇ£‰∫õÊÉ≥Ë¶ÅÊûÑÂª∫RESTful Web ServicesÁöÑÂºÄÂèëËÄÖÊù•ËØ¥ÔºåJAX-RSÁªôÂá∫‰∫Ü‰∏çÂêå‰∫éJAX-WSÔºàJSR-224ÔºâÁöÑÂè¶‰∏ÄÁßçËß£ÂÜ≥ÊñπÊ°à„ÄÇÁõÆÂâçÂÖ±Êúâ4ÁßçJAX-RSÂÆûÁé∞ÔºåÊâÄÊúâËøô‰∫õÂÆûÁé∞ÈÉΩÊîØÊåÅSpringÔºåJerseyÂàôÊòØJAX-RSÁöÑÂèÇËÄÉÂÆûÁé∞„ÄÇ ÊúâÂøÖË¶ÅÊåáÂá∫JAX-RSÁöÑÁõÆÊ†áÊòØWeb ServicesÂºÄÂèëÔºàËøô‰∏éHTML WebÂ∫îÁî®‰∏çÂêåÔºâËÄåSpring MVCÁöÑÁõÆÊ†áÂàôÊòØWebÂ∫îÁî®ÂºÄÂèë„ÄÇSpring 3‰∏∫WebÂ∫îÁî®‰∏éWeb ServicesÂ¢ûÂä†‰∫ÜÂπøÊ≥õÁöÑRESTÊîØÊåÅÔºå‰ΩÜÊú¨ÊñáÂàôÂÖ≥Ê≥®‰∫é‰∏éWeb ServicesÂºÄÂèëÁõ∏ÂÖ≥ÁöÑÁâπÊÄß„ÄÇÊàëËßâÂæóËøôÁßçÊñπÂºèÊõ¥ÊúâÂä©‰∫éÂú®JAX-RSÁöÑ‰∏ä‰∏ãÊñá‰∏≠ËÆ®ËÆ∫Spring MVC„ÄÇ Ë¶ÅËØ¥ÊòéÁöÑÁ¨¨‰∫åÁÇπÊòØÊàë‰ª¨Â∞ÜË¶ÅËÆ®ËÆ∫ÁöÑRESTÁâπÊÄßÊòØSpring FrameworkÁöÑ‰∏ÄÈÉ®ÂàÜÔºå‰πüÊòØÁé∞ÊúâÁöÑSpring MVCÁºñÁ®ãÊ®°ÂûãÁöÑÂª∂Áª≠ÔºåÂõ†Ê≠§ÔºåÂπ∂Ê≤°ÊúâÊâÄË∞ìÁöÑ‚ÄúSpring REST framework‚ÄùËøôÁßçÊ¶ÇÂøµÔºåÊúâÁöÑÂè™ÊòØSpringÂíåSpring MVC„ÄÇËøôÊÑèÂë≥ÁùÄÂ¶ÇÊûú‰Ω†Êúâ‰∏Ä‰∏™SpringÂ∫îÁî®ÁöÑËØùÔºå‰Ω†Êó¢ÂèØ‰ª•‰ΩøÁî®Spring MVCÂàõÂª∫HTML WebÂ±ÇÔºå‰πüÂèØ‰ª•ÂàõÂª∫RESTful Web ServicesÂ±Ç„ÄÇ]]></content>
      <categories>
        <category>ÂæÆÊúçÂä°</category>
      </categories>
      <tags>
        <tag>REST</tag>
        <tag>Jersey</tag>
        <tag>Spring Boot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mac‰∏ãÂø´ÈÄüËøõÂÖ•ÂΩìÂâçÁõÆÂΩïiterm2]]></title>
    <url>%2F2017%2F08%2F28%2Fmac%E5%BF%AB%E6%8D%B7%E9%94%AE%2F</url>
    <content type="text"><![CDATA[winÁéØÂ¢É‰∏ãÔºåÊúâÁõ¥Êé•Âú®Êñá‰ª∂ÊµèËßàÁöÑÂú∞ÂùÄ‰∏äÔºåÁõ¥Êé•ËæìÂÖ•cmdÔºåÂç≥ÂèØÊâìÂºÄcmdÂëΩ‰ª§Ê°Ü„ÄÇÁ¨îËÄÖÂú®macOS‰∏ãÔºå‰πüÊÉ≥ÂÆûÁé∞ËøôÊ†∑ÁöÑÂäüËÉΩÔºåÁΩë‰∏äÊü•‰∫Ü‰∏Ä‰∏ãÔºåÂèØ‰ª•ÊàêÂäüÂÆûË∑µ„ÄÇ 1. Ê∑ªÂä†ÊúçÂä°1git clone https://github.com/peterldowns/iterm2-finder-tools.git ËøõÂÖ• iterm2-finder-toolsÊñá‰ª∂Â§πÔºåËøêË°åiTerm.workflow„ÄÇÂÆâË£ÖÊúçÂä°Ê†è„ÄÇ 2. ‰ΩøÁî®ÊúçÂä°Âú®Â∑•‰ΩúÊñá‰ª∂Â§π‰∏äÂè≥ÈîÆÔºåÂºπÂá∫Á™óÂè£‰∏≠ÊâæÂà∞ÊúçÂä°‰∏ÄÊ†èÔºåÂ∞ÜÈº†Ê†áÊîæÁΩÆÂÖ∂‰∏äÔºåÂú®ÂºπÂá∫Á™óÂè£‰∏≠ÊâæÂà∞ Open iTerm‰∏ÄÊ†èÔºåÂçïÂáªÂç≥ÂèØ„ÄÇ 3. Ê∑ªÂä†Âø´Êç∑ÈîÆÊúçÂä°-&gt;ÂÅèÂ•ΩËÆæÁΩÆ-&gt;Âø´Êç∑ÈîÆ Á¨îËÄÖËÆæÁΩÆ‰∫Ücontrol+command+L„ÄÇÂ§ßÂÆ∂ÂèØ‰ª•Ê†πÊçÆËá™Â∑±ÁöÑÂñúÂ•ΩËøõË°åËÆæÁΩÆÂø´Êç∑ÈîÆ„ÄÇ ÂèÇËÄÉÔºö MacÂú®Finder‰∏≠ÂΩìÂâçÁõÆÂΩï‰∏ãÊâìÂºÄiTerm2]]></content>
      <categories>
        <category>Utils</category>
      </categories>
      <tags>
        <tag>mac</tag>
        <tag>utils</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HTTP 2ÂÆûÈôÖÂ∫îÁî®]]></title>
    <url>%2F2017%2F08%2F27%2Fhttp2%E5%BA%94%E7%94%A8%2F</url>
    <content type="text"><![CDATA[1. ËÉåÊôØ‰ªãÁªç1.1 ÈúÄË¶ÅËß£ÂÜ≥ÁöÑÈóÆÈ¢òÊú¨ÊñáÊù•Ê∫ê‰∫éÈ°πÁõÆÈúÄË¶ÅÔºåÈ°πÁõÆÊâÄ‰ΩøÁî®ÂæÆÊúçÂä°Ê°ÜÊû∂‰∏∫Spring CloudÔºåÂæÆÊúçÂä°‰πãÈó¥ÁöÑË∞ÉÁî®Âü∫‰∫éHTTP 1.XÂçèËÆÆÔºå‰∏ä‰∏ÄÁØáÊñáÁ´† HTTPS vs HTTP 1.1 vs HTTP 2Ôºå‰ªãÁªç‰∫Ühttp2 Âíåhttp1.1ÁöÑÁõ∏ÂÖ≥Áü•ËØÜÔºå‰πüÂàóÂá∫‰∫Ühttp1.1Â±ÄÈôêÊÄßÔºåÈìæË∑Ø‰∏çËÉΩÂ§çÁî®„ÄÅÊï∞ÊçÆ‰∏çÂä†ÂØÜ„ÄÅÂ§¥‰ø°ÊÅØËøáÂ§öÁ≠âÁ≠â„ÄÇ‰∏∫Ê≠§ÔºåÁ¨îËÄÖÂú®ÊÉ≥ËÉΩ‰∏çËÉΩÂ∞Üfeign clientÁöÑË∞ÉÁî®Âü∫‰∫éhttp2ÂçèËÆÆÔºåÂÅö‰∫ÜÂ¶Ç‰∏ãË∞ÉÁ†î„ÄÇ HTTP/2 Ê∫êËá™ SPDY/2„ÄÇSPDY Á≥ªÂàóÂçèËÆÆÁî±Ë∞∑Ê≠åÂºÄÂèëÔºå‰∫é 2009 Âπ¥ÂÖ¨ÂºÄ„ÄÇÂÆÉÁöÑËÆæËÆ°ÁõÆÊ†áÊòØÈôç‰Ωé 50% ÁöÑÈ°µÈù¢Âä†ËΩΩÊó∂Èó¥„ÄÇÂΩì‰∏ãÂæàÂ§öËëóÂêçÁöÑ‰∫íËÅîÁΩëÂÖ¨Âè∏Ôºå‰æãÂ¶ÇÁôæÂ∫¶„ÄÅÊ∑òÂÆù„ÄÅUPYUN ÈÉΩÂú®Ëá™Â∑±ÁöÑÁΩëÁ´ôÊàñ APP ‰∏≠ÈááÁî®‰∫Ü SPDY Á≥ªÂàóÂçèËÆÆÔºàÂΩìÂâçÊúÄÊñ∞ÁâàÊú¨ÊòØ SPDY/3.1ÔºâÔºåÂõ†‰∏∫ÂÆÉÂØπÊÄßËÉΩÁöÑÊèêÂçáÊòØÊòæËÄåÊòìËßÅÁöÑ„ÄÇ‰∏ªÊµÅÁöÑÊµèËßàÂô®ÔºàË∞∑Ê≠å„ÄÅÁÅ´Áãê„ÄÅOperaÔºâ‰πüÈÉΩÊó©Â∑≤ÁªèÊîØÊåÅ SPDYÔºåÂÆÉÂ∑≤ÁªèÊàê‰∏∫‰∫ÜÂ∑•‰∏öÊ†áÂáÜÔºåHTTP Working-Group ÊúÄÁªàÂÜ≥ÂÆö‰ª• SPDY/2 ‰∏∫Âü∫Á°ÄÔºåÂºÄÂèë HTTP/2„ÄÇ2013Âπ¥8ÊúàÔºåËøõË°åÈ¶ñÊ¨°ÊµãËØïÔºåËØûÁîüÁöÑÊó∂Èó¥ÂæàÊôöÔºåÁ¨îËÄÖÊêúÁ¥¢‰∫ÜÁΩë‰∏äÂÖ≥‰∫éhttp2ÂÆûË∑µÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØÔºåÂèëÁé∞Âπ∂‰∏çÂ§ö„ÄÇ 1.2 ÂÖ≥‰∫éÈ°πÁõÆ‰ªãÁªçSpring CloudÊòØÁ¨îËÄÖÈ°πÁõÆÈááÁî®ÁöÑÂæÆÊúçÂä°Ê°ÜÊû∂ÔºåÂÖ∑‰Ωì‰ªãÁªçËßÅSpring Cloud„ÄÇSpring CloudÊòØÂü∫‰∫éSpring BootÂºÄÂèëÁöÑÁªÑÂêàÊ°ÜÊû∂ÔºåSpring BootÂÜÖÁΩÆÁöÑÂÆπÂô®ÊòØTomcatÔºåÁ¨îËÄÖÁöÑÈ°πÁõÆ‰∏ÄËà¨ÈÉΩ‰ºöexclude TomcatÁöÑÂºïÁî®Ôºå‰ΩøÁî®ÁöÑÊòØJettyÂÆπÂô®„ÄÇÊâÄ‰ª•ÊêúÁ¥¢ÁöÑ‰∏ªÈ¢òËØçÂ∞±ÂèòÊàê‰∫Ü jetty http2„ÄÇ 2. Ë∞ÉÁ†îÁªìÊûúÂ§ßÈÉ®ÂàÜÁöÑ‰∫∫‰π†ÊÉØ‰∫éÂ∞ÜTomcatËøêË°åÂú®8080Á´ØÂè£ÔºåÂÜçÁî®Apache serverÂú®ÂâçÈù¢Êèê‰æõhttps„ÄÇËøôÊ†∑ÂÅöÊòØÂõ†‰∏∫ÁÆÄÂçï‰∏îÈ™åËØÅËøáÁöÑÊñπÊ≥ï„ÄÇ‰ΩøÁî®http2 Ôºå‰Ω†Â∞ÜË¢´Ëø´‰ΩøÁî®httpsÔºåËøôÊ†∑Â∞±‰∏çÁî®ÈÉ®ÁΩ≤Apache (or nginx)„ÄÇ 2.1 ÊúçÂä°Á´Ø Currently Jetty and undertow are the only servers in Spring Boot that support HTTP/2.Jetty has booked some progress and this repository shows an excellent example. In my opinion it‚Äôs still too much custom code, but they‚Äôre getting there.The next candidate is undertow. It seems almost too easy, but it works. Because we use AJP in our current configuration it even means this HTTP/2 solution has less lines of code! ÂΩìÂâçSpring BootÂè™ÊúâJetty Âíå undertowÊîØÊåÅHTTP/2„ÄÇ Ê†∑‰æãrepoÊòØ‰∏Ä‰∏™ÂæàÂ•ΩÁöÑexample„ÄÇÊÄªÂæóÂàÜ‰∏∫‰∏âÊ≠•Ôºö update dependencies org.springframework.boot:spring-boot-starter-undertow org.mortbay.jetty.alpn:alpn-boot:8.1.8.v20160420 create a servlet container bean 1234567@Bean UndertowEmbeddedServletContainerFactory embeddedServletContainerFactory() &#123; UndertowEmbeddedServletContainerFactory factory = new UndertowEmbeddedServletContainerFactory(); factory.addBuilderCustomizers( builder -&gt; builder.setServerOption(UndertowOptions.ENABLE_HTTP2, true)); return factory; &#125; start your server with alpn‰∏∫‰∫ÜÂêØÂä®ÊúçÂä°ÔºåÈúÄË¶ÅÂ∏¶‰∏ä -Xbootclasspath ÂèÇÊï∞Êù•ÂåÖÊã¨alpn „ÄÇÂõ†‰∏∫alpn ÊúâÂèØËÉΩÂú®jdk‰∏≠Ê≤°Êúâ„ÄÇ 1-Xbootclasspath/p:/home/harrie/.m2/repository/org/mortbay/jetty/alpn/alpn-boot/8.1.8.v20160420/alpn-boot-8.1.8.v20160420.jar 2.2 ÂÆ¢Êà∑Á´Ø Currently Java HTTP/2 clients are scarce. According to this wiki Netty and OkHttp are the only two implementations supported by Spring. To switch HTTP-client in RestTemplate you have to call the constructor with a different ClientHttpRequestFactory (either Netty4ClientHttpRequestFactory or OkHttpClientHttpRequestFactory). ÂΩìÂâçJavaÁöÑhttp2ÁöÑÂÆ¢Êà∑Á´Ø‰πüÂæàÂ∞ëÔºåSpringÂè™ÊúâNetty and OkHttpÊîØÊåÅ„ÄÇËøôËæπÊàë‰ª¨ÈÄâÁî®‰∫ÜOkHttpÔºåÂõ†‰∏∫OkHttpÊú¨Êù•Â∞±ÊúâÂú®feign client‰∏≠ÂÜÖÁΩÆ„ÄÇ 1234567891011121314151617&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-web&lt;/artifactId&gt; &lt;version&gt;4.3.0.RC1&lt;/version&gt;&lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-core&lt;/artifactId&gt; &lt;version&gt;4.3.0.RC1&lt;/version&gt;&lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.squareup.okhttp3&lt;/groupId&gt; &lt;artifactId&gt;okhttp&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt;&lt;/dependency&gt; 2.3 ÊµèËßàÂô®ÂØπ‰∫éHTTP/2ÁöÑÊîØÊåÅÈÄöËøáÊµèËßàÂô®ÊîØÊåÅhttp2Êü•Áúã„ÄÇ 2.4 okhttpÁõÆÂâç, Http/1.1Âú®ÂÖ®‰∏ñÁïåÂ§ßËåÉÂõ¥ÁöÑ‰ΩøÁî®‰∏≠, Áõ¥Êé•Â∫üÂºÉË∑≥Âà∞http/2ËÇØÂÆö‰∏çÁé∞ÂÆû. ‰∏çÊòØÊØè‰∏™Áî®Êà∑ÁöÑÊµèËßàÂô®ÈÉΩÊîØÊåÅhttp/2ÁöÑ, ‰πü‰∏çÊòØÊØè‰∏™ÊúçÂä°Âô®ÈÉΩÊâìÁÆóÊîØÊåÅhttp/2ÁöÑ, Â¶ÇÊûúÊàë‰ª¨Áõ¥Êé•ÂèëÈÄÅhttp/2Ê†ºÂºèÁöÑÂçèËÆÆ, ÊúçÂä°Âô®Âèà‰∏çÊîØÊåÅ, ÈÇ£‰∏çÊòØÊåÇÊéâ‰∫Ü! ÊÄª‰∏çËÉΩÁª¥Êä§‰∏Ä‰∏™ÂÖ®‰∏ñÁïåÁöÑÁΩëÁ´ôÂàóË°®, Ë°®Á§∫Âì™‰∫õÊîØÊåÅhttp/2, Âì™‰∫õ‰∏çÊîØÊåÅ?‰∏∫‰∫ÜËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢ò, ‰ªéÁ®çÈ´òÂ±ÇÊ¨°‰∏äÊù•ËØ¥, Â∞±ÊòØ‰∏∫‰∫ÜÊõ¥Êñπ‰æøÂú∞ÈÉ®ÁΩ≤Êñ∞ÂçèËÆÆ, HTTP/1.1 ÂºïÂÖ•‰∫Ü Upgrade Êú∫Âà∂. Ëøô‰∏™Êú∫Âà∂Âú® RFC7230 ÁöÑ„Äå6.7 Upgrade„ÄçËøô‰∏ÄËäÇ‰∏≠ÊúâËØ¶ÁªÜÊèèËø∞.ÁÆÄÂçïËØ¥Êù•, Â∞±ÊòØÂÖàÈóÆ‰∏ã‰Ω†ÊîØÊåÅhttp/2‰πà? Â¶ÇÊûú‰Ω†ÊîØÊåÅ, ÈÇ£‰πàÊé•‰∏ãÊù•ÊàëÂ∞±Áî®http/2Âíå‰Ω†ËÅäÂ§©. Â¶ÇÊûú‰Ω†‰∏çÊîØÊåÅ, ÈÇ£‰πàÊàëËøòÊòØÁî®ÂéüÊù•ÁöÑhttp/1.1Âíå‰Ω†ËÅäÂ§©. ÂÆ¢Êà∑Á´ØÂú®ËØ∑Ê±ÇÂ§¥ÈÉ®‰∏≠ÊåáÂÆöConnectionÂíåUpgrade‰∏§‰∏™Â≠óÊÆµÂèëËµ∑ HTTP/1.1 ÂçèËÆÆÂçáÁ∫ß. HTTP/2 ÁöÑÂçèËÆÆÂêçÁß∞ÊòØ h2c, ‰ª£Ë°® HTTP/2 ClearText. Â¶ÇÊûúÊúçÂä°Á´Ø‰∏çÂêåÊÑèÂçáÁ∫ßÊàñËÄÖ‰∏çÊîØÊåÅ Upgrade ÊâÄÂàóÂá∫ÁöÑÂçèËÆÆÔºåÁõ¥Êé•ÂøΩÁï•Âç≥ÂèØÔºàÂΩìÊàê HTTP/1.1 ËØ∑Ê±ÇÔºå‰ª• HTTP/1.1 ÂìçÂ∫îÔºâ. Â¶ÇÊûúÊúçÂä°Á´ØÂêåÊÑèÂçáÁ∫ßÔºåÈÇ£‰πàÈúÄË¶ÅËøôÊ†∑ÂìçÂ∫î HTTP/1.1 101 Switching ProtocolsConnection: UpgradeUpgrade: h2c[ HTTP/2 connection ‚Ä¶ ] HTTP Upgrade ÂìçÂ∫îÁöÑÁä∂ÊÄÅÁ†ÅÊòØ 101ÔºåÂπ∂‰∏îÂìçÂ∫îÊ≠£ÊñáÂèØ‰ª•‰ΩøÁî®Êñ∞ÂçèËÆÆÂÆö‰πâÁöÑÊï∞ÊçÆÊ†ºÂºè„ÄÇ ËøôÊ†∑Â∞±ÂèØ‰ª•ÂÆåÊàê‰ªéhttp/1.1ÂçáÁ∫ßÂà∞http/2‰∫Ü. ÂêåÊ†∑‰πüÂèØ‰ª•‰ªéhttp/1.1ÂçáÁ∫ßÂà∞WebSocket.OkHttp‰ΩøÁî®‰∫ÜËØ∑Ê±ÇÂçèËÆÆÁöÑÂçèÂïÜÂçáÁ∫ß, Êó†ËÆ∫ÊòØ1.1ËøòÊòØ2, ÈÉΩÂÖàÂè™‰ª•1.1Êù•ÂèëÈÄÅ, Âπ∂Âú®ÂèëÈÄÅÁöÑ‰ø°ÊÅØÂ§¥ÈáåÂåÖÂê´ÂçèËÆÆÂçáÁ∫ßÂ≠óÊÆµ. Êé•‰∏ãÊù•Â∞±ÁúãÊúçÂä°Âô®ÊòØÂê¶ÊîØÊåÅÂçèËÆÆÂçáÁ∫ß‰∫Ü. OkHttp‰ΩøÁî®ÁöÑÂçèËÆÆÂçáÁ∫ßÂ≠óÊÆµÊòØALPN, Â¶ÇÊûúÊúâÂÖ¥Ë∂£, ÂèØ‰ª•Êõ¥Ê∑±ÂÖ•ÁöÑÊü•ÈòÖÁõ∏ÂÖ≥ËµÑÊñô. 3. ÊÄªÁªìÊÄª‰ΩìÁúãÊù•ÔºåÁé∞Âú®Spring boot ÊòØÂèØ‰ª•ÊîØÊåÅHTTP/2 serverÂíåclient„ÄÇÁé∞ÊúâÈ°πÁõÆÁöÑapiÊé•Âè£Èù¢ÂêëÁßªÂä®Á´ØÂíåwebÁ´ØÔºåwebÊµèËßàÂô®ÂØπ‰∫éhttp2ÁöÑÊîØÊåÅÂú®‰∏äÊñáÂ∑≤ÁªèËØ¥Êòé„ÄÇ ÂèÇËÄÉËµÑÊñôÔºöOkHttp‰ΩøÁî®ÂÆåÂÖ®ÊïôÁ®ãSpring Boot with HTTP/2 ‚Äì Start a server and make REST calls as a clientHTTPS ‰∏é HTTP2 ÂçèËÆÆÂàÜÊûê]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>HTTP2</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HTTPS vs HTTP 1.1 vs HTTP 2]]></title>
    <url>%2F2017%2F08%2F26%2FHTTP2%2F</url>
    <content type="text"><![CDATA[1. HTTPSÂçèËÆÆÂéüÁêÜÂàÜÊûê1.1 ÈúÄË¶ÅËß£ÂÜ≥ÁöÑÈóÆÈ¢ò Ë∫´‰ªΩÈ™åËØÅ:Á°Æ‰øùÈÄö‰ø°ÂèåÊñπË∫´‰ªΩÁöÑÁúüÂÆûÊÄß„ÄÇ ÈÄö‰ø°Âä†ÂØÜ:ÈÄö‰ø°ÁöÑÊú∫ÂØÜÊÄß„ÄÅÂÆåÊï¥ÊÄß‰æùËµñ‰∫éÁÆóÊ≥ï‰∏éÂØÜÈí•ÔºåÈÄö‰ø°ÂèåÊñπÊòØÂ¶Ç‰ΩïÈÄâÊã©ÁÆóÊ≥ï‰∏éÂØÜÈí•ÁöÑ„ÄÇ 1.2Áõ∏ÂÖ≥Ê¶ÇÂøµ Êï∞Â≠óËØÅ‰π¶ CAÔºàcertification authorityÔºâ:Êï∞Â≠óËØÅ‰π¶ÁöÑÁ≠æÂèëÊú∫ÊûÑ„ÄÇ HTTPSÂçèËÆÆ„ÄÅSSLÂçèËÆÆ„ÄÅTLSÂçèËÆÆ„ÄÅÊè°ÊâãÂçèËÆÆÁöÑÂÖ≥Á≥ª HTTPSÊòØHypertext Transfer Protocol over Secure Socket LayerÁöÑÁº©ÂÜôÔºåÂç≥HTTP over SSLÔºåÂèØÁêÜËß£‰∏∫Âü∫‰∫éSSLÁöÑHTTPÂçèËÆÆ„ÄÇ HTTPSÂçèËÆÆÂÆâÂÖ®ÊòØÁî±SSLÂçèËÆÆÔºàÁõÆÂâçÂ∏∏Áî®ÁöÑÔºåÊú¨ÊñáÂü∫‰∫éTLS 1.2ËøõË°åÂàÜÊûêÔºâÂÆûÁé∞ÁöÑ„ÄÇ SSLÂçèËÆÆÊòØ‰∏ÄÁßçËÆ∞ÂΩïÂçèËÆÆÔºåÊâ©Â±ïÊÄßËâØÂ•ΩÔºåÂèØ‰ª•ÂæàÊñπ‰æøÁöÑÊ∑ªÂä†Â≠êÂçèËÆÆÔºåËÄåÊè°ÊâãÂçèËÆÆ‰æøÊòØSSLÂçèËÆÆÁöÑ‰∏Ä‰∏™Â≠êÂçèËÆÆ„ÄÇ TLSÂçèËÆÆÊòØSSLÂçèËÆÆÁöÑÂêéÁª≠ÁâàÊú¨ÔºåÊú¨Êñá‰∏≠Ê∂âÂèäÁöÑSSLÂçèËÆÆÈªòËÆ§ÊòØTLSÂçèËÆÆ1.2ÁâàÊú¨„ÄÇ HTTPSÂçèËÆÆÁöÑÂÆâÂÖ®ÊÄßÁî±SSLÂçèËÆÆÂÆûÁé∞ÔºåÂΩìÂâç‰ΩøÁî®ÁöÑTLSÂçèËÆÆ1.2ÁâàÊú¨ÂåÖÂê´‰∫ÜÂõõ‰∏™Ê†∏ÂøÉÂ≠êÂçèËÆÆÔºöÊè°ÊâãÂçèËÆÆ„ÄÅÂØÜÈí•ÈÖçÁΩÆÂàáÊç¢ÂçèËÆÆ„ÄÅÂ∫îÁî®Êï∞ÊçÆÂçèËÆÆÂèäÊä•Ë≠¶ÂçèËÆÆ„ÄÇ 1.3 Êè°ÊâãÂçèËÆÆÊè°ÊâãÂçèËÆÆÁöÑ‰ΩúÁî®‰æøÊòØÈÄö‰ø°ÂèåÊñπËøõË°åË∫´‰ªΩÁ°ÆËÆ§„ÄÅÂçèÂïÜÂÆâÂÖ®ËøûÊé•ÂêÑÂèÇÊï∞ÔºàÂä†ÂØÜÁÆóÊ≥ï„ÄÅÂØÜÈí•Á≠âÔºâÔºåÁ°Æ‰øùÂèåÊñπË∫´‰ªΩÁúüÂÆûÂπ∂‰∏îÂçèÂïÜÁöÑÁÆóÊ≥ï‰∏éÂØÜÈí•ËÉΩÂ§ü‰øùËØÅÈÄö‰ø°ÂÆâÂÖ®„ÄÇÂçèËÆÆ‰∫§‰∫íÂõæÔºö ClientHelloÊ∂àÊÅØÁöÑ‰ΩúÁî®ÊòØÔºåÂ∞ÜÂÆ¢Êà∑Á´ØÂèØÁî®‰∫éÂª∫Á´ãÂä†ÂØÜÈÄöÈÅìÁöÑÂèÇÊï∞ÈõÜÂêàÔºå‰∏ÄÊ¨°ÊÄßÂèëÈÄÅÁªôÊúçÂä°Á´Ø„ÄÇ ServerHelloÊ∂àÊÅØÁöÑ‰ΩúÁî®ÊòØÔºåÂú®ClientHelloÂèÇÊï∞ÈõÜÂêà‰∏≠ÈÄâÊã©ÈÄÇÂêàÁöÑÂèÇÊï∞ÔºåÂπ∂Â∞ÜÊúçÂä°Á´ØÁî®‰∫éÂª∫Á´ãÂä†ÂØÜÈÄöÈÅìÁöÑÂèÇÊï∞ÂèëÈÄÅÁªôÂÆ¢Êà∑Á´Ø„ÄÇ CertificateÊ∂àÊÅØÁöÑ‰ΩúÁî®ÊòØÔºåÂ∞ÜÊúçÂä°Á´ØËØÅ‰π¶ÁöÑËØ¶ÁªÜ‰ø°ÊÅØÂèëÈÄÅÁªôÂÆ¢Êà∑Á´ØÔºå‰æõÂÆ¢Êà∑Á´ØËøõË°åÊúçÂä°Á´ØË∫´‰ªΩÊ†°È™å„ÄÇ ServerKeyExchangeÊ∂àÊÅØÁöÑ‰ΩúÁî®ÊòØÔºåÂ∞ÜÈúÄË¶ÅÊúçÂä°Á´ØÊèê‰æõÁöÑÂØÜÈí•‰∫§Êç¢ÁöÑÈ¢ùÂ§ñÂèÇÊï∞Ôºå‰º†ÁªôÂÆ¢Êà∑Á´Ø„ÄÇÊúâÁöÑÁÆóÊ≥ï‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÂèÇÊï∞ÔºåÂàôServerKeyExchangeÊ∂àÊÅØÂèØ‰∏çÂèëÈÄÅ„ÄÇ ServerHelloDoneÊ∂àÊÅØÁöÑ‰ΩúÁî®ÊòØÔºåÈÄöÁü•ÂÆ¢Êà∑Á´ØServerHelloÈò∂ÊÆµÁöÑÊï∞ÊçÆÂùáÂ∑≤ÂèëÈÄÅÂÆåÊØïÔºåÁ≠âÂæÖÂÆ¢Êà∑Á´Ø‰∏ã‰∏ÄÊ≠•Ê∂àÊÅØ„ÄÇ ClientKeyExchangeÊ∂àÊÅØÁöÑ‰ΩúÁî®ÊòØÔºåÂ∞ÜÂÆ¢Êà∑Á´ØÈúÄË¶Å‰∏∫ÂØÜÈí•‰∫§Êç¢Êèê‰æõÁöÑÊï∞ÊçÆÂèëÈÄÅÁªôÊúçÂä°Á´Ø„ÄÇ ChangeCipherSpecÊ∂àÊÅØÁöÑ‰ΩúÁî®Ôºå‰æøÊòØÂ£∞ÊòéÂêéÁª≠Ê∂àÊÅØÂùáÈááÁî®ÂØÜÈí•Âä†ÂØÜ„ÄÇÂú®Ê≠§Ê∂àÊÅØÂêéÔºåÊàë‰ª¨Âú®WireShark‰∏ä‰æøÁúã‰∏çÂà∞ÊòéÊñá‰ø°ÊÅØ‰∫Ü„ÄÇ FinishedÊ∂àÊÅØÁöÑ‰ΩúÁî®ÔºåÊòØÂØπÊè°ÊâãÈò∂ÊÆµÊâÄÊúâÊ∂àÊÅØËÆ°ÁÆóÊëòË¶ÅÔºåÂπ∂ÂèëÈÄÅÁªôÂØπÊñπÊ†°È™åÔºåÈÅøÂÖçÈÄö‰ø°ËøáÁ®ã‰∏≠Ë¢´‰∏≠Èó¥‰∫∫ÊâÄÁØ°Êîπ„ÄÇ 1.4 ÊÄªÁªìHTTPSÂ¶Ç‰Ωï‰øùËØÅÈÄö‰ø°ÂÆâÂÖ®ÔºåÈÄöËøáÊè°ÊâãÂçèËÆÆÁöÑ‰ªãÁªçÔºåÊàë‰ª¨Â∑≤ÁªèÊúâÊâÄ‰∫ÜËß£„ÄÇ‰ΩÜÊòØÔºåÂú®ÂÖ®Èù¢‰ΩøÁî®HTTPSÂâçÔºåÊàë‰ª¨ËøòÈúÄË¶ÅËÄÉËôë‰∏Ä‰∏™‰ºóÊâÄÂë®Áü•ÁöÑÈóÆÈ¢ò‚Äî‚ÄîHTTPSÊÄßËÉΩ„ÄÇÁõ∏ÂØπHTTPÂçèËÆÆÊù•ËØ¥ÔºåHTTPSÂçèËÆÆÂª∫Á´ãÊï∞ÊçÆÈÄöÈÅìÁöÑÊõ¥Âä†ËÄóÊó∂ÔºåËã•Áõ¥Êé•ÈÉ®ÁΩ≤Âà∞App‰∏≠ÔºåÂäøÂøÖÈôç‰ΩéÊï∞ÊçÆ‰º†ÈÄíÁöÑÊïàÁéáÔºåÈó¥Êé•ÂΩ±ÂìçÁî®Êà∑‰ΩìÈ™å„ÄÇ 2. HTTP 22.1 HTTP1.xÂçèËÆÆÈöèÁùÄ‰∫íËÅîÁΩëÁöÑÂø´ÈÄüÂèëÂ±ïÔºåHTTP1.xÂçèËÆÆÂæóÂà∞‰∫ÜËøÖÁåõÂèëÂ±ïÔºå‰ΩÜÂΩìApp‰∏Ä‰∏™È°µÈù¢ÂåÖÂê´‰∫ÜÊï∞ÂçÅ‰∏™ËØ∑Ê±ÇÊó∂ÔºåHTTP1.xÂçèËÆÆÁöÑÂ±ÄÈôêÊÄß‰æøÊö¥Èú≤‰∫ÜÂá∫Êù•Ôºö ÊØè‰∏™ËØ∑Ê±Ç‰∏éÂìçÂ∫îÈúÄË¶ÅÂçïÁã¨Âª∫Á´ãÈìæË∑ØËøõË°åËØ∑Ê±Ç(ConnectionÂ≠óÊÆµËÉΩÂ§üËß£ÂÜ≥ÈÉ®ÂàÜÈóÆÈ¢ò)ÔºåÊµ™Ë¥πËµÑÊ∫ê„ÄÇ ÊØè‰∏™ËØ∑Ê±Ç‰∏éÂìçÂ∫îÈÉΩÈúÄË¶ÅÊ∑ªÂä†ÂÆåÊï¥ÁöÑÂ§¥‰ø°ÊÅØÔºåÂ∫îÁî®Êï∞ÊçÆ‰º†ËæìÊïàÁéáËæÉ‰Ωé„ÄÇ ÈªòËÆ§Ê≤°ÊúâËøõË°åÂä†ÂØÜÔºåÊï∞ÊçÆÂú®‰º†ËæìËøáÁ®ã‰∏≠ÂÆπÊòìË¢´ÁõëÂê¨‰∏éÁØ°Êîπ„ÄÇ 2.2 HTTP 2‰ªãÁªçHTTP2Ê≠£ÊòØ‰∏∫‰∫ÜËß£ÂÜ≥HTTP1.xÊö¥Èú≤Âá∫Êù•ÁöÑÈóÆÈ¢òËÄåËØûÁîüÁöÑ„ÄÇ ËØ¥Âà∞HTTP2‰∏çÂæó‰∏çÊèêspdy„ÄÇÁî±‰∫éHTTP1.xÊö¥Èú≤Âá∫Êù•ÁöÑÈóÆÈ¢òÔºåGoogleËÆæËÆ°‰∫ÜÂÖ®Êñ∞ÁöÑÂêç‰∏∫spdyÁöÑÊñ∞ÂçèËÆÆ„ÄÇspdyÂú®‰∫îÂ±ÇÂçèËÆÆÊ†àÁöÑTCPÂ±Ç‰∏éHTTPÂ±ÇÂºïÂÖ•‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑÈÄªËæëÂ±Ç‰ª•ÊèêÈ´òÊïàÁéá„ÄÇspdyÊòØ‰∏Ä‰∏™‰∏≠Èó¥Â±ÇÔºåÂØπTCPÂ±Ç‰∏éHTTPÂ±ÇÊúâÂæàÂ•ΩÁöÑÂÖºÂÆπÔºå‰∏çÈúÄË¶Å‰øÆÊîπHTTPÂ±ÇÂç≥ÂèØÊîπÂñÑÂ∫îÁî®Êï∞ÊçÆ‰º†ËæìÈÄüÂ∫¶„ÄÇspdyÈÄöËøáÂ§öË∑ØÂ§çÁî®ÊäÄÊúØÔºå‰ΩøÂÆ¢Êà∑Á´Ø‰∏éÊúçÂä°Âô®Âè™ÈúÄË¶Å‰øùÊåÅ‰∏ÄÊù°ÈìæÊé•Âç≥ÂèØÂπ∂ÂèëÂ§öÊ¨°Êï∞ÊçÆ‰∫§‰∫íÔºåÊèêÈ´ò‰∫ÜÈÄö‰ø°ÊïàÁéá„ÄÇËÄåHTTP2‰æøÂ£´Âü∫‰∫éspdyÁöÑÊÄùË∑ØÂºÄÂèëÁöÑ„ÄÇÈÄöËøáÊµÅ‰∏éÂ∏ßÊ¶ÇÂøµÁöÑÂºïÂÖ•ÔºåÁªßÊâø‰∫ÜspdyÁöÑÂ§öË∑ØÂ§çÁî®ÔºåÂπ∂Â¢ûÂä†‰∫Ü‰∏Ä‰∫õÂÆûÁî®ÁâπÊÄß„ÄÇ Êñ∞ÁâπÊÄßÔºö Â§öË∑ØÂ§çÁî® ÂéãÁº©Â§¥‰ø°ÊÅØ ÂØπËØ∑Ê±ÇÂàíÂàÜ‰ºòÂÖàÁ∫ß ÊîØÊåÅÊúçÂä°Á´ØPushÊ∂àÊÅØÂà∞ÂÆ¢Êà∑Á´Ø HTTP2ÁõÆÂâçÂú®ÂÆûÈôÖ‰ΩøÁî®‰∏≠ÔºåÂè™Áî®‰∫éHTTPSÂçèËÆÆÂú∫ÊôØ‰∏ãÔºåÈÄöËøáÊè°ÊâãÈò∂ÊÆµClientHello‰∏éServerHelloÁöÑextensionÂ≠óÊÆµÂçèÂïÜËÄåÊù•ÔºåÊâÄ‰ª•ÁõÆÂâçHTTP2ÁöÑ‰ΩøÁî®Âú∫ÊôØÔºåÈÉΩÊòØÈªòËÆ§ÂÆâÂÖ®Âä†ÂØÜÁöÑ„ÄÇ Êü•Áúã‰∫ÜwikiÂèëÁé∞Ôºö Netty and OkHttp are the only two implementations supported by Spring. 2.3 ÂçèËÆÆÂçèÂïÜHTTP2ÂçèËÆÆÁöÑÂçèÂïÜÊòØÂú®Êè°ÊâãÈò∂ÊÆµËøõË°åÁöÑ„ÄÇ ÂçèÂïÜÁöÑÊñπÂºèÊòØÈÄöËøáÊè°ÊâãÂçèËÆÆextensionÊâ©Â±ïÂ≠óÊÆµËøõË°åÊâ©Â±ïÔºåÊñ∞Â¢ûApplication Layer Protocol NegotiationÂ≠óÊÆµËøõË°åÂçèÂïÜ„ÄÇ Âú®Êè°ÊâãÂçèËÆÆÁöÑClientHelloÈò∂ÊÆµÔºåÂÆ¢Êà∑Á´ØÂ∞ÜÊâÄÊîØÊåÅÁöÑÂçèËÆÆÂàóË°®Â°´ÂÖ•Application Layer Protocol NegotiationÂ≠óÊÆµÔºå‰æõÊúçÂä°Á´ØËøõË°åÊåëÈÄâ„ÄÇ 2.4 Â§öË∑ØÂ§çÁî®MultipexingÂú®HTTP2‰∏≠ÔºåÂêå‰∏ÄÂüüÂêç‰∏ãÁöÑËØ∑Ê±ÇÔºåÂèØÈÄöËøáÂêå‰∏ÄÊù°TCPÈìæË∑ØËøõË°å‰º†ËæìÔºå‰ΩøÂ§ö‰∏™ËØ∑Ê±Ç‰∏çÂøÖÂçïÁã¨Âª∫Á´ãÈìæË∑ØÔºåËäÇÁúÅÂª∫Á´ãÈìæË∑ØÁöÑÂºÄÈîÄ„ÄÇ ‰∏∫‰∫ÜËææÂà∞Ëøô‰∏™ÁõÆÁöÑÔºåHTTP2ÊèêÂá∫‰∫ÜÊµÅ‰∏éÂ∏ßÁöÑÊ¶ÇÂøµÔºåÊµÅ‰ª£Ë°®ËØ∑Ê±Ç‰∏éÂìçÂ∫îÔºåËÄåËØ∑Ê±Ç‰∏éÂìçÂ∫îÂÖ∑‰ΩìÁöÑÊï∞ÊçÆÂàôÂåÖË£Ö‰∏∫Â∏ßÔºåÂØπÈìæË∑Ø‰∏≠‰º†ËæìÁöÑÊï∞ÊçÆÈÄöËøáÊµÅID‰∏éÂ∏ßÁ±ªÂûãËøõË°åÂå∫ÂàÜÂ§ÑÁêÜ„ÄÇ‰∏ãÂõæÊòØÂ§öË∑ØÂ§çÁî®ÁöÑÊäΩË±°ÂõæÔºåÊØè‰∏™Âùó‰ª£Ë°®‰∏ÄÂ∏ßÔºåËÄåÁõ∏ÂêåÈ¢úËâ≤ÁöÑÂùóÂàô‰ª£Ë°®ÊòØÂêå‰∏Ä‰∏™ÊµÅ„ÄÇ ÂΩíÁ∫≥‰∏ãokhttpÁöÑÂ§öË∑ØÂ§çÁî®ÂÆûÁé∞ÊÄùË∑ØÔºö ÈÄöËøáËØ∑Ê±ÇÁöÑAddress‰∏éËøûÊé•Ê±†‰∏≠Áé∞ÊúâËøûÊé•Address‰æùÊ¨°ÂåπÈÖçÔºåÈÄâÂá∫ÂèØÁî®ÁöÑConnection„ÄÇ ÈÄöËøáHttp2xStreamÂàõÂª∫ÁöÑFramedStreamÂú®ÂèëÈÄÅ‰∫ÜËØ∑Ê±ÇÂêéÔºåÂ∞ÜFramedStreamÂØπË±°‰∏éStreamIDÁöÑÊò†Â∞ÑÂÖ≥Á≥ªÁºìÂ≠òÂà∞FramedConnection‰∏≠„ÄÇ Êî∂Âà∞Ê∂àÊÅØÂêéÔºåFramedConnectionËß£ÊûêÂ∏ß‰ø°ÊÅØÔºåÂú®Map‰∏≠ÈÄöËøáËß£ÊûêÁöÑStreamIDÈÄâÂá∫ÁºìÂ≠òÁöÑFramedStreamÔºåÂπ∂Âî§ÈÜíFramedStreamËøõË°åResponseÁöÑÂ§ÑÁêÜ„ÄÇ 2.5 ÂéãÁº©Â§¥‰ø°ÊÅØHTTP2‰∏∫‰∫ÜËß£ÂÜ≥HTTP1.x‰∏≠Â§¥‰ø°ÊÅØËøáÂ§ßÂØºËá¥ÊïàÁéá‰Ωé‰∏ãÁöÑÈóÆÈ¢òÔºåÊèêÂá∫ÁöÑËß£ÂÜ≥ÊñπÊ°à‰æøÊòØÂéãÁº©Â§¥ÈÉ®‰ø°ÊÅØ„ÄÇÂÖ∑‰ΩìÁöÑÂéãÁº©ÊñπÂºèÔºåÂàôÂºïÂÖ•‰∫ÜHPACK„ÄÇ HPACKÂéãÁº©ÁÆóÊ≥ïÊòØ‰∏ìÈó®‰∏∫HTTP2Â§¥ÈÉ®ÂéãÁº©ÊúçÂä°ÁöÑ„ÄÇ‰∏∫‰∫ÜËææÂà∞ÂéãÁº©Â§¥ÈÉ®‰ø°ÊÅØÁöÑÁõÆÁöÑÔºåHPACKÂ∞ÜÂ§¥ÈÉ®Â≠óÊÆµÁºìÂ≠ò‰∏∫Á¥¢ÂºïÔºåÈÄöËøáÁ¥¢ÂºïID‰ª£Ë°®Â§¥ÈÉ®Â≠óÊÆµ„ÄÇÂÆ¢Êà∑Á´Ø‰∏éÊúçÂä°Á´ØÁª¥Êä§Á¥¢ÂºïË°®ÔºåÈÄö‰ø°ËøáÁ®ã‰∏≠Â∞ΩÂèØËÉΩÈááÁî®Á¥¢ÂºïËøõË°åÈÄö‰ø°ÔºåÊî∂Âà∞Á¥¢ÂºïÂêéÊü•ËØ¢Á¥¢ÂºïË°®ÔºåÊâçËÉΩËß£ÊûêÂá∫ÁúüÊ≠£ÁöÑÂ§¥ÈÉ®‰ø°ÊÅØ„ÄÇ HPACKÁ¥¢ÂºïË°®ÂàíÂàÜ‰∏∫Âä®ÊÄÅÁ¥¢ÂºïË°®‰∏éÈùôÊÄÅÁ¥¢ÂºïË°®ÔºåÂä®ÊÄÅÁ¥¢ÂºïË°®ÊòØHTTP2ÂçèËÆÆÈÄö‰ø°ËøáÁ®ã‰∏≠‰∏§Á´ØÂä®ÊÄÅÁª¥Êä§ÁöÑÁ¥¢ÂºïË°®ÔºåËÄåÈùôÊÄÅÁ¥¢ÂºïË°®ÊòØÁ°¨ÁºñÁ†ÅËøõÂçèËÆÆ‰∏≠ÁöÑÁ¥¢ÂºïË°®„ÄÇ ‰Ωú‰∏∫ÂàÜÊûêHPACKÂéãÁº©Â§¥‰ø°ÊÅØÁöÑÂü∫Á°ÄÔºåÈúÄË¶ÅÂÖà‰ªãÁªçHPACKÂØπÁ¥¢Âºï‰ª•ÂèäÂ§¥ÈÉ®Â≠óÁ¨¶‰∏≤ÁöÑË°®Á§∫ÊñπÂºè„ÄÇ Á¥¢Âºï Á¥¢Âºï‰ª•Êï¥ÂûãÊï∞Â≠óË°®Á§∫ÔºåÁî±‰∫éHPACKÈúÄË¶ÅËÄÉËôëÂéãÁº©‰∏éÁºñËß£Á†ÅÈóÆÈ¢òÔºåÊâÄ‰ª•Êï¥ÂûãÊï∞Â≠óÁªìÊûÑÂÆö‰πâ‰∏ãÂõæÊâÄÁ§∫Ôºö Á±ªÂà´Ê†áËØÜ:ÈÄöËøáÁ±ªÂà´Ê†áËØÜËøõË°åHPACKÁ±ªÂà´ÂàÜÁ±ªÔºåÊåáÂØºÂêéÁª≠ÁºñËß£Á†ÅÊìç‰ΩúÔºåÂ∏∏ËßÅÁöÑÊúâ1Ôºå01Ôºå01000000Á≠âÂÖ´‰∏™Á±ªÂà´„ÄÇ È¶ñÂ≠óËäÇ‰Ωé‰ΩçÊï¥Âûã:È¶ñÂ≠óËäÇÊéíÈô§Á±ªÂà´Ê†áËØÜÁöÑÂâ©‰Ωô‰ΩçÔºåÁî®‰∫éË°®Á§∫‰Ωé‰ΩçÊï¥Âûã„ÄÇËã•Êï∞ÂÄºÂ§ß‰∫éÂâ©‰Ωô‰ΩçÊâÄËÉΩË°®Á§∫ÁöÑÂÆπÈáèÔºåÂàôÈúÄË¶ÅÂêéÁª≠Â≠óËäÇË°®Á§∫È´ò‰ΩçÊï¥Âûã„ÄÇ ÁªìÊùüÊ†áËØÜ:Ë°®Á§∫Ê≠§Â≠óËäÇÊòØÂê¶‰∏∫Êï¥ÂûãËß£ÊûêÁªàÊ≠¢Â≠óËäÇ„ÄÇ È´ò‰ΩçÊï¥Âûã:Â≠óËäÇ‰Ωô‰∏ã7bitÔºåÁî®‰∫éÂ°´ÂÖÖÊï¥ÂûãÈ´ò‰Ωç„ÄÇ]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>HTTPS</tag>
        <tag>HTTP2</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mongodb ÈõÜÁæ§Âü∫Á°Ä]]></title>
    <url>%2F2017%2F08%2F10%2Fmongodb%E9%9B%86%E7%BE%A4%E5%9F%BA%E7%A1%80%2F</url>
    <content type="text"><![CDATA[1. MongoDB‰ªãÁªç MongoDB ÊòØ‰∏Ä‰∏™ÂèØÊâ©Â±ïÁöÑÈ´òÊÄßËÉΩ,ÂºÄÊ∫ê,Ê®°ÂºèËá™Áî±,Èù¢ÂêëÊñáÊ°£ÁöÑÊï∞ÊçÆÂ∫ì„ÄÇ ÂÆÉ‰ΩøÁî® C++ÁºñÂÜô„ÄÇMongoDB ÂåÖÂê´‰∏Ä‰∏ãÁâπÁÇπ: Èù¢ÂêëÈõÜÂêàÁöÑÂ≠òÂÇ®:ÈÄÇÂêàÂ≠òÂÇ®ÂØπË±°ÂèäJSONÂΩ¢ÂºèÁöÑÊï∞ÊçÆ„ÄÇ Âä®ÊÄÅÊü•ËØ¢:Mongo ÊîØÊåÅ‰∏∞ÂØåÁöÑÊü•ËØ¢ÊñπÂºè,Êü•ËØ¢Êåá‰ª§‰ΩøÁî® JSON ÂΩ¢ÂºèÁöÑÊ†áËÆ∞,ÂèØËΩªÊòìÊü•ËØ¢ÊñáÊ°£‰∏≠ÂÜÖÂµåÁöÑÂØπË±°ÂèäÊï∞ÁªÑ„ÄÇ ÂÆåÊï¥ÁöÑÁ¥¢ÂºïÊîØÊåÅ:ÂåÖÊã¨ÊñáÊ°£ÂÜÖÂµåÂØπË±°ÂèäÊï∞ÁªÑ„ÄÇMongo ÁöÑÊü•ËØ¢‰ºòÂåñÂô®‰ºöÂàÜÊûêÊü•ËØ¢Ë°®ËææÂºè,Âπ∂ÁîüÊàê‰∏Ä‰∏™È´òÊïàÁöÑÊü•ËØ¢ËÆ°Âàí„ÄÇ Êü•ËØ¢ÁõëËßÜ:MongoÂåÖÂê´‰∏Ä‰∏™ÁõëÊéßÂ∑•ÂÖ∑Áî®‰∫éÂàÜÊûêÊï∞ÊçÆÂ∫ìÊìç‰ΩúÊÄßËÉΩ„ÄÇ Â§çÂà∂ÂèäËá™Âä®ÊïÖÈöúËΩ¨Áßª:Mongo Êï∞ÊçÆÂ∫ìÊîØÊåÅÊúçÂä°Âô®‰πãÈó¥ÁöÑÊï∞ÊçÆÂ§çÂà∂,ÊîØÊåÅ‰∏ª-‰ªéÊ®°ÂºèÂèäÊúçÂä°Âô®‰πãÈó¥ÁöÑÁõ∏‰∫íÂ§çÂà∂„ÄÇÂ§çÂà∂ÁöÑ‰∏ªË¶ÅÁõÆÁöÑÊòØÊèê‰æõÂÜó‰ΩôÂèäËá™Âä®ÊïÖÈöúËΩ¨Áßª„ÄÇ È´òÊïàÁöÑ‰º†ÁªüÂ≠òÂÇ®ÊñπÂºè:ÊîØÊåÅ‰∫åËøõÂà∂Êï∞ÊçÆÂèäÂ§ßÂûãÂØπË±°(Â¶Ç:ÁÖßÁâáÊàñÂõæÁâá)„ÄÇ Ëá™Âä®ÂàÜÁâá‰ª•ÊîØÊåÅ‰∫ëÁ∫ßÂà´ÁöÑ‰º∏Áº©ÊÄß:Ëá™Âä®ÂàÜÁâáÂäüËÉΩÊîØÊåÅÊ∞¥Âπ≥ÁöÑÊï∞ÊçÆÂ∫ìÈõÜÁæ§,ÂèØÂä®ÊÄÅÊ∑ªÂä†È¢ùÂ§ñÁöÑÊú∫Âô®„ÄÇ 2.Replica SetÈõÜÁæ§ÂΩì‰∏≠ÂåÖÂê´‰∫ÜÂ§ö‰ªΩÊï∞ÊçÆÔºå‰øùËØÅ‰∏ªËäÇÁÇπÊåÇÊéâ‰∫ÜÔºåÂ§áËäÇÁÇπËÉΩÁªßÁª≠Êèê‰æõÊï∞ÊçÆÊúçÂä°ÔºåÊèê‰æõÁöÑÂâçÊèêÂ∞±ÊòØÊï∞ÊçÆÈúÄË¶ÅÂíå‰∏ªËäÇÁÇπ‰∏ÄËá¥„ÄÇ Mongodb(M)Ë°®Á§∫‰∏ªËäÇÁÇπÔºåMongodb(S)Ë°®Á§∫Â§áËäÇÁÇπÔºåMongodb(A)Ë°®Á§∫‰ª≤Ë£ÅËäÇÁÇπ„ÄÇ‰∏ªÂ§áËäÇÁÇπÂ≠òÂÇ®Êï∞ÊçÆÔºå‰ª≤Ë£ÅËäÇÁÇπ‰∏çÂ≠òÂÇ®Êï∞ÊçÆ„ÄÇÂÆ¢Êà∑Á´ØÂêåÊó∂ËøûÊé•‰∏ªËäÇÁÇπ‰∏éÂ§áËäÇÁÇπÔºå‰∏çËøûÊé•‰ª≤Ë£ÅËäÇÁÇπ„ÄÇ ÈªòËÆ§ËÆæÁΩÆ‰∏ãÔºå‰∏ªËäÇÁÇπÊèê‰æõÊâÄÊúâÂ¢ûÂà†Êü•ÊîπÊúçÂä°ÔºåÂ§áËäÇÁÇπ‰∏çÊèê‰æõ‰ªª‰ΩïÊúçÂä°„ÄÇ‰ΩÜÊòØÂèØ‰ª•ÈÄöËøáËÆæÁΩÆ‰ΩøÂ§áËäÇÁÇπÊèê‰æõÊü•ËØ¢ÊúçÂä°ÔºåËøôÊ†∑Â∞±ÂèØ‰ª•ÂáèÂ∞ë‰∏ªËäÇÁÇπÁöÑÂéãÂäõÔºåÂΩìÂÆ¢Êà∑Á´ØËøõË°åÊï∞ÊçÆÊü•ËØ¢Êó∂ÔºåËØ∑Ê±ÇËá™Âä®ËΩ¨Âà∞Â§áËäÇÁÇπ‰∏ä„ÄÇËøô‰∏™ËÆæÁΩÆÂè´ÂÅöRead Preference ModesÔºåÂêåÊó∂JavaÂÆ¢Êà∑Á´ØÊèê‰æõ‰∫ÜÁÆÄÂçïÁöÑÈÖçÁΩÆÊñπÂºèÔºåÂèØ‰ª•‰∏çÂøÖÁõ¥Êé•ÂØπÊï∞ÊçÆÂ∫ìËøõË°åÊìç‰Ωú„ÄÇ ‰ª≤Ë£ÅËäÇÁÇπÊòØ‰∏ÄÁßçÁâπÊÆäÁöÑËäÇÁÇπÔºåÂÆÉÊú¨Ë∫´Âπ∂‰∏çÂ≠òÂÇ®Êï∞ÊçÆÔºå‰∏ªË¶ÅÁöÑ‰ΩúÁî®ÊòØÂÜ≥ÂÆöÂì™‰∏Ä‰∏™Â§áËäÇÁÇπÂú®‰∏ªËäÇÁÇπÊåÇÊéâ‰πãÂêéÊèêÂçá‰∏∫‰∏ªËäÇÁÇπÔºåÊâÄ‰ª•ÂÆ¢Êà∑Á´Ø‰∏çÈúÄË¶ÅËøûÊé•Ê≠§ËäÇÁÇπ„ÄÇËøôÈáåËôΩÁÑ∂Âè™Êúâ‰∏Ä‰∏™Â§áËäÇÁÇπÔºå‰ΩÜÊòØ‰ªçÁÑ∂ÈúÄË¶Å‰∏Ä‰∏™‰ª≤Ë£ÅËäÇÁÇπÊù•ÊèêÂçáÂ§áËäÇÁÇπÁ∫ßÂà´„ÄÇÊàëÂºÄÂßã‰πü‰∏çÁõ∏‰ø°ÂøÖÈ°ªË¶ÅÊúâ‰ª≤Ë£ÅËäÇÁÇπÔºå‰ΩÜÊòØËá™Â∑±‰πüËØïËøáÊ≤°‰ª≤Ë£ÅËäÇÁÇπÁöÑËØùÔºå‰∏ªËäÇÁÇπÊåÇ‰∫ÜÂ§áËäÇÁÇπËøòÊòØÂ§áËäÇÁÇπÔºåÊâÄ‰ª•Âí±‰ª¨ËøòÊòØÈúÄË¶ÅÂÆÉÁöÑ„ÄÇ 3.Sharding ÂíåReplica SetÁ±ª‰ººÔºåÈÉΩÈúÄË¶Å‰∏Ä‰∏™‰ª≤Ë£ÅËäÇÁÇπÔºå‰ΩÜÊòØShardingËøòÈúÄË¶ÅÈÖçÁΩÆËäÇÁÇπÂíåË∑ØÁî±ËäÇÁÇπ„ÄÇ ÈõÜÁæ§Êê≠Âª∫ÊñπÂºèÈ¶ñÈÄâReplica SetÔºåÂè™ÊúâÁúüÁöÑÊòØÂ§ßÊï∞ÊçÆÔºåShardingÊâçËÉΩÊòæÁé∞Â®ÅÂäõÔºåÊØïÁ´üÂ§áËäÇÁÇπÂêåÊ≠•Êï∞ÊçÆÊòØÈúÄË¶ÅÊó∂Èó¥ÁöÑ„ÄÇShardingÂèØ‰ª•Â∞ÜÂ§öÁâáÊï∞ÊçÆÈõÜ‰∏≠Âà∞Ë∑ØÁî±ËäÇÁÇπ‰∏äËøõË°å‰∏Ä‰∫õÂØπÊØîÔºåÁÑ∂ÂêéÂ∞ÜÊï∞ÊçÆËøîÂõûÁªôÂÆ¢Êà∑Á´ØÔºå‰ΩÜÊòØÊïàÁéáËøòÊòØÊØîËæÉ‰ΩéÁöÑËØ¥„ÄÇ ÊàëËá™Â∑±ÊúâÊµãËØïËøáÔºå‰∏çËøáÂÖ∑‰ΩìÁöÑÊú∫Âô®ÈÖçÁΩÆÂ∑≤Áªè‰∏çËÆ∞Âæó‰∫Ü„ÄÇReplica SetÁöÑipsÂú®Êï∞ÊçÆËææÂà∞1400wÊù°Êó∂Âü∫Êú¨ËÉΩËææÂà∞1000Â∑¶Âè≥ÔºåËÄåShardingÂú®300wÊó∂Â∑≤Áªè‰∏ãÈôçÂà∞500ips‰∫ÜÔºå‰∏§ËÄÖÁöÑÂçï‰ΩçÊï∞ÊçÆÂ§ßÂ∞èÂ§ßÊ¶ÇÊòØ10kb„ÄÇÂ§ßÂÆ∂Âú®Â∫îÁî®ÁöÑÊó∂ÂÄôËøòÊòØÂ§öÂ§öÂÅö‰∏ãÊÄßËÉΩÊµãËØïÔºåÊØïÁ´ü‰∏çÂÉèRedisÊúâbenchmark„ÄÇ MongodbÁé∞Âú®Áî®ÁöÑËøòÊòØÊØîËæÉÂ§öÁöÑÔºå‰ΩÜÊòØ‰∏™‰∫∫ËßâÂæóÈÖçÁΩÆÂ§™Â§ö‰∫Ü„ÄÇÊàëÁúãÂÆòÁΩëÈÉΩÁúã‰∫ÜÂ•ΩÂ§öÂ§©ÔºåÊâçÊääÈõÜÁæ§Êê≠Âª∫ÁöÑÈÖçÁΩÆÂíåÊ≥®ÊÑèË¶ÅÁÇπÂºÑÊòéÁôΩ„ÄÇËÄå‰∏îÁî®ËøáÁöÑ‰∫∫Â∫îËØ•Áü•ÈÅìmongodbÂêÉÂÜÖÂ≠òÁöÑÈóÆÈ¢òÔºåËß£ÂÜ≥ÂäûÊ≥ïÂè™ËÉΩÈÄöËøáulimitÊù•ÊéßÂà∂ÂÜÖÂ≠ò‰ΩøÁî®ÈáèÔºå‰ΩÜÊòØÂ¶ÇÊûúÊéßÂà∂‰∏çÂ•ΩÁöÑËØùÔºåmongodb‰ºöÊåÇÊéâ PS: ÂêéÈù¢ÁªßÁª≠Ë°•ÂÖÖ„ÄÇ]]></content>
      <categories>
        <category>‰∏≠Èó¥‰ª∂</category>
      </categories>
      <tags>
        <tag>MongoDB</tag>
        <tag>Cluster</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Spring Cloud ÂÖ•Èó®]]></title>
    <url>%2F2017%2F07%2F18%2Fspring-cloud%2F</url>
    <content type="text"><![CDATA[1. ÂæÆÊúçÂä°Êû∂ÊûÑÂæÆÊúçÂä°Êû∂ÊûÑÔºàMicro-Service ArchetictureÔºâÊòØÂΩì‰∏ãÊµÅË°åÁöÑÊû∂ÊûÑÈ£éÊ†ºÔºåÊó®Âú®ÈÄöËøáÂ∞ÜÂäüËÉΩÊ®°ÂùóÂàÜËß£Âà∞ÂêÑ‰∏™Áã¨Á´ãÁöÑÂ≠êÁ≥ªÁªü‰∏≠‰ª•ÂÆûÁé∞Ëß£ËÄ¶ÔºåÂÆÉÂπ∂Ê≤°Êúâ‰∏ÄÊàê‰∏çÂèòÁöÑËßÑÂÆöÔºåËÄåÊòØÈúÄË¶ÅÊ†πÊçÆ‰∏öÂä°Êù•ÂÅöËÆæËÆ°[ÊùéË¥ûÊòä,2017]„ÄÇÂæÆÊúçÂä°Êû∂ÊûÑ‰∏≠ÔºåÊØè‰∏™ÂæÆÊúçÂä°Ê®°ÂùóÂè™ÊòØÂØπÁÆÄÂçï„ÄÅÁã¨Á´ã„ÄÅÊòéÁ°ÆÁöÑ‰ªªÂä°ËøõË°åÂ§ÑÁêÜÔºåÈÄöËøáREST APIËøîÂõûÂ§ÑÁêÜÁªìÊûúÁªôÂ§ñÈÉ®„ÄÇÂú®ÂæÆÊúçÂä°Êé®ÂπøÂÆûË∑µËßíÂ∫¶Êù•ÁúãÔºåÂæÆÊúçÂä°Â∞ÜÊï¥‰∏™Á≥ªÁªüËøõË°åÊãÜÂàÜÔºåÊãÜÂàÜÊàêÊõ¥Â∞èÁöÑÁ≤íÂ∫¶Ôºå‰øùÊåÅËøô‰∫õÊúçÂä°Áã¨Á´ãËøêË°åÔºåÂ∫îÁî®ÂÆπÂô®ÂåñÊäÄÊúØÂ∞ÜÂæÆÊúçÂä°Áã¨Á´ãËøêË°åÂú®ÂÆπÂô®‰∏≠„ÄÇËøáÂéªËÆæËÆ°Êû∂ÊûÑÊó∂ÔºåÊòØÂú®ÂÜÖÂ≠ò‰∏≠‰ª•ÂèÇÊï∞ÊàñÂØπË±°ÁöÑÊñπÂºèÂÆûÁé∞Á≤íÂ∫¶ÁªÜÂåñ„ÄÇÂæÆÊúçÂä°‰ΩøÁî®ÂêÑ‰∏™Â≠êÊúçÂä°ÊéßÂà∂Ê®°ÂùóÁöÑÊÄùÊÉ≥‰ª£ÊõøÊÄªÁ∫ø„ÄÇ‰∏çÂêåÁöÑ‰∏öÂä°Ë¶ÅÊ±ÇÔºåÊúçÂä°ÊéßÂà∂Ê®°ÂùóËá≥Â∞ëÂåÖÂê´ÊúçÂä°ÁöÑÂèëÂ∏É„ÄÅÊ≥®ÂÜå„ÄÅË∑ØÁî±„ÄÅ‰ª£ÁêÜÂäüËÉΩ„ÄÇ 2. vs Âçï‰ΩìÂ∫îÁî®Êû∂ÊûÑÂæÆÊúçÂä°Êû∂ÊûÑÊ®°ÂºèÁõ∏ÊØî‰∫éÂçï‰ΩìÂ∫îÁî®Êû∂ÊûÑÔºåÊúâÂæàÂ§ö‰ºòÂäø„ÄÇ È¶ñÂÖàÔºåÂ∑®Â§ßÁöÑÂçï‰ΩìÂºèÂ∫îÁî®ÊãÜÂàÜ‰∏∫Â§ö‰∏™ÂæÆÊúçÂä°ÔºåÈôç‰Ωé‰∫ÜÂ§çÊùÇÊÄß„ÄÇÂú®ÂÖ∑Êúâ‰πãÂâçÂçï‰ΩìÂ∫îÁî®ÂäüËÉΩÁöÑÂêåÊó∂ÔºåÂçï‰ΩìÂ∫îÁî®Ë¢´ÊãÜÂàÜ‰∏∫Â§ö‰∏™ÂèØÁÆ°ÁêÜÁöÑÂæÆÊúçÂä°„ÄÇÊØè‰∏™ÂæÆÊúçÂä°ÈÉΩÂÖ∑ÊúâÂÆö‰πâÊ∏ÖÊ•öÁöÑËæπÁïåÔºå‰ΩøÁî®ËøúÁ®ãËøáÁ®ãË∞ÉÁî®ÔºàRPCÔºâÊàñËÄÖÊ∂àÊÅØÈ©±Âä®API„ÄÇÊãÜÂàÜÂêéÁöÑÂæÆÊúçÂä°Ê®°ÂùóÔºåÁ≤íÂ∫¶Â∞èÔºåÂæàÂÆπÊòìÂºÄÂèëÂíåÁª¥Êä§„ÄÇÂæÆÊúçÂä°Êû∂ÊûÑÊ®°ÂºèÈôç‰Ωé‰∫ÜÂçï‰ΩìÂºèÁºñÁ†ÅÁöÑÈöæÂ∫¶ÔºåÂπ∂‰∏îÂäüËÉΩÊèê‰æõ‰∫ÜÊ®°ÂùóÂåñÁöÑËß£ÂÜ≥ÊñπÊ°à„ÄÇ Á¨¨‰∫åÔºåÂæÆÊúçÂä°Êû∂ÊûÑ‰∏ãÔºå‰∏ìÈó®ÂºÄÂèëÂõ¢ÈòüË¥üË¥£ÂºÄÂèë‰∏Ä‰∏™Â≠êÊúçÂä°„ÄÇÊØè‰∏™ÂºÄÂèëÂõ¢ÈòüÂèØ‰ª•Ëá™‰∏ªÈÄâÊã©ÊäÄÊúØÊ†àÔºåÊèê‰æõAPIÊé•Âè£„ÄÇÂΩìÁÑ∂ÔºåËÆ∏Â§öÂÖ¨Âè∏Â∞ÜÊäÄÊúØÊ†àÁªü‰∏ÄÔºåÂè™Êèê‰æõÁâπÂÆöÈÄâÊã©ÁöÑÊäÄÊúØ„ÄÇÁÑ∂ÂêéÔºåËøôÁßçËá™Áî±‰ΩøÂæóÂºÄÂèëÂõ¢Èòü‰∏çÈúÄË¶ÅË¢´Ëø´‰ΩøÁî®ÁâπÂÆöÁöÑÈÇ£‰∫õÊäÄÊúØÔºå‰ªñ‰ª¨ÂèØ‰ª•Ëá™Áî±Âú∞ÈÄâÊã©ÈÄÇÂêàËØ•ÂæÆÊúçÂä°ÁöÑÊäÄÊúØ„ÄÇÁîöËá≥‰∫éÔºåÈáçÊûÑ‰πãÂâçÁöÑ‰ª£Á†Å‰πüÂèòÂæóÂæà‰æøÊç∑„ÄÇ Á¨¨‰∏âÔºåÊØè‰∏™ÂæÆÊúçÂä°ÈÉΩÊòØÁã¨Á´ãÁöÑÈÉ®ÁΩ≤„ÄÇÂºÄÂèëÂõ¢Èòü‰∏çÂÜçÈúÄË¶ÅÂçèË∞ÉÂÖ∂ÂÆÉÊúçÂä°ÈÉ®ÁΩ≤ÂØπÊú¨ÊúçÂä°ÁöÑÂΩ±Âìç„ÄÇËøôÊ†∑ÁöÑÁâπÊÄßÂ§ßÂ§ßÂä†Âø´‰∫ÜÈÉ®ÁΩ≤ÈÄüÂ∫¶„ÄÇÂæÆÊúçÂä°Êû∂ÊûÑÊ®°Âºè‰ΩøÂæóÊåÅÁª≠ÂåñÈÉ®ÁΩ≤Êàê‰∏∫ÂèØËÉΩ„ÄÇ ÊúÄÂêéÔºåÂæÆÊúçÂä°Êû∂ÊûÑÊ®°Âºè‰ΩøÂæóÊØè‰∏™ÂæÆÊúçÂä°Â∫îÁî®ÈÉΩÂèØ‰ª•Ë¢´Áã¨Á´ãÊâ©Â±ï„ÄÇÂçï‰ΩìÊû∂ÊûÑÂ∫îÁî®‰πüÂèØ‰ª•Ê®™ÂêëÊâ©Â±ïÔºåÂç≥Êï¥‰∏™Â∫îÁî®ÂÆåÊï¥ÁöÑÂ§çÂà∂Âà∞‰∏çÂêåÁöÑËäÇÁÇπ„ÄÇÂΩìÂ∫îÁî®ÁöÑ‰∏çÂêåÁªÑ‰ª∂Âú®Êâ©Â±ïÈúÄÊ±Ç‰∏äÂ≠òÂú®Â∑ÆÂºÇÊó∂ÔºåÂæÆÊúçÂä°Êû∂ÊûÑ‰æø‰ΩìÁé∞Âá∫ÂÖ∂‰ºòË∂äÊÄß„ÄÇÈÄöËøáÂú®‰∏çÂêåÁöÑÂü∫Á°ÄËÆæÊñΩ‰πãÈó¥ÂÆûÁé∞Êâ©Â±ïÔºåËøô‰∫õÊúçÂä°ËÉΩÂ§üÊúâÊïàÂú∞Èôç‰ΩéÈ£éÈô©[ÈôàÊò•Èúû, 2016]„ÄÇ 3. Spring CloudÂºÄÊ∫êÊ°ÜÊû∂Spring CloudÊòØ‰∏Ä‰∏™Âü∫‰∫éSpring BootÂÆûÁé∞ÁöÑ‰∫ëÂ∫îÁî®ÂºÄÂèëÂ∑•ÂÖ∑ÔºåÂÆÉ‰∏∫Âü∫‰∫éJVMÁöÑ‰∫ëÂ∫îÁî®ÂºÄÂèë‰∏≠ÁöÑÊúçÂä°ÂèëÁé∞‰∏éÊ≥®ÂÜå„ÄÅÁÜîÊñ≠Êú∫Âà∂„ÄÅË∑ØÁî±„ÄÅÂÖ®Â±ÄÈîÅ„ÄÅ‰∏≠ÂøÉÈÖçÁΩÆÁÆ°ÁêÜ„ÄÅÊéßÂà∂ÊÄªÁ∫ø„ÄÅÂÜ≥Á≠ñÁ´ûÈÄâ„ÄÅÂàÜÂ∏ÉÂºè‰ºöËØùÂíåÈõÜÁæ§Áä∂ÊÄÅÁÆ°ÁêÜÁ≠âÊìç‰ΩúÊèê‰æõ‰∫Ü‰∏ÄÁßçÁÆÄÂçïÁöÑÂºÄÂèëÊñπÂºè[ÁøüÊ∞∏Ë∂Ö,2016]„ÄÇSpring CloudÊï¥‰ΩìÊû∂ÊûÑÂõæÂ¶ÇÂõæ1.1ÊâÄÁ§∫„ÄÇ Spring CloudÊï¥‰ΩìÊû∂ÊûÑ‰∏≠Â¶Ç‰∏ãÂá†‰∏™Âü∫Á°ÄÊúçÂä°Ê®°ÂùóÔºöÂæÆÊúçÂä°ÈÖçÁΩÆÁÆ°ÁêÜ„ÄÅAPIÁΩëÂÖ≥ÊúçÂä°„ÄÅÊúçÂä°ÂèëÁé∞‰∏éÊ≥®ÂÜåÂíåÊ∂àÊÅØÊÄªÁ∫øÊ®°Âùó„ÄÇ spring-cloud-configÔºåÂæÆÊúçÂä°ÈÖçÁΩÆÁÆ°ÁêÜÔºåÂç≥‰∏∫‰∏äÂõæÁöÑconfig serviceÊúçÂä°Ê®°ÂùóÔºå‰∏∫ÊúçÂä°Á´ØÊèê‰æõ‰∫ÜÂàÜÂ∏ÉÂºèÁéØÂ¢ÉÁöÑ‰∏≠Â§ÆÈÖçÁΩÆÊîØÊåÅ„ÄÇÈÖçÁΩÆÊúçÂä°Âô®‰∏∫ÂêÑÂ∫îÁî®ÁöÑÊâÄÊúâÁéØÂ¢ÉÊèê‰æõ‰∫Ü‰∏Ä‰∏™‰∏≠ÂøÉÂåñÁöÑÂ§ñÈÉ®ÈÖçÁΩÆ„ÄÇÂÆÉÂÆåÊàê‰∫ÜÂØπÊúçÂä°Á´ØSpring-EnvÂíåÈÖçÁΩÆÊ∫êÊäΩË±°ÁöÑÊò†Â∞ÑÔºåÊâÄ‰ª•configÊúçÂä°‰∏ç‰ªÖÈÄÇÁî®‰∫éSpringÊ°ÜÊû∂ÊûÑÂª∫ÁöÑÂ∫îÁî®Ôºå‰πüÂèØ‰ª•‰ΩøÁî®Âú®ÂÖ∂‰ªñËØ≠Ë®ÄÁöÑÂ∫îÁî®Á®ãÂ∫è„ÄÇ‰Ωú‰∏∫‰∏Ä‰∏™Â∫îÁî®ÔºåÂèØ‰ª•ÈÄöËøáÈÉ®ÁΩ≤ÁÆ°ÈÅìÊù•ËøõË°åÊµãËØïÊàñËÄÖÊäïÂÖ•Áîü‰∫ßÔºåÂàÜÂà´‰∏∫Ëøô‰∫õÁéØÂ¢ÉÂàõÂª∫ÈÖçÁΩÆÔºåÂπ∂‰∏îÂú®ÈúÄË¶ÅËøÅÁßªÁéØÂ¢ÉÁöÑÊó∂ÂÄôËé∑ÂèñÂØπÂ∫îÁöÑÈÖçÁΩÆÊù•ËøêË°å„ÄÇ APIÁΩëÂÖ≥ÔºåÊú¨Á≥ªÁªü‰ΩøÁî®netflixÁöÑzuulÊ°ÜÊû∂Ôºå‰Ωú‰∏∫Á≥ªÁªüÁöÑÁªü‰∏ÄÂÖ•Âè£ÔºåÂÖ∑ÊúâË¥üËΩΩÂùáË°°„ÄÅÊúçÂä°Ë∑ØÁî±„ÄÅÊúçÂä°ËøáÊª§Á≠âÂäüËÉΩ„ÄÇ ÊúçÂä°ÂèëÁé∞‰∏éÊ≥®ÂÜåÊúâÂ§öÁßçÂºÄÊ∫êÁªÑ‰ª∂ÊîØÊåÅÔºåÊØîÂ¶Çzookeeper„ÄÅetcd„ÄÅnetflixÂÖ¨Âè∏ÁöÑEurekaÔºå‰ª•ÂèäÊú¨Á≥ªÁªü‰ΩøÁî®ÁöÑConsul„ÄÇÊúçÂä°ÂèëÁé∞ÊòØ‰∏Ä‰∏™ÊúçÂä°Â∞ÜÂÖ∂Âú∞ÂùÄ‰ø°ÊÅØÂú®‰∏≠ÂøÉÊ≥®ÂÜåËäÇÁÇπËøõË°åÊ≥®ÂÜåÁöÑËøáÁ®ã„ÄÇËØ•ÊúçÂä°‰∏ÄËà¨‰ºöÂ∞ÜÂÆÉÁöÑ‰∏ªÊú∫IPÂú∞ÂùÄ‰ª•ÂèäÁ´ØÂè£Âè∑ËøõË°åÊ≥®ÂÜåÔºåÂÖ∑‰ΩìËøò‰ºöÂåÖÊã¨ËÆ§ËØÅ‰ø°ÊÅØ„ÄÅ‰ΩøÁî®ÂçèËÆÆ„ÄÅÁâàÊú¨Âè∑Á≠â‰ø°ÊÅØÔºå‰ª•ÂèäÂÖ≥‰∫éÂ∫îÁî®ÊúçÂä°ÁéØÂ¢ÉÁöÑÁªÜËäÇ‰ø°ÊÅØ„ÄÇ‰∏Ä‰∏™Â∫îÁî®ÊúçÂä°ÊàñËÄÖÁªÑ‰ª∂ÈÄöËøáÊúçÂä°ÂèëÁé∞ÂèØ‰ª•ÊéåÊè°ÂÖ∂ËøêË°åÁéØÂ¢É‰ª•ÂèäÂÖ∂ÂÆÉÂ∫îÁî®ÊúçÂä°ÊàñÁªÑ‰ª∂ÁöÑ‰ø°ÊÅØ„ÄÇÁî®Êà∑ÈÖçÁΩÆ‰∏Ä‰∏™ÊúçÂä°ÂèëÁé∞Â∑•ÂÖ∑‰πãÂêéÔºåÂ∞±ÂèØ‰ª•Â∞ÜÂÆûÈôÖÂÆπÂô®‰∏éËøêË°åÈÖçÁΩÆÂàÜÁ¶ªÂºÄ„ÄÇ]]></content>
      <categories>
        <category>ÂæÆÊúçÂä°</category>
      </categories>
      <tags>
        <tag>Spring Cloud</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ÊµÖÊûêREST‰∏éHTTP]]></title>
    <url>%2F2017%2F07%2F10%2FREST%E4%B8%8EHTTP%2F</url>
    <content type="text"><![CDATA[ÂπÇÁ≠âÊÄßMethods can also have the property of &quot;idempotence&quot; in that (aside from error or expiration issues) the side-effects of N &gt; 0 identical requests is the same as for a single request. ÂÆâÂÖ®Êìç‰Ωú‰∏éÂπÇÊåáÁõ∏Á≠âÁâπÊÄßÔºàSafety /IdempotenceÔºâHTTP ÁöÑ GET„ÄÅHEAD ËØ∑Ê±ÇÊú¨Ë¥®‰∏äÂ∫îËØ•ÊòØÂÆâÂÖ®ÁöÑË∞ÉÁî®ÔºåÂç≥ÔºöGET„ÄÅHEAD Ë∞ÉÁî®‰∏ç‰ºöÊúâ‰ªª‰ΩïÁöÑÂâØ‰ΩúÁî®Ôºå‰∏ç‰ºöÈÄ†ÊàêÊúçÂä°Âô®Á´ØÁä∂ÊÄÅÁöÑÊîπÂèò„ÄÇÂØπ‰∫éÊúçÂä°Âô®Êù•ËØ¥ÔºåÂÆ¢Êà∑Á´ØÂØπÊüê‰∏Ä URI ÂÅö n Ê¨°ÁöÑ GET„ÄÅHAED Ë∞ÉÁî®ÔºåÂÖ∂Áä∂ÊÄÅ‰∏éÊ≤°ÊúâÂÅöË∞ÉÁî®ÊòØ‰∏ÄÊ†∑ÁöÑÔºå‰∏ç‰ºöÂèëÁîü‰ªª‰ΩïÁöÑÊîπÂèò„ÄÇ HTTP ÁöÑ PUT„ÄÅDELTE Ë∞ÉÁî®ÔºåÂÖ∑ÊúâÂπÇÊåáÁõ∏Á≠âÁâπÊÄß , Âç≥ÔºöÂÆ¢Êà∑Á´ØÂØπÊüê‰∏Ä URI ÂÅö n Ê¨°ÁöÑ PUT„ÄÅDELTE Ë∞ÉÁî®ÔºåÂÖ∂ÊïàÊûú‰∏éÂÅö‰∏ÄÊ¨°ÁöÑË∞ÉÁî®ÊòØ‰∏ÄÊ†∑ÁöÑ„ÄÇHTTP ÁöÑ GET„ÄÅHEAD ÊñπÊ≥ï‰πüÂÖ∑ÊúâÂπÇÊåáÁõ∏Á≠âÁâπÊÄß„ÄÇHTTP Ëøô‰∫õÊ†áÂáÜÊñπÊ≥ïÂú®ÂéüÂàô‰∏ä‰øùËØÅ‰Ω†ÁöÑÂàÜÂ∏ÉÂºèÁ≥ªÁªüÂÖ∑ÊúâËøô‰∫õÁâπÊÄßÔºå‰ª•Â∏ÆÂä©ÊûÑÂª∫Êõ¥Âä†ÂÅ•Â£ÆÁöÑÂàÜÂ∏ÉÂºèÁ≥ªÁªü„ÄÇ ÂΩìÁÑ∂‰Ωú‰∏∫ËÆæËÆ°ÁöÑÂü∫Á°ÄÔºåÂá†‰∏™ÂøÖÈ°ªÁöÑÂéüÂàôËøòÊòØË¶ÅÈÅµÂÆàÁöÑÔºö ÂΩìÊ†áÂáÜÂêàÁêÜÁöÑÊó∂ÂÄôÈÅµÂÆàÊ†áÂáÜ„ÄÇ APIÂ∫îËØ•ÂØπÁ®ãÂ∫èÂëòÂèãÂ•ΩÔºåÂπ∂‰∏îÂú®ÊµèËßàÂô®Âú∞ÂùÄÊ†èÂÆπÊòìËæìÂÖ•„ÄÇ APIÂ∫îËØ•ÁÆÄÂçïÔºåÁõ¥ËßÇÔºåÂÆπÊòì‰ΩøÁî®ÁöÑÂêåÊó∂‰ºòÈõÖ„ÄÇ APIÂ∫îËØ•ÂÖ∑ÊúâË∂≥Â§üÁöÑÁÅµÊ¥ªÊÄßÊù•ÊîØÊåÅ‰∏äÂ±Çui„ÄÇ APIËÆæËÆ°ÊùÉË°°‰∏äËø∞Âá†‰∏™ÂéüÂàô„ÄÇ HTTPhttpËØ∑Ê±ÇÁî±‰∏âÈÉ®ÂàÜÁªÑÊàêÔºåÂàÜÂà´ÊòØÔºöËØ∑Ê±ÇË°å„ÄÅÊ∂àÊÅØÊä•Â§¥„ÄÅËØ∑Ê±ÇÊ≠£Êñá. http 1.1/2 http://www.blogjava.net/yongboy/archive/2015/03/23/423751.html HTTP/1.1ÔºåHTTPÂÆ¢Êà∑Á´ØÊó†Ê≥ïÈáçËØïÈùûÂπÇÁ≠âËØ∑Ê±ÇÔºåÂ∞§ÂÖ∂Âú®ÈîôËØØÂèëÁîüÁöÑÊó∂ÂÄôÔºåÁî±‰∫éÊó†Ê≥ïÊ£ÄÊµãÈîôËØØÊÄßË¥®Ëøô‰ºöÂØπÈáçËØïÂ∏¶Êù•‰∏çÂà©ÁöÑÂΩ±Âìç„ÄÇ HTTP/2‰∏çÂÖÅËÆ∏‰ΩøÁî®ËøûÊé•ÁâπÂÆöÂ§¥ÈÉ®Â≠óÊÆµ Êñ∞Â¢ûÁöÑ5‰∏™Â§¥ÈÉ® Êé®ÈÄÅÊú∫Âà∂ÁöÑ‰∏Ä‰∫õÁâπÊÄßÈúÄÊ±Ç RST_STREAMÁ≠âÂ∏ßÊ†áÂøó‰ΩçÁöÑ‰ΩøÁî®]]></content>
      <categories>
        <category>Note</category>
      </categories>
      <tags>
        <tag>REST</tag>
        <tag>HTTP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ËÆæËÆ°Ê®°Âºè‰πãÂçï‰æãÊ®°Âºè]]></title>
    <url>%2F2017%2F02%2F19%2Fdesignsingleton%2F</url>
    <content type="text"><![CDATA[‰∏ä‰∏ÄÁØáÂÜô‰∫Ü23ÁßçËÆæËÆ°Ê®°ÂºèÊÄªËßàÔºåÊú¨Êñá‰∏ªË¶Å‰ªãÁªçÂàõÂª∫Ê®°Âºè‰∏≠ÁöÑÂçï‰æãÊ®°ÂºèÔºåÊó•Â∏∏Â∑•‰Ωú‰∏≠‰πü‰ºöÊúâÁªèÂ∏∏Áî®Âà∞„ÄÇ 1. ÂÆö‰πâÈ¶ñÂÖàÔºå‰ªÄ‰πàÊòØÂçï‰æãÊ®°ÂºèÔºüÂçï‰æãÊ®°ÂºèÊúâ‰ª•‰∏ãÁâπÁÇπÔºö ‰ªéÂ≠óÈù¢Â∞±ÂèØ‰ª•ÁêÜËß£ÔºåÂçï‰æãÁ±ªÂè™ËÉΩÊúâ‰∏Ä‰∏™ÂÆû‰æã„ÄÇ Âçï‰æãÁ±ªÂøÖÈ°ªËá™Â∑±ÂàõÂª∫Ëá™Â∑±ÁöÑÂîØ‰∏ÄÂÆû‰æã„ÄÇ Âçï‰æãÁ±ªÂøÖÈ°ªÁªôÊâÄÊúâÂÖ∂‰ªñÂØπË±°Êèê‰æõËøô‰∏ÄÂÆû‰æã„ÄÇ Âçï‰æãÊ®°ÂºèÁ°Æ‰øùÊüê‰∏™Á±ªÂè™Êúâ‰∏Ä‰∏™ÂÆû‰æãÔºåËÄå‰∏îËá™Ë°åÂÆû‰æãÂåñÂπ∂ÂêëÊï¥‰∏™Á≥ªÁªüÊèê‰æõËøô‰∏™ÂÆû‰æã„ÄÇÈÄÇÁî®Âú∫Âêà‰∏ÄËà¨ÊòØÈúÄË¶ÅÈ¢ëÁπÅÂú∞ËøõË°åÂàõÂª∫ÂíåÈîÄÊØÅÁöÑÂØπË±°„ÄÇÂ¶ÇÂ∫îÁî®Á®ãÂ∫è‰∏≠ÁöÑÊï∞ÊçÆÂ∫ìËøûÊé•Ê±†„ÄÅÁ∫øÁ®ãÊ±†Á≠â„ÄÇÁ≥ªÁªüÂÜÖÂ≠ò‰∏≠ËØ•Á±ªÂè™Â≠òÂú®‰∏Ä‰∏™ÂØπË±°ÔºåËäÇÁúÅ‰∫ÜÁ≥ªÁªüËµÑÊ∫êÔºåÂØπ‰∫é‰∏Ä‰∫õÈúÄË¶ÅÈ¢ëÁπÅÂàõÂª∫ÈîÄÊØÅÁöÑÂØπË±°Ôºå‰ΩøÁî®Âçï‰æãÊ®°ÂºèÂèØ‰ª•ÊèêÈ´òÁ≥ªÁªüÊÄßËÉΩ„ÄÇÁî±‰∫éÂçï‰æãÊ®°ÂºèÂú®ÂÜÖÂ≠ò‰∏≠Âè™Êúâ‰∏Ä‰∏™ÂÆû‰æãÔºåÂáèÂ∞ë‰∫ÜÂÜÖÂ≠òÂºÄÈîÄ„ÄÇ Âçï‰æãÊ®°ÂºèÁöÑÂÜôÊ≥ïÊúâÂ•ΩÂá†ÁßçÔºåËøôÈáå‰∏ªË¶Å‰ªãÁªç‰∏âÁßçÔºöÊáíÊ±âÂºèÂçï‰æã„ÄÅÈ•øÊ±âÂºèÂçï‰æã„ÄÅÁôªËÆ∞ÂºèÂçï‰æã„ÄÇ 2. ÂÆûÁé∞ÊñπÊ≥ï‰∏ãÈù¢‰ª•javaÂÆûÁé∞‰∏∫‰æãÔºåÂ±ïÁ§∫Âá†ÁßçÂçï‰æãÊ®°ÂºèÁöÑÂÖ∑‰ΩìÂÆûÁé∞„ÄÇ 2.1 ÊáíÊ±âÂºèÂçï‰æã12345678910111213//ÊáíÊ±âÂºèÂçï‰æãÁ±ª.Âú®Á¨¨‰∏ÄÊ¨°Ë∞ÉÁî®ÁöÑÊó∂ÂÄôÂÆû‰æãÂåñËá™Â∑± public class Singleton &#123; private Singleton() &#123;&#125; private static Singleton single=null; //ÈùôÊÄÅÂ∑•ÂéÇÊñπÊ≥ï public static Singleton getInstance() &#123; if (single == null) &#123; single = new Singleton(); &#125; return single; &#125; //... &#125; ‰∏äËø∞Singleton‰ª£Á†ÅÈÄöËøáÂ∞ÜÊûÑÈÄ†ÊñπÊ≥ïÈôêÂÆö‰∏∫privateÈÅøÂÖç‰∫ÜÁ±ªÂú®Â§ñÈÉ®Ë¢´ÂÆû‰æãÂåñÔºåÂú®Âêå‰∏Ä‰∏™ËôöÊãüÊú∫ËåÉÂõ¥ÂÜÖÔºåSingletonÁöÑÂîØ‰∏ÄÂÆû‰æãÂè™ËÉΩÈÄöËøágetInstance()ÊñπÊ≥ïËÆøÈóÆ„ÄÇÔºà‰∫ãÂÆû‰∏äÔºåÈÄöËøáJavaÂèçÂ∞ÑÊú∫Âà∂ÊòØËÉΩÂ§üÂÆû‰æãÂåñÊûÑÈÄ†ÊñπÊ≥ï‰∏∫privateÁöÑÁ±ªÁöÑÔºåÈÇ£Âü∫Êú¨‰∏ä‰ºö‰ΩøÊâÄÊúâÁöÑJavaÂçï‰æãÂÆûÁé∞Â§±Êïà„ÄÇÊ≠§ÈóÆÈ¢òÂú®Ê≠§Â§Ñ‰∏çÂÅöËÆ®ËÆ∫ÔºåÂßë‰∏îÊé©ËÄ≥ÁõóÈìÉÂú∞ËÆ§‰∏∫ÂèçÂ∞ÑÊú∫Âà∂‰∏çÂ≠òÂú®„ÄÇÔºâ ‰ΩÜÊòØ‰ª•‰∏äÂÆûÁé∞Ê≤°ÊúâËÄÉËôëÁ∫øÁ®ãÂÆâÂÖ®ÈóÆÈ¢ò„ÄÇÊâÄË∞ìÁ∫øÁ®ãÂÆâÂÖ®ÊòØÊåáÔºöÂ¶ÇÊûú‰Ω†ÁöÑ‰ª£Á†ÅÊâÄÂú®ÁöÑËøõÁ®ã‰∏≠ÊúâÂ§ö‰∏™Á∫øÁ®ãÂú®ÂêåÊó∂ËøêË°åÔºåËÄåËøô‰∫õÁ∫øÁ®ãÂèØËÉΩ‰ºöÂêåÊó∂ËøêË°åËøôÊÆµ‰ª£Á†Å„ÄÇÂ¶ÇÊûúÊØèÊ¨°ËøêË°åÁªìÊûúÂíåÂçïÁ∫øÁ®ãËøêË°åÁöÑÁªìÊûúÊòØ‰∏ÄÊ†∑ÁöÑÔºåËÄå‰∏îÂÖ∂‰ªñÁöÑÂèòÈáèÁöÑÂÄº‰πüÂíåÈ¢ÑÊúüÁöÑÊòØ‰∏ÄÊ†∑ÁöÑÔºåÂ∞±ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑ„ÄÇÊàñËÄÖËØ¥Ôºö‰∏Ä‰∏™Á±ªÊàñËÄÖÁ®ãÂ∫èÊâÄÊèê‰æõÁöÑÊé•Âè£ÂØπ‰∫éÁ∫øÁ®ãÊù•ËØ¥ÊòØÂéüÂ≠êÊìç‰ΩúÊàñËÄÖÂ§ö‰∏™Á∫øÁ®ã‰πãÈó¥ÁöÑÂàáÊç¢‰∏ç‰ºöÂØºËá¥ËØ•Êé•Âè£ÁöÑÊâßË°åÁªìÊûúÂ≠òÂú®‰∫å‰πâÊÄß,‰πüÂ∞±ÊòØËØ¥Êàë‰ª¨‰∏çÁî®ËÄÉËôëÂêåÊ≠•ÁöÑÈóÆÈ¢ò„ÄÇÊòæÁÑ∂‰ª•‰∏äÂÆûÁé∞Âπ∂‰∏çÊª°Ë∂≥Á∫øÁ®ãÂÆâÂÖ®ÁöÑË¶ÅÊ±ÇÔºåÂú®Âπ∂ÂèëÁéØÂ¢É‰∏ãÂæàÂèØËÉΩÂá∫Áé∞Â§ö‰∏™SingletonÂÆû‰æã„ÄÇ ‰∏äËø∞ÁöÑÂÆûÁé∞ÁöÑÊñπÂºèÔºåÂ¶ÇÊûúÁé∞Âú®Â≠òÂú®ÁùÄÁ∫øÁ®ãAÂíåBÔºåÁ∫øÁ®ãAÊâßË°åÂà∞‰∫ÜIf(singleton == null);ÔºåÁ∫øÁ®ãBÊâßË°åÂà∞‰∫ÜSingleton = new Singleton();Á∫øÁ®ãBËôΩÁÑ∂ÂÆû‰æãÂåñ‰∫Ü‰∏Ä‰∏™SingletonÔºå‰ΩÜÊòØÂØπ‰∫éÁ∫øÁ®ãAÊù•ËØ¥Âà§Êñ≠singletonËøòÊòØÊú®ÊúâÂàùÂßãÂåñÁöÑÔºåÊâÄ‰ª•Á∫øÁ®ãAËøò‰ºöÂØπsingletonËøõË°åÂàùÂßãÂåñ„ÄÇ Ôºà1ÔºâÂú®getInstanceÊñπÊ≥ï‰∏äÂä†ÂêåÊ≠• 123456public static synchronized Singleton getInstance() &#123; if (single == null) &#123; single = new Singleton(); &#125; return single; &#125; ÂΩìÁ∫øÁ®ãBËÆøÈóÆËøô‰∏™ÂáΩÊï∞ÁöÑÊó∂ÂÄôÔºåÂÖ∂‰ªñÁöÑ‰ªª‰ΩïË¶ÅËÆøÈóÆËØ•ÂáΩÊï∞ÁöÑ‰ª£Á†Å‰∏çËÉΩÊâßË°åÔºåÁõ¥Âà∞Á∫øÁ®ãBÊâßË°åÂÆåËØ•ÂáΩÊï∞ÔºàËøôÊòØÂà©Áî®ÈîÅÂÆûÁé∞ÁöÑÔºâ„ÄÇ (2) ÂèåÈáçÊ£ÄÊü•ÈîÅÂÆöDCL synchronized‰ºº‰πéÂ∑≤ÁªèËß£ÂÜ≥‰∫ÜÂ§öÁ∫øÁ®ã‰∏ãÁöÑÈóÆÈ¢òÔºå‰ΩÜÂ§ö‰∏™Á∫øÁ®ãËÆøÈóÆÂêå‰∏Ä‰∏™ÂáΩÊï∞ÁöÑÊó∂ÂÄôÔºåÈÇ£‰πàÂè™ËÉΩÊúâ‰∏Ä‰∏™Á∫øÁ®ãËÉΩÂ§üËÆøÈóÆËøô‰∏™ÂáΩÊï∞ÔºåÊïàÁéáÂæà‰Ωé„ÄÇ 12345678910public static Singleton getInstance() &#123; if (singleton == null) &#123; synchronized (Singleton.class) &#123; if (singleton == null) &#123; singleton = new Singleton(); &#125; &#125; &#125; return singleton; &#125; ËøôÁßçÊñπÂºèÂ∞ÜÂú®ÊñπÊ≥ï‰∏äÁöÑÂ£∞ÊòéËΩ¨ÁßªÂà∞‰∫ÜÂÜÖÈÉ®ÁöÑ‰ª£Á†ÅÂùó‰∏≠ÔºåÂè™ÊúâÂΩìsingleton=nullÊó∂ÔºåÊâçÈúÄË¶ÅÈîÅÊú∫Âà∂Ôºå‰ΩÜÊòØÂ¶ÇÊûúÁ∫øÁ®ãAÂíåBÂêåÊó∂ÊâßË°åÂà∞‰∫ÜSynchronized(singleton.class)ÔºåËôΩÁÑ∂‰πüÊòØÂè™Êúâ‰∏Ä‰∏™Á∫øÁ®ãËÉΩÂ§üÊâßË°åÔºåÂÅáÂ¶ÇÁ∫øÁ®ãBÂÖàÊâßË°åÔºåÁ∫øÁ®ãBËé∑ÂæóÈîÅÔºåÁ∫øÁ®ãBÊâßË°åÂÆå‰πãÂêéÔºåÁ∫øÁ®ãAËé∑ÂæóÈîÅÔºåÊ≠§Êó∂Ê£ÄÊü•singletonÊòØÂê¶‰∏∫Á©∫ÂÜçÊâßË°åÔºåÊâÄ‰ª•‰∏ç‰ºöÂá∫Áé∞‰∏§‰∏™singletonÂÆû‰æãÁöÑÊÉÖÂÜµ„ÄÇ (3) ÈùôÊÄÅÂÜÖÈÉ®Á±ª ÂÖ≥‰∫éÂÜÖÈÉ®Á±ªÔºö ÂÜÖÈÉ®Á±ªÈÉΩÊòØÂú®Á¨¨‰∏ÄÊ¨°‰ΩøÁî®Êó∂Êâç‰ºöË¢´Âä†ËΩΩ„ÄÇÂ§ñÈÉ®Á±ª‰∏çË∞ÉÁî® getInstanceÔºàÔºâÊó∂ÂÄô ÂÜÖÈÉ®Á±ªÊòØ‰∏ç‰ºöÂä†ËΩΩÁöÑÔºåÊâÄ‰ª•ËææÂà∞‰∫ÜÊáíÊ±âÁöÑÊïàÊûú„ÄÇÁÑ∂ÂêéË∞ÉÁî®ÁöÑÊó∂ÂÄô ÂÜÖÈÉ®Á±ªË¢´Âä†ËΩΩÔºåÂä†ËΩΩÁöÑÊó∂ÂÄôÂ∞±‰ºöÂàùÂßãÂåñÂÆû‰æãÔºõËøô‰∏™Âä†ËΩΩÁöÑËøáÁ®ãÊòØ‰∏ç‰ºöÊúâÂ§öÁ∫øÁ®ãÁöÑÈóÆÈ¢òÁöÑÔºÅÁ±ªÂä†ËΩΩÁöÑÊó∂ÂÄôÊúâ‰∏ÄÁßçÊú∫Âà∂Âè´ÂÅöÔºåÁºìÂ≠òÊú∫Âà∂ÔºõÁ¨¨‰∏ÄÊ¨°Âä†ËΩΩÊàêÂäü‰πãÂêé‰ºöË¢´ÁºìÂ≠òËµ∑Êù•ÔºõËÄå‰∏î‰∏ÄËà¨‰∏Ä‰∏™Á±ª‰∏ç‰ºöÂä†ËΩΩÂ§öÊ¨°„ÄÇ 123456789public class Singleton &#123; private static class LazyHolder &#123; private static final Singleton INSTANCE = new Singleton(); &#125; private Singleton ()&#123;&#125; public static final Singleton getInstance() &#123; return LazyHolder.INSTANCE; &#125; &#125; DCL‰ºòÁÇπÊòØËµÑÊ∫êÂà©Áî®ÁéáÈ´òÔºåÁ¨¨‰∏ÄÊ¨°ÊâßË°ågetInstanceÊó∂Âçï‰æãÂØπË±°ÊâçË¢´ÂÆû‰æãÂåñÔºåÊïàÁéáÈ´ò„ÄÇÁº∫ÁÇπÊòØÁ¨¨‰∏ÄÊ¨°Âä†ËΩΩÊó∂ÂèçÂ∫îÁ®çÊÖ¢‰∏Ä‰∫õÔºåÂú®È´òÂπ∂ÂèëÁéØÂ¢É‰∏ã‰πüÊúâ‰∏ÄÂÆöÁöÑÁº∫Èô∑„ÄÇÈùôÊÄÅÂÜÖÈÉ®Á±ªÂÆûÁé∞ÔºåÁ¨¨‰∏ÄÊ¨°Âä†ËΩΩSingletonÁ±ªÊó∂Âπ∂‰∏ç‰ºöÂàùÂßãÂåñsInstanceÔºåÂè™ÊúâÁ¨¨‰∏ÄÊ¨°Ë∞ÉÁî®getInstanceÊñπÊ≥ïÊó∂ËôöÊãüÊú∫Âä†ËΩΩSingletonHolder Âπ∂ÂàùÂßãÂåñsInstance ÔºåËøôÊ†∑‰∏ç‰ªÖËÉΩÁ°Æ‰øùÁ∫øÁ®ãÂÆâÂÖ®‰πüËÉΩ‰øùËØÅSingletonÁ±ªÁöÑÂîØ‰∏ÄÊÄßÔºåÊâÄ‰ª•Êé®Ëçê‰ΩøÁî®ÈùôÊÄÅÂÜÖÈÉ®Á±ªÂçï‰æãÊ®°Âºè„ÄÇ ‰ΩÜÊòØÂú®ÂèçÂ∫èÂàóÂåñÊó∂‰ºöÈáçÊñ∞ÂàõÂª∫ÂØπË±°ÔºåÂ∞Ü‰∏Ä‰∏™Âçï‰æãÂÆû‰æãÂØπË±°ÂÜôÂà∞Á£ÅÁõòÂÜçËØªÂõûÊù•Ôºå‰ªéËÄåËé∑Âæó‰∫Ü‰∏Ä‰∏™ÂÆû‰æã„ÄÇÂèçÂ∫èÂàóÂåñÊìç‰ΩúÊèê‰æõ‰∫ÜreadResolveÊñπÊ≥ïÔºåËøô‰∏™ÊñπÊ≥ïÂèØ‰ª•ËÆ©ÂºÄÂèë‰∫∫ÂëòÊéßÂà∂ÂØπË±°ÁöÑÂèçÂ∫èÂàóÂåñ„ÄÇÂú®‰∏äËø∞ÁöÑÂá†‰∏™ÊñπÊ≥ïÁ§∫‰æã‰∏≠Â¶ÇÊûúË¶ÅÊùúÁªùÂçï‰æãÂØπË±°Ë¢´ÂèçÂ∫èÂàóÂåñÊòØÈáçÊñ∞ÁîüÊàêÂØπË±°ÔºåÂ∞±ÂøÖÈ°ªÂä†ÂÖ•Â¶Ç‰∏ãÊñπÊ≥ïÔºö 123private Object readResolve() throws ObjectStreamException&#123; return singleton;&#125; 2.2 È•øÊ±âÂºèÂçï‰æã12345678public class Singleton &#123; private static Singleton instance = new Singleton(); private Singleton ()&#123; &#125; public static Singleton getInstance() &#123; return instance; &#125; &#125; Âú®Á±ªÂä†ËΩΩÊó∂Â∞±ÂÆåÊàê‰∫ÜÂàùÂßãÂåñÔºåÊâÄ‰ª•Á±ªÂä†ËΩΩËæÉÊÖ¢Ôºå‰ΩÜËé∑ÂèñÂØπË±°ÁöÑÈÄüÂ∫¶Âø´„ÄÇ ËøôÁßçÊñπÂºèÂü∫‰∫éÁ±ªÂä†ËΩΩÊú∫Âà∂ÈÅøÂÖç‰∫ÜÂ§öÁ∫øÁ®ãÁöÑÂêåÊ≠•ÈóÆÈ¢òÔºå‰ΩÜÊòØ‰πü‰∏çËÉΩÁ°ÆÂÆöÊúâÂÖ∂‰ªñÁöÑÊñπÂºèÔºàÊàñËÄÖÂÖ∂‰ªñÁöÑÈùôÊÄÅÊñπÊ≥ïÔºâÂØºËá¥Á±ªË£ÖËΩΩÔºåËøôÊó∂ÂÄôÂàùÂßãÂåñinstanceÊòæÁÑ∂Ê≤°ÊúâËææÂà∞ÊáíÂä†ËΩΩÁöÑÊïàÊûú„ÄÇ 2.3 ÁôªËÆ∞ÂºèÂçï‰æã123456789101112131415 //ÁôªËÆ∞ÂºèÂçï‰æãÁ±ªÔºåÂà©Áî®ÂÆπÂô®ÂÆûÁé∞ //Á±ª‰ººSpringÈáåÈù¢ÁöÑÊñπÊ≥ïÔºåÂ∞ÜÁ±ªÂêçÊ≥®ÂÜåÔºå‰∏ãÊ¨°‰ªéÈáåÈù¢Áõ¥Êé•Ëé∑Âèñ„ÄÇ public class SingletonManager &#123; private static Map&lt;String, Object&gt; objMap = new HashMap&lt;String,Object&gt;(); private Singleton() &#123; &#125; public static void registerService(String key, Objectinstance) &#123; if (!objMap.containsKey(key) ) &#123; objMap.put(key, instance) ; &#125; &#125; public static ObjectgetService(String key) &#123; return objMap.get(key) ; &#125;&#125; SingletonManagerÂ∞ÜÂ§öÁßçÁöÑÂçï‰æãÁ±ªÁªü‰∏ÄÁÆ°ÁêÜÔºåÂú®‰ΩøÁî®Êó∂Ê†πÊçÆkeyËé∑ÂèñÂØπË±°ÂØπÂ∫îÁ±ªÂûãÁöÑÂØπË±°„ÄÇËøôÁßçÊñπÂºè‰ΩøÂæóÊàë‰ª¨ÂèØ‰ª•ÁÆ°ÁêÜÂ§öÁßçÁ±ªÂûãÁöÑÂçï‰æãÔºåÂπ∂‰∏îÂú®‰ΩøÁî®Êó∂ÂèØ‰ª•ÈÄöËøáÁªü‰∏ÄÁöÑÊé•Âè£ËøõË°åËé∑ÂèñÊìç‰ΩúÔºåÈôç‰Ωé‰∫ÜÁî®Êà∑ÁöÑ‰ΩøÁî®ÊàêÊú¨Ôºå‰πüÂØπÁî®Êà∑ÈöêËóè‰∫ÜÂÖ∑‰ΩìÂÆûÁé∞ÔºåÈôç‰Ωé‰∫ÜËÄ¶ÂêàÂ∫¶„ÄÇËøôÁßç‰∏çÂ∏∏Áî®ÔºåÂÜÖÈÉ®ÂÆûÁé∞ËøòÊòØÁî®ÁöÑÈ•øÊ±âÂºèÂçï‰æãÔºåÂõ†‰∏∫ÂÖ∂‰∏≠ÁöÑstaticÊñπÊ≥ïÂùóÔºåÂÆÉÁöÑÂçï‰æãÂú®Á±ªË¢´Ë£ÖËΩΩÁöÑÊó∂ÂÄôÂ∞±Ë¢´ÂÆû‰æãÂåñ‰∫Ü„ÄÇ 3. ÊÄªÁªìÊú¨Êñá‰∏ªË¶ÅËÆ≤‰∫ÜÂçï‰æãÊ®°ÂºèÁöÑ‰∏âÁßçÊñπÂºèÔºåÂàÜÂà´ÊòØÊáíÊ±âÂçï‰æã„ÄÅÈ•øÊ±âÂçï‰æãÂíåÁôªËÆ∞ÂºèÂçï‰æã„ÄÇ ‰∏ªË¶ÅÁöÑ‰ΩøÁî®Âú∫ÊôØÔºö ÈúÄË¶ÅÈ¢ëÁπÅÁöÑËøõË°åÂàõÂª∫ÂíåÈîÄÊØÅÁöÑÂØπË±°Ôºõ ÂàõÂª∫ÂØπË±°Êó∂ËÄóÊó∂ËøáÂ§öÊàñËÄóË¥πËµÑÊ∫êËøáÂ§öÔºå‰ΩÜÂèàÁªèÂ∏∏Áî®Âà∞ÁöÑÂØπË±°Ôºõ Â∑•ÂÖ∑Á±ªÂØπË±°Ôºõ È¢ëÁπÅËÆøÈóÆÊï∞ÊçÆÂ∫ìÊàñÊñá‰ª∂ÁöÑÂØπË±°„ÄÇ È•øÊ±âÂçï‰æãÔºåÁ±ª‰∏ÄÊó¶Âä†ËΩΩÔºåÂ∞±ÊääÂçï‰æãÂàùÂßãÂåñÂÆåÊàêÔºå‰øùËØÅgetInstanceÁöÑÊó∂ÂÄôÔºåÂçï‰æãÊòØÂ∑≤ÁªèÂ≠òÂú®ÁöÑ‰∫Ü„ÄÇÈ•øÊ±âÂºèÂ§©ÁîüÂ∞±ÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÔºåÂèØ‰ª•Áõ¥Êé•Áî®‰∫éÂ§öÁ∫øÁ®ãËÄå‰∏ç‰ºöÂá∫Áé∞ÈóÆÈ¢ò„ÄÇ È•øÊ±âÂºèÂú®Á±ªÂàõÂª∫ÁöÑÂêåÊó∂Â∞±ÂÆû‰æãÂåñ‰∏Ä‰∏™ÈùôÊÄÅÂØπË±°Âá∫Êù•ÔºåÂç†ÊçÆ‰∏ÄÂÆöÁöÑÂÜÖÂ≠òÔºå‰ΩÜÊòØÂú®Á¨¨‰∏ÄÊ¨°Ë∞ÉÁî®Êó∂ÈÄüÂ∫¶‰πü‰ºöÊõ¥Âø´ÔºåÂõ†‰∏∫ÂÖ∂ËµÑÊ∫êÂ∑≤ÁªèÂàùÂßãÂåñÂÆåÊàê„ÄÇ ÊáíÊ±âÂçï‰æãÔºåÂè™ÊúâÂΩìË∞ÉÁî®getInstanceÁöÑÊó∂ÂÄôÔºåÊâç‰ºöÂéªÂàùÂßãÂåñËøô‰∏™Âçï‰æã„ÄÇÊòØÁ∫øÁ®ã‰∏çÂÆâÂÖ®ÁöÑÔºåÂú®È•øÊ±âÂçï‰æãÂÆûÁé∞ÁöÑÂü∫Á°Ä‰∏äÔºåÊúâ‰∏âÁßçÊñπÊ≥ïÂØπÂ§öÁ∫øÁ®ãÂÆâÂÖ®ËøõË°å‰∫ÜÂ§ÑÁêÜ„ÄÇÊáíÊ±âÂºè‰ºöÂª∂ËøüÂä†ËΩΩÔºåÂú®Á¨¨‰∏ÄÊ¨°‰ΩøÁî®ËØ•Âçï‰æãÁöÑÊó∂ÂÄôÊâç‰ºöÂÆû‰æãÂåñÂØπË±°Âá∫Êù•ÔºåÁ¨¨‰∏ÄÊ¨°Ë∞ÉÁî®Êó∂Ë¶ÅÂÅöÂàùÂßãÂåñÔºåÂ¶ÇÊûúË¶ÅÂÅöÁöÑÂ∑•‰ΩúÊØîËæÉÂ§öÔºåÊÄßËÉΩ‰∏ä‰ºöÊúâ‰∫õÂª∂ËøüÔºå‰πãÂêéÂ∞±ÂíåÈ•øÊ±âÂºè‰∏ÄÊ†∑‰∫Ü„ÄÇ ÂèÇËÄÉ JAVAËÆæËÆ°Ê®°Âºè‰πãÂçï‰æãÊ®°Âºè È´òÂπ∂Âèë‰∏ãÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÂçï‰æãÊ®°ÂºèÔºàÊúÄÂÖ®ÊúÄÁªèÂÖ∏Ôºâ]]></content>
      <categories>
        <category>ËÆæËÆ°Ê®°Âºè</category>
      </categories>
      <tags>
        <tag>ËÆæËÆ°Ê®°Âºè</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[23ÁßçËÆæËÆ°Ê®°ÂºèÊÄªËßà]]></title>
    <url>%2F2017%2F01%2F12%2FdesignPattern1%2F</url>
    <content type="text"><![CDATA[1. ËÆæËÆ°Ê®°ÂºèÂàÜÁ±ª ÂàõÂª∫ÂûãÊ®°ÂºèÔºåÂÖ±‰∫îÁßçÔºöÂ∑•ÂéÇÊñπÊ≥ïÊ®°Âºè„ÄÅÊäΩË±°Â∑•ÂéÇÊ®°Âºè„ÄÅÂçï‰æãÊ®°Âºè„ÄÅÂª∫ÈÄ†ËÄÖÊ®°Âºè„ÄÅÂéüÂûãÊ®°Âºè„ÄÇ ÁªìÊûÑÂûãÊ®°ÂºèÔºåÂÖ±‰∏ÉÁßçÔºöÈÄÇÈÖçÂô®Ê®°Âºè„ÄÅË£ÖÈ•∞Âô®Ê®°Âºè„ÄÅ‰ª£ÁêÜÊ®°Âºè„ÄÅÂ§ñËßÇÊ®°Âºè„ÄÅÊ°•Êé•Ê®°Âºè„ÄÅÁªÑÂêàÊ®°Âºè„ÄÅ‰∫´ÂÖÉÊ®°Âºè„ÄÇ Ë°å‰∏∫ÂûãÊ®°ÂºèÔºåÂÖ±ÂçÅ‰∏ÄÁßçÔºöÁ≠ñÁï•Ê®°Âºè„ÄÅÊ®°ÊùøÊñπÊ≥ïÊ®°Âºè„ÄÅËßÇÂØüËÄÖÊ®°Âºè„ÄÅËø≠‰ª£Â≠êÊ®°Âºè„ÄÅË¥£‰ªªÈìæÊ®°Âºè„ÄÅÂëΩ‰ª§Ê®°Âºè„ÄÅÂ§áÂøòÂΩïÊ®°Âºè„ÄÅÁä∂ÊÄÅÊ®°Âºè„ÄÅËÆøÈóÆËÄÖÊ®°Âºè„ÄÅ‰∏≠‰ªãËÄÖÊ®°Âºè„ÄÅËß£ÈáäÂô®Ê®°Âºè„ÄÇ ÂÖ∂‰ªñ‰∏§Á±ªÔºöÂπ∂ÂèëÂûãÊ®°ÂºèÂíåÁ∫øÁ®ãÊ±†Ê®°Âºè„ÄÇ ËøôËæπÂºïÁî®‰∏ãÁΩë‰∏äÁöÑËÆæËÆ°Ê®°ÂºèÂõæ„ÄÇ 2. ËÆæËÆ°Ê®°ÂºèÁöÑÂÖ≠Â§ßÂéüÂàô2.1 ÊÄªÂéüÂàôÊÄªÂéüÂàô‰∏∫ÂºÄÈó≠ÂéüÂàô„ÄÇÂØπÊâ©Â±ïÂºÄÊîæÔºåÂØπ‰øÆÊîπÂ∞ÅÈó≠„ÄÇÂú®Á®ãÂ∫èÈúÄË¶ÅËøõË°åÊãìÂ±ïÁöÑÊó∂ÂÄôÔºå‰∏çÁî®Âéª‰øÆÊîπÂéüÊúâÁöÑ‰ª£Á†ÅÔºåËÄåÊòØÊâ©Â±ïÂéüÊúâ‰ª£Á†ÅÔºåÂÆûÁé∞‰∏Ä‰∏™ÁÉ≠ÊèíÊãîÁöÑÊïàÊûú„ÄÇÊâÄ‰ª•‰∏ÄÂè•ËØùÊ¶ÇÊã¨Â∞±ÊòØÔºö‰∏∫‰∫Ü‰ΩøÁ®ãÂ∫èÁöÑÊâ©Â±ïÊÄßÂ•ΩÔºåÊòì‰∫éÁª¥Êä§ÂíåÂçáÁ∫ß„ÄÇÊÉ≥Ë¶ÅËææÂà∞ËøôÊ†∑ÁöÑÊïàÊûúÔºåÊàë‰ª¨ÈúÄË¶Å‰ΩøÁî®Êé•Âè£ÂíåÊäΩË±°Á±ªÁ≠âÔºåÂêéÈù¢ÁöÑÂÖ∑‰ΩìËÆæËÆ°‰∏≠Êàë‰ª¨‰ºöÊèêÂà∞ËøôÁÇπ„ÄÇ 2.2 Âçï‰∏ÄËÅåË¥£ÂéüÂàô‰∏çË¶ÅÂ≠òÂú®Â§ö‰∫é‰∏Ä‰∏™ÂØºËá¥Á±ªÂèòÊõ¥ÁöÑÂéüÂõ†Ôºå‰πüÂ∞±ÊòØËØ¥ÊØè‰∏™Á±ªÂ∫îËØ•ÂÆûÁé∞Âçï‰∏ÄÁöÑËÅåË¥£ÔºåÂê¶ÂàôÂ∞±Â∫îËØ•ÊääÁ±ªÊãÜÂàÜ„ÄÇ 2.3 ÈáåÊ∞èÊõøÊç¢ÂéüÂàôÈáåÊ∞èÊõøÊç¢ÂéüÂàôÔºàLiskov Substitution PrincipleÔºâÔºå‰ªª‰ΩïÂü∫Á±ªÂèØ‰ª•Âá∫Áé∞ÁöÑÂú∞ÊñπÔºåÂ≠êÁ±ª‰∏ÄÂÆöÂèØ‰ª•Âá∫Áé∞„ÄÇÈáåÊ∞èÊõøÊç¢ÂéüÂàôÊòØÁªßÊâøÂ§çÁî®ÁöÑÂü∫Áü≥ÔºåÂè™ÊúâÂΩìË°çÁîüÁ±ªÂèØ‰ª•ÊõøÊç¢Âü∫Á±ªÔºåËΩØ‰ª∂Âçï‰ΩçÁöÑÂäüËÉΩ‰∏çÂèóÂà∞ÂΩ±ÂìçÊó∂ÔºåÂü∫Á±ªÊâçËÉΩÁúüÊ≠£Ë¢´Â§çÁî®ÔºåËÄåË°çÁîüÁ±ª‰πüËÉΩÂ§üÂú®Âü∫Á±ªÁöÑÂü∫Á°Ä‰∏äÂ¢ûÂä†Êñ∞ÁöÑË°å‰∏∫„ÄÇÈáåÊ∞è‰ª£Êç¢ÂéüÂàôÊòØÂØπ‚ÄúÂºÄ-Èó≠‚ÄùÂéüÂàôÁöÑË°•ÂÖÖ„ÄÇÂÆûÁé∞‚ÄúÂºÄÈó≠‚ÄùÂéüÂàôÁöÑÂÖ≥ÈîÆÊ≠•È™§Â∞±ÊòØÊäΩË±°Âåñ„ÄÇËÄåÂü∫Á±ª‰∏éÂ≠êÁ±ªÁöÑÁªßÊâøÂÖ≥Á≥ªÂ∞±ÊòØÊäΩË±°ÂåñÁöÑÂÖ∑‰ΩìÂÆûÁé∞ÔºåÊâÄ‰ª•ÈáåÊ∞è‰ª£Êç¢ÂéüÂàôÊòØÂØπÂÆûÁé∞ÊäΩË±°ÂåñÁöÑÂÖ∑‰ΩìÊ≠•È™§ÁöÑËßÑËåÉ„ÄÇÈáåÊ∞èÊõøÊç¢ÂéüÂàô‰∏≠ÔºåÂ≠êÁ±ªÂØπÁà∂Á±ªÁöÑÊñπÊ≥ïÂ∞ΩÈáè‰∏çË¶ÅÈáçÂÜôÂíåÈáçËΩΩ„ÄÇÂõ†‰∏∫Áà∂Á±ª‰ª£Ë°®‰∫ÜÂÆö‰πâÂ•ΩÁöÑÁªìÊûÑÔºåÈÄöËøáËøô‰∏™ËßÑËåÉÁöÑÊé•Âè£‰∏éÂ§ñÁïå‰∫§‰∫íÔºåÂ≠êÁ±ª‰∏çÂ∫îËØ•Èöè‰æøÁ†¥ÂùèÂÆÉ„ÄÇ 2.4 ‰æùËµñÂÄíËΩ¨ÂéüÂàô‰æùËµñÂÄíËΩ¨ÂéüÂàôÔºàDependence Inversion PrincipleÔºâÔºåÈù¢ÂêëÊé•Âè£ÁºñÁ®ãÔºå‰æùËµñ‰∫éÊäΩË±°ËÄå‰∏ç‰æùËµñ‰∫éÂÖ∑‰Ωì„ÄÇÂÜô‰ª£Á†ÅÊó∂Áî®Âà∞ÂÖ∑‰ΩìÁ±ªÊó∂Ôºå‰∏ç‰∏éÂÖ∑‰ΩìÁ±ª‰∫§‰∫íÔºåËÄå‰∏éÂÖ∑‰ΩìÁ±ªÁöÑ‰∏äÂ±ÇÊé•Âè£‰∫§‰∫í„ÄÇ 2.5 Êé•Âè£ÈöîÁ¶ªÂéüÂàôÊé•Âè£ÈöîÁ¶ªÂéüÂàôÔºàInterface Segregation PrincipleÔºâÔºåÊØè‰∏™Êé•Âè£‰∏≠‰∏çÂ≠òÂú®Â≠êÁ±ªÁî®‰∏çÂà∞Âç¥ÂøÖÈ°ªÂÆûÁé∞ÁöÑÊñπÊ≥ïÔºåÂ¶ÇÊûú‰∏çÁÑ∂ÔºåÂ∞±Ë¶ÅÂ∞ÜÊé•Âè£ÊãÜÂàÜ„ÄÇ‰ΩøÁî®Â§ö‰∏™ÈöîÁ¶ªÁöÑÊé•Âè£ÔºåÊØî‰ΩøÁî®Âçï‰∏™Êé•Âè£ÔºàÂ§ö‰∏™Êé•Âè£ÊñπÊ≥ïÈõÜÂêàÂà∞‰∏Ä‰∏™ÁöÑÊé•Âè£ÔºâË¶ÅÂ•Ω„ÄÇ 2.6 Ëø™Á±≥ÁâπÊ≥ïÂàôËø™Á±≥ÁâπÊ≥ïÂàôÔºåÊúÄÂ∞ëÁü•ÈÅìÂéüÂàôÔºàDemeter PrincipleÔºâÔºå‰∏Ä‰∏™ÂÆû‰ΩìÂ∫îÂΩìÂ∞ΩÈáèÂ∞ëÁöÑ‰∏éÂÖ∂‰ªñÂÆû‰Ωì‰πãÈó¥ÂèëÁîüÁõ∏‰∫í‰ΩúÁî®Ôºå‰ΩøÂæóÁ≥ªÁªüÂäüËÉΩÊ®°ÂùóÁõ∏ÂØπÁã¨Á´ã„ÄÇÊó†ËÆ∫Ë¢´‰æùËµñÁöÑÁ±ªÂ§ö‰πàÂ§çÊùÇÔºåÈÉΩÂ∫îËØ•Â∞ÜÈÄªËæëÂ∞ÅË£ÖÂú®ÊñπÊ≥ïÁöÑÂÜÖÈÉ®ÔºåÈÄöËøápublicÊñπÊ≥ïÊèê‰æõÁªôÂ§ñÈÉ®„ÄÇËøôÊ†∑ÂΩìË¢´‰æùËµñÁöÑÁ±ªÂèòÂåñÊó∂ÔºåÊâçËÉΩÊúÄÂ∞èÁöÑÂΩ±ÂìçËØ•Á±ª„ÄÇÊúÄÂ∞ëÁü•ÈÅìÂéüÂàôÁöÑÂè¶‰∏Ä‰∏™Ë°®ËææÊñπÂºèÊòØÔºöÂè™‰∏éÁõ¥Êé•ÁöÑÊúãÂèãÈÄö‰ø°„ÄÇÁ±ª‰πãÈó¥Âè™Ë¶ÅÊúâËÄ¶ÂêàÂÖ≥Á≥ªÔºåÂ∞±Âè´ÊúãÂèãÂÖ≥Á≥ª„ÄÇËÄ¶ÂêàÂàÜ‰∏∫‰æùËµñ„ÄÅÂÖ≥ËÅî„ÄÅËÅöÂêà„ÄÅÁªÑÂêàÁ≠â„ÄÇÊàë‰ª¨Áß∞Âá∫Áé∞‰∏∫ÊàêÂëòÂèòÈáè„ÄÅÊñπÊ≥ïÂèÇÊï∞„ÄÅÊñπÊ≥ïËøîÂõûÂÄº‰∏≠ÁöÑÁ±ª‰∏∫Áõ¥Êé•ÊúãÂèã„ÄÇÂ±ÄÈÉ®ÂèòÈáè„ÄÅ‰∏¥Êó∂ÂèòÈáèÂàô‰∏çÊòØÁõ¥Êé•ÁöÑÊúãÂèã„ÄÇÊàë‰ª¨Ë¶ÅÊ±ÇÈôåÁîüÁöÑÁ±ª‰∏çË¶Å‰Ωú‰∏∫Â±ÄÈÉ®ÂèòÈáèÂá∫Áé∞Âú®Á±ª‰∏≠„ÄÇ 2.7 ÂêàÊàêÂ§çÁî®ÂéüÂàôÂêàÊàêÂ§çÁî®ÂéüÂàôÔºàComposite Reuse PrincipleÔºâÔºåÂ∞ΩÈáèÈ¶ñÂÖà‰ΩøÁî®ÂêàÊàê/ËÅöÂêàÁöÑÊñπÂºèÔºåËÄå‰∏çÊòØ‰ΩøÁî®ÁªßÊâø„ÄÇ 3 ÊÄªÁªìÊú¨Êñá‰∏ªË¶ÅÂÜô‰∫ÜËÆæËÆ°Ê®°ÂºèÁöÑÊÄªËßàÔºåÂØπ23ÁßçËÆæËÆ°Ê®°ÂºèËøõË°åÂàÜÁ±ªÔºåÂåÖÊã¨ÂàõÂª∫ÂûãÊ®°Âºè„ÄÅÁªìÊûÑÂûãÊ®°Âºè„ÄÅË°å‰∏∫ÂûãÊ®°Âºè‰ª•Âèä‰∏§ÁßçÂÖ∂‰ªñÊ®°Âºè„ÄÇÂÖ∂Ê¨°‰ªãÁªç‰∫ÜËÆæËÆ°Ê®°ÂºèÁöÑÂÖ≠Â§ßÂéüÂàô„ÄÇÂêéÈù¢ÊñáÁ´†Â∞ÜÊâ©Â±ï‰ªãÁªçÊØè‰∏ÄÁßçËÆæËÆ°Ê®°Âºè„ÄÇ ÂèÇËÄÉ1.23ÁßçËÆæËÆ°Ê®°ÂºèÂÖ®Ëß£Êûê]]></content>
      <categories>
        <category>ËÆæËÆ°Ê®°Âºè</category>
      </categories>
      <tags>
        <tag>ËÆæËÆ°Ê®°Âºè</tag>
      </tags>
  </entry>
</search>